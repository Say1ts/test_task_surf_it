INFO     2023-07-26 03:49:01.472 request id: app - logging:callHandlers - Started server process [17124]
INFO     2023-07-26 03:49:01.472 request id: app - logging:callHandlers - Started server process [17124]
INFO     2023-07-26 03:49:01.473 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 03:49:01.474 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 03:49:01.475 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 03:49:01.475 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 03:49:18.605 request id: app - logging:callHandlers - 127.0.0.1:59455 - "POST /ad/list HTTP/1.1" 500
ERROR    2023-07-26 03:49:18.607 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 324
               │     └ 3
               └ <function _main at 0x000001A18A68B4C0>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 324
           │    └ <function BaseProcess._bootstrap at 0x000001A18A5C1080>
           └ <SpawnProcess name='SpawnProcess-1' parent=21780 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001A18A5C05E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=21780 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001A18A651E10>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=21780 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=21780 started>
    │    └ <function subprocess_started at 0x000001A18C6A8540>
    └ <SpawnProcess name='SpawnProcess-1' parent=21780 started>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=728, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000001A18C7F3050>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=728, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x000001A18C68B740>
           │       │   └ <uvicorn.server.Server object at 0x000001A18C7F3050>
           │       └ <function run at 0x000001A18C03F6A0>
           └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000001A18C8008C0>
           │      └ <function Runner.run at 0x000001A18C03FB00>
           └ <asyncio.runners.Runner object at 0x000001A18C7D4B90>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000001A18C03D580>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000001A18C7D4B90>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001A18C03D4E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001A18C03F2E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001A18BFAF2E0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
> File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001A18C7FA610>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A18F...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000001A18C8F3B50>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001A18C7FA610>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\applications.py", line 289, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A18F...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A18F...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001A18FBFF8D0>
          └ <fastapi.applications.FastAPI object at 0x000001A18C8F3B50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001A18FD956C0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001A18C7FB8D0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001A18FBFF8D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000001A18FD95E40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x000001A18FAFFC10>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001A18C7FB8D0>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
          │    │   │      │    │      └ <traceback object at 0x000001A18FDCCEC0>
          │    │   │      │    └ Exception('Just Checking')
          │    │   │      └ <class 'Exception'>
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object get_db at 0x000001A18FD9DEE0>
          └ <contextlib._AsyncGeneratorContextManager object at 0x000001A18FDC27D0>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\db\connection.py", line 19, in get_db
    yield session
          └ <sqlalchemy.orm.session.AsyncSession object at 0x000001A18FAFFAD0>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000001A18FD95E40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x000001A18FCD9650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x000001A18FAFFC10>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000001A18FD95E40>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x000001A18EA2F4C0>
          └ APIRoute(path='/ad/list', name='list_ads', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000001A18FD95E40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x000001A18FD56F20>
          └ APIRoute(path='/ad/list', name='list_ads', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x000001A18FDC1B10>
                     └ <function get_request_handler.<locals>.app at 0x000001A18FD56FC0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 273, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x000001A18EA2D940>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 190, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x000001A18FAFFAD0>, 'query': AdListQuery(page=1, per_page=10, categori...
                 │         └ <function list_ads at 0x000001A18FC6F060>
                 └ <fastapi.dependencies.models.Dependant object at 0x000001A18FD6F690>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\routes.py", line 25, in list_ads
    raise Exception("Just Checking")

Exception: Just Checking
ERROR    2023-07-26 03:49:18.644 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 324
               │     └ 3
               └ <function _main at 0x000001A18A68B4C0>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 324
           │    └ <function BaseProcess._bootstrap at 0x000001A18A5C1080>
           └ <SpawnProcess name='SpawnProcess-1' parent=21780 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001A18A5C05E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=21780 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001A18A651E10>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=21780 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=21780 started>
    │    └ <function subprocess_started at 0x000001A18C6A8540>
    └ <SpawnProcess name='SpawnProcess-1' parent=21780 started>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=728, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000001A18C7F3050>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=728, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x000001A18C68B740>
           │       │   └ <uvicorn.server.Server object at 0x000001A18C7F3050>
           │       └ <function run at 0x000001A18C03F6A0>
           └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000001A18C8008C0>
           │      └ <function Runner.run at 0x000001A18C03FB00>
           └ <asyncio.runners.Runner object at 0x000001A18C7D4B90>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000001A18C03D580>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000001A18C7D4B90>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001A18C03D4E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001A18C03F2E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001A18BFAF2E0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
> File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001A18C7FA610>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A18F...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000001A18C8F3B50>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001A18C7FA610>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\applications.py", line 289, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A18F...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A18F...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001A18FBFF8D0>
          └ <fastapi.applications.FastAPI object at 0x000001A18C8F3B50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001A18FD956C0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001A18C7FB8D0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001A18FBFF8D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000001A18FD95E40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x000001A18FAFFC10>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001A18C7FB8D0>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
          │    │   │      │    │      └ <traceback object at 0x000001A18FDCCEC0>
          │    │   │      │    └ Exception('Just Checking')
          │    │   │      └ <class 'Exception'>
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object get_db at 0x000001A18FD9DEE0>
          └ <contextlib._AsyncGeneratorContextManager object at 0x000001A18FDC27D0>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\db\connection.py", line 19, in get_db
    yield session
          └ <sqlalchemy.orm.session.AsyncSession object at 0x000001A18FAFFAD0>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000001A18FD95E40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x000001A18FCD9650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x000001A18FAFFC10>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000001A18FD95E40>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x000001A18EA2F4C0>
          └ APIRoute(path='/ad/list', name='list_ads', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000001A18FD95E40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x000001A18FD56F20>
          └ APIRoute(path='/ad/list', name='list_ads', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x000001A18FDC1B10>
                     └ <function get_request_handler.<locals>.app at 0x000001A18FD56FC0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 273, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x000001A18EA2D940>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 190, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x000001A18FAFFAD0>, 'query': AdListQuery(page=1, per_page=10, categori...
                 │         └ <function list_ads at 0x000001A18FC6F060>
                 └ <fastapi.dependencies.models.Dependant object at 0x000001A18FD6F690>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\routes.py", line 25, in list_ads
    raise Exception("Just Checking")

Exception: Just Checking
INFO     2023-07-26 04:00:31.489 request id: app - logging:callHandlers - Started server process [25024]
INFO     2023-07-26 04:00:31.489 request id: app - logging:callHandlers - Started server process [25024]
INFO     2023-07-26 04:00:31.490 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 04:00:31.490 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 04:00:31.491 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 04:00:31.491 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 04:00:41.830 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 04:00:41.830 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 04:00:41.940 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 04:00:41.940 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 04:00:41.941 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 04:00:41.941 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 04:00:41.942 request id: app - logging:callHandlers - Finished server process [25024]
INFO     2023-07-26 04:00:41.942 request id: app - logging:callHandlers - Finished server process [25024]
INFO     2023-07-26 04:00:44.888 request id: app - logging:callHandlers - Started server process [18944]
INFO     2023-07-26 04:00:44.888 request id: app - logging:callHandlers - Started server process [18944]
INFO     2023-07-26 04:00:44.889 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 04:00:44.889 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 04:00:44.890 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 04:00:44.891 request id: app - logging:callHandlers - Application startup complete.
CRITICAL 2023-07-26 04:00:50.480 request id: None - db.connection:get_db - DataBase Error: Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127.0.0.1', 5432)
INFO     2023-07-26 04:00:50.481 request id: app - logging:callHandlers - 127.0.0.1:59612 - "POST /ad/list HTTP/1.1" 500
ERROR    2023-07-26 04:00:50.482 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 312
               │     └ 3
               └ <function _main at 0x000002B47581B4C0>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 312
           │    └ <function BaseProcess._bootstrap at 0x000002B475751080>
           └ <SpawnProcess name='SpawnProcess-1' parent=18404 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000002B4757505E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=18404 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000002B4757E1E10>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=18404 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=18404 started>
    │    └ <function subprocess_started at 0x000002B477838540>
    └ <SpawnProcess name='SpawnProcess-1' parent=18404 started>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=604, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000002B477983050>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=604, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x000002B47781B740>
           │       │   └ <uvicorn.server.Server object at 0x000002B477983050>
           │       └ <function run at 0x000002B4771CF6A0>
           └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000002B4779908C0>
           │      └ <function Runner.run at 0x000002B4771CFB00>
           └ <asyncio.runners.Runner object at 0x000002B477964B90>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000002B4771CD580>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000002B477964B90>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000002B4771CD4E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000002B4771CF2E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000002B47713F2E0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
> File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002B47798A610>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002B47A...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002B...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000002B47ADCFB50>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002B47798A610>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\applications.py", line 289, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002B47A...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002B...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002B47A...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002B...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000002B47AE8DB90>
          └ <fastapi.applications.FastAPI object at 0x000002B47ADCFB50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000002B47AF26520>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002B...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002B47ADCF0D0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000002B47AE8DB90>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002B47AF26480>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002B...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x000002B47AE98C10>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002B47ADCF0D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 25, in __call__
    raise dependency_exception
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\db\connection.py", line 22, in get_db
    yield session
          └ <sqlalchemy.orm.session.AsyncSession object at 0x000002B47AF393D0>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002B47AF26480>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002B...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x000002B477A9CA50>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x000002B47AE98C10>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002B47AF26480>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002B...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x000002B479BC34C0>
          └ APIRoute(path='/ad/list', name='list_ads', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002B47AF26480>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002B...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x000002B47AEF71A0>
          └ APIRoute(path='/ad/list', name='list_ads', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x000002B47AF5EFD0>
                     └ <function get_request_handler.<locals>.app at 0x000002B47AEF7240>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 273, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x000002B479BC1940>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 190, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x000002B47AF393D0>, 'query': AdListQuery(page=1, per_page=10, categori...
                 │         └ <function list_ads at 0x000002B47AE637E0>
                 └ <fastapi.dependencies.models.Dependant object at 0x000002B47AF09A10>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\routes.py", line 25, in list_ads
    return await services.list_ads(query, db)
                 │        │        │      └ <sqlalchemy.orm.session.AsyncSession object at 0x000002B47AF393D0>
                 │        │        └ AdListQuery(page=1, per_page=10, categories=[0], ad_type=0, sort='string', creation_time_interval=CreationTimeInterval(older_...
                 │        └ <function list_ads at 0x000002B47ACECC20>
                 └ <module 'ad.services' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\ad\\services.py'>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\services.py", line 29, in list_ads
    ads = await queries.list_ads(filter_conditions, start, end, query.sort, db)
                │       │        │                  │      │    │     │     └ <sqlalchemy.orm.session.AsyncSession object at 0x000002B47AF393D0>
                │       │        │                  │      │    │     └ 'string'
                │       │        │                  │      │    └ AdListQuery(page=1, per_page=10, categories=[0], ad_type=0, sort='string', creation_time_interval=CreationTimeInterval(older_...
                │       │        │                  │      └ 10
                │       │        │                  └ 0
                │       │        └ [<sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x000002B47AC945E0>, <sqlalchemy.sql.elements.BinaryExpression ob...
                │       └ <function list_ads at 0x000002B47AC77240>
                └ <module 'ad.queries' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\ad\\queries.py'>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\queries.py", line 29, in list_ads
    result = await db.execute(ads.slice(start, end))
                   │  │       │   │     │      └ 10
                   │  │       │   │     └ 0
                   │  │       │   └ <function GenerativeSelect.slice at 0x000002B47A11E980>
                   │  │       └ <sqlalchemy.sql.selectable.Select object at 0x000002B47ACE1710>
                   │  └ <function AsyncSession.execute at 0x000002B47A5F7B00>
                   └ <sqlalchemy.orm.session.AsyncSession object at 0x000002B47AF393D0>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 439, in execute
    result = await greenlet_spawn(
                   └ <function greenlet_spawn at 0x000002B479DB6020>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             │       │      │   └ <built-in function exc_info>
             │       │      └ <module 'sys' (built-in)>
             │       └ <method 'throw' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x000002B47ADCEB40 (otid=0x000002B479D1D230) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2246, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x000002B47A538900>
           └ <sqlalchemy.orm.session.Session object at 0x000002B47AE8D8D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2131, in _execute_internal
    conn = self._connection_for_bind(bind)
           │    │                    └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │    └ <function Session._connection_for_bind at 0x000002B47A538680>
           └ <sqlalchemy.orm.session.Session object at 0x000002B47AE8D8D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1998, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           │     │                    │       └ None
           │     │                    └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │     └ <function SessionTransaction._connection_for_bind at 0x000002B47A537060>
           └ <sqlalchemy.orm.session.SessionTransaction object at 0x000002B47AF428A0>
  File "<string>", line 2, in _connection_for_bind
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ (Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it), None)
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x000002B47AF428A0>
                └ <function SessionTransaction._connection_for_bind at 0x000002B47A536FC0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1123, in _connection_for_bind
    conn = bind.connect()
           │    └ <function Engine.connect at 0x000002B47A1B0D60>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3264, in connect
    return self._connection_cls(self)
           │    │               └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │    └ <class 'sqlalchemy.engine.base.Connection'>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 145, in __init__
    self._dbapi_connection = engine.raw_connection()
    │                        │      └ <function Engine.raw_connection at 0x000002B47A1B0E00>
    │                        └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
    └ <sqlalchemy.engine.base.Connection object at 0x000002B47AC8FE10>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3288, in raw_connection
    return self.pool.connect()
           │    │    └ <function Pool.connect at 0x000002B479E5CA40>
           │    └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002B47AE04650>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 452, in connect
    return _ConnectionFairy._checkout(self)
           │                │         └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002B47AE04650>
           │                └ <classmethod(<function _ConnectionFairy._checkout at 0x000002B479E5EAC0>)>
           └ <class 'sqlalchemy.pool.base._ConnectionFairy'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1267, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            │                 │        └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002B47AE04650>
            │                 └ <classmethod(<function _ConnectionRecord.checkout at 0x000002B479E5D620>)>
            └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 716, in checkout
    rec = pool._do_get()
          │    └ <function QueuePool._do_get at 0x000002B479E66200>
          └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002B47AE04650>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 169, in _do_get
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x000002B47AF51940>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 167, in _do_get
    return self._create_connection()
           │    └ <function Pool._create_connection at 0x000002B479E5C7C0>
           └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002B47AE04650>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 393, in _create_connection
    return _ConnectionRecord(self)
           │                 └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002B47AE04650>
           └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 678, in __init__
    self.__connect()
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x000002B47AE0FE70>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 902, in __connect
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x000002B47AF518C0>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 898, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
    │    │                               │    │               └ <sqlalchemy.pool.base._ConnectionRecord object at 0x000002B47AE0FE70>
    │    │                               │    └ <function create_engine.<locals>.connect at 0x000002B47ACEE840>
    │    │                               └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002B47AE04650>
    │    └ <member 'dbapi_connection' of '_ConnectionRecord' objects>
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x000002B47AE0FE70>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\create.py", line 637, in connect
    return dialect.connect(*cargs, **cparams)
           │       │        │        └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
           │       │        └ []
           │       └ <function DefaultDialect.connect at 0x000002B47A223E20>
           └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x000002B47ACF2E10>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 615, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)
           │    │            │        │        └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
           │    │            │        └ ()
           │    │            └ <function AsyncAdapt_asyncpg_dbapi.connect at 0x000002B47AB059E0>
           │    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi object at 0x000002B47AD91E50>
           └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x000002B47ACF2E10>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 916, in connect
    await_only(creator_fn(*arg, **kw)),
    │          │           │      └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
    │          │           └ ()
    │          └ <function connect at 0x000002B47AE22E80>
    └ <function await_only at 0x000002B479D318A0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object connect at 0x000002B47ADBE5A0>
           └ <_AsyncIoGreenlet object at 0x000002B47ADCEB40 (otid=0x000002B479D1D230) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object connect at 0x000002B47ADBE5A0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connection.py", line 2114, in connect
    return await connect_utils._connect(
                 │             └ <function _connect at 0x000002B47AE22A20>
                 └ <module 'asyncpg.connect_utils' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 1011, in _connect
    raise last_error or exceptions.TargetServerAttributeNotMatched(
          │             │          └ <class 'asyncpg.exceptions._base.TargetServerAttributeNotMatched'>
          │             └ <module 'asyncpg.exceptions' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\s...
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 982, in _connect
    conn = await _connect_addr(
                 └ <function _connect_addr at 0x000002B47AE22340>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 808, in _connect_addr
    return await __connect_addr(params, timeout, True, *args)
                 │              │       │               └ (('localhost', 5432), <_WindowsSelectorEventLoop running=True closed=False debug=False>, ConnectionConfiguration(command_time...
                 │              │       └ 60
                 │              └ ConnectionParameters(user='admin', password='<z5&+lLwlgB(]KV#', database='surf_it', ssl=<ssl.SSLContext object at 0x000002B47...
                 └ <function __connect_addr at 0x000002B47AE223E0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 860, in __connect_addr
    tr, pr = await compat.wait_for(connector, timeout=timeout)
                   │      │        │                  └ 60
                   │      │        └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
                   │      └ <function wait_for at 0x000002B47ADC0540>
                   └ <module 'asyncpg.compat' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site-...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\compat.py", line 60, in wait_for
    return await asyncio.wait_for(fut, timeout)
                 │       │        │    └ 60
                 │       │        └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
                 │       └ <function wait_for at 0x000002B4771C4180>
                 └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\tasks.py", line 479, in wait_for
    return fut.result()
           │   └ <method 'result' of '_asyncio.Task' objects>
           └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 719, in _create_ssl_connection
    tr, pr = await loop.create_connection(
                   │    └ <function BaseEventLoop.create_connection at 0x000002B4771CE480>
                   └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1081, in create_connection
    raise OSError('Multiple exceptions: {}'.format(

OSError: Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127.0.0.1', 5432)
ERROR    2023-07-26 04:00:50.801 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 312
               │     └ 3
               └ <function _main at 0x000002B47581B4C0>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 312
           │    └ <function BaseProcess._bootstrap at 0x000002B475751080>
           └ <SpawnProcess name='SpawnProcess-1' parent=18404 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000002B4757505E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=18404 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000002B4757E1E10>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=18404 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=18404 started>
    │    └ <function subprocess_started at 0x000002B477838540>
    └ <SpawnProcess name='SpawnProcess-1' parent=18404 started>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=604, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000002B477983050>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=604, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x000002B47781B740>
           │       │   └ <uvicorn.server.Server object at 0x000002B477983050>
           │       └ <function run at 0x000002B4771CF6A0>
           └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000002B4779908C0>
           │      └ <function Runner.run at 0x000002B4771CFB00>
           └ <asyncio.runners.Runner object at 0x000002B477964B90>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000002B4771CD580>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000002B477964B90>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000002B4771CD4E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000002B4771CF2E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000002B47713F2E0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
> File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002B47798A610>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002B47A...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002B...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000002B47ADCFB50>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002B47798A610>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\applications.py", line 289, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002B47A...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002B...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002B47A...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002B...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000002B47AE8DB90>
          └ <fastapi.applications.FastAPI object at 0x000002B47ADCFB50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000002B47AF26520>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002B...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002B47ADCF0D0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000002B47AE8DB90>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002B47AF26480>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002B...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x000002B47AE98C10>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002B47ADCF0D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 25, in __call__
    raise dependency_exception
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\db\connection.py", line 22, in get_db
    yield session
          └ <sqlalchemy.orm.session.AsyncSession object at 0x000002B47AF393D0>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002B47AF26480>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002B...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x000002B477A9CA50>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x000002B47AE98C10>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002B47AF26480>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002B...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x000002B479BC34C0>
          └ APIRoute(path='/ad/list', name='list_ads', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002B47AF26480>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002B...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x000002B47AEF71A0>
          └ APIRoute(path='/ad/list', name='list_ads', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x000002B47AF5EFD0>
                     └ <function get_request_handler.<locals>.app at 0x000002B47AEF7240>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 273, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x000002B479BC1940>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 190, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x000002B47AF393D0>, 'query': AdListQuery(page=1, per_page=10, categori...
                 │         └ <function list_ads at 0x000002B47AE637E0>
                 └ <fastapi.dependencies.models.Dependant object at 0x000002B47AF09A10>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\routes.py", line 25, in list_ads
    return await services.list_ads(query, db)
                 │        │        │      └ <sqlalchemy.orm.session.AsyncSession object at 0x000002B47AF393D0>
                 │        │        └ AdListQuery(page=1, per_page=10, categories=[0], ad_type=0, sort='string', creation_time_interval=CreationTimeInterval(older_...
                 │        └ <function list_ads at 0x000002B47ACECC20>
                 └ <module 'ad.services' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\ad\\services.py'>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\services.py", line 29, in list_ads
    ads = await queries.list_ads(filter_conditions, start, end, query.sort, db)
                │       │        │                  │      │    │     │     └ <sqlalchemy.orm.session.AsyncSession object at 0x000002B47AF393D0>
                │       │        │                  │      │    │     └ 'string'
                │       │        │                  │      │    └ AdListQuery(page=1, per_page=10, categories=[0], ad_type=0, sort='string', creation_time_interval=CreationTimeInterval(older_...
                │       │        │                  │      └ 10
                │       │        │                  └ 0
                │       │        └ [<sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x000002B47AC945E0>, <sqlalchemy.sql.elements.BinaryExpression ob...
                │       └ <function list_ads at 0x000002B47AC77240>
                └ <module 'ad.queries' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\ad\\queries.py'>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\queries.py", line 29, in list_ads
    result = await db.execute(ads.slice(start, end))
                   │  │       │   │     │      └ 10
                   │  │       │   │     └ 0
                   │  │       │   └ <function GenerativeSelect.slice at 0x000002B47A11E980>
                   │  │       └ <sqlalchemy.sql.selectable.Select object at 0x000002B47ACE1710>
                   │  └ <function AsyncSession.execute at 0x000002B47A5F7B00>
                   └ <sqlalchemy.orm.session.AsyncSession object at 0x000002B47AF393D0>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 439, in execute
    result = await greenlet_spawn(
                   └ <function greenlet_spawn at 0x000002B479DB6020>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             │       │      │   └ <built-in function exc_info>
             │       │      └ <module 'sys' (built-in)>
             │       └ <method 'throw' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x000002B47ADCEB40 (otid=0x000002B479D1D230) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2246, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x000002B47A538900>
           └ <sqlalchemy.orm.session.Session object at 0x000002B47AE8D8D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2131, in _execute_internal
    conn = self._connection_for_bind(bind)
           │    │                    └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │    └ <function Session._connection_for_bind at 0x000002B47A538680>
           └ <sqlalchemy.orm.session.Session object at 0x000002B47AE8D8D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1998, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           │     │                    │       └ None
           │     │                    └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │     └ <function SessionTransaction._connection_for_bind at 0x000002B47A537060>
           └ <sqlalchemy.orm.session.SessionTransaction object at 0x000002B47AF428A0>
  File "<string>", line 2, in _connection_for_bind
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ (Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it), None)
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x000002B47AF428A0>
                └ <function SessionTransaction._connection_for_bind at 0x000002B47A536FC0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1123, in _connection_for_bind
    conn = bind.connect()
           │    └ <function Engine.connect at 0x000002B47A1B0D60>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3264, in connect
    return self._connection_cls(self)
           │    │               └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │    └ <class 'sqlalchemy.engine.base.Connection'>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 145, in __init__
    self._dbapi_connection = engine.raw_connection()
    │                        │      └ <function Engine.raw_connection at 0x000002B47A1B0E00>
    │                        └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
    └ <sqlalchemy.engine.base.Connection object at 0x000002B47AC8FE10>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3288, in raw_connection
    return self.pool.connect()
           │    │    └ <function Pool.connect at 0x000002B479E5CA40>
           │    └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002B47AE04650>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 452, in connect
    return _ConnectionFairy._checkout(self)
           │                │         └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002B47AE04650>
           │                └ <classmethod(<function _ConnectionFairy._checkout at 0x000002B479E5EAC0>)>
           └ <class 'sqlalchemy.pool.base._ConnectionFairy'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1267, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            │                 │        └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002B47AE04650>
            │                 └ <classmethod(<function _ConnectionRecord.checkout at 0x000002B479E5D620>)>
            └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 716, in checkout
    rec = pool._do_get()
          │    └ <function QueuePool._do_get at 0x000002B479E66200>
          └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002B47AE04650>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 169, in _do_get
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x000002B47AF51940>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 167, in _do_get
    return self._create_connection()
           │    └ <function Pool._create_connection at 0x000002B479E5C7C0>
           └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002B47AE04650>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 393, in _create_connection
    return _ConnectionRecord(self)
           │                 └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002B47AE04650>
           └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 678, in __init__
    self.__connect()
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x000002B47AE0FE70>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 902, in __connect
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x000002B47AF518C0>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 898, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
    │    │                               │    │               └ <sqlalchemy.pool.base._ConnectionRecord object at 0x000002B47AE0FE70>
    │    │                               │    └ <function create_engine.<locals>.connect at 0x000002B47ACEE840>
    │    │                               └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002B47AE04650>
    │    └ <member 'dbapi_connection' of '_ConnectionRecord' objects>
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x000002B47AE0FE70>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\create.py", line 637, in connect
    return dialect.connect(*cargs, **cparams)
           │       │        │        └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
           │       │        └ []
           │       └ <function DefaultDialect.connect at 0x000002B47A223E20>
           └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x000002B47ACF2E10>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 615, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)
           │    │            │        │        └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
           │    │            │        └ ()
           │    │            └ <function AsyncAdapt_asyncpg_dbapi.connect at 0x000002B47AB059E0>
           │    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi object at 0x000002B47AD91E50>
           └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x000002B47ACF2E10>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 916, in connect
    await_only(creator_fn(*arg, **kw)),
    │          │           │      └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
    │          │           └ ()
    │          └ <function connect at 0x000002B47AE22E80>
    └ <function await_only at 0x000002B479D318A0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object connect at 0x000002B47ADBE5A0>
           └ <_AsyncIoGreenlet object at 0x000002B47ADCEB40 (otid=0x000002B479D1D230) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object connect at 0x000002B47ADBE5A0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connection.py", line 2114, in connect
    return await connect_utils._connect(
                 │             └ <function _connect at 0x000002B47AE22A20>
                 └ <module 'asyncpg.connect_utils' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 1011, in _connect
    raise last_error or exceptions.TargetServerAttributeNotMatched(
          │             │          └ <class 'asyncpg.exceptions._base.TargetServerAttributeNotMatched'>
          │             └ <module 'asyncpg.exceptions' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\s...
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 982, in _connect
    conn = await _connect_addr(
                 └ <function _connect_addr at 0x000002B47AE22340>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 808, in _connect_addr
    return await __connect_addr(params, timeout, True, *args)
                 │              │       │               └ (('localhost', 5432), <_WindowsSelectorEventLoop running=True closed=False debug=False>, ConnectionConfiguration(command_time...
                 │              │       └ 60
                 │              └ ConnectionParameters(user='admin', password='<z5&+lLwlgB(]KV#', database='surf_it', ssl=<ssl.SSLContext object at 0x000002B47...
                 └ <function __connect_addr at 0x000002B47AE223E0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 860, in __connect_addr
    tr, pr = await compat.wait_for(connector, timeout=timeout)
                   │      │        │                  └ 60
                   │      │        └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
                   │      └ <function wait_for at 0x000002B47ADC0540>
                   └ <module 'asyncpg.compat' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site-...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\compat.py", line 60, in wait_for
    return await asyncio.wait_for(fut, timeout)
                 │       │        │    └ 60
                 │       │        └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
                 │       └ <function wait_for at 0x000002B4771C4180>
                 └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\tasks.py", line 479, in wait_for
    return fut.result()
           │   └ <method 'result' of '_asyncio.Task' objects>
           └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 719, in _create_ssl_connection
    tr, pr = await loop.create_connection(
                   │    └ <function BaseEventLoop.create_connection at 0x000002B4771CE480>
                   └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1081, in create_connection
    raise OSError('Multiple exceptions: {}'.format(

OSError: Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127.0.0.1', 5432)
INFO     2023-07-26 05:24:40.927 request id: app - logging:callHandlers - 127.0.0.1:61144 - "GET /docs HTTP/1.1" 200
INFO     2023-07-26 05:24:41.247 request id: app - logging:callHandlers - 127.0.0.1:61144 - "GET /openapi.json HTTP/1.1" 200
INFO     2023-07-26 05:24:52.876 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 05:24:52.877 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 05:24:52.976 request id: app - logging:callHandlers - Waiting for connections to close. (CTRL+C to force quit)
INFO     2023-07-26 05:24:52.976 request id: app - logging:callHandlers - Waiting for connections to close. (CTRL+C to force quit)
INFO     2023-07-26 05:24:53.555 request id: app - logging:callHandlers - 127.0.0.1:61145 - "POST /auth/register HTTP/1.1" 201
INFO     2023-07-26 05:24:53.557 request id: app - logging:callHandlers - Waiting for background tasks to complete. (CTRL+C to force quit)
INFO     2023-07-26 05:24:53.559 request id: app - logging:callHandlers - Waiting for background tasks to complete. (CTRL+C to force quit)
INFO     2023-07-26 05:24:53.670 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 05:24:53.671 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 05:24:53.672 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 05:24:53.673 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 05:24:53.673 request id: app - logging:callHandlers - Finished server process [18944]
INFO     2023-07-26 05:24:53.674 request id: app - logging:callHandlers - Finished server process [18944]
INFO     2023-07-26 05:24:56.775 request id: app - logging:callHandlers - Started server process [19104]
INFO     2023-07-26 05:24:56.775 request id: app - logging:callHandlers - Started server process [19104]
INFO     2023-07-26 05:24:56.776 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 05:24:56.776 request id: app - logging:callHandlers - Waiting for application startup.
ERROR    2023-07-26 05:24:56.781 request id: app - logging:callHandlers - Traceback (most recent call last):
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 650, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 78, in serve
    await self.startup(sockets=sockets)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 89, in startup
    await self.lifespan.startup()
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\lifespan\on.py", line 56, in startup
    await self.startup_event.wait()
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\locks.py", line 213, in wait
    await fut
asyncio.exceptions.CancelledError

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 123, in run
    raise KeyboardInterrupt()
KeyboardInterrupt

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 686, in lifespan
    await receive()
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\lifespan\on.py", line 139, in receive
    return await self.receive_queue.get()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\queues.py", line 158, in get
    await getter
asyncio.exceptions.CancelledError

ERROR    2023-07-26 05:24:56.781 request id: app - logging:callHandlers - Traceback (most recent call last):
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 650, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 78, in serve
    await self.startup(sockets=sockets)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 89, in startup
    await self.lifespan.startup()
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\lifespan\on.py", line 56, in startup
    await self.startup_event.wait()
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\locks.py", line 213, in wait
    await fut
asyncio.exceptions.CancelledError

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 123, in run
    raise KeyboardInterrupt()
KeyboardInterrupt

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 686, in lifespan
    await receive()
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\lifespan\on.py", line 139, in receive
    return await self.receive_queue.get()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\queues.py", line 158, in get
    await getter
asyncio.exceptions.CancelledError

INFO     2023-07-26 05:24:59.326 request id: app - logging:callHandlers - Started server process [16808]
INFO     2023-07-26 05:24:59.327 request id: app - logging:callHandlers - Started server process [16808]
INFO     2023-07-26 05:24:59.328 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 05:24:59.329 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 05:24:59.329 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 05:24:59.330 request id: app - logging:callHandlers - Application startup complete.
CRITICAL 2023-07-26 05:25:11.332 request id: None - db.connection:get_db - DataBase Error: 
INFO     2023-07-26 05:25:11.340 request id: app - logging:callHandlers - 127.0.0.1:61157 - "POST /auth/register HTTP/1.1" 400
INFO     2023-07-26 05:25:57.358 request id: app - logging:callHandlers - 127.0.0.1:61170 - "POST /auth/jwt/login HTTP/1.1" 204
CRITICAL 2023-07-26 05:26:17.600 request id: None - db.connection:get_db - DataBase Error: 
INFO     2023-07-26 05:26:17.605 request id: app - logging:callHandlers - 127.0.0.1:61175 - "GET /ad/5/get/ HTTP/1.1" 404
CRITICAL 2023-07-26 05:26:21.154 request id: None - db.connection:get_db - DataBase Error: 
INFO     2023-07-26 05:26:21.162 request id: app - logging:callHandlers - 127.0.0.1:61175 - "GET /ad/8/get/ HTTP/1.1" 404
CRITICAL 2023-07-26 05:26:21.453 request id: None - db.connection:get_db - DataBase Error: 
INFO     2023-07-26 05:26:21.457 request id: app - logging:callHandlers - 127.0.0.1:61175 - "GET /ad/8/get/ HTTP/1.1" 404
CRITICAL 2023-07-26 05:26:24.432 request id: None - db.connection:get_db - DataBase Error: 
INFO     2023-07-26 05:26:24.436 request id: app - logging:callHandlers - 127.0.0.1:61175 - "GET /ad/10/get/ HTTP/1.1" 404
INFO     2023-07-26 05:26:31.692 request id: app - logging:callHandlers - 127.0.0.1:61181 - "GET /ad/3/get/ HTTP/1.1" 200
CRITICAL 2023-07-26 05:26:54.467 request id: None - db.connection:get_db - DataBase Error: SQL expression element or literal value expected, got <db.models.User object at 0x000001DE2CE8CC50>.
INFO     2023-07-26 05:26:54.481 request id: app - logging:callHandlers - 127.0.0.1:61182 - "POST /ad/ad_id%7D/edit?ad_id=3 HTTP/1.1" 500
ERROR    2023-07-26 05:26:54.482 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\coercions.py", line 811, in _literal_coercion
    return expr._bind_param(operator, element, type_=bindparam_type)
           │    │           │         │              └ None
           │    │           │         └ <db.models.User object at 0x000001DE2CE8CC50>
           │    │           └ <built-in function eq>
           │    └ <function NamedColumn._bind_param at 0x000001DE2B542E80>
           └ Column('id', Integer(), table=<user>, primary_key=True, nullable=False)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 4478, in _bind_param
    return BindParameter(
           └ <class 'sqlalchemy.sql.elements.BindParameter'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 2050, in __init__
    self.type = _compared_to_type.coerce_compared_value(
    │    │      │                 └ <function TypeEngine.coerce_compared_value at 0x000001DE2B525120>
    │    │      └ Integer()
    │    └ NullType()
    └ BindParameter('%(2053747787088 id)s', <db.models.User object at 0x000001DE2CE8CC50>, type_=NullType())
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\type_api.py", line 1085, in coerce_compared_value
    _coerced_type = _resolve_value_to_type(value)
                    │                      └ <db.models.User object at 0x000001DE2CE8CC50>
                    └ <function _resolve_value_to_type at 0x000001DE2B5C0400>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\sqltypes.py", line 3826, in _resolve_value_to_type
    raise exc.ArgumentError(
          │   └ <class 'sqlalchemy.exc.ArgumentError'>
          └ <module 'sqlalchemy.exc' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site-...

sqlalchemy.exc.ArgumentError: Object <db.models.User object at 0x000001DE2CE8CC50> is not legal as a SQL literal value


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 312
               │     └ 3
               └ <function _main at 0x000001DE26CCF4C0>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 312
           │    └ <function BaseProcess._bootstrap at 0x000001DE26C05080>
           └ <SpawnProcess name='SpawnProcess-3' parent=18404 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001DE26C045E0>
    └ <SpawnProcess name='SpawnProcess-3' parent=18404 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001DE26C6E610>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-3' parent=18404 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-3' parent=18404 started>
    │    └ <function subprocess_started at 0x000001DE28CE8540>
    └ <SpawnProcess name='SpawnProcess-3' parent=18404 started>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=472, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000001DE28E33290>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=472, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x000001DE28CCB740>
           │       │   └ <uvicorn.server.Server object at 0x000001DE28E33290>
           │       └ <function run at 0x000001DE286836A0>
           └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000001DE28E408C0>
           │      └ <function Runner.run at 0x000001DE28683B00>
           └ <asyncio.runners.Runner object at 0x000001DE28E33710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000001DE28681580>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000001DE28E33710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001DE286814E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001DE286832E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001DE285EF2E0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
> File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001DE28E3E7D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001DE2C...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001D...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000001DE28F59610>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001DE28E3E7D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\applications.py", line 289, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001DE2C...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001D...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001DE2C...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001D...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001DE2CBD4150>
          └ <fastapi.applications.FastAPI object at 0x000001DE28F59610>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001DE2CB83920>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001D...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001DE2CBAEC50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001DE2CBD4150>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000001DE2CC0B4C0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001D...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x000001DE2CC7DC10>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001DE2CBAEC50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 25, in __call__
    raise dependency_exception
          └ ArgumentError('SQL expression element or literal value expected, got <db.models.User object at 0x000001DE2CE8CC50>.')

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\db\connection.py", line 22, in get_db
    yield session
          └ <sqlalchemy.orm.session.AsyncSession object at 0x000001DE2CE69B90>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000001DE2CC0B4C0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001D...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x000001DE2C465290>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x000001DE2CC7DC10>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000001DE2CC0B4C0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001D...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x000001DE2B0734C0>
          └ APIRoute(path='/ad/ad_id}/edit', name='edit_ad', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000001DE2CC0B4C0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001D...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x000001DE2CC60A40>
          └ APIRoute(path='/ad/ad_id}/edit', name='edit_ad', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x000001DE2CE850D0>
                     └ <function get_request_handler.<locals>.app at 0x000001DE2CC609A0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 273, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x000001DE2B071940>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 190, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x000001DE2CE69B90>, 'user': <db.models.User object at 0x000001DE2CE8CC...
                 │         └ <function edit_ad at 0x000001DE2CB90FE0>
                 └ <fastapi.dependencies.models.Dependant object at 0x000001DE2CC11F50>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\routes.py", line 35, in edit_ad
    return await services.edit_ad(ad_id, user, ad_data, db)
                 │        │       │      │     │        └ <sqlalchemy.orm.session.AsyncSession object at 0x000001DE2CE69B90>
                 │        │       │      │     └ AdBase(type_id=1, title='New ad', category_id=0, content='string', is_published=True, owner=3, price=1000.0, created_at=datet...
                 │        │       │      └ <db.models.User object at 0x000001DE2CE8CC50>
                 │        │       └ 3
                 │        └ <function edit_ad at 0x000001DE2C1A0A40>
                 └ <module 'ad.services' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\ad\\services.py'>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\services.py", line 61, in edit_ad
    if user.id == ad.owner or await queries.is_user_has_permission(user, "edit_ads", db):
       │    │     │  │              │       │                      │                 └ <sqlalchemy.orm.session.AsyncSession object at 0x000001DE2CE69B90>
       │    │     │  │              │       │                      └ <db.models.User object at 0x000001DE2CE8CC50>
       │    │     │  │              │       └ <function is_user_has_permission at 0x000001DE2C1A0540>
       │    │     │  │              └ <module 'ad.queries' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\ad\\queries.py'>
       │    │     │  └ <sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x000001DE2C150400>
       │    │     └ <db.models.Ad object at 0x000001DE2CE8DA90>
       │    └ <sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x000001DE2C174A40>
       └ <db.models.User object at 0x000001DE2CE8CC50>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\queries.py", line 105, in is_user_has_permission
    stmt = select(User).where(User.id == user_id)
           │      │           │    │     └ <db.models.User object at 0x000001DE2CE8CC50>
           │      │           │    └ <sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x000001DE2C174A40>
           │      │           └ <class 'db.models.User'>
           │      └ <class 'db.models.User'>
           └ <function select at 0x000001DE2B6254E0>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\operators.py", line 582, in __eq__
    return self.operate(eq, other)
           │    │       │   └ <db.models.User object at 0x000001DE2CE8CC50>
           │    │       └ <built-in function eq>
           │    └ <function QueryableAttribute.operate at 0x000001DE2B80B560>
           └ <sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x000001DE2C174A40>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 450, in operate
    return op(self.comparator, *other, **kwargs)  # type: ignore[return-value,no-any-return]  # noqa: E501
           │  │    │            │        └ {}
           │  │    │            └ (<db.models.User object at 0x000001DE2CE8CC50>,)
           │  │    └ <member 'comparator' of 'QueryableAttribute' objects>
           │  └ <sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x000001DE2C174A40>
           └ <built-in function eq>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\operators.py", line 582, in __eq__
    return self.operate(eq, other)
           │    │       │   └ <db.models.User object at 0x000001DE2CE8CC50>
           │    │       └ <built-in function eq>
           │    └ <function ColumnProperty.Comparator.operate at 0x000001DE2B915440>
           └ <sqlalchemy.orm.properties.ColumnProperty.Comparator object at 0x000001DE2C178AE0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\properties.py", line 478, in operate
    return op(self.__clause_element__(), *other, **kwargs)  # type: ignore[return-value,no-any-return]  # noqa: E501
           │  │    │                      │        └ {}
           │  │    │                      └ (<db.models.User object at 0x000001DE2CE8CC50>,)
           │  │    └ <member '__clause_element__' of 'Comparator' objects>
           │  └ <sqlalchemy.orm.properties.ColumnProperty.Comparator object at 0x000001DE2C178AE0>
           └ <built-in function eq>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\annotation.py", line 378, in __eq__
    return self.__element.__class__.__eq__(self, other)
           │                               │     └ <db.models.User object at 0x000001DE2CE8CC50>
           │                               └ Column('id', Integer(), table=<user>, primary_key=True, nullable=False)
           └ Column('id', Integer(), table=<user>, primary_key=True, nullable=False)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\operators.py", line 582, in __eq__
    return self.operate(eq, other)
           │    │       │   └ <db.models.User object at 0x000001DE2CE8CC50>
           │    │       └ <built-in function eq>
           │    └ <function ColumnElement.operate at 0x000001DE2B5299E0>
           └ Column('id', Integer(), table=<user>, primary_key=True, nullable=False)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 1538, in operate
    return op(self.comparator, *other, **kwargs)  # type: ignore[return-value,no-any-return]  # noqa: E501
           │  │    │            │        └ {}
           │  │    │            └ (<db.models.User object at 0x000001DE2CE8CC50>,)
           │  │    └ <sqlalchemy.sql.sqltypes.HasExpressionLookup.Comparator object at 0x000001DE2CD05810>
           │  └ Column('id', Integer(), table=<user>, primary_key=True, nullable=False)
           └ <built-in function eq>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\operators.py", line 582, in __eq__
    return self.operate(eq, other)
           │    │       │   └ <db.models.User object at 0x000001DE2CE8CC50>
           │    │       └ <built-in function eq>
           │    └ <function TypeEngine.Comparator.operate at 0x000001DE2B493740>
           └ <sqlalchemy.sql.sqltypes.HasExpressionLookup.Comparator object at 0x000001DE2CD05810>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\type_api.py", line 194, in operate
    return op_fn(self.expr, op, *other, **addtl_kw)  # type: ignore
           │     │    │     │    │        └ immutabledict({'negate_op': <built-in function ne>})
           │     │    │     │    └ (<db.models.User object at 0x000001DE2CE8CC50>,)
           │     │    │     └ <built-in function eq>
           │     │    └ <member 'expr' of 'Comparator' objects>
           │     └ <sqlalchemy.sql.sqltypes.HasExpressionLookup.Comparator object at 0x000001DE2CD05810>
           └ <function _boolean_compare at 0x000001DE2B5E5B20>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\default_comparator.py", line 122, in _boolean_compare
    obj = coercions.expect(
          │         └ <function expect at 0x000001DE2B40A660>
          └ <module 'sqlalchemy.sql.coercions' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\coercions.py", line 413, in expect
    resolved = impl._literal_coercion(
               │    └ <function BinaryElementImpl._literal_coercion at 0x000001DE2B40B740>
               └ <sqlalchemy.sql.coercions.BinaryElementImpl object at 0x000001DE2B456280>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\coercions.py", line 813, in _literal_coercion
    self._raise_for_expected(element, err=err)
    │    │                   └ <db.models.User object at 0x000001DE2CE8CC50>
    │    └ <function ExpressionElementImpl._raise_for_expected at 0x000001DE2B40B600>
    └ <sqlalchemy.sql.coercions.BinaryElementImpl object at 0x000001DE2B456280>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\coercions.py", line 799, in _raise_for_expected
    return super()._raise_for_expected(
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\coercions.py", line 535, in _raise_for_expected
    raise exc.ArgumentError(msg, code=code) from err
          │   │             │         │          └ ArgumentError('Object <db.models.User object at 0x000001DE2CE8CC50> is not legal as a SQL literal value')
          │   │             │         └ None
          │   │             └ 'SQL expression element or literal value expected, got <db.models.User object at 0x000001DE2CE8CC50>.'
          │   └ <class 'sqlalchemy.exc.ArgumentError'>
          └ <module 'sqlalchemy.exc' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site-...

sqlalchemy.exc.ArgumentError: SQL expression element or literal value expected, got <db.models.User object at 0x000001DE2CE8CC50>.
ERROR    2023-07-26 05:26:54.515 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\coercions.py", line 811, in _literal_coercion
    return expr._bind_param(operator, element, type_=bindparam_type)
           │    │           │         │              └ None
           │    │           │         └ <db.models.User object at 0x000001DE2CE8CC50>
           │    │           └ <built-in function eq>
           │    └ <function NamedColumn._bind_param at 0x000001DE2B542E80>
           └ Column('id', Integer(), table=<user>, primary_key=True, nullable=False)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 4478, in _bind_param
    return BindParameter(
           └ <class 'sqlalchemy.sql.elements.BindParameter'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 2050, in __init__
    self.type = _compared_to_type.coerce_compared_value(
    │    │      │                 └ <function TypeEngine.coerce_compared_value at 0x000001DE2B525120>
    │    │      └ Integer()
    │    └ NullType()
    └ BindParameter('%(2053747787088 id)s', <db.models.User object at 0x000001DE2CE8CC50>, type_=NullType())
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\type_api.py", line 1085, in coerce_compared_value
    _coerced_type = _resolve_value_to_type(value)
                    │                      └ <db.models.User object at 0x000001DE2CE8CC50>
                    └ <function _resolve_value_to_type at 0x000001DE2B5C0400>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\sqltypes.py", line 3826, in _resolve_value_to_type
    raise exc.ArgumentError(
          │   └ <class 'sqlalchemy.exc.ArgumentError'>
          └ <module 'sqlalchemy.exc' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site-...

sqlalchemy.exc.ArgumentError: Object <db.models.User object at 0x000001DE2CE8CC50> is not legal as a SQL literal value


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 312
               │     └ 3
               └ <function _main at 0x000001DE26CCF4C0>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 312
           │    └ <function BaseProcess._bootstrap at 0x000001DE26C05080>
           └ <SpawnProcess name='SpawnProcess-3' parent=18404 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001DE26C045E0>
    └ <SpawnProcess name='SpawnProcess-3' parent=18404 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001DE26C6E610>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-3' parent=18404 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-3' parent=18404 started>
    │    └ <function subprocess_started at 0x000001DE28CE8540>
    └ <SpawnProcess name='SpawnProcess-3' parent=18404 started>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=472, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000001DE28E33290>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=472, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x000001DE28CCB740>
           │       │   └ <uvicorn.server.Server object at 0x000001DE28E33290>
           │       └ <function run at 0x000001DE286836A0>
           └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000001DE28E408C0>
           │      └ <function Runner.run at 0x000001DE28683B00>
           └ <asyncio.runners.Runner object at 0x000001DE28E33710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000001DE28681580>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000001DE28E33710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001DE286814E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001DE286832E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001DE285EF2E0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
> File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001DE28E3E7D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001DE2C...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001D...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000001DE28F59610>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001DE28E3E7D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\applications.py", line 289, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001DE2C...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001D...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001DE2C...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001D...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001DE2CBD4150>
          └ <fastapi.applications.FastAPI object at 0x000001DE28F59610>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001DE2CB83920>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001D...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001DE2CBAEC50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001DE2CBD4150>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000001DE2CC0B4C0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001D...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x000001DE2CC7DC10>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001DE2CBAEC50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 25, in __call__
    raise dependency_exception
          └ ArgumentError('SQL expression element or literal value expected, got <db.models.User object at 0x000001DE2CE8CC50>.')

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\db\connection.py", line 22, in get_db
    yield session
          └ <sqlalchemy.orm.session.AsyncSession object at 0x000001DE2CE69B90>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000001DE2CC0B4C0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001D...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x000001DE2C465290>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x000001DE2CC7DC10>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000001DE2CC0B4C0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001D...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x000001DE2B0734C0>
          └ APIRoute(path='/ad/ad_id}/edit', name='edit_ad', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000001DE2CC0B4C0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001D...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x000001DE2CC60A40>
          └ APIRoute(path='/ad/ad_id}/edit', name='edit_ad', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x000001DE2CE850D0>
                     └ <function get_request_handler.<locals>.app at 0x000001DE2CC609A0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 273, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x000001DE2B071940>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 190, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x000001DE2CE69B90>, 'user': <db.models.User object at 0x000001DE2CE8CC...
                 │         └ <function edit_ad at 0x000001DE2CB90FE0>
                 └ <fastapi.dependencies.models.Dependant object at 0x000001DE2CC11F50>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\routes.py", line 35, in edit_ad
    return await services.edit_ad(ad_id, user, ad_data, db)
                 │        │       │      │     │        └ <sqlalchemy.orm.session.AsyncSession object at 0x000001DE2CE69B90>
                 │        │       │      │     └ AdBase(type_id=1, title='New ad', category_id=0, content='string', is_published=True, owner=3, price=1000.0, created_at=datet...
                 │        │       │      └ <db.models.User object at 0x000001DE2CE8CC50>
                 │        │       └ 3
                 │        └ <function edit_ad at 0x000001DE2C1A0A40>
                 └ <module 'ad.services' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\ad\\services.py'>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\services.py", line 61, in edit_ad
    if user.id == ad.owner or await queries.is_user_has_permission(user, "edit_ads", db):
       │    │     │  │              │       │                      │                 └ <sqlalchemy.orm.session.AsyncSession object at 0x000001DE2CE69B90>
       │    │     │  │              │       │                      └ <db.models.User object at 0x000001DE2CE8CC50>
       │    │     │  │              │       └ <function is_user_has_permission at 0x000001DE2C1A0540>
       │    │     │  │              └ <module 'ad.queries' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\ad\\queries.py'>
       │    │     │  └ <sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x000001DE2C150400>
       │    │     └ <db.models.Ad object at 0x000001DE2CE8DA90>
       │    └ <sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x000001DE2C174A40>
       └ <db.models.User object at 0x000001DE2CE8CC50>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\queries.py", line 105, in is_user_has_permission
    stmt = select(User).where(User.id == user_id)
           │      │           │    │     └ <db.models.User object at 0x000001DE2CE8CC50>
           │      │           │    └ <sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x000001DE2C174A40>
           │      │           └ <class 'db.models.User'>
           │      └ <class 'db.models.User'>
           └ <function select at 0x000001DE2B6254E0>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\operators.py", line 582, in __eq__
    return self.operate(eq, other)
           │    │       │   └ <db.models.User object at 0x000001DE2CE8CC50>
           │    │       └ <built-in function eq>
           │    └ <function QueryableAttribute.operate at 0x000001DE2B80B560>
           └ <sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x000001DE2C174A40>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 450, in operate
    return op(self.comparator, *other, **kwargs)  # type: ignore[return-value,no-any-return]  # noqa: E501
           │  │    │            │        └ {}
           │  │    │            └ (<db.models.User object at 0x000001DE2CE8CC50>,)
           │  │    └ <member 'comparator' of 'QueryableAttribute' objects>
           │  └ <sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x000001DE2C174A40>
           └ <built-in function eq>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\operators.py", line 582, in __eq__
    return self.operate(eq, other)
           │    │       │   └ <db.models.User object at 0x000001DE2CE8CC50>
           │    │       └ <built-in function eq>
           │    └ <function ColumnProperty.Comparator.operate at 0x000001DE2B915440>
           └ <sqlalchemy.orm.properties.ColumnProperty.Comparator object at 0x000001DE2C178AE0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\properties.py", line 478, in operate
    return op(self.__clause_element__(), *other, **kwargs)  # type: ignore[return-value,no-any-return]  # noqa: E501
           │  │    │                      │        └ {}
           │  │    │                      └ (<db.models.User object at 0x000001DE2CE8CC50>,)
           │  │    └ <member '__clause_element__' of 'Comparator' objects>
           │  └ <sqlalchemy.orm.properties.ColumnProperty.Comparator object at 0x000001DE2C178AE0>
           └ <built-in function eq>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\annotation.py", line 378, in __eq__
    return self.__element.__class__.__eq__(self, other)
           │                               │     └ <db.models.User object at 0x000001DE2CE8CC50>
           │                               └ Column('id', Integer(), table=<user>, primary_key=True, nullable=False)
           └ Column('id', Integer(), table=<user>, primary_key=True, nullable=False)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\operators.py", line 582, in __eq__
    return self.operate(eq, other)
           │    │       │   └ <db.models.User object at 0x000001DE2CE8CC50>
           │    │       └ <built-in function eq>
           │    └ <function ColumnElement.operate at 0x000001DE2B5299E0>
           └ Column('id', Integer(), table=<user>, primary_key=True, nullable=False)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 1538, in operate
    return op(self.comparator, *other, **kwargs)  # type: ignore[return-value,no-any-return]  # noqa: E501
           │  │    │            │        └ {}
           │  │    │            └ (<db.models.User object at 0x000001DE2CE8CC50>,)
           │  │    └ <sqlalchemy.sql.sqltypes.HasExpressionLookup.Comparator object at 0x000001DE2CD05810>
           │  └ Column('id', Integer(), table=<user>, primary_key=True, nullable=False)
           └ <built-in function eq>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\operators.py", line 582, in __eq__
    return self.operate(eq, other)
           │    │       │   └ <db.models.User object at 0x000001DE2CE8CC50>
           │    │       └ <built-in function eq>
           │    └ <function TypeEngine.Comparator.operate at 0x000001DE2B493740>
           └ <sqlalchemy.sql.sqltypes.HasExpressionLookup.Comparator object at 0x000001DE2CD05810>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\type_api.py", line 194, in operate
    return op_fn(self.expr, op, *other, **addtl_kw)  # type: ignore
           │     │    │     │    │        └ immutabledict({'negate_op': <built-in function ne>})
           │     │    │     │    └ (<db.models.User object at 0x000001DE2CE8CC50>,)
           │     │    │     └ <built-in function eq>
           │     │    └ <member 'expr' of 'Comparator' objects>
           │     └ <sqlalchemy.sql.sqltypes.HasExpressionLookup.Comparator object at 0x000001DE2CD05810>
           └ <function _boolean_compare at 0x000001DE2B5E5B20>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\default_comparator.py", line 122, in _boolean_compare
    obj = coercions.expect(
          │         └ <function expect at 0x000001DE2B40A660>
          └ <module 'sqlalchemy.sql.coercions' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\coercions.py", line 413, in expect
    resolved = impl._literal_coercion(
               │    └ <function BinaryElementImpl._literal_coercion at 0x000001DE2B40B740>
               └ <sqlalchemy.sql.coercions.BinaryElementImpl object at 0x000001DE2B456280>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\coercions.py", line 813, in _literal_coercion
    self._raise_for_expected(element, err=err)
    │    │                   └ <db.models.User object at 0x000001DE2CE8CC50>
    │    └ <function ExpressionElementImpl._raise_for_expected at 0x000001DE2B40B600>
    └ <sqlalchemy.sql.coercions.BinaryElementImpl object at 0x000001DE2B456280>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\coercions.py", line 799, in _raise_for_expected
    return super()._raise_for_expected(
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\coercions.py", line 535, in _raise_for_expected
    raise exc.ArgumentError(msg, code=code) from err
          │   │             │         │          └ ArgumentError('Object <db.models.User object at 0x000001DE2CE8CC50> is not legal as a SQL literal value')
          │   │             │         └ None
          │   │             └ 'SQL expression element or literal value expected, got <db.models.User object at 0x000001DE2CE8CC50>.'
          │   └ <class 'sqlalchemy.exc.ArgumentError'>
          └ <module 'sqlalchemy.exc' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site-...

sqlalchemy.exc.ArgumentError: SQL expression element or literal value expected, got <db.models.User object at 0x000001DE2CE8CC50>.
INFO     2023-07-26 05:29:32.767 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 05:29:32.767 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 05:29:32.877 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 05:29:32.877 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 05:29:32.878 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 05:29:32.878 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 05:29:32.878 request id: app - logging:callHandlers - Finished server process [16808]
INFO     2023-07-26 05:29:32.878 request id: app - logging:callHandlers - Finished server process [16808]
INFO     2023-07-26 05:29:36.611 request id: app - logging:callHandlers - Started server process [24868]
INFO     2023-07-26 05:29:36.612 request id: app - logging:callHandlers - Started server process [24868]
INFO     2023-07-26 05:29:36.613 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 05:29:36.613 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 05:29:36.614 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 05:29:36.615 request id: app - logging:callHandlers - Application startup complete.
CRITICAL 2023-07-26 05:29:37.929 request id: None - db.connection:get_db - DataBase Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: datetime.datetime(2023, 7, 25, 21, 0, 46... (can't subtract offset-naive and offset-aware datetimes)
[SQL: SELECT ad.id, ad.type_id, ad.title, ad.category_id, ad.content, ad.created_at, ad.is_published, ad.owner, ad.price 
FROM ad 
WHERE ad.is_published AND ad.category_id IN ($4::INTEGER) AND ad.created_at >= $1::TIMESTAMP WITHOUT TIME ZONE AND ad.created_at <= $2::TIMESTAMP WITHOUT TIME ZONE 
 LIMIT $3::INTEGER]
[parameters: (datetime.datetime(2023, 7, 25, 21, 0, 46, 511000, tzinfo=TzInfo(UTC)), datetime.datetime(2023, 7, 25, 21, 0, 46, 511000, tzinfo=TzInfo(UTC)), 10, 0)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
INFO     2023-07-26 05:29:37.946 request id: app - logging:callHandlers - 127.0.0.1:61264 - "POST /ad/list HTTP/1.1" 500
ERROR    2023-07-26 05:29:37.946 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "asyncpg\protocol\prepared_stmt.pyx", line 168, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
  File "asyncpg\protocol\codecs/base.pyx", line 206, in asyncpg.protocol.protocol.Codec.encode
  File "asyncpg\protocol\codecs/base.pyx", line 111, in asyncpg.protocol.protocol.Codec.encode_scalar
  File "asyncpg\pgproto\./codecs/datetime.pyx", line 152, in asyncpg.pgproto.pgproto.timestamp_encode

TypeError: can't subtract offset-naive and offset-aware datetimes


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 551, in _prepare_and_execute
    self._rows = await prepared_stmt.fetch(*parameters)
    │    │             │             │      └ (datetime.datetime(2023, 7, 25, 21, 0, 46, 511000, tzinfo=TzInfo(UTC)), datetime.datetime(2023, 7, 25, 21, 0, 46, 511000, tzi...
    │    │             │             └ <function PreparedStatement.fetch at 0x000001DD89AE1D00>
    │    │             └ <asyncpg.prepared_stmt.PreparedStatement object at 0x000001DD88ED3060>
    │    └ <member '_rows' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000001DD89C66B00>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
                 │                   │        └ None
                 │                   └ (datetime.datetime(2023, 7, 25, 21, 0, 46, 511000, tzinfo=TzInfo(UTC)), datetime.datetime(2023, 7, 25, 21, 0, 46, 511000, tzi...
                 └ <asyncpg.prepared_stmt.PreparedStatement object at 0x000001DD88ED3060>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 241, in __bind_execute
    data, status, _ = await self.__do_execute(
                            └ <asyncpg.prepared_stmt.PreparedStatement object at 0x000001DD88ED3060>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 230, in __do_execute
    return await executor(protocol)
                 │        └ <asyncpg.protocol.protocol.Protocol object at 0x000001DD89A2F2A0>
                 └ <function PreparedStatement.__bind_execute.<locals>.<lambda> at 0x000001DD89CA0680>
  File "asyncpg\protocol\protocol.pyx", line 183, in bind_execute
  File "asyncpg\protocol\prepared_stmt.pyx", line 197, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg

asyncpg.exceptions.DataError: invalid input for query argument $1: datetime.datetime(2023, 7, 25, 21, 0, 46... (can't subtract offset-naive and offset-aware datetimes)


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1965, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000001DD88668AE0>
    │    └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x000001DD89A3D250>
    └ <sqlalchemy.engine.base.Connection object at 0x000001DD89B3C0D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 921, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ (datetime.datetime(2023, 7, 25, 21, 0, 46, 511000, tzinfo=TzInfo(UTC)), datetime.datetime(2023, 7, 25, 21, 0, 46, 511000, tzi...
    │      │       └ 'SELECT ad.id, ad.type_id, ad.title, ad.category_id, ad.content, ad.created_at, ad.is_published, ad.owner, ad.price \nFROM ad...
    │      └ <function AsyncAdapt_asyncpg_cursor.execute at 0x000001DD88F380E0>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000001DD89C66B00>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 584, in execute
    self._adapt_connection.await_(
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000001DD89C66B00>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x000001DD89A629E0>
           └ <_AsyncIoGreenlet object at 0x000001DD89C19D80 (otid=0x000001DD88151260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x000001DD89A629E0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 563, in _prepare_and_execute
    self._handle_exception(error)
    │    └ <function AsyncAdapt_asyncpg_cursor._handle_exception at 0x000001DD88F33EC0>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000001DD89C66B00>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 514, in _handle_exception
    self._adapt_connection._handle_exception(error)
    │    │                                   └ DataError("invalid input for query argument $1: datetime.datetime(2023, 7, 25, 21, 0, 46... (can't subtract offset-naive and ...
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000001DD89C66B00>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 801, in _handle_exception
    raise translated_error from error
          │                     └ DataError("invalid input for query argument $1: datetime.datetime(2023, 7, 25, 21, 0, 46... (can't subtract offset-naive and ...
          └ Error("<class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: datetime.datetime(2023, 7, 25, 21, 0, 46....

sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: datetime.datetime(2023, 7, 25, 21, 0, 46... (can't subtract offset-naive and offset-aware datetimes)


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 312
               │     └ 3
               └ <function _main at 0x000001DD83C6F4C0>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 312
           │    └ <function BaseProcess._bootstrap at 0x000001DD83BC5080>
           └ <SpawnProcess name='SpawnProcess-1' parent=24760 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001DD83BC45E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=24760 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001DD83C2E610>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=24760 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=24760 started>
    │    └ <function subprocess_started at 0x000001DD85C68540>
    └ <SpawnProcess name='SpawnProcess-1' parent=24760 started>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=708, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000001DD85DB3290>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=708, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x000001DD85C4B740>
           │       │   └ <uvicorn.server.Server object at 0x000001DD85DB3290>
           │       └ <function run at 0x000001DD856036A0>
           └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000001DD85DC08C0>
           │      └ <function Runner.run at 0x000001DD85603B00>
           └ <asyncio.runners.Runner object at 0x000001DD85DB3710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000001DD85601580>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000001DD85DB3710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001DD856014E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001DD856032E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001DD8556F2E0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
> File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001DD89B2F490>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001DD89...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001D...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000001DD85ED9610>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001DD89B2F490>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\applications.py", line 289, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001DD89...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001D...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001DD89...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001D...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001DD89BF49D0>
          └ <fastapi.applications.FastAPI object at 0x000001DD85ED9610>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001DD85DA5580>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001D...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001DD89BF7C50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001DD89BF49D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000001DD89BE2F20>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001D...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x000001DD89BF7D50>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001DD89BF7C50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 25, in __call__
    raise dependency_exception
          └ DBAPIError("(sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query ar...

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\db\connection.py", line 22, in get_db
    yield session
          └ <sqlalchemy.orm.session.AsyncSession object at 0x000001DD8911EF10>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000001DD89BE2F20>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001D...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x000001DD89B205D0>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x000001DD89BF7D50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000001DD89BE2F20>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001D...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x000001DD87FF34C0>
          └ APIRoute(path='/ad/list', name='list_ads', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000001DD89BE2F20>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001D...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x000001DD89B134C0>
          └ APIRoute(path='/ad/list', name='list_ads', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x000001DD89BF7010>
                     └ <function get_request_handler.<locals>.app at 0x000001DD88DAB100>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 273, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x000001DD87FF1940>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 190, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x000001DD8911EF10>, 'query': AdListQuery(page=1, per_page=10, categori...
                 │         └ <function list_ads at 0x000001DD89B105E0>
                 └ <fastapi.dependencies.models.Dependant object at 0x000001DD89B9E7D0>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\routes.py", line 25, in list_ads
    return await services.list_ads(query, db)
                 │        │        │      └ <sqlalchemy.orm.session.AsyncSession object at 0x000001DD8911EF10>
                 │        │        └ AdListQuery(page=1, per_page=10, categories=[0], ad_type=0, sort='string', creation_time_interval=CreationTimeInterval(older_...
                 │        └ <function list_ads at 0x000001DD891209A0>
                 └ <module 'ad.services' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\ad\\services.py'>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\services.py", line 34, in list_ads
    ads = await queries.list_ads(filter_conditions, start, end, query.sort, db)
                │       │        │                  │      │    │     │     └ <sqlalchemy.orm.session.AsyncSession object at 0x000001DD8911EF10>
                │       │        │                  │      │    │     └ 'string'
                │       │        │                  │      │    └ AdListQuery(page=1, per_page=10, categories=[0], ad_type=0, sort='string', creation_time_interval=CreationTimeInterval(older_...
                │       │        │                  │      └ 10
                │       │        │                  └ 0
                │       │        └ [<sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x000001DD890D0360>, <sqlalchemy.sql.elements.BinaryExpression ob...
                │       └ <function list_ads at 0x000001DD890AAFC0>
                └ <module 'ad.queries' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\ad\\queries.py'>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\queries.py", line 31, in list_ads
    result = await db.execute(ads.slice(start, end))
                   │  │       │   │     │      └ 10
                   │  │       │   │     └ 0
                   │  │       │   └ <function GenerativeSelect.slice at 0x000001DD8854A980>
                   │  │       └ <sqlalchemy.sql.selectable.Select object at 0x000001DD89BEFA50>
                   │  └ <function AsyncSession.execute at 0x000001DD88A23B00>
                   └ <sqlalchemy.orm.session.AsyncSession object at 0x000001DD8911EF10>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 439, in execute
    result = await greenlet_spawn(
                   └ <function greenlet_spawn at 0x000001DD881E6020>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             │       │      │   └ <built-in function exc_info>
             │       │      └ <module 'sys' (built-in)>
             │       └ <method 'throw' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x000001DD89C19D80 (otid=0x000001DD88151260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2246, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x000001DD8896C900>
           └ <sqlalchemy.orm.session.Session object at 0x000001DD89446ED0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2141, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                   │      │                 └ <classmethod(<function AbstractORMCompileState.orm_execute_statement at 0x000001DD888168E0>)>
                   │      └ <class 'sqlalchemy.orm.context.ORMSelectCompileState'>
                   └ typing.Any
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
             │    └ <function Connection.execute at 0x000001DD885D9D00>
             └ <sqlalchemy.engine.base.Connection object at 0x000001DD89B3C0D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1412, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.selectable.Select object at 0x000001DD893E4910>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x000001DD885DA020>
           └ <sqlalchemy.engine.base.Connection object at 0x000001DD89B3C0D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x000001DD885DA200>
          └ <sqlalchemy.engine.base.Connection object at 0x000001DD89B3C0D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1844, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x000001DD885DA2A0>
           └ <sqlalchemy.engine.base.Connection object at 0x000001DD89B3C0D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1984, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x000001DD885DA520>
    └ <sqlalchemy.engine.base.Connection object at 0x000001DD89B3C0D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ Error("<class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: datetime.datetime(2023, 7, 25, 21, 0, 46....
          │                    │              └ (<class 'sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error'>, Error("<class 'asyncpg.exceptions.DataError...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ DBAPIError("(sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query ar...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1965, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000001DD88668AE0>
    │    └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x000001DD89A3D250>
    └ <sqlalchemy.engine.base.Connection object at 0x000001DD89B3C0D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 921, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ (datetime.datetime(2023, 7, 25, 21, 0, 46, 511000, tzinfo=TzInfo(UTC)), datetime.datetime(2023, 7, 25, 21, 0, 46, 511000, tzi...
    │      │       └ 'SELECT ad.id, ad.type_id, ad.title, ad.category_id, ad.content, ad.created_at, ad.is_published, ad.owner, ad.price \nFROM ad...
    │      └ <function AsyncAdapt_asyncpg_cursor.execute at 0x000001DD88F380E0>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000001DD89C66B00>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 584, in execute
    self._adapt_connection.await_(
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000001DD89C66B00>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x000001DD89A629E0>
           └ <_AsyncIoGreenlet object at 0x000001DD89C19D80 (otid=0x000001DD88151260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x000001DD89A629E0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 563, in _prepare_and_execute
    self._handle_exception(error)
    │    └ <function AsyncAdapt_asyncpg_cursor._handle_exception at 0x000001DD88F33EC0>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000001DD89C66B00>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 514, in _handle_exception
    self._adapt_connection._handle_exception(error)
    │    │                                   └ DataError("invalid input for query argument $1: datetime.datetime(2023, 7, 25, 21, 0, 46... (can't subtract offset-naive and ...
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000001DD89C66B00>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 801, in _handle_exception
    raise translated_error from error
          │                     └ DataError("invalid input for query argument $1: datetime.datetime(2023, 7, 25, 21, 0, 46... (can't subtract offset-naive and ...
          └ Error("<class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: datetime.datetime(2023, 7, 25, 21, 0, 46....

sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: datetime.datetime(2023, 7, 25, 21, 0, 46... (can't subtract offset-naive and offset-aware datetimes)
[SQL: SELECT ad.id, ad.type_id, ad.title, ad.category_id, ad.content, ad.created_at, ad.is_published, ad.owner, ad.price 
FROM ad 
WHERE ad.is_published AND ad.category_id IN ($4::INTEGER) AND ad.created_at >= $1::TIMESTAMP WITHOUT TIME ZONE AND ad.created_at <= $2::TIMESTAMP WITHOUT TIME ZONE 
 LIMIT $3::INTEGER]
[parameters: (datetime.datetime(2023, 7, 25, 21, 0, 46, 511000, tzinfo=TzInfo(UTC)), datetime.datetime(2023, 7, 25, 21, 0, 46, 511000, tzinfo=TzInfo(UTC)), 10, 0)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
ERROR    2023-07-26 05:29:37.972 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "asyncpg\protocol\prepared_stmt.pyx", line 168, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
  File "asyncpg\protocol\codecs/base.pyx", line 206, in asyncpg.protocol.protocol.Codec.encode
  File "asyncpg\protocol\codecs/base.pyx", line 111, in asyncpg.protocol.protocol.Codec.encode_scalar
  File "asyncpg\pgproto\./codecs/datetime.pyx", line 152, in asyncpg.pgproto.pgproto.timestamp_encode

TypeError: can't subtract offset-naive and offset-aware datetimes


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 551, in _prepare_and_execute
    self._rows = await prepared_stmt.fetch(*parameters)
    │    │             │             │      └ (datetime.datetime(2023, 7, 25, 21, 0, 46, 511000, tzinfo=TzInfo(UTC)), datetime.datetime(2023, 7, 25, 21, 0, 46, 511000, tzi...
    │    │             │             └ <function PreparedStatement.fetch at 0x000001DD89AE1D00>
    │    │             └ <asyncpg.prepared_stmt.PreparedStatement object at 0x000001DD88ED3060>
    │    └ <member '_rows' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000001DD89C66B00>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
                 │                   │        └ None
                 │                   └ (datetime.datetime(2023, 7, 25, 21, 0, 46, 511000, tzinfo=TzInfo(UTC)), datetime.datetime(2023, 7, 25, 21, 0, 46, 511000, tzi...
                 └ <asyncpg.prepared_stmt.PreparedStatement object at 0x000001DD88ED3060>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 241, in __bind_execute
    data, status, _ = await self.__do_execute(
                            └ <asyncpg.prepared_stmt.PreparedStatement object at 0x000001DD88ED3060>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 230, in __do_execute
    return await executor(protocol)
                 │        └ <asyncpg.protocol.protocol.Protocol object at 0x000001DD89A2F2A0>
                 └ <function PreparedStatement.__bind_execute.<locals>.<lambda> at 0x000001DD89CA0680>
  File "asyncpg\protocol\protocol.pyx", line 183, in bind_execute
  File "asyncpg\protocol\prepared_stmt.pyx", line 197, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg

asyncpg.exceptions.DataError: invalid input for query argument $1: datetime.datetime(2023, 7, 25, 21, 0, 46... (can't subtract offset-naive and offset-aware datetimes)


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1965, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000001DD88668AE0>
    │    └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x000001DD89A3D250>
    └ <sqlalchemy.engine.base.Connection object at 0x000001DD89B3C0D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 921, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ (datetime.datetime(2023, 7, 25, 21, 0, 46, 511000, tzinfo=TzInfo(UTC)), datetime.datetime(2023, 7, 25, 21, 0, 46, 511000, tzi...
    │      │       └ 'SELECT ad.id, ad.type_id, ad.title, ad.category_id, ad.content, ad.created_at, ad.is_published, ad.owner, ad.price \nFROM ad...
    │      └ <function AsyncAdapt_asyncpg_cursor.execute at 0x000001DD88F380E0>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000001DD89C66B00>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 584, in execute
    self._adapt_connection.await_(
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000001DD89C66B00>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x000001DD89A629E0>
           └ <_AsyncIoGreenlet object at 0x000001DD89C19D80 (otid=0x000001DD88151260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x000001DD89A629E0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 563, in _prepare_and_execute
    self._handle_exception(error)
    │    └ <function AsyncAdapt_asyncpg_cursor._handle_exception at 0x000001DD88F33EC0>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000001DD89C66B00>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 514, in _handle_exception
    self._adapt_connection._handle_exception(error)
    │    │                                   └ DataError("invalid input for query argument $1: datetime.datetime(2023, 7, 25, 21, 0, 46... (can't subtract offset-naive and ...
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000001DD89C66B00>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 801, in _handle_exception
    raise translated_error from error
          │                     └ DataError("invalid input for query argument $1: datetime.datetime(2023, 7, 25, 21, 0, 46... (can't subtract offset-naive and ...
          └ Error("<class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: datetime.datetime(2023, 7, 25, 21, 0, 46....

sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: datetime.datetime(2023, 7, 25, 21, 0, 46... (can't subtract offset-naive and offset-aware datetimes)


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 312
               │     └ 3
               └ <function _main at 0x000001DD83C6F4C0>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 312
           │    └ <function BaseProcess._bootstrap at 0x000001DD83BC5080>
           └ <SpawnProcess name='SpawnProcess-1' parent=24760 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001DD83BC45E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=24760 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001DD83C2E610>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=24760 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=24760 started>
    │    └ <function subprocess_started at 0x000001DD85C68540>
    └ <SpawnProcess name='SpawnProcess-1' parent=24760 started>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=708, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000001DD85DB3290>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=708, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x000001DD85C4B740>
           │       │   └ <uvicorn.server.Server object at 0x000001DD85DB3290>
           │       └ <function run at 0x000001DD856036A0>
           └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000001DD85DC08C0>
           │      └ <function Runner.run at 0x000001DD85603B00>
           └ <asyncio.runners.Runner object at 0x000001DD85DB3710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000001DD85601580>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000001DD85DB3710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001DD856014E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001DD856032E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001DD8556F2E0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
> File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001DD89B2F490>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001DD89...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001D...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000001DD85ED9610>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001DD89B2F490>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\applications.py", line 289, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001DD89...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001D...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001DD89...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001D...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001DD89BF49D0>
          └ <fastapi.applications.FastAPI object at 0x000001DD85ED9610>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001DD85DA5580>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001D...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001DD89BF7C50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001DD89BF49D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000001DD89BE2F20>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001D...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x000001DD89BF7D50>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001DD89BF7C50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 25, in __call__
    raise dependency_exception
          └ DBAPIError("(sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query ar...

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\db\connection.py", line 22, in get_db
    yield session
          └ <sqlalchemy.orm.session.AsyncSession object at 0x000001DD8911EF10>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000001DD89BE2F20>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001D...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x000001DD89B205D0>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x000001DD89BF7D50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000001DD89BE2F20>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001D...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x000001DD87FF34C0>
          └ APIRoute(path='/ad/list', name='list_ads', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000001DD89BE2F20>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001D...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x000001DD89B134C0>
          └ APIRoute(path='/ad/list', name='list_ads', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x000001DD89BF7010>
                     └ <function get_request_handler.<locals>.app at 0x000001DD88DAB100>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 273, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x000001DD87FF1940>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 190, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x000001DD8911EF10>, 'query': AdListQuery(page=1, per_page=10, categori...
                 │         └ <function list_ads at 0x000001DD89B105E0>
                 └ <fastapi.dependencies.models.Dependant object at 0x000001DD89B9E7D0>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\routes.py", line 25, in list_ads
    return await services.list_ads(query, db)
                 │        │        │      └ <sqlalchemy.orm.session.AsyncSession object at 0x000001DD8911EF10>
                 │        │        └ AdListQuery(page=1, per_page=10, categories=[0], ad_type=0, sort='string', creation_time_interval=CreationTimeInterval(older_...
                 │        └ <function list_ads at 0x000001DD891209A0>
                 └ <module 'ad.services' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\ad\\services.py'>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\services.py", line 34, in list_ads
    ads = await queries.list_ads(filter_conditions, start, end, query.sort, db)
                │       │        │                  │      │    │     │     └ <sqlalchemy.orm.session.AsyncSession object at 0x000001DD8911EF10>
                │       │        │                  │      │    │     └ 'string'
                │       │        │                  │      │    └ AdListQuery(page=1, per_page=10, categories=[0], ad_type=0, sort='string', creation_time_interval=CreationTimeInterval(older_...
                │       │        │                  │      └ 10
                │       │        │                  └ 0
                │       │        └ [<sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x000001DD890D0360>, <sqlalchemy.sql.elements.BinaryExpression ob...
                │       └ <function list_ads at 0x000001DD890AAFC0>
                └ <module 'ad.queries' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\ad\\queries.py'>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\queries.py", line 31, in list_ads
    result = await db.execute(ads.slice(start, end))
                   │  │       │   │     │      └ 10
                   │  │       │   │     └ 0
                   │  │       │   └ <function GenerativeSelect.slice at 0x000001DD8854A980>
                   │  │       └ <sqlalchemy.sql.selectable.Select object at 0x000001DD89BEFA50>
                   │  └ <function AsyncSession.execute at 0x000001DD88A23B00>
                   └ <sqlalchemy.orm.session.AsyncSession object at 0x000001DD8911EF10>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 439, in execute
    result = await greenlet_spawn(
                   └ <function greenlet_spawn at 0x000001DD881E6020>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             │       │      │   └ <built-in function exc_info>
             │       │      └ <module 'sys' (built-in)>
             │       └ <method 'throw' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x000001DD89C19D80 (otid=0x000001DD88151260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2246, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x000001DD8896C900>
           └ <sqlalchemy.orm.session.Session object at 0x000001DD89446ED0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2141, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                   │      │                 └ <classmethod(<function AbstractORMCompileState.orm_execute_statement at 0x000001DD888168E0>)>
                   │      └ <class 'sqlalchemy.orm.context.ORMSelectCompileState'>
                   └ typing.Any
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
             │    └ <function Connection.execute at 0x000001DD885D9D00>
             └ <sqlalchemy.engine.base.Connection object at 0x000001DD89B3C0D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1412, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.selectable.Select object at 0x000001DD893E4910>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x000001DD885DA020>
           └ <sqlalchemy.engine.base.Connection object at 0x000001DD89B3C0D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x000001DD885DA200>
          └ <sqlalchemy.engine.base.Connection object at 0x000001DD89B3C0D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1844, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x000001DD885DA2A0>
           └ <sqlalchemy.engine.base.Connection object at 0x000001DD89B3C0D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1984, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x000001DD885DA520>
    └ <sqlalchemy.engine.base.Connection object at 0x000001DD89B3C0D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ Error("<class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: datetime.datetime(2023, 7, 25, 21, 0, 46....
          │                    │              └ (<class 'sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error'>, Error("<class 'asyncpg.exceptions.DataError...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ DBAPIError("(sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query ar...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1965, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000001DD88668AE0>
    │    └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x000001DD89A3D250>
    └ <sqlalchemy.engine.base.Connection object at 0x000001DD89B3C0D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 921, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ (datetime.datetime(2023, 7, 25, 21, 0, 46, 511000, tzinfo=TzInfo(UTC)), datetime.datetime(2023, 7, 25, 21, 0, 46, 511000, tzi...
    │      │       └ 'SELECT ad.id, ad.type_id, ad.title, ad.category_id, ad.content, ad.created_at, ad.is_published, ad.owner, ad.price \nFROM ad...
    │      └ <function AsyncAdapt_asyncpg_cursor.execute at 0x000001DD88F380E0>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000001DD89C66B00>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 584, in execute
    self._adapt_connection.await_(
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000001DD89C66B00>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x000001DD89A629E0>
           └ <_AsyncIoGreenlet object at 0x000001DD89C19D80 (otid=0x000001DD88151260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x000001DD89A629E0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 563, in _prepare_and_execute
    self._handle_exception(error)
    │    └ <function AsyncAdapt_asyncpg_cursor._handle_exception at 0x000001DD88F33EC0>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000001DD89C66B00>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 514, in _handle_exception
    self._adapt_connection._handle_exception(error)
    │    │                                   └ DataError("invalid input for query argument $1: datetime.datetime(2023, 7, 25, 21, 0, 46... (can't subtract offset-naive and ...
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000001DD89C66B00>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 801, in _handle_exception
    raise translated_error from error
          │                     └ DataError("invalid input for query argument $1: datetime.datetime(2023, 7, 25, 21, 0, 46... (can't subtract offset-naive and ...
          └ Error("<class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: datetime.datetime(2023, 7, 25, 21, 0, 46....

sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: datetime.datetime(2023, 7, 25, 21, 0, 46... (can't subtract offset-naive and offset-aware datetimes)
[SQL: SELECT ad.id, ad.type_id, ad.title, ad.category_id, ad.content, ad.created_at, ad.is_published, ad.owner, ad.price 
FROM ad 
WHERE ad.is_published AND ad.category_id IN ($4::INTEGER) AND ad.created_at >= $1::TIMESTAMP WITHOUT TIME ZONE AND ad.created_at <= $2::TIMESTAMP WITHOUT TIME ZONE 
 LIMIT $3::INTEGER]
[parameters: (datetime.datetime(2023, 7, 25, 21, 0, 46, 511000, tzinfo=TzInfo(UTC)), datetime.datetime(2023, 7, 25, 21, 0, 46, 511000, tzinfo=TzInfo(UTC)), 10, 0)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
INFO     2023-07-26 05:33:23.092 request id: app - logging:callHandlers - 127.0.0.1:61287 - "POST /ad/list HTTP/1.1" 200
INFO     2023-07-26 05:36:03.896 request id: app - logging:callHandlers - 127.0.0.1:61308 - "POST /ad/ad_id%7D/edit?ad_id=4 HTTP/1.1" 422
CRITICAL 2023-07-26 05:36:23.281 request id: None - db.connection:get_db - DataBase Error: [{'type': 'missing', 'loc': ('body', 'owner'), 'msg': 'Field required', 'input': {'type_id': 1, 'title': 'New ad 3', 'category_id': 0, 'is_published': True, 'price': 0, 'content': 'string'}, 'url': 'https://errors.pydantic.dev/2.0.3/v/missing'}]
INFO     2023-07-26 05:36:23.287 request id: app - logging:callHandlers - 127.0.0.1:61309 - "POST /ad/ad_id%7D/edit?ad_id=4 HTTP/1.1" 422
INFO     2023-07-26 05:37:20.166 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 05:37:20.166 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 05:37:20.276 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 05:37:20.276 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 05:37:20.277 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 05:37:20.277 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 05:37:20.278 request id: app - logging:callHandlers - Finished server process [24868]
INFO     2023-07-26 05:37:20.278 request id: app - logging:callHandlers - Finished server process [24868]
INFO     2023-07-26 05:37:23.520 request id: app - logging:callHandlers - Started server process [11076]
INFO     2023-07-26 05:37:23.521 request id: app - logging:callHandlers - Started server process [11076]
INFO     2023-07-26 05:37:23.521 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 05:37:23.522 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 05:37:23.523 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 05:37:23.523 request id: app - logging:callHandlers - Application startup complete.
CRITICAL 2023-07-26 05:37:24.467 request id: None - db.connection:get_db - DataBase Error: [{'type': 'missing', 'loc': ('body', 'owner'), 'msg': 'Field required', 'input': {'type_id': 1, 'title': 'New ad 3', 'category_id': 0, 'is_published': True, 'price': 0, 'content': 'string'}, 'url': 'https://errors.pydantic.dev/2.0.3/v/missing'}]
INFO     2023-07-26 05:37:24.475 request id: app - logging:callHandlers - 127.0.0.1:61376 - "POST /ad/ad_id%7D/edit?ad_id=4 HTTP/1.1" 422
CRITICAL 2023-07-26 05:42:57.108 request id: None - db.connection:get_db - DataBase Error: [{'type': 'missing', 'loc': ('body', 'owner'), 'msg': 'Field required', 'input': {'type_id': 1, 'title': 'New ad 3', 'category_id': 0, 'is_published': True, 'price': 0, 'content': 'string'}, 'url': 'https://errors.pydantic.dev/2.0.3/v/missing'}]
INFO     2023-07-26 05:42:57.117 request id: app - logging:callHandlers - 127.0.0.1:61414 - "POST /ad/ad_id%7D/edit?ad_id=4 HTTP/1.1" 422
INFO     2023-07-26 05:42:57.170 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 05:42:57.171 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 05:42:57.280 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 05:42:57.281 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 05:42:57.282 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 05:42:57.283 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 05:42:57.284 request id: app - logging:callHandlers - Finished server process [11076]
INFO     2023-07-26 05:42:57.285 request id: app - logging:callHandlers - Finished server process [11076]
INFO     2023-07-26 05:42:59.877 request id: app - logging:callHandlers - Started server process [26052]
INFO     2023-07-26 05:42:59.878 request id: app - logging:callHandlers - Started server process [26052]
INFO     2023-07-26 05:42:59.879 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 05:42:59.880 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 05:42:59.880 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 05:42:59.881 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 05:43:15.227 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 05:43:15.227 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 05:43:15.336 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 05:43:15.336 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 05:43:15.337 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 05:43:15.337 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 05:43:15.338 request id: app - logging:callHandlers - Finished server process [26052]
INFO     2023-07-26 05:43:15.338 request id: app - logging:callHandlers - Finished server process [26052]
INFO     2023-07-26 05:43:19.122 request id: app - logging:callHandlers - Started server process [24812]
INFO     2023-07-26 05:43:19.122 request id: app - logging:callHandlers - Started server process [24812]
INFO     2023-07-26 05:43:19.122 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 05:43:19.123 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 05:43:19.123 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 05:43:19.124 request id: app - logging:callHandlers - Application startup complete.
CRITICAL 2023-07-26 05:43:19.664 request id: None - db.connection:get_db - DataBase Error: [{'type': 'missing', 'loc': ('body', 'owner'), 'msg': 'Field required', 'input': {'type_id': 1, 'title': 'New ad 3', 'category_id': 0, 'is_published': True, 'price': 0, 'content': 'string'}, 'url': 'https://errors.pydantic.dev/2.0.3/v/missing'}]
INFO     2023-07-26 05:43:19.675 request id: app - logging:callHandlers - 127.0.0.1:61420 - "POST /ad/ad_id%7D/edit?ad_id=4 HTTP/1.1" 422
INFO     2023-07-26 05:43:29.194 request id: app - logging:callHandlers - 127.0.0.1:61424 - "GET /docs HTTP/1.1" 200
INFO     2023-07-26 05:43:29.485 request id: app - logging:callHandlers - 127.0.0.1:61424 - "GET /openapi.json HTTP/1.1" 200
CRITICAL 2023-07-26 05:43:36.892 request id: None - db.connection:get_db - DataBase Error: [{'type': 'missing', 'loc': ('body', 'owner'), 'msg': 'Field required', 'input': {'type_id': 1, 'title': 'New ad 3', 'category_id': 0, 'is_published': True, 'price': 0, 'content': 'string'}, 'url': 'https://errors.pydantic.dev/2.0.3/v/missing'}]
INFO     2023-07-26 05:43:36.897 request id: app - logging:callHandlers - 127.0.0.1:61426 - "POST /ad/ad_id%7D/edit?ad_id=4 HTTP/1.1" 422
INFO     2023-07-26 05:46:06.196 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 05:46:06.196 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 05:46:06.306 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 05:46:06.306 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 05:46:06.307 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 05:46:06.307 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 05:46:06.308 request id: app - logging:callHandlers - Finished server process [24812]
INFO     2023-07-26 05:46:06.308 request id: app - logging:callHandlers - Finished server process [24812]
INFO     2023-07-26 05:46:11.036 request id: app - logging:callHandlers - Started server process [2852]
INFO     2023-07-26 05:46:11.037 request id: app - logging:callHandlers - Started server process [2852]
INFO     2023-07-26 05:46:11.038 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 05:46:11.039 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 05:46:11.042 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 05:46:11.043 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 05:46:12.246 request id: app - logging:callHandlers - 127.0.0.1:61449 - "GET /docs HTTP/1.1" 200
INFO     2023-07-26 05:46:12.540 request id: app - logging:callHandlers - 127.0.0.1:61449 - "GET /openapi.json HTTP/1.1" 200
INFO     2023-07-26 05:46:17.059 request id: app - logging:callHandlers - 127.0.0.1:61449 - "GET /docs HTTP/1.1" 200
INFO     2023-07-26 05:46:17.225 request id: app - logging:callHandlers - 127.0.0.1:61449 - "GET /openapi.json HTTP/1.1" 200
CRITICAL 2023-07-26 05:46:28.156 request id: None - db.connection:get_db - DataBase Error: [{'type': 'missing', 'loc': ('body', 'owner'), 'msg': 'Field required', 'input': {'type_id': 1, 'title': 'New ad 3', 'category_id': 0, 'is_published': True, 'price': 0, 'content': 'string'}, 'url': 'https://errors.pydantic.dev/2.0.3/v/missing'}]
INFO     2023-07-26 05:46:28.163 request id: app - logging:callHandlers - 127.0.0.1:61451 - "POST /ad/ad_id%7D/edit?ad_id=4 HTTP/1.1" 422
CRITICAL 2023-07-26 05:48:34.246 request id: None - db.connection:get_db - DataBase Error: SQL expression element or literal value expected, got <db.models.User object at 0x0000021987319350>.
INFO     2023-07-26 05:48:34.264 request id: app - logging:callHandlers - 127.0.0.1:61530 - "POST /ad/ad_id%7D/edit?ad_id=4 HTTP/1.1" 500
ERROR    2023-07-26 05:48:34.267 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\coercions.py", line 811, in _literal_coercion
    return expr._bind_param(operator, element, type_=bindparam_type)
           │    │           │         │              └ None
           │    │           │         └ <db.models.User object at 0x0000021987319350>
           │    │           └ <built-in function eq>
           │    └ <function NamedColumn._bind_param at 0x0000021985BC2E80>
           └ Column('id', Integer(), table=<user>, primary_key=True, nullable=False)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 4478, in _bind_param
    return BindParameter(
           └ <class 'sqlalchemy.sql.elements.BindParameter'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 2050, in __init__
    self.type = _compared_to_type.coerce_compared_value(
    │    │      │                 └ <function TypeEngine.coerce_compared_value at 0x0000021985BA5120>
    │    │      └ Integer()
    │    └ NullType()
    └ BindParameter('%(2308654677008 id)s', <db.models.User object at 0x0000021987319350>, type_=NullType())
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\type_api.py", line 1085, in coerce_compared_value
    _coerced_type = _resolve_value_to_type(value)
                    │                      └ <db.models.User object at 0x0000021987319350>
                    └ <function _resolve_value_to_type at 0x0000021985C40400>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\sqltypes.py", line 3826, in _resolve_value_to_type
    raise exc.ArgumentError(
          │   └ <class 'sqlalchemy.exc.ArgumentError'>
          └ <module 'sqlalchemy.exc' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site-...

sqlalchemy.exc.ArgumentError: Object <db.models.User object at 0x0000021987319350> is not legal as a SQL literal value


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 336
               │     └ 3
               └ <function _main at 0x000002198134F4C0>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 336
           │    └ <function BaseProcess._bootstrap at 0x0000021981295080>
           └ <SpawnProcess name='SpawnProcess-1' parent=23696 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x00000219812945E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=23696 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x00000219812FE610>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=23696 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=23696 started>
    │    └ <function subprocess_started at 0x0000021983368540>
    └ <SpawnProcess name='SpawnProcess-1' parent=23696 started>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=772, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x00000219834B3290>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=772, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x000002198334B740>
           │       │   └ <uvicorn.server.Server object at 0x00000219834B3290>
           │       └ <function run at 0x00000219831036A0>
           └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x00000219834C08C0>
           │      └ <function Runner.run at 0x0000021983103B00>
           └ <asyncio.runners.Runner object at 0x00000219834B3710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x0000021983101580>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x00000219834B3710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x00000219831014E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x00000219831032E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000021982C6F2E0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
> File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000219834BE890>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021987...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000021987210AD0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000219834BE890>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\applications.py", line 289, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021987...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021987...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x00000219872FC510>
          └ <fastapi.applications.FastAPI object at 0x0000021987210AD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x00000219873E0900>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000021987232E90>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x00000219872FC510>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x00000219873D7BA0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x0000021987229F90>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000021987232E90>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 25, in __call__
    raise dependency_exception
          └ ArgumentError('SQL expression element or literal value expected, got <db.models.User object at 0x0000021987319350>.')

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\db\connection.py", line 22, in get_db
    yield session
          └ <sqlalchemy.orm.session.AsyncSession object at 0x000002198749C450>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x00000219873D7BA0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x000002198721D310>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x0000021987229F90>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x00000219873D7BA0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x00000219856F34C0>
          └ APIRoute(path='/ad/ad_id}/edit', name='edit_ad', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x00000219873D7BA0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000021987287A60>
          └ APIRoute(path='/ad/ad_id}/edit', name='edit_ad', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x000002198747FE10>
                     └ <function get_request_handler.<locals>.app at 0x0000021987287BA0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 273, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x00000219856F1940>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 190, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x000002198749C450>, 'user': <db.models.User object at 0x00000219873193...
                 │         └ <function edit_ad at 0x0000021987218CC0>
                 └ <fastapi.dependencies.models.Dependant object at 0x00000219872DFB10>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\routes.py", line 35, in edit_ad
    return await services.edit_ad(ad_id, user, ad_data, db)
                 │        │       │      │     │        └ <sqlalchemy.orm.session.AsyncSession object at 0x000002198749C450>
                 │        │       │      │     └ AdEdit(type_id=1, title='New ad 3', category_id=0, content='string', is_published=True, owner=4, price=0.0)
                 │        │       │      └ <db.models.User object at 0x0000021987319350>
                 │        │       └ 4
                 │        └ <function edit_ad at 0x0000021986822340>
                 └ <module 'ad.services' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\ad\\services.py'>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\services.py", line 61, in edit_ad
    if user.id == ad.owner or await queries.has_user_permission(user, "edit_ads", db):
       │    │     │  │              │       │                   │                 └ <sqlalchemy.orm.session.AsyncSession object at 0x000002198749C450>
       │    │     │  │              │       │                   └ <db.models.User object at 0x0000021987319350>
       │    │     │  │              │       └ <function has_user_permission at 0x00000219868220C0>
       │    │     │  │              └ <module 'ad.queries' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\ad\\queries.py'>
       │    │     │  └ <sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x00000219867D0400>
       │    │     └ <db.models.Ad object at 0x00000219874AC290>
       │    └ <sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x00000219867F8A40>
       └ <db.models.User object at 0x0000021987319350>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\queries.py", line 105, in has_user_permission
    stmt = select(User).where(User.id == user_id)
           │      │           │    │     └ <db.models.User object at 0x0000021987319350>
           │      │           │    └ <sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x00000219867F8A40>
           │      │           └ <class 'db.models.User'>
           │      └ <class 'db.models.User'>
           └ <function select at 0x0000021985CA54E0>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\operators.py", line 582, in __eq__
    return self.operate(eq, other)
           │    │       │   └ <db.models.User object at 0x0000021987319350>
           │    │       └ <built-in function eq>
           │    └ <function QueryableAttribute.operate at 0x0000021985E8B560>
           └ <sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x00000219867F8A40>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 450, in operate
    return op(self.comparator, *other, **kwargs)  # type: ignore[return-value,no-any-return]  # noqa: E501
           │  │    │            │        └ {}
           │  │    │            └ (<db.models.User object at 0x0000021987319350>,)
           │  │    └ <member 'comparator' of 'QueryableAttribute' objects>
           │  └ <sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x00000219867F8A40>
           └ <built-in function eq>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\operators.py", line 582, in __eq__
    return self.operate(eq, other)
           │    │       │   └ <db.models.User object at 0x0000021987319350>
           │    │       └ <built-in function eq>
           │    └ <function ColumnProperty.Comparator.operate at 0x0000021985F95440>
           └ <sqlalchemy.orm.properties.ColumnProperty.Comparator object at 0x00000219867F0D60>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\properties.py", line 478, in operate
    return op(self.__clause_element__(), *other, **kwargs)  # type: ignore[return-value,no-any-return]  # noqa: E501
           │  │    │                      │        └ {}
           │  │    │                      └ (<db.models.User object at 0x0000021987319350>,)
           │  │    └ <member '__clause_element__' of 'Comparator' objects>
           │  └ <sqlalchemy.orm.properties.ColumnProperty.Comparator object at 0x00000219867F0D60>
           └ <built-in function eq>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\annotation.py", line 378, in __eq__
    return self.__element.__class__.__eq__(self, other)
           │                               │     └ <db.models.User object at 0x0000021987319350>
           │                               └ Column('id', Integer(), table=<user>, primary_key=True, nullable=False)
           └ Column('id', Integer(), table=<user>, primary_key=True, nullable=False)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\operators.py", line 582, in __eq__
    return self.operate(eq, other)
           │    │       │   └ <db.models.User object at 0x0000021987319350>
           │    │       └ <built-in function eq>
           │    └ <function ColumnElement.operate at 0x0000021985BA99E0>
           └ Column('id', Integer(), table=<user>, primary_key=True, nullable=False)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 1538, in operate
    return op(self.comparator, *other, **kwargs)  # type: ignore[return-value,no-any-return]  # noqa: E501
           │  │    │            │        └ {}
           │  │    │            └ (<db.models.User object at 0x0000021987319350>,)
           │  │    └ <sqlalchemy.sql.sqltypes.HasExpressionLookup.Comparator object at 0x00000219872FA560>
           │  └ Column('id', Integer(), table=<user>, primary_key=True, nullable=False)
           └ <built-in function eq>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\operators.py", line 582, in __eq__
    return self.operate(eq, other)
           │    │       │   └ <db.models.User object at 0x0000021987319350>
           │    │       └ <built-in function eq>
           │    └ <function TypeEngine.Comparator.operate at 0x0000021985B13740>
           └ <sqlalchemy.sql.sqltypes.HasExpressionLookup.Comparator object at 0x00000219872FA560>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\type_api.py", line 194, in operate
    return op_fn(self.expr, op, *other, **addtl_kw)  # type: ignore
           │     │    │     │    │        └ immutabledict({'negate_op': <built-in function ne>})
           │     │    │     │    └ (<db.models.User object at 0x0000021987319350>,)
           │     │    │     └ <built-in function eq>
           │     │    └ <member 'expr' of 'Comparator' objects>
           │     └ <sqlalchemy.sql.sqltypes.HasExpressionLookup.Comparator object at 0x00000219872FA560>
           └ <function _boolean_compare at 0x0000021985C65B20>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\default_comparator.py", line 122, in _boolean_compare
    obj = coercions.expect(
          │         └ <function expect at 0x0000021985A8A660>
          └ <module 'sqlalchemy.sql.coercions' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\coercions.py", line 413, in expect
    resolved = impl._literal_coercion(
               │    └ <function BinaryElementImpl._literal_coercion at 0x0000021985A8B740>
               └ <sqlalchemy.sql.coercions.BinaryElementImpl object at 0x0000021985AD2580>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\coercions.py", line 813, in _literal_coercion
    self._raise_for_expected(element, err=err)
    │    │                   └ <db.models.User object at 0x0000021987319350>
    │    └ <function ExpressionElementImpl._raise_for_expected at 0x0000021985A8B600>
    └ <sqlalchemy.sql.coercions.BinaryElementImpl object at 0x0000021985AD2580>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\coercions.py", line 799, in _raise_for_expected
    return super()._raise_for_expected(
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\coercions.py", line 535, in _raise_for_expected
    raise exc.ArgumentError(msg, code=code) from err
          │   │             │         │          └ ArgumentError('Object <db.models.User object at 0x0000021987319350> is not legal as a SQL literal value')
          │   │             │         └ None
          │   │             └ 'SQL expression element or literal value expected, got <db.models.User object at 0x0000021987319350>.'
          │   └ <class 'sqlalchemy.exc.ArgumentError'>
          └ <module 'sqlalchemy.exc' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site-...

sqlalchemy.exc.ArgumentError: SQL expression element or literal value expected, got <db.models.User object at 0x0000021987319350>.
ERROR    2023-07-26 05:48:34.307 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\coercions.py", line 811, in _literal_coercion
    return expr._bind_param(operator, element, type_=bindparam_type)
           │    │           │         │              └ None
           │    │           │         └ <db.models.User object at 0x0000021987319350>
           │    │           └ <built-in function eq>
           │    └ <function NamedColumn._bind_param at 0x0000021985BC2E80>
           └ Column('id', Integer(), table=<user>, primary_key=True, nullable=False)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 4478, in _bind_param
    return BindParameter(
           └ <class 'sqlalchemy.sql.elements.BindParameter'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 2050, in __init__
    self.type = _compared_to_type.coerce_compared_value(
    │    │      │                 └ <function TypeEngine.coerce_compared_value at 0x0000021985BA5120>
    │    │      └ Integer()
    │    └ NullType()
    └ BindParameter('%(2308654677008 id)s', <db.models.User object at 0x0000021987319350>, type_=NullType())
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\type_api.py", line 1085, in coerce_compared_value
    _coerced_type = _resolve_value_to_type(value)
                    │                      └ <db.models.User object at 0x0000021987319350>
                    └ <function _resolve_value_to_type at 0x0000021985C40400>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\sqltypes.py", line 3826, in _resolve_value_to_type
    raise exc.ArgumentError(
          │   └ <class 'sqlalchemy.exc.ArgumentError'>
          └ <module 'sqlalchemy.exc' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site-...

sqlalchemy.exc.ArgumentError: Object <db.models.User object at 0x0000021987319350> is not legal as a SQL literal value


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 336
               │     └ 3
               └ <function _main at 0x000002198134F4C0>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 336
           │    └ <function BaseProcess._bootstrap at 0x0000021981295080>
           └ <SpawnProcess name='SpawnProcess-1' parent=23696 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x00000219812945E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=23696 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x00000219812FE610>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=23696 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=23696 started>
    │    └ <function subprocess_started at 0x0000021983368540>
    └ <SpawnProcess name='SpawnProcess-1' parent=23696 started>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=772, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x00000219834B3290>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=772, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x000002198334B740>
           │       │   └ <uvicorn.server.Server object at 0x00000219834B3290>
           │       └ <function run at 0x00000219831036A0>
           └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x00000219834C08C0>
           │      └ <function Runner.run at 0x0000021983103B00>
           └ <asyncio.runners.Runner object at 0x00000219834B3710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x0000021983101580>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x00000219834B3710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x00000219831014E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x00000219831032E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000021982C6F2E0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
> File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000219834BE890>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021987...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000021987210AD0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000219834BE890>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\applications.py", line 289, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021987...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021987...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x00000219872FC510>
          └ <fastapi.applications.FastAPI object at 0x0000021987210AD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x00000219873E0900>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000021987232E90>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x00000219872FC510>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x00000219873D7BA0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x0000021987229F90>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000021987232E90>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 25, in __call__
    raise dependency_exception
          └ ArgumentError('SQL expression element or literal value expected, got <db.models.User object at 0x0000021987319350>.')

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\db\connection.py", line 22, in get_db
    yield session
          └ <sqlalchemy.orm.session.AsyncSession object at 0x000002198749C450>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x00000219873D7BA0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x000002198721D310>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x0000021987229F90>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x00000219873D7BA0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x00000219856F34C0>
          └ APIRoute(path='/ad/ad_id}/edit', name='edit_ad', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x00000219873D7BA0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000021987287A60>
          └ APIRoute(path='/ad/ad_id}/edit', name='edit_ad', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x000002198747FE10>
                     └ <function get_request_handler.<locals>.app at 0x0000021987287BA0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 273, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x00000219856F1940>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 190, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x000002198749C450>, 'user': <db.models.User object at 0x00000219873193...
                 │         └ <function edit_ad at 0x0000021987218CC0>
                 └ <fastapi.dependencies.models.Dependant object at 0x00000219872DFB10>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\routes.py", line 35, in edit_ad
    return await services.edit_ad(ad_id, user, ad_data, db)
                 │        │       │      │     │        └ <sqlalchemy.orm.session.AsyncSession object at 0x000002198749C450>
                 │        │       │      │     └ AdEdit(type_id=1, title='New ad 3', category_id=0, content='string', is_published=True, owner=4, price=0.0)
                 │        │       │      └ <db.models.User object at 0x0000021987319350>
                 │        │       └ 4
                 │        └ <function edit_ad at 0x0000021986822340>
                 └ <module 'ad.services' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\ad\\services.py'>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\services.py", line 61, in edit_ad
    if user.id == ad.owner or await queries.has_user_permission(user, "edit_ads", db):
       │    │     │  │              │       │                   │                 └ <sqlalchemy.orm.session.AsyncSession object at 0x000002198749C450>
       │    │     │  │              │       │                   └ <db.models.User object at 0x0000021987319350>
       │    │     │  │              │       └ <function has_user_permission at 0x00000219868220C0>
       │    │     │  │              └ <module 'ad.queries' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\ad\\queries.py'>
       │    │     │  └ <sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x00000219867D0400>
       │    │     └ <db.models.Ad object at 0x00000219874AC290>
       │    └ <sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x00000219867F8A40>
       └ <db.models.User object at 0x0000021987319350>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\queries.py", line 105, in has_user_permission
    stmt = select(User).where(User.id == user_id)
           │      │           │    │     └ <db.models.User object at 0x0000021987319350>
           │      │           │    └ <sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x00000219867F8A40>
           │      │           └ <class 'db.models.User'>
           │      └ <class 'db.models.User'>
           └ <function select at 0x0000021985CA54E0>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\operators.py", line 582, in __eq__
    return self.operate(eq, other)
           │    │       │   └ <db.models.User object at 0x0000021987319350>
           │    │       └ <built-in function eq>
           │    └ <function QueryableAttribute.operate at 0x0000021985E8B560>
           └ <sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x00000219867F8A40>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 450, in operate
    return op(self.comparator, *other, **kwargs)  # type: ignore[return-value,no-any-return]  # noqa: E501
           │  │    │            │        └ {}
           │  │    │            └ (<db.models.User object at 0x0000021987319350>,)
           │  │    └ <member 'comparator' of 'QueryableAttribute' objects>
           │  └ <sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x00000219867F8A40>
           └ <built-in function eq>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\operators.py", line 582, in __eq__
    return self.operate(eq, other)
           │    │       │   └ <db.models.User object at 0x0000021987319350>
           │    │       └ <built-in function eq>
           │    └ <function ColumnProperty.Comparator.operate at 0x0000021985F95440>
           └ <sqlalchemy.orm.properties.ColumnProperty.Comparator object at 0x00000219867F0D60>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\properties.py", line 478, in operate
    return op(self.__clause_element__(), *other, **kwargs)  # type: ignore[return-value,no-any-return]  # noqa: E501
           │  │    │                      │        └ {}
           │  │    │                      └ (<db.models.User object at 0x0000021987319350>,)
           │  │    └ <member '__clause_element__' of 'Comparator' objects>
           │  └ <sqlalchemy.orm.properties.ColumnProperty.Comparator object at 0x00000219867F0D60>
           └ <built-in function eq>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\annotation.py", line 378, in __eq__
    return self.__element.__class__.__eq__(self, other)
           │                               │     └ <db.models.User object at 0x0000021987319350>
           │                               └ Column('id', Integer(), table=<user>, primary_key=True, nullable=False)
           └ Column('id', Integer(), table=<user>, primary_key=True, nullable=False)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\operators.py", line 582, in __eq__
    return self.operate(eq, other)
           │    │       │   └ <db.models.User object at 0x0000021987319350>
           │    │       └ <built-in function eq>
           │    └ <function ColumnElement.operate at 0x0000021985BA99E0>
           └ Column('id', Integer(), table=<user>, primary_key=True, nullable=False)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 1538, in operate
    return op(self.comparator, *other, **kwargs)  # type: ignore[return-value,no-any-return]  # noqa: E501
           │  │    │            │        └ {}
           │  │    │            └ (<db.models.User object at 0x0000021987319350>,)
           │  │    └ <sqlalchemy.sql.sqltypes.HasExpressionLookup.Comparator object at 0x00000219872FA560>
           │  └ Column('id', Integer(), table=<user>, primary_key=True, nullable=False)
           └ <built-in function eq>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\operators.py", line 582, in __eq__
    return self.operate(eq, other)
           │    │       │   └ <db.models.User object at 0x0000021987319350>
           │    │       └ <built-in function eq>
           │    └ <function TypeEngine.Comparator.operate at 0x0000021985B13740>
           └ <sqlalchemy.sql.sqltypes.HasExpressionLookup.Comparator object at 0x00000219872FA560>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\type_api.py", line 194, in operate
    return op_fn(self.expr, op, *other, **addtl_kw)  # type: ignore
           │     │    │     │    │        └ immutabledict({'negate_op': <built-in function ne>})
           │     │    │     │    └ (<db.models.User object at 0x0000021987319350>,)
           │     │    │     └ <built-in function eq>
           │     │    └ <member 'expr' of 'Comparator' objects>
           │     └ <sqlalchemy.sql.sqltypes.HasExpressionLookup.Comparator object at 0x00000219872FA560>
           └ <function _boolean_compare at 0x0000021985C65B20>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\default_comparator.py", line 122, in _boolean_compare
    obj = coercions.expect(
          │         └ <function expect at 0x0000021985A8A660>
          └ <module 'sqlalchemy.sql.coercions' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\coercions.py", line 413, in expect
    resolved = impl._literal_coercion(
               │    └ <function BinaryElementImpl._literal_coercion at 0x0000021985A8B740>
               └ <sqlalchemy.sql.coercions.BinaryElementImpl object at 0x0000021985AD2580>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\coercions.py", line 813, in _literal_coercion
    self._raise_for_expected(element, err=err)
    │    │                   └ <db.models.User object at 0x0000021987319350>
    │    └ <function ExpressionElementImpl._raise_for_expected at 0x0000021985A8B600>
    └ <sqlalchemy.sql.coercions.BinaryElementImpl object at 0x0000021985AD2580>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\coercions.py", line 799, in _raise_for_expected
    return super()._raise_for_expected(
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\coercions.py", line 535, in _raise_for_expected
    raise exc.ArgumentError(msg, code=code) from err
          │   │             │         │          └ ArgumentError('Object <db.models.User object at 0x0000021987319350> is not legal as a SQL literal value')
          │   │             │         └ None
          │   │             └ 'SQL expression element or literal value expected, got <db.models.User object at 0x0000021987319350>.'
          │   └ <class 'sqlalchemy.exc.ArgumentError'>
          └ <module 'sqlalchemy.exc' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site-...

sqlalchemy.exc.ArgumentError: SQL expression element or literal value expected, got <db.models.User object at 0x0000021987319350>.
INFO     2023-07-26 05:51:49.783 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 05:51:49.784 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 05:51:49.891 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 05:51:49.891 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 05:51:49.892 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 05:51:49.892 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 05:51:49.892 request id: app - logging:callHandlers - Finished server process [2852]
INFO     2023-07-26 05:51:49.893 request id: app - logging:callHandlers - Finished server process [2852]
INFO     2023-07-26 05:51:53.646 request id: app - logging:callHandlers - Started server process [16684]
INFO     2023-07-26 05:51:53.647 request id: app - logging:callHandlers - Started server process [16684]
INFO     2023-07-26 05:51:53.648 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 05:51:53.649 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 05:51:53.650 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 05:51:53.652 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 05:51:57.182 request id: app - logging:callHandlers - 127.0.0.1:61551 - "POST /ad/ad_id%7D/edit?ad_id=4 HTTP/1.1" 200
CRITICAL 2023-07-26 05:53:48.745 request id: None - db.connection:get_db - DataBase Error: [{'type': 'missing', 'loc': ('body', 'owner'), 'msg': 'Field required', 'input': {'type_id': 1, 'title': 'New ad 3', 'category_id': 0, 'is_published': True, 'price': 0, 'content': 'string'}, 'url': 'https://errors.pydantic.dev/2.0.3/v/missing'}]
INFO     2023-07-26 05:53:48.756 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 05:53:48.758 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 05:53:48.758 request id: app - logging:callHandlers - 127.0.0.1:61567 - "POST /ad/ad_id%7D/edit?ad_id=4 HTTP/1.1" 422
INFO     2023-07-26 05:53:48.866 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 05:53:48.867 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 05:53:48.868 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 05:53:48.868 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 05:53:48.868 request id: app - logging:callHandlers - Finished server process [16684]
INFO     2023-07-26 05:53:48.868 request id: app - logging:callHandlers - Finished server process [16684]
INFO     2023-07-26 05:53:51.604 request id: app - logging:callHandlers - Started server process [21176]
INFO     2023-07-26 05:53:51.604 request id: app - logging:callHandlers - Started server process [21176]
INFO     2023-07-26 05:53:51.605 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 05:53:51.605 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 05:53:51.606 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 05:53:51.606 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 05:53:51.930 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 05:53:51.930 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 05:53:52.038 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 05:53:52.038 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 05:53:52.038 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 05:53:52.038 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 05:53:52.039 request id: app - logging:callHandlers - Finished server process [21176]
INFO     2023-07-26 05:53:52.039 request id: app - logging:callHandlers - Finished server process [21176]
INFO     2023-07-26 05:53:54.975 request id: app - logging:callHandlers - Started server process [15536]
INFO     2023-07-26 05:53:54.975 request id: app - logging:callHandlers - Started server process [15536]
INFO     2023-07-26 05:53:54.976 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 05:53:54.976 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 05:53:54.976 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 05:53:54.977 request id: app - logging:callHandlers - Application startup complete.
CRITICAL 2023-07-26 05:53:56.847 request id: None - db.connection:get_db - DataBase Error: [{'type': 'missing', 'loc': ('body', 'owner'), 'msg': 'Field required', 'input': {'type_id': 1, 'title': 'New ad 3', 'category_id': 0, 'is_published': True, 'price': 0, 'content': 'string'}, 'url': 'https://errors.pydantic.dev/2.0.3/v/missing'}]
INFO     2023-07-26 05:53:56.856 request id: app - logging:callHandlers - 127.0.0.1:61573 - "POST /ad/ad_id%7D/edit?ad_id=4 HTTP/1.1" 422
INFO     2023-07-26 05:58:36.850 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 05:58:36.851 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 05:58:36.960 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 05:58:36.960 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 05:58:36.961 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 05:58:36.962 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 05:58:36.962 request id: app - logging:callHandlers - Finished server process [15536]
INFO     2023-07-26 05:58:36.963 request id: app - logging:callHandlers - Finished server process [15536]
INFO     2023-07-26 05:58:39.426 request id: app - logging:callHandlers - Started server process [3308]
INFO     2023-07-26 05:58:39.426 request id: app - logging:callHandlers - Started server process [3308]
INFO     2023-07-26 05:58:39.427 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 05:58:39.427 request id: app - logging:callHandlers - Waiting for application startup.
ERROR    2023-07-26 05:58:39.431 request id: app - logging:callHandlers - Traceback (most recent call last):
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 650, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 78, in serve
    await self.startup(sockets=sockets)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 89, in startup
    await self.lifespan.startup()
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\lifespan\on.py", line 56, in startup
    await self.startup_event.wait()
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\locks.py", line 213, in wait
    await fut
asyncio.exceptions.CancelledError

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 123, in run
    raise KeyboardInterrupt()
KeyboardInterrupt

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 686, in lifespan
    await receive()
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\lifespan\on.py", line 139, in receive
    return await self.receive_queue.get()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\queues.py", line 158, in get
    await getter
asyncio.exceptions.CancelledError

ERROR    2023-07-26 05:58:39.432 request id: app - logging:callHandlers - Traceback (most recent call last):
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 650, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 78, in serve
    await self.startup(sockets=sockets)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 89, in startup
    await self.lifespan.startup()
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\lifespan\on.py", line 56, in startup
    await self.startup_event.wait()
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\locks.py", line 213, in wait
    await fut
asyncio.exceptions.CancelledError

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 123, in run
    raise KeyboardInterrupt()
KeyboardInterrupt

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 686, in lifespan
    await receive()
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\lifespan\on.py", line 139, in receive
    return await self.receive_queue.get()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\queues.py", line 158, in get
    await getter
asyncio.exceptions.CancelledError

INFO     2023-07-26 05:58:43.038 request id: app - logging:callHandlers - Started server process [24196]
INFO     2023-07-26 05:58:43.038 request id: app - logging:callHandlers - Started server process [24196]
INFO     2023-07-26 05:58:43.040 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 05:58:43.041 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 05:58:43.041 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 05:58:43.042 request id: app - logging:callHandlers - Application startup complete.
CRITICAL 2023-07-26 05:58:47.569 request id: None - db.connection:get_db - DataBase Error: [{'type': 'missing', 'loc': ('body', 'owner'), 'msg': 'Field required', 'input': {'type_id': 1, 'title': 'New ad 3', 'category_id': 0, 'is_published': True, 'price': 0, 'content': 'string'}, 'url': 'https://errors.pydantic.dev/2.0.3/v/missing'}]
INFO     2023-07-26 05:58:47.579 request id: app - logging:callHandlers - 127.0.0.1:61676 - "POST /ad/ad_id%7D/edit?ad_id=4 HTTP/1.1" 422
INFO     2023-07-26 05:59:56.900 request id: app - logging:callHandlers - 127.0.0.1:61685 - "GET /docs HTTP/1.1" 200
INFO     2023-07-26 05:59:57.496 request id: app - logging:callHandlers - 127.0.0.1:61685 - "GET /openapi.json HTTP/1.1" 200
CRITICAL 2023-07-26 06:00:05.359 request id: None - db.connection:get_db - DataBase Error: [{'type': 'missing', 'loc': ('body', 'owner'), 'msg': 'Field required', 'input': {'type_id': 1, 'title': 'New ad 3', 'category_id': 0, 'is_published': True, 'price': 0, 'content': 'string'}, 'url': 'https://errors.pydantic.dev/2.0.3/v/missing'}]
INFO     2023-07-26 06:00:05.363 request id: app - logging:callHandlers - 127.0.0.1:61689 - "POST /ad/ad_id%7D/edit?ad_id=4 HTTP/1.1" 422
INFO     2023-07-26 06:01:30.626 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 06:01:30.626 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 06:01:30.736 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 06:01:30.736 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 06:01:30.737 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 06:01:30.737 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 06:01:30.738 request id: app - logging:callHandlers - Finished server process [24196]
INFO     2023-07-26 06:01:30.738 request id: app - logging:callHandlers - Finished server process [24196]
INFO     2023-07-26 06:03:26.242 request id: app - logging:callHandlers - Started server process [16100]
INFO     2023-07-26 06:03:26.243 request id: app - logging:callHandlers - Started server process [16100]
INFO     2023-07-26 06:03:26.243 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 06:03:26.244 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 06:03:26.244 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 06:03:26.244 request id: app - logging:callHandlers - Application startup complete.
CRITICAL 2023-07-26 06:03:28.080 request id: None - db.connection:get_db - DataBase Error: [{'type': 'missing', 'loc': ('body', 'owner'), 'msg': 'Field required', 'input': {'type_id': 1, 'title': 'New ad 3', 'category_id': 0, 'is_published': True, 'price': 0, 'content': 'string'}, 'url': 'https://errors.pydantic.dev/2.0.3/v/missing'}]
INFO     2023-07-26 06:03:28.096 request id: app - logging:callHandlers - 127.0.0.1:61826 - "POST /ad/ad_id%7D/edit?ad_id=4 HTTP/1.1" 422
INFO     2023-07-26 06:04:44.487 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 06:04:44.487 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 06:04:44.596 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 06:04:44.596 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 06:04:44.597 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 06:04:44.597 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 06:04:44.598 request id: app - logging:callHandlers - Finished server process [16100]
INFO     2023-07-26 06:04:44.598 request id: app - logging:callHandlers - Finished server process [16100]
INFO     2023-07-26 06:04:49.826 request id: app - logging:callHandlers - Started server process [7656]
INFO     2023-07-26 06:04:49.826 request id: app - logging:callHandlers - Started server process [7656]
INFO     2023-07-26 06:04:49.827 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 06:04:49.827 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 06:04:49.828 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 06:04:49.828 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 06:04:50.465 request id: app - logging:callHandlers - 127.0.0.1:61839 - "POST /ad/ad_id%7D/edit?ad_id=4 HTTP/1.1" 422
INFO     2023-07-26 06:07:07.058 request id: app - logging:callHandlers - 127.0.0.1:61914 - "GET /ad/4/get/ HTTP/1.1" 200
INFO     2023-07-26 06:07:35.278 request id: app - logging:callHandlers - 127.0.0.1:61919 - "POST /ad/ad_id%7D/edit?ad_id=4 HTTP/1.1" 200
INFO     2023-07-26 06:08:32.314 request id: app - logging:callHandlers - 127.0.0.1:61933 - "DELETE /ad/2/delete/ HTTP/1.1" 200
INFO     2023-07-26 06:11:37.213 request id: app - logging:callHandlers - 127.0.0.1:61959 - "POST /ad/complains/create HTTP/1.1" 200
INFO     2023-07-26 06:11:55.927 request id: app - logging:callHandlers - 127.0.0.1:61960 - "POST /ad/complains/create HTTP/1.1" 500
ERROR    2023-07-26 06:11:55.929 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 551, in _prepare_and_execute
    self._rows = await prepared_stmt.fetch(*parameters)
    │    │             │             │      └ (31, 'string', 'string', datetime.datetime(2023, 7, 26, 6, 11, 55, 922987), 4)
    │    │             │             └ <function PreparedStatement.fetch at 0x0000022464FF99E0>
    │    │             └ <asyncpg.prepared_stmt.PreparedStatement object at 0x00000224651B5580>
    │    └ <member '_rows' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x00000224652701C0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
                 │                   │        └ None
                 │                   └ (31, 'string', 'string', datetime.datetime(2023, 7, 26, 6, 11, 55, 922987), 4)
                 └ <asyncpg.prepared_stmt.PreparedStatement object at 0x00000224651B5580>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 241, in __bind_execute
    data, status, _ = await self.__do_execute(
                            └ <asyncpg.prepared_stmt.PreparedStatement object at 0x00000224651B5580>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 230, in __do_execute
    return await executor(protocol)
                 │        └ <asyncpg.protocol.protocol.Protocol object at 0x00000224651955E0>
                 └ <function PreparedStatement.__bind_execute.<locals>.<lambda> at 0x00000224652D04A0>
  File "asyncpg\protocol\protocol.pyx", line 201, in bind_execute
    return await waiter

asyncpg.exceptions.ForeignKeyViolationError: insert or update on table "complain" violates foreign key constraint "complain_ad_id_fkey"
DETAIL:  Key (ad_id)=(31) is not present in table "ad".


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1965, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000022463B88AE0>
    │    └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x0000022464F5C810>
    └ <sqlalchemy.engine.base.Connection object at 0x00000224652D7A50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 921, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ (31, 'string', 'string', datetime.datetime(2023, 7, 26, 6, 11, 55, 922987), 4)
    │      │       └ 'INSERT INTO complain (ad_id, title, description, created_at, created_by) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::...
    │      └ <function AsyncAdapt_asyncpg_cursor.execute at 0x00000224644580E0>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x00000224652701C0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 584, in execute
    self._adapt_connection.await_(
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x00000224652701C0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x0000022465298700>
           └ <_AsyncIoGreenlet object at 0x00000224652D76C0 (otid=0x0000022463671260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object Transaction.rollback at 0x00000224652B5150>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 563, in _prepare_and_execute
    self._handle_exception(error)
    │    └ <function AsyncAdapt_asyncpg_cursor._handle_exception at 0x0000022464453EC0>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x00000224652701C0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 514, in _handle_exception
    self._adapt_connection._handle_exception(error)
    │    │                                   └ ForeignKeyViolationError('insert or update on table "complain" violates foreign key constraint "complain_ad_id_fkey"')
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x00000224652701C0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 801, in _handle_exception
    raise translated_error from error
          │                     └ ForeignKeyViolationError('insert or update on table "complain" violates foreign key constraint "complain_ad_id_fkey"')
          └ IntegrityError('<class \'asyncpg.exceptions.ForeignKeyViolationError\'>: insert or update on table "complain" violates foreig...

sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.ForeignKeyViolationError'>: insert or update on table "complain" violates foreign key constraint "complain_ad_id_fkey"
DETAIL:  Key (ad_id)=(31) is not present in table "ad".


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 184
               │     └ 3
               └ <function _main at 0x000002245F16F4C0>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 184
           │    └ <function BaseProcess._bootstrap at 0x000002245F0A5080>
           └ <SpawnProcess name='SpawnProcess-1' parent=4668 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000002245F0A45E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=4668 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000002245F10E610>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=4668 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=4668 started>
    │    └ <function subprocess_started at 0x0000022461188540>
    └ <SpawnProcess name='SpawnProcess-1' parent=4668 started>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=788, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x00000224612D3290>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=788, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x000002246116B740>
           │       │   └ <uvicorn.server.Server object at 0x00000224612D3290>
           │       └ <function run at 0x0000022460B236A0>
           └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x00000224612E08C0>
           │      └ <function Runner.run at 0x0000022460B23B00>
           └ <asyncio.runners.Runner object at 0x00000224612D3710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x0000022460B21580>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x00000224612D3710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000022460B214E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000022460B232E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000022460A8F2E0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
> File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000224612DE7D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022465...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x00000224613F9610>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000224612DE7D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\applications.py", line 289, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022465...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022465...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000002246504D9D0>
          └ <fastapi.applications.FastAPI object at 0x00000224613F9610>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000022465283CE0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000022464FC9A50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000002246504D9D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x00000224651CC180>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x0000022465060A50>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000022464FC9A50>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
          │    │   │      │    │      └ <traceback object at 0x00000224652DCCC0>
          │    │   │      │    └ IntegrityError('(sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class \'asyncpg.exceptions.ForeignKeyViolationError\...
          │    │   │      └ <class 'sqlalchemy.exc.IntegrityError'>
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object get_db at 0x00000224652C51C0>
          └ <contextlib._AsyncGeneratorContextManager object at 0x00000224652CA390>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\db\connection.py", line 21, in get_db
    try:

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x00000224651CC180>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x000002246506B790>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x0000022465060A50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x00000224651CC180>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x00000224634FF4C0>
          └ APIRoute(path='/ad/complains/create', name='complain_ad', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x00000224651CC180>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x00000224651044A0>
          └ APIRoute(path='/ad/complains/create', name='complain_ad', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x00000224652CA190>
                     └ <function get_request_handler.<locals>.app at 0x00000224651045E0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 273, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x00000224634FD940>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 190, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x000002246528EF50>, 'user': <db.models.User object at 0x00000224652DC1...
                 │         └ <function complain_ad at 0x00000224650344A0>
                 └ <fastapi.dependencies.models.Dependant object at 0x00000224650B23D0>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\routes.py", line 45, in complain_ad
    return await services.create_complain(complain, db, user)
                 │        │               │         │   └ <db.models.User object at 0x00000224652DC1D0>
                 │        │               │         └ <sqlalchemy.orm.session.AsyncSession object at 0x000002246528EF50>
                 │        │               └ ComplainBase(ad_id=31, title='string', description='string', created_by=4, created_at=datetime.datetime(2023, 7, 26, 6, 11, 5...
                 │        └ <function create_complain at 0x00000224646427A0>
                 └ <module 'ad.services' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\ad\\services.py'>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\services.py", line 71, in create_complain
    return await queries.create_complain(complain, db)
                 │       │               │         └ <sqlalchemy.orm.session.AsyncSession object at 0x000002246528EF50>
                 │       │               └ ComplainBase(ad_id=31, title='string', description='string', created_by=4, created_at=datetime.datetime(2023, 7, 26, 6, 11, 5...
                 │       └ <function create_complain at 0x00000224646420C0>
                 └ <module 'ad.queries' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\ad\\queries.py'>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\queries.py", line 56, in create_complain
    await db.commit()
          │  └ <function AsyncSession.commit at 0x0000022463F58CC0>
          └ <sqlalchemy.orm.session.AsyncSession object at 0x000002246528EF50>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 944, in commit
    await greenlet_spawn(self.sync_session.commit)
          │              │    │            └ <function Session.commit at 0x0000022463E8C4A0>
          │              │    └ <sqlalchemy.orm.session.Session object at 0x000002246511A2D0>
          │              └ <sqlalchemy.orm.session.AsyncSession object at 0x000002246528EF50>
          └ <function greenlet_spawn at 0x0000022463706020>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 192, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x00000224652D76C0 (otid=0x0000022463671260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1920, in commit
    trans.commit(_to_root=True)
    │     └ <function SessionTransaction.commit at 0x0000022463E87600>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x00000224652968A0>
  File "<string>", line 2, in commit
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {'_to_root': True}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x00000224652968A0>
                └ <function SessionTransaction.commit at 0x0000022463E87420>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1236, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x0000022463E872E0>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x00000224652968A0>
  File "<string>", line 2, in _prepare_impl
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x00000224652968A0>
                └ <function SessionTransaction._prepare_impl at 0x0000022463E87240>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1211, in _prepare_impl
    self.session.flush()
    │    │       └ <function Session.flush at 0x0000022463E8F1A0>
    │    └ <sqlalchemy.orm.session.Session object at 0x000002246511A2D0>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x00000224652968A0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4163, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x0000022463E8F380>
    └ <sqlalchemy.orm.session.Session object at 0x000002246511A2D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4298, in _flush
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x00000224652DC8C0>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ IntegrityError('(sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class \'asyncpg.exceptions.ForeignKeyViolationError\...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4259, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x0000022463E57F60>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x00000224652D7B10>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x00000224652D7B10>
    │   └ <function SaveUpdateAll.execute at 0x0000022463E84AE0>
    └ SaveUpdateAll(Mapper[Complain(complain)])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x0000022463E0AFC0>
    │    │         └ <module 'sqlalchemy.orm.persistence' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv...
    │    └ <module 'sqlalchemy.util.preloaded' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\...
    └ <module 'sqlalchemy.util' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x0000022463E42F20>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1226, in _emit_insert_statements
    result = connection.execute(
             │          └ <function Connection.execute at 0x0000022463AF9D00>
             └ <sqlalchemy.engine.base.Connection object at 0x00000224652D7A50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1412, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x00000224652CAED0>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x0000022463AFA020>
           └ <sqlalchemy.engine.base.Connection object at 0x00000224652D7A50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x0000022463AFA200>
          └ <sqlalchemy.engine.base.Connection object at 0x00000224652D7A50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1844, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x0000022463AFA2A0>
           └ <sqlalchemy.engine.base.Connection object at 0x00000224652D7A50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1984, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x0000022463AFA520>
    └ <sqlalchemy.engine.base.Connection object at 0x00000224652D7A50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ IntegrityError('<class \'asyncpg.exceptions.ForeignKeyViolationError\'>: insert or update on table "complain" violates foreig...
          │                    │              └ (<class 'sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError'>, IntegrityError('<class \'asyncpg.e...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ IntegrityError('(sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class \'asyncpg.exceptions.ForeignKeyViolationError\...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1965, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000022463B88AE0>
    │    └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x0000022464F5C810>
    └ <sqlalchemy.engine.base.Connection object at 0x00000224652D7A50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 921, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ (31, 'string', 'string', datetime.datetime(2023, 7, 26, 6, 11, 55, 922987), 4)
    │      │       └ 'INSERT INTO complain (ad_id, title, description, created_at, created_by) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::...
    │      └ <function AsyncAdapt_asyncpg_cursor.execute at 0x00000224644580E0>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x00000224652701C0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 584, in execute
    self._adapt_connection.await_(
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x00000224652701C0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x0000022465298700>
           └ <_AsyncIoGreenlet object at 0x00000224652D76C0 (otid=0x0000022463671260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object Transaction.rollback at 0x00000224652B5150>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 563, in _prepare_and_execute
    self._handle_exception(error)
    │    └ <function AsyncAdapt_asyncpg_cursor._handle_exception at 0x0000022464453EC0>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x00000224652701C0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 514, in _handle_exception
    self._adapt_connection._handle_exception(error)
    │    │                                   └ ForeignKeyViolationError('insert or update on table "complain" violates foreign key constraint "complain_ad_id_fkey"')
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x00000224652701C0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 801, in _handle_exception
    raise translated_error from error
          │                     └ ForeignKeyViolationError('insert or update on table "complain" violates foreign key constraint "complain_ad_id_fkey"')
          └ IntegrityError('<class \'asyncpg.exceptions.ForeignKeyViolationError\'>: insert or update on table "complain" violates foreig...

sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.ForeignKeyViolationError'>: insert or update on table "complain" violates foreign key constraint "complain_ad_id_fkey"
DETAIL:  Key (ad_id)=(31) is not present in table "ad".
[SQL: INSERT INTO complain (ad_id, title, description, created_at, created_by) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::INTEGER) RETURNING complain.id]
[parameters: (31, 'string', 'string', datetime.datetime(2023, 7, 26, 6, 11, 55, 922987), 4)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
ERROR    2023-07-26 06:11:56.108 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 551, in _prepare_and_execute
    self._rows = await prepared_stmt.fetch(*parameters)
    │    │             │             │      └ (31, 'string', 'string', datetime.datetime(2023, 7, 26, 6, 11, 55, 922987), 4)
    │    │             │             └ <function PreparedStatement.fetch at 0x0000022464FF99E0>
    │    │             └ <asyncpg.prepared_stmt.PreparedStatement object at 0x00000224651B5580>
    │    └ <member '_rows' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x00000224652701C0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
                 │                   │        └ None
                 │                   └ (31, 'string', 'string', datetime.datetime(2023, 7, 26, 6, 11, 55, 922987), 4)
                 └ <asyncpg.prepared_stmt.PreparedStatement object at 0x00000224651B5580>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 241, in __bind_execute
    data, status, _ = await self.__do_execute(
                            └ <asyncpg.prepared_stmt.PreparedStatement object at 0x00000224651B5580>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 230, in __do_execute
    return await executor(protocol)
                 │        └ <asyncpg.protocol.protocol.Protocol object at 0x00000224651955E0>
                 └ <function PreparedStatement.__bind_execute.<locals>.<lambda> at 0x00000224652D04A0>
  File "asyncpg\protocol\protocol.pyx", line 201, in bind_execute
    return await waiter

asyncpg.exceptions.ForeignKeyViolationError: insert or update on table "complain" violates foreign key constraint "complain_ad_id_fkey"
DETAIL:  Key (ad_id)=(31) is not present in table "ad".


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1965, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000022463B88AE0>
    │    └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x0000022464F5C810>
    └ <sqlalchemy.engine.base.Connection object at 0x00000224652D7A50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 921, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ (31, 'string', 'string', datetime.datetime(2023, 7, 26, 6, 11, 55, 922987), 4)
    │      │       └ 'INSERT INTO complain (ad_id, title, description, created_at, created_by) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::...
    │      └ <function AsyncAdapt_asyncpg_cursor.execute at 0x00000224644580E0>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x00000224652701C0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 584, in execute
    self._adapt_connection.await_(
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x00000224652701C0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x0000022465298700>
           └ <_AsyncIoGreenlet object at 0x00000224652D76C0 (otid=0x0000022463671260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object Transaction.rollback at 0x00000224652B5150>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 563, in _prepare_and_execute
    self._handle_exception(error)
    │    └ <function AsyncAdapt_asyncpg_cursor._handle_exception at 0x0000022464453EC0>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x00000224652701C0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 514, in _handle_exception
    self._adapt_connection._handle_exception(error)
    │    │                                   └ ForeignKeyViolationError('insert or update on table "complain" violates foreign key constraint "complain_ad_id_fkey"')
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x00000224652701C0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 801, in _handle_exception
    raise translated_error from error
          │                     └ ForeignKeyViolationError('insert or update on table "complain" violates foreign key constraint "complain_ad_id_fkey"')
          └ IntegrityError('<class \'asyncpg.exceptions.ForeignKeyViolationError\'>: insert or update on table "complain" violates foreig...

sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.ForeignKeyViolationError'>: insert or update on table "complain" violates foreign key constraint "complain_ad_id_fkey"
DETAIL:  Key (ad_id)=(31) is not present in table "ad".


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 184
               │     └ 3
               └ <function _main at 0x000002245F16F4C0>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 184
           │    └ <function BaseProcess._bootstrap at 0x000002245F0A5080>
           └ <SpawnProcess name='SpawnProcess-1' parent=4668 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000002245F0A45E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=4668 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000002245F10E610>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=4668 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=4668 started>
    │    └ <function subprocess_started at 0x0000022461188540>
    └ <SpawnProcess name='SpawnProcess-1' parent=4668 started>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=788, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x00000224612D3290>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=788, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x000002246116B740>
           │       │   └ <uvicorn.server.Server object at 0x00000224612D3290>
           │       └ <function run at 0x0000022460B236A0>
           └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x00000224612E08C0>
           │      └ <function Runner.run at 0x0000022460B23B00>
           └ <asyncio.runners.Runner object at 0x00000224612D3710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x0000022460B21580>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x00000224612D3710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000022460B214E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000022460B232E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000022460A8F2E0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
> File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000224612DE7D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022465...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x00000224613F9610>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000224612DE7D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\applications.py", line 289, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022465...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022465...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000002246504D9D0>
          └ <fastapi.applications.FastAPI object at 0x00000224613F9610>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000022465283CE0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000022464FC9A50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000002246504D9D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x00000224651CC180>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x0000022465060A50>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000022464FC9A50>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
          │    │   │      │    │      └ <traceback object at 0x00000224652DCCC0>
          │    │   │      │    └ IntegrityError('(sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class \'asyncpg.exceptions.ForeignKeyViolationError\...
          │    │   │      └ <class 'sqlalchemy.exc.IntegrityError'>
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object get_db at 0x00000224652C51C0>
          └ <contextlib._AsyncGeneratorContextManager object at 0x00000224652CA390>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\db\connection.py", line 21, in get_db
    try:

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x00000224651CC180>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x000002246506B790>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x0000022465060A50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x00000224651CC180>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x00000224634FF4C0>
          └ APIRoute(path='/ad/complains/create', name='complain_ad', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x00000224651CC180>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x00000224651044A0>
          └ APIRoute(path='/ad/complains/create', name='complain_ad', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x00000224652CA190>
                     └ <function get_request_handler.<locals>.app at 0x00000224651045E0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 273, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x00000224634FD940>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 190, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x000002246528EF50>, 'user': <db.models.User object at 0x00000224652DC1...
                 │         └ <function complain_ad at 0x00000224650344A0>
                 └ <fastapi.dependencies.models.Dependant object at 0x00000224650B23D0>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\routes.py", line 45, in complain_ad
    return await services.create_complain(complain, db, user)
                 │        │               │         │   └ <db.models.User object at 0x00000224652DC1D0>
                 │        │               │         └ <sqlalchemy.orm.session.AsyncSession object at 0x000002246528EF50>
                 │        │               └ ComplainBase(ad_id=31, title='string', description='string', created_by=4, created_at=datetime.datetime(2023, 7, 26, 6, 11, 5...
                 │        └ <function create_complain at 0x00000224646427A0>
                 └ <module 'ad.services' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\ad\\services.py'>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\services.py", line 71, in create_complain
    return await queries.create_complain(complain, db)
                 │       │               │         └ <sqlalchemy.orm.session.AsyncSession object at 0x000002246528EF50>
                 │       │               └ ComplainBase(ad_id=31, title='string', description='string', created_by=4, created_at=datetime.datetime(2023, 7, 26, 6, 11, 5...
                 │       └ <function create_complain at 0x00000224646420C0>
                 └ <module 'ad.queries' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\ad\\queries.py'>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\queries.py", line 56, in create_complain
    await db.commit()
          │  └ <function AsyncSession.commit at 0x0000022463F58CC0>
          └ <sqlalchemy.orm.session.AsyncSession object at 0x000002246528EF50>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 944, in commit
    await greenlet_spawn(self.sync_session.commit)
          │              │    │            └ <function Session.commit at 0x0000022463E8C4A0>
          │              │    └ <sqlalchemy.orm.session.Session object at 0x000002246511A2D0>
          │              └ <sqlalchemy.orm.session.AsyncSession object at 0x000002246528EF50>
          └ <function greenlet_spawn at 0x0000022463706020>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 192, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x00000224652D76C0 (otid=0x0000022463671260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1920, in commit
    trans.commit(_to_root=True)
    │     └ <function SessionTransaction.commit at 0x0000022463E87600>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x00000224652968A0>
  File "<string>", line 2, in commit
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {'_to_root': True}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x00000224652968A0>
                └ <function SessionTransaction.commit at 0x0000022463E87420>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1236, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x0000022463E872E0>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x00000224652968A0>
  File "<string>", line 2, in _prepare_impl
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x00000224652968A0>
                └ <function SessionTransaction._prepare_impl at 0x0000022463E87240>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1211, in _prepare_impl
    self.session.flush()
    │    │       └ <function Session.flush at 0x0000022463E8F1A0>
    │    └ <sqlalchemy.orm.session.Session object at 0x000002246511A2D0>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x00000224652968A0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4163, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x0000022463E8F380>
    └ <sqlalchemy.orm.session.Session object at 0x000002246511A2D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4298, in _flush
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x00000224652DC8C0>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ IntegrityError('(sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class \'asyncpg.exceptions.ForeignKeyViolationError\...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4259, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x0000022463E57F60>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x00000224652D7B10>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x00000224652D7B10>
    │   └ <function SaveUpdateAll.execute at 0x0000022463E84AE0>
    └ SaveUpdateAll(Mapper[Complain(complain)])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x0000022463E0AFC0>
    │    │         └ <module 'sqlalchemy.orm.persistence' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv...
    │    └ <module 'sqlalchemy.util.preloaded' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\...
    └ <module 'sqlalchemy.util' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x0000022463E42F20>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1226, in _emit_insert_statements
    result = connection.execute(
             │          └ <function Connection.execute at 0x0000022463AF9D00>
             └ <sqlalchemy.engine.base.Connection object at 0x00000224652D7A50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1412, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x00000224652CAED0>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x0000022463AFA020>
           └ <sqlalchemy.engine.base.Connection object at 0x00000224652D7A50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x0000022463AFA200>
          └ <sqlalchemy.engine.base.Connection object at 0x00000224652D7A50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1844, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x0000022463AFA2A0>
           └ <sqlalchemy.engine.base.Connection object at 0x00000224652D7A50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1984, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x0000022463AFA520>
    └ <sqlalchemy.engine.base.Connection object at 0x00000224652D7A50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ IntegrityError('<class \'asyncpg.exceptions.ForeignKeyViolationError\'>: insert or update on table "complain" violates foreig...
          │                    │              └ (<class 'sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError'>, IntegrityError('<class \'asyncpg.e...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ IntegrityError('(sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class \'asyncpg.exceptions.ForeignKeyViolationError\...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1965, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000022463B88AE0>
    │    └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x0000022464F5C810>
    └ <sqlalchemy.engine.base.Connection object at 0x00000224652D7A50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 921, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ (31, 'string', 'string', datetime.datetime(2023, 7, 26, 6, 11, 55, 922987), 4)
    │      │       └ 'INSERT INTO complain (ad_id, title, description, created_at, created_by) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::...
    │      └ <function AsyncAdapt_asyncpg_cursor.execute at 0x00000224644580E0>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x00000224652701C0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 584, in execute
    self._adapt_connection.await_(
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x00000224652701C0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x0000022465298700>
           └ <_AsyncIoGreenlet object at 0x00000224652D76C0 (otid=0x0000022463671260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object Transaction.rollback at 0x00000224652B5150>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 563, in _prepare_and_execute
    self._handle_exception(error)
    │    └ <function AsyncAdapt_asyncpg_cursor._handle_exception at 0x0000022464453EC0>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x00000224652701C0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 514, in _handle_exception
    self._adapt_connection._handle_exception(error)
    │    │                                   └ ForeignKeyViolationError('insert or update on table "complain" violates foreign key constraint "complain_ad_id_fkey"')
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x00000224652701C0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 801, in _handle_exception
    raise translated_error from error
          │                     └ ForeignKeyViolationError('insert or update on table "complain" violates foreign key constraint "complain_ad_id_fkey"')
          └ IntegrityError('<class \'asyncpg.exceptions.ForeignKeyViolationError\'>: insert or update on table "complain" violates foreig...

sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.ForeignKeyViolationError'>: insert or update on table "complain" violates foreign key constraint "complain_ad_id_fkey"
DETAIL:  Key (ad_id)=(31) is not present in table "ad".
[SQL: INSERT INTO complain (ad_id, title, description, created_at, created_by) VALUES ($1::INTEGER, $2::VARCHAR, $3::VARCHAR, $4::TIMESTAMP WITHOUT TIME ZONE, $5::INTEGER) RETURNING complain.id]
[parameters: (31, 'string', 'string', datetime.datetime(2023, 7, 26, 6, 11, 55, 922987), 4)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
INFO     2023-07-26 06:14:09.688 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 06:14:09.688 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 06:14:09.798 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 06:14:09.798 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 06:14:09.799 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 06:14:09.800 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 06:14:09.800 request id: app - logging:callHandlers - Finished server process [7656]
INFO     2023-07-26 06:14:09.801 request id: app - logging:callHandlers - Finished server process [7656]
INFO     2023-07-26 06:14:14.382 request id: app - logging:callHandlers - Started server process [14944]
INFO     2023-07-26 06:14:14.383 request id: app - logging:callHandlers - Started server process [14944]
INFO     2023-07-26 06:14:14.383 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 06:14:14.384 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 06:14:14.384 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 06:14:14.385 request id: app - logging:callHandlers - Application startup complete.
CRITICAL 2023-07-26 06:14:16.400 request id: None - db.connection:get_db - DataBase Error: 
INFO     2023-07-26 06:14:16.432 request id: app - logging:callHandlers - 127.0.0.1:61977 - "POST /ad/complains/create HTTP/1.1" 404
INFO     2023-07-26 06:18:14.376 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 06:18:14.376 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 06:18:14.487 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 06:18:14.487 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 06:18:14.488 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 06:18:14.488 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 06:18:14.489 request id: app - logging:callHandlers - Finished server process [14944]
INFO     2023-07-26 06:18:14.489 request id: app - logging:callHandlers - Finished server process [14944]
INFO     2023-07-26 06:18:17.177 request id: app - logging:callHandlers - Started server process [2652]
INFO     2023-07-26 06:18:17.177 request id: app - logging:callHandlers - Started server process [2652]
INFO     2023-07-26 06:18:17.177 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 06:18:17.178 request id: app - logging:callHandlers - Waiting for application startup.
ERROR    2023-07-26 06:18:17.184 request id: app - logging:callHandlers - Traceback (most recent call last):
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 650, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 78, in serve
    await self.startup(sockets=sockets)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 89, in startup
    await self.lifespan.startup()
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\lifespan\on.py", line 56, in startup
    await self.startup_event.wait()
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\locks.py", line 213, in wait
    await fut
asyncio.exceptions.CancelledError

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 123, in run
    raise KeyboardInterrupt()
KeyboardInterrupt

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 686, in lifespan
    await receive()
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\lifespan\on.py", line 139, in receive
    return await self.receive_queue.get()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\queues.py", line 158, in get
    await getter
asyncio.exceptions.CancelledError

ERROR    2023-07-26 06:18:17.185 request id: app - logging:callHandlers - Traceback (most recent call last):
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 650, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 78, in serve
    await self.startup(sockets=sockets)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 89, in startup
    await self.lifespan.startup()
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\lifespan\on.py", line 56, in startup
    await self.startup_event.wait()
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\locks.py", line 213, in wait
    await fut
asyncio.exceptions.CancelledError

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 123, in run
    raise KeyboardInterrupt()
KeyboardInterrupt

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 686, in lifespan
    await receive()
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\lifespan\on.py", line 139, in receive
    return await self.receive_queue.get()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\queues.py", line 158, in get
    await getter
asyncio.exceptions.CancelledError

INFO     2023-07-26 06:18:19.745 request id: app - logging:callHandlers - Started server process [7768]
INFO     2023-07-26 06:18:19.745 request id: app - logging:callHandlers - Started server process [7768]
INFO     2023-07-26 06:18:19.746 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 06:18:19.747 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 06:18:19.748 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 06:18:19.748 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 06:18:35.460 request id: app - logging:callHandlers - Started server process [10380]
INFO     2023-07-26 06:18:35.460 request id: app - logging:callHandlers - Started server process [10380]
INFO     2023-07-26 06:18:35.460 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 06:18:35.461 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 06:18:35.461 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 06:18:35.461 request id: app - logging:callHandlers - Application startup complete.
CRITICAL 2023-07-26 06:18:35.896 request id: None - db.connection:get_db - DataBase Error: 
INFO     2023-07-26 06:18:35.897 request id: app - logging:callHandlers - 127.0.0.1:62086 - "POST /ad/complains/create HTTP/1.1" 404
INFO     2023-07-26 06:21:23.517 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 06:21:23.518 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 06:21:23.625 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 06:21:23.625 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 06:21:23.626 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 06:21:23.627 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 06:21:23.628 request id: app - logging:callHandlers - Finished server process [10380]
INFO     2023-07-26 06:21:23.628 request id: app - logging:callHandlers - Finished server process [10380]
INFO     2023-07-26 06:21:27.374 request id: app - logging:callHandlers - Started server process [2984]
INFO     2023-07-26 06:21:27.375 request id: app - logging:callHandlers - Started server process [2984]
INFO     2023-07-26 06:21:27.376 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 06:21:27.377 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 06:21:27.378 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 06:21:27.378 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 06:21:45.505 request id: app - logging:callHandlers - 127.0.0.1:62137 - "POST /ad/complains/create HTTP/1.1" 404
INFO     2023-07-26 06:21:58.356 request id: app - logging:callHandlers - 127.0.0.1:62139 - "POST /ad/complains/create HTTP/1.1" 500
ERROR    2023-07-26 06:21:58.358 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 834, in _start_transaction
    self._transaction = self._connection.transaction(
    │    │              │    └ <member '_connection' of 'AdaptedConnection' objects>
    │    │              └ <AdaptedConnection <asyncpg.connection.Connection object at 0x000001DB0AC50120>>
    │    └ <member '_transaction' of 'AsyncAdapt_asyncpg_connection' objects>
    └ <AdaptedConnection <asyncpg.connection.Connection object at 0x000001DB0AC50120>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connection.py", line 274, in transaction
    self._check_open()
    │    └ <function Connection._check_open at 0x000001DB0AA98720>
    └ <asyncpg.connection.Connection object at 0x000001DB0AC50120>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connection.py", line 1399, in _check_open
    raise exceptions.InterfaceError('connection is closed')
          │          └ <class 'asyncpg.exceptions._base.InterfaceError'>
          └ <module 'asyncpg.exceptions' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\s...

asyncpg.exceptions._base.InterfaceError: connection is closed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1965, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000001DB09620AE0>
    │    └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x000001DB0A9EC650>
    └ <sqlalchemy.engine.base.Connection object at 0x000001DB0AC71290>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 921, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ (4,)
    │      │       └ 'SELECT "user".id, "user".username, "user".first_name, "user".last_name, "user".role_id, "user".email, "user".hashed_password...
    │      └ <function AsyncAdapt_asyncpg_cursor.execute at 0x000001DB09EE80E0>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000001DB0AC2F460>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 584, in execute
    self._adapt_connection.await_(
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000001DB0AC2F460>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x000001DB0AA129E0>
           └ <_AsyncIoGreenlet object at 0x000001DB0AAFF9C0 (otid=0x000001DB09101260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x000001DB0AA129E0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 521, in _prepare_and_execute
    await adapt_connection._start_transaction()
          │                └ <function AsyncAdapt_asyncpg_connection._start_transaction at 0x000001DB09EE9120>
          └ <AdaptedConnection <asyncpg.connection.Connection object at 0x000001DB0AC50120>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 841, in _start_transaction
    self._handle_exception(error)
    │    └ <function AsyncAdapt_asyncpg_connection._handle_exception at 0x000001DB09EE8E00>
    └ <AdaptedConnection <asyncpg.connection.Connection object at 0x000001DB0AC50120>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 801, in _handle_exception
    raise translated_error from error
          │                     └ InterfaceError('connection is closed')
          └ InterfaceError("<class 'asyncpg.exceptions._base.InterfaceError'>: connection is closed")

sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: connection is closed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 376
               │     └ 3
               └ <function _main at 0x000001DB04C6F4C0>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 376
           │    └ <function BaseProcess._bootstrap at 0x000001DB04BC5080>
           └ <SpawnProcess name='SpawnProcess-1' parent=4184 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001DB04BC45E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=4184 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001DB04C2E610>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=4184 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=4184 started>
    │    └ <function subprocess_started at 0x000001DB06C28540>
    └ <SpawnProcess name='SpawnProcess-1' parent=4184 started>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=788, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000001DB06D63290>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=788, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x000001DB06C0B740>
           │       │   └ <uvicorn.server.Server object at 0x000001DB06D63290>
           │       └ <function run at 0x000001DB069F36A0>
           └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000001DB06D708C0>
           │      └ <function Runner.run at 0x000001DB069F3B00>
           └ <asyncio.runners.Runner object at 0x000001DB06D63710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000001DB069F1580>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000001DB06D63710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001DB069F14E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001DB069F32E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001DB0656F2E0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
> File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001DB0AADF490>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001DB0A...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001D...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000001DB0AA64250>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001DB0AADF490>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\applications.py", line 289, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001DB0A...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001D...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001DB0A...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001D...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001DB09A12F90>
          └ <fastapi.applications.FastAPI object at 0x000001DB0AA64250>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001DB0B06F6A0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001D...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001DB0AB44490>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001DB09A12F90>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000001DB0B06FCE0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001D...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x000001DB0AADF290>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001DB0AB44490>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
          │    │   │      │    │      └ <traceback object at 0x000001DB0B08B7C0>
          │    │   │      │    └ InterfaceError("(sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: co...
          │    │   │      └ <class 'sqlalchemy.exc.InterfaceError'>
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object get_db at 0x000001DB0AC6BF10>
          └ <contextlib._AsyncGeneratorContextManager object at 0x000001DB0B08A610>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\db\connection.py", line 23, in get_db
    yield session
          └ <sqlalchemy.orm.session.AsyncSession object at 0x000001DB0B08A650>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000001DB0B06FCE0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001D...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x000001DB06E7C750>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x000001DB0AADF290>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000001DB0B06FCE0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001D...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x000001DB08FA34C0>
          └ APIRoute(path='/ad/complains/create', name='complain_ad', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000001DB0B06FCE0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001D...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x000001DB0AB944A0>
          └ APIRoute(path='/ad/complains/create', name='complain_ad', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x000001DB0B08A150>
                     └ <function get_request_handler.<locals>.app at 0x000001DB0AB945E0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 263, in app
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x000001DB08F6BC40>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\dependencies\utils.py", line 584, in solve_dependencies
    solved = await call(**sub_values)
                   │      └ {'user_manager': <auth.manager.UserManager object at 0x000001DB0B08AB10>, 'jwt': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdW...
                   └ <function Authenticator.current_user.<locals>.current_user_dependency at 0x000001DB0AAB39C0>
  File "<makefun-gen-0>", line 2, in current_user_dependency
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\authentication\authenticator.py", line 136, in current_user_dependency
    user, _ = await self._authenticate(
                    │    └ <function Authenticator._authenticate at 0x000001DB09DE51C0>
                    └ <fastapi_users.authentication.authenticator.Authenticator object at 0x000001DB0A0F9D10>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\authentication\authenticator.py", line 170, in _authenticate
    user = await strategy.read_token(token, user_manager)
                 │        │          │      └ <auth.manager.UserManager object at 0x000001DB0B08AB10>
                 │        │          └ 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI0IiwiYXVkIjpbImZhc3RhcGktdXNlcnM6YXV0aCJdLCJleHAiOjE2OTA0MTM5NTd9.tjqhO6xSK_...
                 │        └ <function JWTStrategy.read_token at 0x000001DB09DD7A60>
                 └ <fastapi_users.authentication.strategy.jwt.JWTStrategy object at 0x000001DB0AC30C90>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\authentication\strategy\jwt.py", line 55, in read_token
    return await user_manager.get(parsed_id)
                 │            │   └ 4
                 │            └ <function BaseUserManager.get at 0x000001DB09DD5D00>
                 └ <auth.manager.UserManager object at 0x000001DB0B08AB10>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\manager.py", line 72, in get
    user = await self.user_db.get(id)
                 │    │       │   └ 4
                 │    │       └ <function SQLAlchemyUserDatabase.get at 0x000001DB09F1F380>
                 │    └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x000001DB0B08AA50>
                 └ <auth.manager.UserManager object at 0x000001DB0B08AB10>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users_db_sqlalchemy\__init__.py", line 121, in get
    return await self._get_user(statement)
                 │    │         └ <sqlalchemy.sql.selectable.Select object at 0x000001DB0AB01BD0>
                 │    └ <function SQLAlchemyUserDatabase._get_user at 0x000001DB09F1F880>
                 └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x000001DB0B08AA50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users_db_sqlalchemy\__init__.py", line 186, in _get_user
    results = await self.session.execute(statement)
                    │    │       │       └ <sqlalchemy.sql.selectable.Select object at 0x000001DB0AB01BD0>
                    │    │       └ <function AsyncSession.execute at 0x000001DB099D7B00>
                    │    └ <sqlalchemy.orm.session.AsyncSession object at 0x000001DB0B08A650>
                    └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x000001DB0B08AA50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 439, in execute
    result = await greenlet_spawn(
                   └ <function greenlet_spawn at 0x000001DB09196020>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             │       │      │   └ <built-in function exc_info>
             │       │      └ <module 'sys' (built-in)>
             │       └ <method 'throw' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x000001DB0AAFF9C0 (otid=0x000001DB09101260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2246, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x000001DB09918900>
           └ <sqlalchemy.orm.session.Session object at 0x000001DB0B08A690>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2141, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                   │      │                 └ <classmethod(<function AbstractORMCompileState.orm_execute_statement at 0x000001DB097C68E0>)>
                   │      └ <class 'sqlalchemy.orm.context.ORMSelectCompileState'>
                   └ typing.Any
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
             │    └ <function Connection.execute at 0x000001DB09591D00>
             └ <sqlalchemy.engine.base.Connection object at 0x000001DB0AC71290>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1412, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.selectable.Select object at 0x000001DB0AB01BD0>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x000001DB09592020>
           └ <sqlalchemy.engine.base.Connection object at 0x000001DB0AC71290>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x000001DB09592200>
          └ <sqlalchemy.engine.base.Connection object at 0x000001DB0AC71290>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1844, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x000001DB095922A0>
           └ <sqlalchemy.engine.base.Connection object at 0x000001DB0AC71290>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1984, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x000001DB09592520>
    └ <sqlalchemy.engine.base.Connection object at 0x000001DB0AC71290>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ InterfaceError("<class 'asyncpg.exceptions._base.InterfaceError'>: connection is closed")
          │                    │              └ (<class 'sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError'>, InterfaceError("<class 'asyncpg.ex...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ InterfaceError("(sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: co...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1965, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000001DB09620AE0>
    │    └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x000001DB0A9EC650>
    └ <sqlalchemy.engine.base.Connection object at 0x000001DB0AC71290>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 921, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ (4,)
    │      │       └ 'SELECT "user".id, "user".username, "user".first_name, "user".last_name, "user".role_id, "user".email, "user".hashed_password...
    │      └ <function AsyncAdapt_asyncpg_cursor.execute at 0x000001DB09EE80E0>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000001DB0AC2F460>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 584, in execute
    self._adapt_connection.await_(
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000001DB0AC2F460>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x000001DB0AA129E0>
           └ <_AsyncIoGreenlet object at 0x000001DB0AAFF9C0 (otid=0x000001DB09101260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x000001DB0AA129E0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 521, in _prepare_and_execute
    await adapt_connection._start_transaction()
          │                └ <function AsyncAdapt_asyncpg_connection._start_transaction at 0x000001DB09EE9120>
          └ <AdaptedConnection <asyncpg.connection.Connection object at 0x000001DB0AC50120>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 841, in _start_transaction
    self._handle_exception(error)
    │    └ <function AsyncAdapt_asyncpg_connection._handle_exception at 0x000001DB09EE8E00>
    └ <AdaptedConnection <asyncpg.connection.Connection object at 0x000001DB0AC50120>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 801, in _handle_exception
    raise translated_error from error
          │                     └ InterfaceError('connection is closed')
          └ InterfaceError("<class 'asyncpg.exceptions._base.InterfaceError'>: connection is closed")

sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: connection is closed
[SQL: SELECT "user".id, "user".username, "user".first_name, "user".last_name, "user".role_id, "user".email, "user".hashed_password, "user".is_active, "user".is_superuser, "user".is_verified 
FROM "user" 
WHERE "user".id = $1::INTEGER]
[parameters: (4,)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
ERROR    2023-07-26 06:21:58.410 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 834, in _start_transaction
    self._transaction = self._connection.transaction(
    │    │              │    └ <member '_connection' of 'AdaptedConnection' objects>
    │    │              └ <AdaptedConnection <asyncpg.connection.Connection object at 0x000001DB0AC50120>>
    │    └ <member '_transaction' of 'AsyncAdapt_asyncpg_connection' objects>
    └ <AdaptedConnection <asyncpg.connection.Connection object at 0x000001DB0AC50120>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connection.py", line 274, in transaction
    self._check_open()
    │    └ <function Connection._check_open at 0x000001DB0AA98720>
    └ <asyncpg.connection.Connection object at 0x000001DB0AC50120>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connection.py", line 1399, in _check_open
    raise exceptions.InterfaceError('connection is closed')
          │          └ <class 'asyncpg.exceptions._base.InterfaceError'>
          └ <module 'asyncpg.exceptions' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\s...

asyncpg.exceptions._base.InterfaceError: connection is closed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1965, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000001DB09620AE0>
    │    └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x000001DB0A9EC650>
    └ <sqlalchemy.engine.base.Connection object at 0x000001DB0AC71290>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 921, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ (4,)
    │      │       └ 'SELECT "user".id, "user".username, "user".first_name, "user".last_name, "user".role_id, "user".email, "user".hashed_password...
    │      └ <function AsyncAdapt_asyncpg_cursor.execute at 0x000001DB09EE80E0>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000001DB0AC2F460>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 584, in execute
    self._adapt_connection.await_(
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000001DB0AC2F460>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x000001DB0AA129E0>
           └ <_AsyncIoGreenlet object at 0x000001DB0AAFF9C0 (otid=0x000001DB09101260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x000001DB0AA129E0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 521, in _prepare_and_execute
    await adapt_connection._start_transaction()
          │                └ <function AsyncAdapt_asyncpg_connection._start_transaction at 0x000001DB09EE9120>
          └ <AdaptedConnection <asyncpg.connection.Connection object at 0x000001DB0AC50120>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 841, in _start_transaction
    self._handle_exception(error)
    │    └ <function AsyncAdapt_asyncpg_connection._handle_exception at 0x000001DB09EE8E00>
    └ <AdaptedConnection <asyncpg.connection.Connection object at 0x000001DB0AC50120>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 801, in _handle_exception
    raise translated_error from error
          │                     └ InterfaceError('connection is closed')
          └ InterfaceError("<class 'asyncpg.exceptions._base.InterfaceError'>: connection is closed")

sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: connection is closed


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 376
               │     └ 3
               └ <function _main at 0x000001DB04C6F4C0>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 376
           │    └ <function BaseProcess._bootstrap at 0x000001DB04BC5080>
           └ <SpawnProcess name='SpawnProcess-1' parent=4184 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001DB04BC45E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=4184 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001DB04C2E610>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=4184 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=4184 started>
    │    └ <function subprocess_started at 0x000001DB06C28540>
    └ <SpawnProcess name='SpawnProcess-1' parent=4184 started>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=788, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000001DB06D63290>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=788, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x000001DB06C0B740>
           │       │   └ <uvicorn.server.Server object at 0x000001DB06D63290>
           │       └ <function run at 0x000001DB069F36A0>
           └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000001DB06D708C0>
           │      └ <function Runner.run at 0x000001DB069F3B00>
           └ <asyncio.runners.Runner object at 0x000001DB06D63710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000001DB069F1580>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000001DB06D63710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001DB069F14E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001DB069F32E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001DB0656F2E0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
> File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001DB0AADF490>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001DB0A...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001D...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000001DB0AA64250>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001DB0AADF490>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\applications.py", line 289, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001DB0A...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001D...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001DB0A...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001D...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001DB09A12F90>
          └ <fastapi.applications.FastAPI object at 0x000001DB0AA64250>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001DB0B06F6A0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001D...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001DB0AB44490>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001DB09A12F90>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000001DB0B06FCE0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001D...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x000001DB0AADF290>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001DB0AB44490>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
          │    │   │      │    │      └ <traceback object at 0x000001DB0B08B7C0>
          │    │   │      │    └ InterfaceError("(sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: co...
          │    │   │      └ <class 'sqlalchemy.exc.InterfaceError'>
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object get_db at 0x000001DB0AC6BF10>
          └ <contextlib._AsyncGeneratorContextManager object at 0x000001DB0B08A610>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\db\connection.py", line 23, in get_db
    yield session
          └ <sqlalchemy.orm.session.AsyncSession object at 0x000001DB0B08A650>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000001DB0B06FCE0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001D...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x000001DB06E7C750>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x000001DB0AADF290>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000001DB0B06FCE0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001D...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x000001DB08FA34C0>
          └ APIRoute(path='/ad/complains/create', name='complain_ad', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000001DB0B06FCE0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001D...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x000001DB0AB944A0>
          └ APIRoute(path='/ad/complains/create', name='complain_ad', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x000001DB0B08A150>
                     └ <function get_request_handler.<locals>.app at 0x000001DB0AB945E0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 263, in app
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x000001DB08F6BC40>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\dependencies\utils.py", line 584, in solve_dependencies
    solved = await call(**sub_values)
                   │      └ {'user_manager': <auth.manager.UserManager object at 0x000001DB0B08AB10>, 'jwt': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdW...
                   └ <function Authenticator.current_user.<locals>.current_user_dependency at 0x000001DB0AAB39C0>
  File "<makefun-gen-0>", line 2, in current_user_dependency
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\authentication\authenticator.py", line 136, in current_user_dependency
    user, _ = await self._authenticate(
                    │    └ <function Authenticator._authenticate at 0x000001DB09DE51C0>
                    └ <fastapi_users.authentication.authenticator.Authenticator object at 0x000001DB0A0F9D10>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\authentication\authenticator.py", line 170, in _authenticate
    user = await strategy.read_token(token, user_manager)
                 │        │          │      └ <auth.manager.UserManager object at 0x000001DB0B08AB10>
                 │        │          └ 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI0IiwiYXVkIjpbImZhc3RhcGktdXNlcnM6YXV0aCJdLCJleHAiOjE2OTA0MTM5NTd9.tjqhO6xSK_...
                 │        └ <function JWTStrategy.read_token at 0x000001DB09DD7A60>
                 └ <fastapi_users.authentication.strategy.jwt.JWTStrategy object at 0x000001DB0AC30C90>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\authentication\strategy\jwt.py", line 55, in read_token
    return await user_manager.get(parsed_id)
                 │            │   └ 4
                 │            └ <function BaseUserManager.get at 0x000001DB09DD5D00>
                 └ <auth.manager.UserManager object at 0x000001DB0B08AB10>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\manager.py", line 72, in get
    user = await self.user_db.get(id)
                 │    │       │   └ 4
                 │    │       └ <function SQLAlchemyUserDatabase.get at 0x000001DB09F1F380>
                 │    └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x000001DB0B08AA50>
                 └ <auth.manager.UserManager object at 0x000001DB0B08AB10>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users_db_sqlalchemy\__init__.py", line 121, in get
    return await self._get_user(statement)
                 │    │         └ <sqlalchemy.sql.selectable.Select object at 0x000001DB0AB01BD0>
                 │    └ <function SQLAlchemyUserDatabase._get_user at 0x000001DB09F1F880>
                 └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x000001DB0B08AA50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users_db_sqlalchemy\__init__.py", line 186, in _get_user
    results = await self.session.execute(statement)
                    │    │       │       └ <sqlalchemy.sql.selectable.Select object at 0x000001DB0AB01BD0>
                    │    │       └ <function AsyncSession.execute at 0x000001DB099D7B00>
                    │    └ <sqlalchemy.orm.session.AsyncSession object at 0x000001DB0B08A650>
                    └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x000001DB0B08AA50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 439, in execute
    result = await greenlet_spawn(
                   └ <function greenlet_spawn at 0x000001DB09196020>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             │       │      │   └ <built-in function exc_info>
             │       │      └ <module 'sys' (built-in)>
             │       └ <method 'throw' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x000001DB0AAFF9C0 (otid=0x000001DB09101260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2246, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x000001DB09918900>
           └ <sqlalchemy.orm.session.Session object at 0x000001DB0B08A690>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2141, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                   │      │                 └ <classmethod(<function AbstractORMCompileState.orm_execute_statement at 0x000001DB097C68E0>)>
                   │      └ <class 'sqlalchemy.orm.context.ORMSelectCompileState'>
                   └ typing.Any
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
             │    └ <function Connection.execute at 0x000001DB09591D00>
             └ <sqlalchemy.engine.base.Connection object at 0x000001DB0AC71290>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1412, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.selectable.Select object at 0x000001DB0AB01BD0>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x000001DB09592020>
           └ <sqlalchemy.engine.base.Connection object at 0x000001DB0AC71290>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x000001DB09592200>
          └ <sqlalchemy.engine.base.Connection object at 0x000001DB0AC71290>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1844, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x000001DB095922A0>
           └ <sqlalchemy.engine.base.Connection object at 0x000001DB0AC71290>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1984, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x000001DB09592520>
    └ <sqlalchemy.engine.base.Connection object at 0x000001DB0AC71290>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ InterfaceError("<class 'asyncpg.exceptions._base.InterfaceError'>: connection is closed")
          │                    │              └ (<class 'sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError'>, InterfaceError("<class 'asyncpg.ex...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ InterfaceError("(sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: co...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1965, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x000001DB09620AE0>
    │    └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x000001DB0A9EC650>
    └ <sqlalchemy.engine.base.Connection object at 0x000001DB0AC71290>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 921, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ (4,)
    │      │       └ 'SELECT "user".id, "user".username, "user".first_name, "user".last_name, "user".role_id, "user".email, "user".hashed_password...
    │      └ <function AsyncAdapt_asyncpg_cursor.execute at 0x000001DB09EE80E0>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000001DB0AC2F460>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 584, in execute
    self._adapt_connection.await_(
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000001DB0AC2F460>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x000001DB0AA129E0>
           └ <_AsyncIoGreenlet object at 0x000001DB0AAFF9C0 (otid=0x000001DB09101260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x000001DB0AA129E0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 521, in _prepare_and_execute
    await adapt_connection._start_transaction()
          │                └ <function AsyncAdapt_asyncpg_connection._start_transaction at 0x000001DB09EE9120>
          └ <AdaptedConnection <asyncpg.connection.Connection object at 0x000001DB0AC50120>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 841, in _start_transaction
    self._handle_exception(error)
    │    └ <function AsyncAdapt_asyncpg_connection._handle_exception at 0x000001DB09EE8E00>
    └ <AdaptedConnection <asyncpg.connection.Connection object at 0x000001DB0AC50120>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 801, in _handle_exception
    raise translated_error from error
          │                     └ InterfaceError('connection is closed')
          └ InterfaceError("<class 'asyncpg.exceptions._base.InterfaceError'>: connection is closed")

sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: connection is closed
[SQL: SELECT "user".id, "user".username, "user".first_name, "user".last_name, "user".role_id, "user".email, "user".hashed_password, "user".is_active, "user".is_superuser, "user".is_verified 
FROM "user" 
WHERE "user".id = $1::INTEGER]
[parameters: (4,)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
INFO     2023-07-26 06:22:41.028 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 06:22:41.028 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 06:22:41.139 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 06:22:41.139 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 06:22:41.140 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 06:22:41.140 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 06:22:41.140 request id: app - logging:callHandlers - Finished server process [2984]
INFO     2023-07-26 06:22:41.140 request id: app - logging:callHandlers - Finished server process [2984]
INFO     2023-07-26 06:22:44.639 request id: app - logging:callHandlers - Started server process [24372]
INFO     2023-07-26 06:22:44.640 request id: app - logging:callHandlers - Started server process [24372]
INFO     2023-07-26 06:22:44.640 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 06:22:44.641 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 06:22:44.642 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 06:22:44.643 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 06:22:48.934 request id: app - logging:callHandlers - 127.0.0.1:62146 - "POST /ad/complains/create HTTP/1.1" 500
ERROR    2023-07-26 06:22:48.935 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 328
               │     └ 3
               └ <function _main at 0x0000028C5F8EF4C0>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 328
           │    └ <function BaseProcess._bootstrap at 0x0000028C5F645080>
           └ <SpawnProcess name='SpawnProcess-1' parent=26176 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000028C5F6445E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=26176 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000028C5F6AE610>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=26176 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=26176 started>
    │    └ <function subprocess_started at 0x0000028C618D8540>
    └ <SpawnProcess name='SpawnProcess-1' parent=26176 started>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=752, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000028C61A23290>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=752, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x0000028C618BB740>
           │       │   └ <uvicorn.server.Server object at 0x0000028C61A23290>
           │       └ <function run at 0x0000028C616736A0>
           └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x0000028C61A308C0>
           │      └ <function Runner.run at 0x0000028C61673B00>
           └ <asyncio.runners.Runner object at 0x0000028C61A23710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x0000028C61671580>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x0000028C61A23710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000028C616714E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000028C616732E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000028C611EF2E0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
> File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000028C65796E50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028C65...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000028C657C5150>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000028C65796E50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\applications.py", line 289, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028C65...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028C65...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000028C657DA9D0>
          └ <fastapi.applications.FastAPI object at 0x0000028C657C5150>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000028C65856480>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000028C657DAED0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000028C657DA9D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000028C65855120>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x0000028C651D15D0>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000028C657DAED0>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
          │    │   │      │    │      └ <traceback object at 0x0000028C658D1000>
          │    │   │      │    └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
          │    │   │      └ <class 'OSError'>
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object get_db at 0x0000028C658D8040>
          └ <contextlib._AsyncGeneratorContextManager object at 0x0000028C6587CF50>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\db\connection.py", line 24, in get_db
    yield session
          └ <sqlalchemy.orm.session.AsyncSession object at 0x0000028C657BFF50>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000028C65855120>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x0000028C61B49610>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x0000028C651D15D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000028C65855120>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x0000028C63C634C0>
          └ APIRoute(path='/ad/complains/create', name='complain_ad', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000028C65855120>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000028C658545E0>
          └ APIRoute(path='/ad/complains/create', name='complain_ad', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x0000028C658C67D0>
                     └ <function get_request_handler.<locals>.app at 0x0000028C658547C0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 263, in app
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x0000028C63C2BC40>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\dependencies\utils.py", line 584, in solve_dependencies
    solved = await call(**sub_values)
                   │      └ {'user_manager': <auth.manager.UserManager object at 0x0000028C6586A990>, 'jwt': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdW...
                   └ <function Authenticator.current_user.<locals>.current_user_dependency at 0x0000028C6579C2C0>
  File "<makefun-gen-0>", line 2, in current_user_dependency
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\authentication\authenticator.py", line 136, in current_user_dependency
    user, _ = await self._authenticate(
                    │    └ <function Authenticator._authenticate at 0x0000028C64AA51C0>
                    └ <fastapi_users.authentication.authenticator.Authenticator object at 0x0000028C64D82ED0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\authentication\authenticator.py", line 170, in _authenticate
    user = await strategy.read_token(token, user_manager)
                 │        │          │      └ <auth.manager.UserManager object at 0x0000028C6586A990>
                 │        │          └ 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI0IiwiYXVkIjpbImZhc3RhcGktdXNlcnM6YXV0aCJdLCJleHAiOjE2OTA0MTM5NTd9.tjqhO6xSK_...
                 │        └ <function JWTStrategy.read_token at 0x0000028C64A97A60>
                 └ <fastapi_users.authentication.strategy.jwt.JWTStrategy object at 0x0000028C658C7A50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\authentication\strategy\jwt.py", line 55, in read_token
    return await user_manager.get(parsed_id)
                 │            │   └ 4
                 │            └ <function BaseUserManager.get at 0x0000028C64A95D00>
                 └ <auth.manager.UserManager object at 0x0000028C6586A990>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\manager.py", line 72, in get
    user = await self.user_db.get(id)
                 │    │       │   └ 4
                 │    │       └ <function SQLAlchemyUserDatabase.get at 0x0000028C64BDF380>
                 │    └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x0000028C657DA950>
                 └ <auth.manager.UserManager object at 0x0000028C6586A990>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users_db_sqlalchemy\__init__.py", line 121, in get
    return await self._get_user(statement)
                 │    │         └ <sqlalchemy.sql.selectable.Select object at 0x0000028C6586A790>
                 │    └ <function SQLAlchemyUserDatabase._get_user at 0x0000028C64BDF880>
                 └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x0000028C657DA950>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users_db_sqlalchemy\__init__.py", line 186, in _get_user
    results = await self.session.execute(statement)
                    │    │       │       └ <sqlalchemy.sql.selectable.Select object at 0x0000028C6586A790>
                    │    │       └ <function AsyncSession.execute at 0x0000028C64693B00>
                    │    └ <sqlalchemy.orm.session.AsyncSession object at 0x0000028C657BFF50>
                    └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x0000028C657DA950>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 439, in execute
    result = await greenlet_spawn(
                   └ <function greenlet_spawn at 0x0000028C63E56020>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             │       │      │   └ <built-in function exc_info>
             │       │      └ <module 'sys' (built-in)>
             │       └ <method 'throw' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x0000028C657BF640 (otid=0x0000028C63DC1260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2246, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x0000028C645D8900>
           └ <sqlalchemy.orm.session.Session object at 0x0000028C657E8150>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2131, in _execute_internal
    conn = self._connection_for_bind(bind)
           │    │                    └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │    └ <function Session._connection_for_bind at 0x0000028C645D8680>
           └ <sqlalchemy.orm.session.Session object at 0x0000028C657E8150>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1998, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           │     │                    │       └ None
           │     │                    └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │     └ <function SessionTransaction._connection_for_bind at 0x0000028C645D7060>
           └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000028C65901CC0>
  File "<string>", line 2, in _connection_for_bind
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ (Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it), None)
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000028C65901CC0>
                └ <function SessionTransaction._connection_for_bind at 0x0000028C645D6FC0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1123, in _connection_for_bind
    conn = bind.connect()
           │    └ <function Engine.connect at 0x0000028C6424CD60>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3264, in connect
    return self._connection_cls(self)
           │    │               └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │    └ <class 'sqlalchemy.engine.base.Connection'>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 145, in __init__
    self._dbapi_connection = engine.raw_connection()
    │                        │      └ <function Engine.raw_connection at 0x0000028C6424CE00>
    │                        └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
    └ <sqlalchemy.engine.base.Connection object at 0x0000028C6586A290>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3288, in raw_connection
    return self.pool.connect()
           │    │    └ <function Pool.connect at 0x0000028C63EFCA40>
           │    └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000028C65794210>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 452, in connect
    return _ConnectionFairy._checkout(self)
           │                │         └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000028C65794210>
           │                └ <classmethod(<function _ConnectionFairy._checkout at 0x0000028C63EFEAC0>)>
           └ <class 'sqlalchemy.pool.base._ConnectionFairy'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1267, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            │                 │        └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000028C65794210>
            │                 └ <classmethod(<function _ConnectionRecord.checkout at 0x0000028C63EFD620>)>
            └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 716, in checkout
    rec = pool._do_get()
          │    └ <function QueuePool._do_get at 0x0000028C63F06200>
          └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000028C65794210>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 169, in _do_get
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x0000028C658D0900>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 167, in _do_get
    return self._create_connection()
           │    └ <function Pool._create_connection at 0x0000028C63EFC7C0>
           └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000028C65794210>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 393, in _create_connection
    return _ConnectionRecord(self)
           │                 └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000028C65794210>
           └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 678, in __init__
    self.__connect()
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x0000028C658CD010>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 902, in __connect
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x0000028C658D0800>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 898, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
    │    │                               │    │               └ <sqlalchemy.pool.base._ConnectionRecord object at 0x0000028C658CD010>
    │    │                               │    └ <function create_engine.<locals>.connect at 0x0000028C64D92E80>
    │    │                               └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000028C65794210>
    │    └ <member 'dbapi_connection' of '_ConnectionRecord' objects>
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x0000028C658CD010>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\create.py", line 637, in connect
    return dialect.connect(*cargs, **cparams)
           │       │        │        └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
           │       │        └ []
           │       └ <function DefaultDialect.connect at 0x0000028C642BFE20>
           └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x0000028C6577BB50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 615, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)
           │    │            │        │        └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
           │    │            │        └ ()
           │    │            └ <function AsyncAdapt_asyncpg_dbapi.connect at 0x0000028C64BA9760>
           │    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi object at 0x0000028C6577B850>
           └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x0000028C6577BB50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 916, in connect
    await_only(creator_fn(*arg, **kw)),
    │          │           │      └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
    │          │           └ ()
    │          └ <function connect at 0x0000028C64E3E200>
    └ <function await_only at 0x0000028C63DD18A0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object connect at 0x0000028C658E41B0>
           └ <_AsyncIoGreenlet object at 0x0000028C657BF640 (otid=0x0000028C63DC1260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object connect at 0x0000028C658E41B0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connection.py", line 2114, in connect
    return await connect_utils._connect(
                 │             └ <function _connect at 0x0000028C64E3DBC0>
                 └ <module 'asyncpg.connect_utils' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 1011, in _connect
    raise last_error or exceptions.TargetServerAttributeNotMatched(
          │             │          └ <class 'asyncpg.exceptions._base.TargetServerAttributeNotMatched'>
          │             └ <module 'asyncpg.exceptions' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\s...
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 982, in _connect
    conn = await _connect_addr(
                 └ <function _connect_addr at 0x0000028C64E3D4E0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 808, in _connect_addr
    return await __connect_addr(params, timeout, True, *args)
                 │              │       │               └ (('localhost', 5432), <_WindowsSelectorEventLoop running=True closed=False debug=False>, ConnectionConfiguration(command_time...
                 │              │       └ 60
                 │              └ ConnectionParameters(user='admin', password='<z5&+lLwlgB(]KV#', database='surf_it', ssl=<ssl.SSLContext object at 0x0000028C6...
                 └ <function __connect_addr at 0x0000028C64E3D580>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 860, in __connect_addr
    tr, pr = await compat.wait_for(connector, timeout=timeout)
                   │      │        │                  └ 60
                   │      │        └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
                   │      └ <function wait_for at 0x0000028C64D936A0>
                   └ <module 'asyncpg.compat' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site-...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\compat.py", line 60, in wait_for
    return await asyncio.wait_for(fut, timeout)
                 │       │        │    └ 60
                 │       │        └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
                 │       └ <function wait_for at 0x0000028C61664180>
                 └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\tasks.py", line 479, in wait_for
    return fut.result()
           │   └ <method 'result' of '_asyncio.Task' objects>
           └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 719, in _create_ssl_connection
    tr, pr = await loop.create_connection(
                   │    └ <function BaseEventLoop.create_connection at 0x0000028C61672480>
                   └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1081, in create_connection
    raise OSError('Multiple exceptions: {}'.format(

OSError: Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127.0.0.1', 5432)
ERROR    2023-07-26 06:22:48.986 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 328
               │     └ 3
               └ <function _main at 0x0000028C5F8EF4C0>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 328
           │    └ <function BaseProcess._bootstrap at 0x0000028C5F645080>
           └ <SpawnProcess name='SpawnProcess-1' parent=26176 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000028C5F6445E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=26176 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000028C5F6AE610>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=26176 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=26176 started>
    │    └ <function subprocess_started at 0x0000028C618D8540>
    └ <SpawnProcess name='SpawnProcess-1' parent=26176 started>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=752, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000028C61A23290>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=752, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x0000028C618BB740>
           │       │   └ <uvicorn.server.Server object at 0x0000028C61A23290>
           │       └ <function run at 0x0000028C616736A0>
           └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x0000028C61A308C0>
           │      └ <function Runner.run at 0x0000028C61673B00>
           └ <asyncio.runners.Runner object at 0x0000028C61A23710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x0000028C61671580>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x0000028C61A23710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000028C616714E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000028C616732E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000028C611EF2E0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
> File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000028C65796E50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028C65...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000028C657C5150>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000028C65796E50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\applications.py", line 289, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028C65...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028C65...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000028C657DA9D0>
          └ <fastapi.applications.FastAPI object at 0x0000028C657C5150>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000028C65856480>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000028C657DAED0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000028C657DA9D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000028C65855120>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x0000028C651D15D0>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000028C657DAED0>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
          │    │   │      │    │      └ <traceback object at 0x0000028C658D1000>
          │    │   │      │    └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
          │    │   │      └ <class 'OSError'>
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object get_db at 0x0000028C658D8040>
          └ <contextlib._AsyncGeneratorContextManager object at 0x0000028C6587CF50>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\db\connection.py", line 24, in get_db
    yield session
          └ <sqlalchemy.orm.session.AsyncSession object at 0x0000028C657BFF50>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000028C65855120>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x0000028C61B49610>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x0000028C651D15D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000028C65855120>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x0000028C63C634C0>
          └ APIRoute(path='/ad/complains/create', name='complain_ad', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000028C65855120>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000028...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000028C658545E0>
          └ APIRoute(path='/ad/complains/create', name='complain_ad', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x0000028C658C67D0>
                     └ <function get_request_handler.<locals>.app at 0x0000028C658547C0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 263, in app
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x0000028C63C2BC40>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\dependencies\utils.py", line 584, in solve_dependencies
    solved = await call(**sub_values)
                   │      └ {'user_manager': <auth.manager.UserManager object at 0x0000028C6586A990>, 'jwt': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdW...
                   └ <function Authenticator.current_user.<locals>.current_user_dependency at 0x0000028C6579C2C0>
  File "<makefun-gen-0>", line 2, in current_user_dependency
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\authentication\authenticator.py", line 136, in current_user_dependency
    user, _ = await self._authenticate(
                    │    └ <function Authenticator._authenticate at 0x0000028C64AA51C0>
                    └ <fastapi_users.authentication.authenticator.Authenticator object at 0x0000028C64D82ED0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\authentication\authenticator.py", line 170, in _authenticate
    user = await strategy.read_token(token, user_manager)
                 │        │          │      └ <auth.manager.UserManager object at 0x0000028C6586A990>
                 │        │          └ 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI0IiwiYXVkIjpbImZhc3RhcGktdXNlcnM6YXV0aCJdLCJleHAiOjE2OTA0MTM5NTd9.tjqhO6xSK_...
                 │        └ <function JWTStrategy.read_token at 0x0000028C64A97A60>
                 └ <fastapi_users.authentication.strategy.jwt.JWTStrategy object at 0x0000028C658C7A50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\authentication\strategy\jwt.py", line 55, in read_token
    return await user_manager.get(parsed_id)
                 │            │   └ 4
                 │            └ <function BaseUserManager.get at 0x0000028C64A95D00>
                 └ <auth.manager.UserManager object at 0x0000028C6586A990>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\manager.py", line 72, in get
    user = await self.user_db.get(id)
                 │    │       │   └ 4
                 │    │       └ <function SQLAlchemyUserDatabase.get at 0x0000028C64BDF380>
                 │    └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x0000028C657DA950>
                 └ <auth.manager.UserManager object at 0x0000028C6586A990>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users_db_sqlalchemy\__init__.py", line 121, in get
    return await self._get_user(statement)
                 │    │         └ <sqlalchemy.sql.selectable.Select object at 0x0000028C6586A790>
                 │    └ <function SQLAlchemyUserDatabase._get_user at 0x0000028C64BDF880>
                 └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x0000028C657DA950>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users_db_sqlalchemy\__init__.py", line 186, in _get_user
    results = await self.session.execute(statement)
                    │    │       │       └ <sqlalchemy.sql.selectable.Select object at 0x0000028C6586A790>
                    │    │       └ <function AsyncSession.execute at 0x0000028C64693B00>
                    │    └ <sqlalchemy.orm.session.AsyncSession object at 0x0000028C657BFF50>
                    └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x0000028C657DA950>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 439, in execute
    result = await greenlet_spawn(
                   └ <function greenlet_spawn at 0x0000028C63E56020>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             │       │      │   └ <built-in function exc_info>
             │       │      └ <module 'sys' (built-in)>
             │       └ <method 'throw' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x0000028C657BF640 (otid=0x0000028C63DC1260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2246, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x0000028C645D8900>
           └ <sqlalchemy.orm.session.Session object at 0x0000028C657E8150>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2131, in _execute_internal
    conn = self._connection_for_bind(bind)
           │    │                    └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │    └ <function Session._connection_for_bind at 0x0000028C645D8680>
           └ <sqlalchemy.orm.session.Session object at 0x0000028C657E8150>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1998, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           │     │                    │       └ None
           │     │                    └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │     └ <function SessionTransaction._connection_for_bind at 0x0000028C645D7060>
           └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000028C65901CC0>
  File "<string>", line 2, in _connection_for_bind
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ (Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it), None)
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000028C65901CC0>
                └ <function SessionTransaction._connection_for_bind at 0x0000028C645D6FC0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1123, in _connection_for_bind
    conn = bind.connect()
           │    └ <function Engine.connect at 0x0000028C6424CD60>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3264, in connect
    return self._connection_cls(self)
           │    │               └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │    └ <class 'sqlalchemy.engine.base.Connection'>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 145, in __init__
    self._dbapi_connection = engine.raw_connection()
    │                        │      └ <function Engine.raw_connection at 0x0000028C6424CE00>
    │                        └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
    └ <sqlalchemy.engine.base.Connection object at 0x0000028C6586A290>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3288, in raw_connection
    return self.pool.connect()
           │    │    └ <function Pool.connect at 0x0000028C63EFCA40>
           │    └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000028C65794210>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 452, in connect
    return _ConnectionFairy._checkout(self)
           │                │         └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000028C65794210>
           │                └ <classmethod(<function _ConnectionFairy._checkout at 0x0000028C63EFEAC0>)>
           └ <class 'sqlalchemy.pool.base._ConnectionFairy'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1267, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            │                 │        └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000028C65794210>
            │                 └ <classmethod(<function _ConnectionRecord.checkout at 0x0000028C63EFD620>)>
            └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 716, in checkout
    rec = pool._do_get()
          │    └ <function QueuePool._do_get at 0x0000028C63F06200>
          └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000028C65794210>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 169, in _do_get
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x0000028C658D0900>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 167, in _do_get
    return self._create_connection()
           │    └ <function Pool._create_connection at 0x0000028C63EFC7C0>
           └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000028C65794210>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 393, in _create_connection
    return _ConnectionRecord(self)
           │                 └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000028C65794210>
           └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 678, in __init__
    self.__connect()
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x0000028C658CD010>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 902, in __connect
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x0000028C658D0800>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 898, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
    │    │                               │    │               └ <sqlalchemy.pool.base._ConnectionRecord object at 0x0000028C658CD010>
    │    │                               │    └ <function create_engine.<locals>.connect at 0x0000028C64D92E80>
    │    │                               └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000028C65794210>
    │    └ <member 'dbapi_connection' of '_ConnectionRecord' objects>
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x0000028C658CD010>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\create.py", line 637, in connect
    return dialect.connect(*cargs, **cparams)
           │       │        │        └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
           │       │        └ []
           │       └ <function DefaultDialect.connect at 0x0000028C642BFE20>
           └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x0000028C6577BB50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 615, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)
           │    │            │        │        └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
           │    │            │        └ ()
           │    │            └ <function AsyncAdapt_asyncpg_dbapi.connect at 0x0000028C64BA9760>
           │    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi object at 0x0000028C6577B850>
           └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x0000028C6577BB50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 916, in connect
    await_only(creator_fn(*arg, **kw)),
    │          │           │      └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
    │          │           └ ()
    │          └ <function connect at 0x0000028C64E3E200>
    └ <function await_only at 0x0000028C63DD18A0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object connect at 0x0000028C658E41B0>
           └ <_AsyncIoGreenlet object at 0x0000028C657BF640 (otid=0x0000028C63DC1260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object connect at 0x0000028C658E41B0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connection.py", line 2114, in connect
    return await connect_utils._connect(
                 │             └ <function _connect at 0x0000028C64E3DBC0>
                 └ <module 'asyncpg.connect_utils' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 1011, in _connect
    raise last_error or exceptions.TargetServerAttributeNotMatched(
          │             │          └ <class 'asyncpg.exceptions._base.TargetServerAttributeNotMatched'>
          │             └ <module 'asyncpg.exceptions' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\s...
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 982, in _connect
    conn = await _connect_addr(
                 └ <function _connect_addr at 0x0000028C64E3D4E0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 808, in _connect_addr
    return await __connect_addr(params, timeout, True, *args)
                 │              │       │               └ (('localhost', 5432), <_WindowsSelectorEventLoop running=True closed=False debug=False>, ConnectionConfiguration(command_time...
                 │              │       └ 60
                 │              └ ConnectionParameters(user='admin', password='<z5&+lLwlgB(]KV#', database='surf_it', ssl=<ssl.SSLContext object at 0x0000028C6...
                 └ <function __connect_addr at 0x0000028C64E3D580>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 860, in __connect_addr
    tr, pr = await compat.wait_for(connector, timeout=timeout)
                   │      │        │                  └ 60
                   │      │        └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
                   │      └ <function wait_for at 0x0000028C64D936A0>
                   └ <module 'asyncpg.compat' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site-...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\compat.py", line 60, in wait_for
    return await asyncio.wait_for(fut, timeout)
                 │       │        │    └ 60
                 │       │        └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
                 │       └ <function wait_for at 0x0000028C61664180>
                 └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\tasks.py", line 479, in wait_for
    return fut.result()
           │   └ <method 'result' of '_asyncio.Task' objects>
           └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 719, in _create_ssl_connection
    tr, pr = await loop.create_connection(
                   │    └ <function BaseEventLoop.create_connection at 0x0000028C61672480>
                   └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1081, in create_connection
    raise OSError('Multiple exceptions: {}'.format(

OSError: Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127.0.0.1', 5432)
INFO     2023-07-26 06:24:36.486 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 06:24:36.486 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 06:24:36.595 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 06:24:36.595 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 06:24:36.597 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 06:24:36.597 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 06:24:36.598 request id: app - logging:callHandlers - Finished server process [24372]
INFO     2023-07-26 06:24:36.598 request id: app - logging:callHandlers - Finished server process [24372]
INFO     2023-07-26 06:24:39.847 request id: app - logging:callHandlers - Started server process [23196]
INFO     2023-07-26 06:24:39.847 request id: app - logging:callHandlers - Started server process [23196]
INFO     2023-07-26 06:24:39.848 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 06:24:39.848 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 06:24:39.849 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 06:24:39.849 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 06:24:47.584 request id: app - logging:callHandlers - 127.0.0.1:62181 - "POST /ad/complains/create HTTP/1.1" 500
ERROR    2023-07-26 06:24:47.584 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 312
               │     └ 3
               └ <function _main at 0x000001A60E50F4C0>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 312
           │    └ <function BaseProcess._bootstrap at 0x000001A60E445080>
           └ <SpawnProcess name='SpawnProcess-1' parent=21376 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001A60E4445E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=21376 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001A60E4AE610>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=21376 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=21376 started>
    │    └ <function subprocess_started at 0x000001A610528540>
    └ <SpawnProcess name='SpawnProcess-1' parent=21376 started>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=316, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000001A610673290>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=316, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x000001A61050B740>
           │       │   └ <uvicorn.server.Server object at 0x000001A610673290>
           │       └ <function run at 0x000001A6102C36A0>
           └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000001A6106808C0>
           │      └ <function Runner.run at 0x000001A6102C3B00>
           └ <asyncio.runners.Runner object at 0x000001A610673710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000001A6102C1580>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000001A610673710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001A6102C14E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001A6102C32E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001A60FE2F2E0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
> File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001A61067E7D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A614...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000001A614415150>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001A61067E7D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\applications.py", line 289, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A614...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A614...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001A6144B9250>
          └ <fastapi.applications.FastAPI object at 0x000001A614415150>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001A6144A6520>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001A61442FF10>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001A6144B9250>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000001A6144A63E0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x000001A6144A9390>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001A61442FF10>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
          │    │   │      │    │      └ <traceback object at 0x000001A61451CC00>
          │    │   │      │    └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
          │    │   │      └ <class 'OSError'>
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object get_db at 0x000001A614520040>
          └ <contextlib._AsyncGeneratorContextManager object at 0x000001A614466110>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\db\connection.py", line 25, in get_db
    yield session
          └ <sqlalchemy.orm.session.AsyncSession object at 0x000001A6144BA890>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000001A6144A63E0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x000001A610799610>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x000001A6144A9390>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000001A6144A63E0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x000001A6128B34C0>
          └ APIRoute(path='/ad/complains/create', name='complain_ad', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000001A6144A63E0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x000001A6144A4720>
          └ APIRoute(path='/ad/complains/create', name='complain_ad', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x000001A6139DBFD0>
                     └ <function get_request_handler.<locals>.app at 0x000001A6144A40E0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 263, in app
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x000001A61287BC40>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\dependencies\utils.py", line 584, in solve_dependencies
    solved = await call(**sub_values)
                   │      └ {'user_manager': <auth.manager.UserManager object at 0x000001A61451C350>, 'jwt': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdW...
                   └ <function Authenticator.current_user.<locals>.current_user_dependency at 0x000001A6143EC220>
  File "<makefun-gen-0>", line 2, in current_user_dependency
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\authentication\authenticator.py", line 136, in current_user_dependency
    user, _ = await self._authenticate(
                    │    └ <function Authenticator._authenticate at 0x000001A6136F51C0>
                    └ <fastapi_users.authentication.authenticator.Authenticator object at 0x000001A613A05F10>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\authentication\authenticator.py", line 170, in _authenticate
    user = await strategy.read_token(token, user_manager)
                 │        │          │      └ <auth.manager.UserManager object at 0x000001A61451C350>
                 │        │          └ 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI0IiwiYXVkIjpbImZhc3RhcGktdXNlcnM6YXV0aCJdLCJleHAiOjE2OTA0MTM5NTd9.tjqhO6xSK_...
                 │        └ <function JWTStrategy.read_token at 0x000001A6136E7A60>
                 └ <fastapi_users.authentication.strategy.jwt.JWTStrategy object at 0x000001A614513390>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\authentication\strategy\jwt.py", line 55, in read_token
    return await user_manager.get(parsed_id)
                 │            │   └ 4
                 │            └ <function BaseUserManager.get at 0x000001A6136E5D00>
                 └ <auth.manager.UserManager object at 0x000001A61451C350>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\manager.py", line 72, in get
    user = await self.user_db.get(id)
                 │    │       │   └ 4
                 │    │       └ <function SQLAlchemyUserDatabase.get at 0x000001A61382F380>
                 │    └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x000001A614414C10>
                 └ <auth.manager.UserManager object at 0x000001A61451C350>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users_db_sqlalchemy\__init__.py", line 121, in get
    return await self._get_user(statement)
                 │    │         └ <sqlalchemy.sql.selectable.Select object at 0x000001A614426F10>
                 │    └ <function SQLAlchemyUserDatabase._get_user at 0x000001A61382F880>
                 └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x000001A614414C10>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users_db_sqlalchemy\__init__.py", line 186, in _get_user
    results = await self.session.execute(statement)
                    │    │       │       └ <sqlalchemy.sql.selectable.Select object at 0x000001A614426F10>
                    │    │       └ <function AsyncSession.execute at 0x000001A6132E3B00>
                    │    └ <sqlalchemy.orm.session.AsyncSession object at 0x000001A6144BA890>
                    └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x000001A614414C10>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 439, in execute
    result = await greenlet_spawn(
                   └ <function greenlet_spawn at 0x000001A612AA6020>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             │       │      │   └ <built-in function exc_info>
             │       │      └ <module 'sys' (built-in)>
             │       └ <method 'throw' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x000001A614414440 (otid=0x000001A612A11260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2246, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x000001A613228900>
           └ <sqlalchemy.orm.session.Session object at 0x000001A61440F190>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2131, in _execute_internal
    conn = self._connection_for_bind(bind)
           │    │                    └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │    └ <function Session._connection_for_bind at 0x000001A613228680>
           └ <sqlalchemy.orm.session.Session object at 0x000001A61440F190>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1998, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           │     │                    │       └ None
           │     │                    └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │     └ <function SessionTransaction._connection_for_bind at 0x000001A613227060>
           └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001A614551B30>
  File "<string>", line 2, in _connection_for_bind
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ (Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it), None)
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001A614551B30>
                └ <function SessionTransaction._connection_for_bind at 0x000001A613226FC0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1123, in _connection_for_bind
    conn = bind.connect()
           │    └ <function Engine.connect at 0x000001A612E9CD60>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3264, in connect
    return self._connection_cls(self)
           │    │               └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │    └ <class 'sqlalchemy.engine.base.Connection'>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 145, in __init__
    self._dbapi_connection = engine.raw_connection()
    │                        │      └ <function Engine.raw_connection at 0x000001A612E9CE00>
    │                        └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
    └ <sqlalchemy.engine.base.Connection object at 0x000001A614512A90>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3288, in raw_connection
    return self.pool.connect()
           │    │    └ <function Pool.connect at 0x000001A612B4CA40>
           │    └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000001A6143E4550>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 452, in connect
    return _ConnectionFairy._checkout(self)
           │                │         └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000001A6143E4550>
           │                └ <classmethod(<function _ConnectionFairy._checkout at 0x000001A612B4EAC0>)>
           └ <class 'sqlalchemy.pool.base._ConnectionFairy'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1267, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            │                 │        └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000001A6143E4550>
            │                 └ <classmethod(<function _ConnectionRecord.checkout at 0x000001A612B4D620>)>
            └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 716, in checkout
    rec = pool._do_get()
          │    └ <function QueuePool._do_get at 0x000001A612B56200>
          └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000001A6143E4550>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 169, in _do_get
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x000001A614497E00>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 167, in _do_get
    return self._create_connection()
           │    └ <function Pool._create_connection at 0x000001A612B4C7C0>
           └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000001A6143E4550>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 393, in _create_connection
    return _ConnectionRecord(self)
           │                 └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000001A6143E4550>
           └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 678, in __init__
    self.__connect()
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x000001A614525010>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 902, in __connect
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x000001A614497F00>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 898, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
    │    │                               │    │               └ <sqlalchemy.pool.base._ConnectionRecord object at 0x000001A614525010>
    │    │                               │    └ <function create_engine.<locals>.connect at 0x000001A6139E2E80>
    │    │                               └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000001A6143E4550>
    │    └ <member 'dbapi_connection' of '_ConnectionRecord' objects>
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x000001A614525010>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\create.py", line 637, in connect
    return dialect.connect(*cargs, **cparams)
           │       │        │        └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
           │       │        └ []
           │       └ <function DefaultDialect.connect at 0x000001A612F0FE20>
           └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x000001A6140AAA10>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 615, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)
           │    │            │        │        └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
           │    │            │        └ ()
           │    │            └ <function AsyncAdapt_asyncpg_dbapi.connect at 0x000001A6137F9760>
           │    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi object at 0x000001A6143CF750>
           └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x000001A6140AAA10>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 916, in connect
    await_only(creator_fn(*arg, **kw)),
    │          │           │      └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
    │          │           └ ()
    │          └ <function connect at 0x000001A613A8E160>
    └ <function await_only at 0x000001A612A218A0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object connect at 0x000001A6145341B0>
           └ <_AsyncIoGreenlet object at 0x000001A614414440 (otid=0x000001A612A11260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object connect at 0x000001A6145341B0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connection.py", line 2114, in connect
    return await connect_utils._connect(
                 │             └ <function _connect at 0x000001A613A8DB20>
                 └ <module 'asyncpg.connect_utils' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 1011, in _connect
    raise last_error or exceptions.TargetServerAttributeNotMatched(
          │             │          └ <class 'asyncpg.exceptions._base.TargetServerAttributeNotMatched'>
          │             └ <module 'asyncpg.exceptions' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\s...
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 982, in _connect
    conn = await _connect_addr(
                 └ <function _connect_addr at 0x000001A613A8D440>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 808, in _connect_addr
    return await __connect_addr(params, timeout, True, *args)
                 │              │       │               └ (('localhost', 5432), <_WindowsSelectorEventLoop running=True closed=False debug=False>, ConnectionConfiguration(command_time...
                 │              │       └ 60
                 │              └ ConnectionParameters(user='admin', password='<z5&+lLwlgB(]KV#', database='surf_it', ssl=<ssl.SSLContext object at 0x000001A61...
                 └ <function __connect_addr at 0x000001A613A8D4E0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 860, in __connect_addr
    tr, pr = await compat.wait_for(connector, timeout=timeout)
                   │      │        │                  └ 60
                   │      │        └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
                   │      └ <function wait_for at 0x000001A6139E3600>
                   └ <module 'asyncpg.compat' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site-...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\compat.py", line 60, in wait_for
    return await asyncio.wait_for(fut, timeout)
                 │       │        │    └ 60
                 │       │        └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
                 │       └ <function wait_for at 0x000001A6102B4180>
                 └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\tasks.py", line 479, in wait_for
    return fut.result()
           │   └ <method 'result' of '_asyncio.Task' objects>
           └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 719, in _create_ssl_connection
    tr, pr = await loop.create_connection(
                   │    └ <function BaseEventLoop.create_connection at 0x000001A6102C2480>
                   └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1081, in create_connection
    raise OSError('Multiple exceptions: {}'.format(

OSError: Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127.0.0.1', 5432)
ERROR    2023-07-26 06:24:47.624 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 312
               │     └ 3
               └ <function _main at 0x000001A60E50F4C0>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 312
           │    └ <function BaseProcess._bootstrap at 0x000001A60E445080>
           └ <SpawnProcess name='SpawnProcess-1' parent=21376 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001A60E4445E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=21376 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001A60E4AE610>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=21376 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=21376 started>
    │    └ <function subprocess_started at 0x000001A610528540>
    └ <SpawnProcess name='SpawnProcess-1' parent=21376 started>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=316, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000001A610673290>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=316, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x000001A61050B740>
           │       │   └ <uvicorn.server.Server object at 0x000001A610673290>
           │       └ <function run at 0x000001A6102C36A0>
           └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000001A6106808C0>
           │      └ <function Runner.run at 0x000001A6102C3B00>
           └ <asyncio.runners.Runner object at 0x000001A610673710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000001A6102C1580>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000001A610673710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001A6102C14E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001A6102C32E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001A60FE2F2E0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
> File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001A61067E7D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A614...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000001A614415150>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001A61067E7D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\applications.py", line 289, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A614...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A614...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001A6144B9250>
          └ <fastapi.applications.FastAPI object at 0x000001A614415150>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001A6144A6520>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001A61442FF10>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001A6144B9250>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000001A6144A63E0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x000001A6144A9390>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001A61442FF10>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
          │    │   │      │    │      └ <traceback object at 0x000001A61451CC00>
          │    │   │      │    └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
          │    │   │      └ <class 'OSError'>
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object get_db at 0x000001A614520040>
          └ <contextlib._AsyncGeneratorContextManager object at 0x000001A614466110>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\db\connection.py", line 25, in get_db
    yield session
          └ <sqlalchemy.orm.session.AsyncSession object at 0x000001A6144BA890>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000001A6144A63E0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x000001A610799610>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x000001A6144A9390>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000001A6144A63E0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x000001A6128B34C0>
          └ APIRoute(path='/ad/complains/create', name='complain_ad', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000001A6144A63E0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x000001A6144A4720>
          └ APIRoute(path='/ad/complains/create', name='complain_ad', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x000001A6139DBFD0>
                     └ <function get_request_handler.<locals>.app at 0x000001A6144A40E0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 263, in app
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x000001A61287BC40>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\dependencies\utils.py", line 584, in solve_dependencies
    solved = await call(**sub_values)
                   │      └ {'user_manager': <auth.manager.UserManager object at 0x000001A61451C350>, 'jwt': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdW...
                   └ <function Authenticator.current_user.<locals>.current_user_dependency at 0x000001A6143EC220>
  File "<makefun-gen-0>", line 2, in current_user_dependency
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\authentication\authenticator.py", line 136, in current_user_dependency
    user, _ = await self._authenticate(
                    │    └ <function Authenticator._authenticate at 0x000001A6136F51C0>
                    └ <fastapi_users.authentication.authenticator.Authenticator object at 0x000001A613A05F10>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\authentication\authenticator.py", line 170, in _authenticate
    user = await strategy.read_token(token, user_manager)
                 │        │          │      └ <auth.manager.UserManager object at 0x000001A61451C350>
                 │        │          └ 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI0IiwiYXVkIjpbImZhc3RhcGktdXNlcnM6YXV0aCJdLCJleHAiOjE2OTA0MTM5NTd9.tjqhO6xSK_...
                 │        └ <function JWTStrategy.read_token at 0x000001A6136E7A60>
                 └ <fastapi_users.authentication.strategy.jwt.JWTStrategy object at 0x000001A614513390>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\authentication\strategy\jwt.py", line 55, in read_token
    return await user_manager.get(parsed_id)
                 │            │   └ 4
                 │            └ <function BaseUserManager.get at 0x000001A6136E5D00>
                 └ <auth.manager.UserManager object at 0x000001A61451C350>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\manager.py", line 72, in get
    user = await self.user_db.get(id)
                 │    │       │   └ 4
                 │    │       └ <function SQLAlchemyUserDatabase.get at 0x000001A61382F380>
                 │    └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x000001A614414C10>
                 └ <auth.manager.UserManager object at 0x000001A61451C350>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users_db_sqlalchemy\__init__.py", line 121, in get
    return await self._get_user(statement)
                 │    │         └ <sqlalchemy.sql.selectable.Select object at 0x000001A614426F10>
                 │    └ <function SQLAlchemyUserDatabase._get_user at 0x000001A61382F880>
                 └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x000001A614414C10>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users_db_sqlalchemy\__init__.py", line 186, in _get_user
    results = await self.session.execute(statement)
                    │    │       │       └ <sqlalchemy.sql.selectable.Select object at 0x000001A614426F10>
                    │    │       └ <function AsyncSession.execute at 0x000001A6132E3B00>
                    │    └ <sqlalchemy.orm.session.AsyncSession object at 0x000001A6144BA890>
                    └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x000001A614414C10>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 439, in execute
    result = await greenlet_spawn(
                   └ <function greenlet_spawn at 0x000001A612AA6020>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             │       │      │   └ <built-in function exc_info>
             │       │      └ <module 'sys' (built-in)>
             │       └ <method 'throw' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x000001A614414440 (otid=0x000001A612A11260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2246, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x000001A613228900>
           └ <sqlalchemy.orm.session.Session object at 0x000001A61440F190>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2131, in _execute_internal
    conn = self._connection_for_bind(bind)
           │    │                    └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │    └ <function Session._connection_for_bind at 0x000001A613228680>
           └ <sqlalchemy.orm.session.Session object at 0x000001A61440F190>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1998, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           │     │                    │       └ None
           │     │                    └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │     └ <function SessionTransaction._connection_for_bind at 0x000001A613227060>
           └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001A614551B30>
  File "<string>", line 2, in _connection_for_bind
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ (Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it), None)
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x000001A614551B30>
                └ <function SessionTransaction._connection_for_bind at 0x000001A613226FC0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1123, in _connection_for_bind
    conn = bind.connect()
           │    └ <function Engine.connect at 0x000001A612E9CD60>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3264, in connect
    return self._connection_cls(self)
           │    │               └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │    └ <class 'sqlalchemy.engine.base.Connection'>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 145, in __init__
    self._dbapi_connection = engine.raw_connection()
    │                        │      └ <function Engine.raw_connection at 0x000001A612E9CE00>
    │                        └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
    └ <sqlalchemy.engine.base.Connection object at 0x000001A614512A90>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3288, in raw_connection
    return self.pool.connect()
           │    │    └ <function Pool.connect at 0x000001A612B4CA40>
           │    └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000001A6143E4550>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 452, in connect
    return _ConnectionFairy._checkout(self)
           │                │         └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000001A6143E4550>
           │                └ <classmethod(<function _ConnectionFairy._checkout at 0x000001A612B4EAC0>)>
           └ <class 'sqlalchemy.pool.base._ConnectionFairy'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1267, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            │                 │        └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000001A6143E4550>
            │                 └ <classmethod(<function _ConnectionRecord.checkout at 0x000001A612B4D620>)>
            └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 716, in checkout
    rec = pool._do_get()
          │    └ <function QueuePool._do_get at 0x000001A612B56200>
          └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000001A6143E4550>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 169, in _do_get
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x000001A614497E00>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 167, in _do_get
    return self._create_connection()
           │    └ <function Pool._create_connection at 0x000001A612B4C7C0>
           └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000001A6143E4550>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 393, in _create_connection
    return _ConnectionRecord(self)
           │                 └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000001A6143E4550>
           └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 678, in __init__
    self.__connect()
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x000001A614525010>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 902, in __connect
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x000001A614497F00>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 898, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
    │    │                               │    │               └ <sqlalchemy.pool.base._ConnectionRecord object at 0x000001A614525010>
    │    │                               │    └ <function create_engine.<locals>.connect at 0x000001A6139E2E80>
    │    │                               └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000001A6143E4550>
    │    └ <member 'dbapi_connection' of '_ConnectionRecord' objects>
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x000001A614525010>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\create.py", line 637, in connect
    return dialect.connect(*cargs, **cparams)
           │       │        │        └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
           │       │        └ []
           │       └ <function DefaultDialect.connect at 0x000001A612F0FE20>
           └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x000001A6140AAA10>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 615, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)
           │    │            │        │        └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
           │    │            │        └ ()
           │    │            └ <function AsyncAdapt_asyncpg_dbapi.connect at 0x000001A6137F9760>
           │    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi object at 0x000001A6143CF750>
           └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x000001A6140AAA10>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 916, in connect
    await_only(creator_fn(*arg, **kw)),
    │          │           │      └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
    │          │           └ ()
    │          └ <function connect at 0x000001A613A8E160>
    └ <function await_only at 0x000001A612A218A0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object connect at 0x000001A6145341B0>
           └ <_AsyncIoGreenlet object at 0x000001A614414440 (otid=0x000001A612A11260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object connect at 0x000001A6145341B0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connection.py", line 2114, in connect
    return await connect_utils._connect(
                 │             └ <function _connect at 0x000001A613A8DB20>
                 └ <module 'asyncpg.connect_utils' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 1011, in _connect
    raise last_error or exceptions.TargetServerAttributeNotMatched(
          │             │          └ <class 'asyncpg.exceptions._base.TargetServerAttributeNotMatched'>
          │             └ <module 'asyncpg.exceptions' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\s...
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 982, in _connect
    conn = await _connect_addr(
                 └ <function _connect_addr at 0x000001A613A8D440>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 808, in _connect_addr
    return await __connect_addr(params, timeout, True, *args)
                 │              │       │               └ (('localhost', 5432), <_WindowsSelectorEventLoop running=True closed=False debug=False>, ConnectionConfiguration(command_time...
                 │              │       └ 60
                 │              └ ConnectionParameters(user='admin', password='<z5&+lLwlgB(]KV#', database='surf_it', ssl=<ssl.SSLContext object at 0x000001A61...
                 └ <function __connect_addr at 0x000001A613A8D4E0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 860, in __connect_addr
    tr, pr = await compat.wait_for(connector, timeout=timeout)
                   │      │        │                  └ 60
                   │      │        └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
                   │      └ <function wait_for at 0x000001A6139E3600>
                   └ <module 'asyncpg.compat' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site-...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\compat.py", line 60, in wait_for
    return await asyncio.wait_for(fut, timeout)
                 │       │        │    └ 60
                 │       │        └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
                 │       └ <function wait_for at 0x000001A6102B4180>
                 └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\tasks.py", line 479, in wait_for
    return fut.result()
           │   └ <method 'result' of '_asyncio.Task' objects>
           └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 719, in _create_ssl_connection
    tr, pr = await loop.create_connection(
                   │    └ <function BaseEventLoop.create_connection at 0x000001A6102C2480>
                   └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1081, in create_connection
    raise OSError('Multiple exceptions: {}'.format(

OSError: Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127.0.0.1', 5432)
INFO     2023-07-26 06:24:56.529 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 06:24:56.529 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 06:24:56.640 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 06:24:56.640 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 06:24:56.641 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 06:24:56.642 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 06:24:56.642 request id: app - logging:callHandlers - Finished server process [23196]
INFO     2023-07-26 06:24:56.643 request id: app - logging:callHandlers - Finished server process [23196]
INFO     2023-07-26 06:25:00.314 request id: app - logging:callHandlers - Started server process [18972]
INFO     2023-07-26 06:25:00.315 request id: app - logging:callHandlers - Started server process [18972]
INFO     2023-07-26 06:25:00.316 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 06:25:00.316 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 06:25:00.317 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 06:25:00.317 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 06:25:04.572 request id: app - logging:callHandlers - 127.0.0.1:62186 - "POST /ad/complains/create HTTP/1.1" 500
ERROR    2023-07-26 06:25:04.572 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 172
               │     └ 3
               └ <function _main at 0x000001694F56F4C0>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 172
           │    └ <function BaseProcess._bootstrap at 0x000001694F4A5080>
           └ <SpawnProcess name='SpawnProcess-1' parent=22596 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001694F4A45E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=22596 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001694F50E610>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=22596 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=22596 started>
    │    └ <function subprocess_started at 0x0000016951588540>
    └ <SpawnProcess name='SpawnProcess-1' parent=22596 started>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=412, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x00000169516D3290>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=412, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x000001695156B740>
           │       │   └ <uvicorn.server.Server object at 0x00000169516D3290>
           │       └ <function run at 0x00000169513236A0>
           └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x00000169516E08C0>
           │      └ <function Runner.run at 0x0000016951323B00>
           └ <asyncio.runners.Runner object at 0x00000169516D3710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x0000016951321580>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x00000169516D3710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x00000169513214E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x00000169513232E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000016950E8F2E0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
> File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000016955457490>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000016955...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000016...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000016955475150>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000016955457490>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\applications.py", line 289, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000016955...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000016...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000016955...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000016...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000016955494350>
          └ <fastapi.applications.FastAPI object at 0x0000016955475150>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000016955506520>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000016...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000016954AAE750>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000016955494350>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x00000169555063E0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000016...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x00000169517EC490>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000016954AAE750>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
          │    │   │      │    │      └ <traceback object at 0x000001695557CA00>
          │    │   │      │    └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
          │    │   │      └ <class 'OSError'>
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object get_db at 0x0000016955580040>
          └ <contextlib._AsyncGeneratorContextManager object at 0x0000016955474F50>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\db\connection.py", line 25, in get_db
    yield session
          └ <sqlalchemy.orm.session.AsyncSession object at 0x000001695551AB10>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x00000169555063E0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000016...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x00000169517F9610>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x00000169517EC490>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x00000169555063E0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000016...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x00000169538FF4C0>
          └ APIRoute(path='/ad/complains/create', name='complain_ad', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x00000169555063E0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000016...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000016955504720>
          └ APIRoute(path='/ad/complains/create', name='complain_ad', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x00000169555188D0>
                     └ <function get_request_handler.<locals>.app at 0x00000169555040E0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 263, in app
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x00000169538DBC40>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\dependencies\utils.py", line 584, in solve_dependencies
    solved = await call(**sub_values)
                   │      └ {'user_manager': <auth.manager.UserManager object at 0x0000016955572550>, 'jwt': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdW...
                   └ <function Authenticator.current_user.<locals>.current_user_dependency at 0x000001695544C220>
  File "<makefun-gen-0>", line 2, in current_user_dependency
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\authentication\authenticator.py", line 136, in current_user_dependency
    user, _ = await self._authenticate(
                    │    └ <function Authenticator._authenticate at 0x00000169547551C0>
                    └ <fastapi_users.authentication.authenticator.Authenticator object at 0x0000016954F0FE50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\authentication\authenticator.py", line 170, in _authenticate
    user = await strategy.read_token(token, user_manager)
                 │        │          │      └ <auth.manager.UserManager object at 0x0000016955572550>
                 │        │          └ 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI0IiwiYXVkIjpbImZhc3RhcGktdXNlcnM6YXV0aCJdLCJleHAiOjE2OTA0MTM5NTd9.tjqhO6xSK_...
                 │        └ <function JWTStrategy.read_token at 0x0000016954747A60>
                 └ <fastapi_users.authentication.strategy.jwt.JWTStrategy object at 0x0000016955540A90>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\authentication\strategy\jwt.py", line 55, in read_token
    return await user_manager.get(parsed_id)
                 │            │   └ 4
                 │            └ <function BaseUserManager.get at 0x0000016954745D00>
                 └ <auth.manager.UserManager object at 0x0000016955572550>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\manager.py", line 72, in get
    user = await self.user_db.get(id)
                 │    │       │   └ 4
                 │    │       └ <function SQLAlchemyUserDatabase.get at 0x000001695488F380>
                 │    └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x0000016955573A90>
                 └ <auth.manager.UserManager object at 0x0000016955572550>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users_db_sqlalchemy\__init__.py", line 121, in get
    return await self._get_user(statement)
                 │    │         └ <sqlalchemy.sql.selectable.Select object at 0x000001695551A450>
                 │    └ <function SQLAlchemyUserDatabase._get_user at 0x000001695488F880>
                 └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x0000016955573A90>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users_db_sqlalchemy\__init__.py", line 186, in _get_user
    results = await self.session.execute(statement)
                    │    │       │       └ <sqlalchemy.sql.selectable.Select object at 0x000001695551A450>
                    │    │       └ <function AsyncSession.execute at 0x0000016954347B00>
                    │    └ <sqlalchemy.orm.session.AsyncSession object at 0x000001695551AB10>
                    └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x0000016955573A90>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 439, in execute
    result = await greenlet_spawn(
                   └ <function greenlet_spawn at 0x0000016953B06020>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             │       │      │   └ <built-in function exc_info>
             │       │      └ <module 'sys' (built-in)>
             │       └ <method 'throw' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x000001695548F9C0 (otid=0x0000016953A71260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2246, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x0000016954288900>
           └ <sqlalchemy.orm.session.Session object at 0x0000016955487190>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2131, in _execute_internal
    conn = self._connection_for_bind(bind)
           │    │                    └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │    └ <function Session._connection_for_bind at 0x0000016954288680>
           └ <sqlalchemy.orm.session.Session object at 0x0000016955487190>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1998, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           │     │                    │       └ None
           │     │                    └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │     └ <function SessionTransaction._connection_for_bind at 0x0000016954287060>
           └ <sqlalchemy.orm.session.SessionTransaction object at 0x00000169555B56D0>
  File "<string>", line 2, in _connection_for_bind
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ (Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it), None)
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x00000169555B56D0>
                └ <function SessionTransaction._connection_for_bind at 0x0000016954286FC0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1123, in _connection_for_bind
    conn = bind.connect()
           │    └ <function Engine.connect at 0x0000016953EFCD60>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3264, in connect
    return self._connection_cls(self)
           │    │               └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │    └ <class 'sqlalchemy.engine.base.Connection'>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 145, in __init__
    self._dbapi_connection = engine.raw_connection()
    │                        │      └ <function Engine.raw_connection at 0x0000016953EFCE00>
    │                        └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
    └ <sqlalchemy.engine.base.Connection object at 0x0000016955477210>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3288, in raw_connection
    return self.pool.connect()
           │    │    └ <function Pool.connect at 0x0000016953BACA40>
           │    └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000016954BC4CD0>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 452, in connect
    return _ConnectionFairy._checkout(self)
           │                │         └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000016954BC4CD0>
           │                └ <classmethod(<function _ConnectionFairy._checkout at 0x0000016953BAEAC0>)>
           └ <class 'sqlalchemy.pool.base._ConnectionFairy'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1267, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            │                 │        └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000016954BC4CD0>
            │                 └ <classmethod(<function _ConnectionRecord.checkout at 0x0000016953BAD620>)>
            └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 716, in checkout
    rec = pool._do_get()
          │    └ <function QueuePool._do_get at 0x0000016953BB6200>
          └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000016954BC4CD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 169, in _do_get
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x000001695557C180>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 167, in _do_get
    return self._create_connection()
           │    └ <function Pool._create_connection at 0x0000016953BAC7C0>
           └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000016954BC4CD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 393, in _create_connection
    return _ConnectionRecord(self)
           │                 └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000016954BC4CD0>
           └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 678, in __init__
    self.__connect()
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x0000016955585010>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 902, in __connect
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x00000169554DF940>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 898, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
    │    │                               │    │               └ <sqlalchemy.pool.base._ConnectionRecord object at 0x0000016955585010>
    │    │                               │    └ <function create_engine.<locals>.connect at 0x0000016954A42E80>
    │    │                               └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000016954BC4CD0>
    │    └ <member 'dbapi_connection' of '_ConnectionRecord' objects>
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x0000016955585010>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\create.py", line 637, in connect
    return dialect.connect(*cargs, **cparams)
           │       │        │        └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
           │       │        └ []
           │       └ <function DefaultDialect.connect at 0x0000016953F6FE20>
           └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x000001695542FAD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 615, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)
           │    │            │        │        └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
           │    │            │        └ ()
           │    │            └ <function AsyncAdapt_asyncpg_dbapi.connect at 0x0000016954859760>
           │    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi object at 0x000001695542F610>
           └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x000001695542FAD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 916, in connect
    await_only(creator_fn(*arg, **kw)),
    │          │           │      └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
    │          │           └ ()
    │          └ <function connect at 0x0000016954AEE160>
    └ <function await_only at 0x0000016953A818A0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object connect at 0x00000169555941B0>
           └ <_AsyncIoGreenlet object at 0x000001695548F9C0 (otid=0x0000016953A71260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object connect at 0x00000169555941B0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connection.py", line 2114, in connect
    return await connect_utils._connect(
                 │             └ <function _connect at 0x0000016954AEDB20>
                 └ <module 'asyncpg.connect_utils' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 1011, in _connect
    raise last_error or exceptions.TargetServerAttributeNotMatched(
          │             │          └ <class 'asyncpg.exceptions._base.TargetServerAttributeNotMatched'>
          │             └ <module 'asyncpg.exceptions' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\s...
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 982, in _connect
    conn = await _connect_addr(
                 └ <function _connect_addr at 0x0000016954AED440>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 808, in _connect_addr
    return await __connect_addr(params, timeout, True, *args)
                 │              │       │               └ (('localhost', 5432), <_WindowsSelectorEventLoop running=True closed=False debug=False>, ConnectionConfiguration(command_time...
                 │              │       └ 60
                 │              └ ConnectionParameters(user='admin', password='<z5&+lLwlgB(]KV#', database='surf_it', ssl=<ssl.SSLContext object at 0x000001695...
                 └ <function __connect_addr at 0x0000016954AED4E0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 860, in __connect_addr
    tr, pr = await compat.wait_for(connector, timeout=timeout)
                   │      │        │                  └ 60
                   │      │        └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
                   │      └ <function wait_for at 0x0000016954A43600>
                   └ <module 'asyncpg.compat' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site-...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\compat.py", line 60, in wait_for
    return await asyncio.wait_for(fut, timeout)
                 │       │        │    └ 60
                 │       │        └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
                 │       └ <function wait_for at 0x0000016951314180>
                 └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\tasks.py", line 479, in wait_for
    return fut.result()
           │   └ <method 'result' of '_asyncio.Task' objects>
           └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 719, in _create_ssl_connection
    tr, pr = await loop.create_connection(
                   │    └ <function BaseEventLoop.create_connection at 0x0000016951322480>
                   └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1081, in create_connection
    raise OSError('Multiple exceptions: {}'.format(

OSError: Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127.0.0.1', 5432)
ERROR    2023-07-26 06:25:04.615 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 172
               │     └ 3
               └ <function _main at 0x000001694F56F4C0>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 172
           │    └ <function BaseProcess._bootstrap at 0x000001694F4A5080>
           └ <SpawnProcess name='SpawnProcess-1' parent=22596 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001694F4A45E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=22596 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001694F50E610>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=22596 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=22596 started>
    │    └ <function subprocess_started at 0x0000016951588540>
    └ <SpawnProcess name='SpawnProcess-1' parent=22596 started>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=412, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x00000169516D3290>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=412, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x000001695156B740>
           │       │   └ <uvicorn.server.Server object at 0x00000169516D3290>
           │       └ <function run at 0x00000169513236A0>
           └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x00000169516E08C0>
           │      └ <function Runner.run at 0x0000016951323B00>
           └ <asyncio.runners.Runner object at 0x00000169516D3710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x0000016951321580>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x00000169516D3710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x00000169513214E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x00000169513232E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000016950E8F2E0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
> File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000016955457490>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000016955...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000016...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000016955475150>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000016955457490>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\applications.py", line 289, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000016955...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000016...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000016955...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000016...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000016955494350>
          └ <fastapi.applications.FastAPI object at 0x0000016955475150>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000016955506520>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000016...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000016954AAE750>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000016955494350>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x00000169555063E0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000016...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x00000169517EC490>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000016954AAE750>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
          │    │   │      │    │      └ <traceback object at 0x000001695557CA00>
          │    │   │      │    └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
          │    │   │      └ <class 'OSError'>
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object get_db at 0x0000016955580040>
          └ <contextlib._AsyncGeneratorContextManager object at 0x0000016955474F50>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\db\connection.py", line 25, in get_db
    yield session
          └ <sqlalchemy.orm.session.AsyncSession object at 0x000001695551AB10>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x00000169555063E0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000016...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x00000169517F9610>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x00000169517EC490>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x00000169555063E0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000016...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x00000169538FF4C0>
          └ APIRoute(path='/ad/complains/create', name='complain_ad', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x00000169555063E0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000016...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000016955504720>
          └ APIRoute(path='/ad/complains/create', name='complain_ad', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x00000169555188D0>
                     └ <function get_request_handler.<locals>.app at 0x00000169555040E0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 263, in app
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x00000169538DBC40>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\dependencies\utils.py", line 584, in solve_dependencies
    solved = await call(**sub_values)
                   │      └ {'user_manager': <auth.manager.UserManager object at 0x0000016955572550>, 'jwt': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdW...
                   └ <function Authenticator.current_user.<locals>.current_user_dependency at 0x000001695544C220>
  File "<makefun-gen-0>", line 2, in current_user_dependency
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\authentication\authenticator.py", line 136, in current_user_dependency
    user, _ = await self._authenticate(
                    │    └ <function Authenticator._authenticate at 0x00000169547551C0>
                    └ <fastapi_users.authentication.authenticator.Authenticator object at 0x0000016954F0FE50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\authentication\authenticator.py", line 170, in _authenticate
    user = await strategy.read_token(token, user_manager)
                 │        │          │      └ <auth.manager.UserManager object at 0x0000016955572550>
                 │        │          └ 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI0IiwiYXVkIjpbImZhc3RhcGktdXNlcnM6YXV0aCJdLCJleHAiOjE2OTA0MTM5NTd9.tjqhO6xSK_...
                 │        └ <function JWTStrategy.read_token at 0x0000016954747A60>
                 └ <fastapi_users.authentication.strategy.jwt.JWTStrategy object at 0x0000016955540A90>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\authentication\strategy\jwt.py", line 55, in read_token
    return await user_manager.get(parsed_id)
                 │            │   └ 4
                 │            └ <function BaseUserManager.get at 0x0000016954745D00>
                 └ <auth.manager.UserManager object at 0x0000016955572550>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\manager.py", line 72, in get
    user = await self.user_db.get(id)
                 │    │       │   └ 4
                 │    │       └ <function SQLAlchemyUserDatabase.get at 0x000001695488F380>
                 │    └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x0000016955573A90>
                 └ <auth.manager.UserManager object at 0x0000016955572550>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users_db_sqlalchemy\__init__.py", line 121, in get
    return await self._get_user(statement)
                 │    │         └ <sqlalchemy.sql.selectable.Select object at 0x000001695551A450>
                 │    └ <function SQLAlchemyUserDatabase._get_user at 0x000001695488F880>
                 └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x0000016955573A90>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users_db_sqlalchemy\__init__.py", line 186, in _get_user
    results = await self.session.execute(statement)
                    │    │       │       └ <sqlalchemy.sql.selectable.Select object at 0x000001695551A450>
                    │    │       └ <function AsyncSession.execute at 0x0000016954347B00>
                    │    └ <sqlalchemy.orm.session.AsyncSession object at 0x000001695551AB10>
                    └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x0000016955573A90>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 439, in execute
    result = await greenlet_spawn(
                   └ <function greenlet_spawn at 0x0000016953B06020>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             │       │      │   └ <built-in function exc_info>
             │       │      └ <module 'sys' (built-in)>
             │       └ <method 'throw' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x000001695548F9C0 (otid=0x0000016953A71260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2246, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x0000016954288900>
           └ <sqlalchemy.orm.session.Session object at 0x0000016955487190>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2131, in _execute_internal
    conn = self._connection_for_bind(bind)
           │    │                    └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │    └ <function Session._connection_for_bind at 0x0000016954288680>
           └ <sqlalchemy.orm.session.Session object at 0x0000016955487190>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1998, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           │     │                    │       └ None
           │     │                    └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │     └ <function SessionTransaction._connection_for_bind at 0x0000016954287060>
           └ <sqlalchemy.orm.session.SessionTransaction object at 0x00000169555B56D0>
  File "<string>", line 2, in _connection_for_bind
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ (Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it), None)
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x00000169555B56D0>
                └ <function SessionTransaction._connection_for_bind at 0x0000016954286FC0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1123, in _connection_for_bind
    conn = bind.connect()
           │    └ <function Engine.connect at 0x0000016953EFCD60>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3264, in connect
    return self._connection_cls(self)
           │    │               └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │    └ <class 'sqlalchemy.engine.base.Connection'>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 145, in __init__
    self._dbapi_connection = engine.raw_connection()
    │                        │      └ <function Engine.raw_connection at 0x0000016953EFCE00>
    │                        └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
    └ <sqlalchemy.engine.base.Connection object at 0x0000016955477210>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3288, in raw_connection
    return self.pool.connect()
           │    │    └ <function Pool.connect at 0x0000016953BACA40>
           │    └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000016954BC4CD0>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 452, in connect
    return _ConnectionFairy._checkout(self)
           │                │         └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000016954BC4CD0>
           │                └ <classmethod(<function _ConnectionFairy._checkout at 0x0000016953BAEAC0>)>
           └ <class 'sqlalchemy.pool.base._ConnectionFairy'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1267, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            │                 │        └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000016954BC4CD0>
            │                 └ <classmethod(<function _ConnectionRecord.checkout at 0x0000016953BAD620>)>
            └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 716, in checkout
    rec = pool._do_get()
          │    └ <function QueuePool._do_get at 0x0000016953BB6200>
          └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000016954BC4CD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 169, in _do_get
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x000001695557C180>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 167, in _do_get
    return self._create_connection()
           │    └ <function Pool._create_connection at 0x0000016953BAC7C0>
           └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000016954BC4CD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 393, in _create_connection
    return _ConnectionRecord(self)
           │                 └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000016954BC4CD0>
           └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 678, in __init__
    self.__connect()
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x0000016955585010>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 902, in __connect
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x00000169554DF940>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 898, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
    │    │                               │    │               └ <sqlalchemy.pool.base._ConnectionRecord object at 0x0000016955585010>
    │    │                               │    └ <function create_engine.<locals>.connect at 0x0000016954A42E80>
    │    │                               └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000016954BC4CD0>
    │    └ <member 'dbapi_connection' of '_ConnectionRecord' objects>
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x0000016955585010>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\create.py", line 637, in connect
    return dialect.connect(*cargs, **cparams)
           │       │        │        └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
           │       │        └ []
           │       └ <function DefaultDialect.connect at 0x0000016953F6FE20>
           └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x000001695542FAD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 615, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)
           │    │            │        │        └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
           │    │            │        └ ()
           │    │            └ <function AsyncAdapt_asyncpg_dbapi.connect at 0x0000016954859760>
           │    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi object at 0x000001695542F610>
           └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x000001695542FAD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 916, in connect
    await_only(creator_fn(*arg, **kw)),
    │          │           │      └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
    │          │           └ ()
    │          └ <function connect at 0x0000016954AEE160>
    └ <function await_only at 0x0000016953A818A0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object connect at 0x00000169555941B0>
           └ <_AsyncIoGreenlet object at 0x000001695548F9C0 (otid=0x0000016953A71260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object connect at 0x00000169555941B0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connection.py", line 2114, in connect
    return await connect_utils._connect(
                 │             └ <function _connect at 0x0000016954AEDB20>
                 └ <module 'asyncpg.connect_utils' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 1011, in _connect
    raise last_error or exceptions.TargetServerAttributeNotMatched(
          │             │          └ <class 'asyncpg.exceptions._base.TargetServerAttributeNotMatched'>
          │             └ <module 'asyncpg.exceptions' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\s...
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 982, in _connect
    conn = await _connect_addr(
                 └ <function _connect_addr at 0x0000016954AED440>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 808, in _connect_addr
    return await __connect_addr(params, timeout, True, *args)
                 │              │       │               └ (('localhost', 5432), <_WindowsSelectorEventLoop running=True closed=False debug=False>, ConnectionConfiguration(command_time...
                 │              │       └ 60
                 │              └ ConnectionParameters(user='admin', password='<z5&+lLwlgB(]KV#', database='surf_it', ssl=<ssl.SSLContext object at 0x000001695...
                 └ <function __connect_addr at 0x0000016954AED4E0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 860, in __connect_addr
    tr, pr = await compat.wait_for(connector, timeout=timeout)
                   │      │        │                  └ 60
                   │      │        └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
                   │      └ <function wait_for at 0x0000016954A43600>
                   └ <module 'asyncpg.compat' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site-...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\compat.py", line 60, in wait_for
    return await asyncio.wait_for(fut, timeout)
                 │       │        │    └ 60
                 │       │        └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
                 │       └ <function wait_for at 0x0000016951314180>
                 └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\tasks.py", line 479, in wait_for
    return fut.result()
           │   └ <method 'result' of '_asyncio.Task' objects>
           └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 719, in _create_ssl_connection
    tr, pr = await loop.create_connection(
                   │    └ <function BaseEventLoop.create_connection at 0x0000016951322480>
                   └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1081, in create_connection
    raise OSError('Multiple exceptions: {}'.format(

OSError: Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127.0.0.1', 5432)
INFO     2023-07-26 06:27:01.538 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 06:27:01.538 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 06:27:01.645 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 06:27:01.646 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 06:27:01.647 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 06:27:01.647 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 06:27:01.648 request id: app - logging:callHandlers - Finished server process [18972]
INFO     2023-07-26 06:27:01.648 request id: app - logging:callHandlers - Finished server process [18972]
INFO     2023-07-26 06:27:06.392 request id: app - logging:callHandlers - Started server process [26012]
INFO     2023-07-26 06:27:06.393 request id: app - logging:callHandlers - Started server process [26012]
INFO     2023-07-26 06:27:06.394 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 06:27:06.394 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 06:27:06.395 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 06:27:06.396 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 06:27:06.664 request id: app - logging:callHandlers - 127.0.0.1:62269 - "POST /ad/complains/create HTTP/1.1" 401
INFO     2023-07-26 06:27:13.625 request id: app - logging:callHandlers - 127.0.0.1:62268 - "POST /ad/complains/create HTTP/1.1" 401
CRITICAL 2023-07-26 06:27:37.371 request id: None - db.connection:get_db - DataBase Error: Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127.0.0.1', 5432)
INFO     2023-07-26 06:27:37.372 request id: app - logging:callHandlers - 127.0.0.1:62273 - "POST /auth/jwt/login HTTP/1.1" 500
ERROR    2023-07-26 06:27:37.373 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 316
               │     └ 3
               └ <function _main at 0x000002F043EBF4C0>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 316
           │    └ <function BaseProcess._bootstrap at 0x000002F043E15080>
           └ <SpawnProcess name='SpawnProcess-1' parent=11244 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000002F043E145E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=11244 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000002F043E7E610>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=11244 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=11244 started>
    │    └ <function subprocess_started at 0x000002F045E78540>
    └ <SpawnProcess name='SpawnProcess-1' parent=11244 started>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=760, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000002F045FC3290>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=760, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x000002F045E5B740>
           │       │   └ <uvicorn.server.Server object at 0x000002F045FC3290>
           │       └ <function run at 0x000002F045C436A0>
           └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000002F045FD08C0>
           │      └ <function Runner.run at 0x000002F045C43B00>
           └ <asyncio.runners.Runner object at 0x000002F045FC3710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000002F045C41580>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000002F045FC3710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000002F045C414E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000002F045C432E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000002F0457BF2E0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
> File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002F049D64E50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002F049...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002F...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000002F0460E9610>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002F049D64E50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\applications.py", line 289, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002F049...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002F...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002F049...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002F...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000002F049E62010>
          └ <fastapi.applications.FastAPI object at 0x000002F0460E9610>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000002F049EAA8E0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002F...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002F049E62050>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000002F049E62010>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002F049EAAC00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002F...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x000002F049E61ED0>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002F049E62050>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 25, in __call__
    raise dependency_exception
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\db\connection.py", line 25, in get_db
    yield session
          └ <sqlalchemy.orm.session.AsyncSession object at 0x000002F049EBDED0>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002F049EAAC00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002F...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x000002F0482AC550>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x000002F049E61ED0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002F049EAAC00>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002F...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x000002F0482034C0>
          └ APIRoute(path='/auth/jwt/login', name='auth:jwt.login', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002F049EAAC00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002F...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x000002F049DF6F20>
          └ APIRoute(path='/auth/jwt/login', name='auth:jwt.login', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x000002F049E6A910>
                     └ <function get_request_handler.<locals>.app at 0x000002F049DF7060>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 273, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x000002F048201940>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 190, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'credentials': <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x000002F049E69310>, 'user_manager': <auth.manag...
                 │         └ <function get_auth_router.<locals>.login at 0x000002F049DF54E0>
                 └ <fastapi.dependencies.models.Dependant object at 0x000002F049E25250>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\router\auth.py", line 57, in login
    user = await user_manager.authenticate(credentials)
                 │            │            └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x000002F049E69310>
                 │            └ <function BaseUserManager.authenticate at 0x000002F049036AC0>
                 └ <auth.manager.UserManager object at 0x000002F049EBE2D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\manager.py", line 645, in authenticate
    user = await self.get_by_email(credentials.username)
                 │    │            │           └ 'admin'
                 │    │            └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x000002F049E69310>
                 │    └ <function BaseUserManager.get_by_email at 0x000002F049035DA0>
                 └ <auth.manager.UserManager object at 0x000002F049EBE2D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\manager.py", line 87, in get_by_email
    user = await self.user_db.get_by_email(user_email)
                 │    │       │            └ 'admin'
                 │    │       └ <function SQLAlchemyUserDatabase.get_by_email at 0x000002F04917F420>
                 │    └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x000002F049EBE210>
                 └ <auth.manager.UserManager object at 0x000002F049EBE2D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users_db_sqlalchemy\__init__.py", line 127, in get_by_email
    return await self._get_user(statement)
                 │    │         └ <sqlalchemy.sql.selectable.Select object at 0x000002F049D7AB10>
                 │    └ <function SQLAlchemyUserDatabase._get_user at 0x000002F04917F880>
                 └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x000002F049EBE210>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users_db_sqlalchemy\__init__.py", line 186, in _get_user
    results = await self.session.execute(statement)
                    │    │       │       └ <sqlalchemy.sql.selectable.Select object at 0x000002F049D7AB10>
                    │    │       └ <function AsyncSession.execute at 0x000002F048C37B00>
                    │    └ <sqlalchemy.orm.session.AsyncSession object at 0x000002F049EBDED0>
                    └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x000002F049EBE210>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 439, in execute
    result = await greenlet_spawn(
                   └ <function greenlet_spawn at 0x000002F0483F6020>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             │       │      │   └ <built-in function exc_info>
             │       │      └ <module 'sys' (built-in)>
             │       └ <method 'throw' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x000002F049D5D000 (otid=0x000002F048361260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2246, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x000002F048B7C900>
           └ <sqlalchemy.orm.session.Session object at 0x000002F049EBDDD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2131, in _execute_internal
    conn = self._connection_for_bind(bind)
           │    │                    └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │    └ <function Session._connection_for_bind at 0x000002F048B7C680>
           └ <sqlalchemy.orm.session.Session object at 0x000002F049EBDDD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1998, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           │     │                    │       └ None
           │     │                    └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │     └ <function SessionTransaction._connection_for_bind at 0x000002F048B77060>
           └ <sqlalchemy.orm.session.SessionTransaction object at 0x000002F0493091D0>
  File "<string>", line 2, in _connection_for_bind
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ (Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it), None)
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x000002F0493091D0>
                └ <function SessionTransaction._connection_for_bind at 0x000002F048B76FC0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1123, in _connection_for_bind
    conn = bind.connect()
           │    └ <function Engine.connect at 0x000002F0487ECD60>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3264, in connect
    return self._connection_cls(self)
           │    │               └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │    └ <class 'sqlalchemy.engine.base.Connection'>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 145, in __init__
    self._dbapi_connection = engine.raw_connection()
    │                        │      └ <function Engine.raw_connection at 0x000002F0487ECE00>
    │                        └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
    └ <sqlalchemy.engine.base.Connection object at 0x000002F0492D5990>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3288, in raw_connection
    return self.pool.connect()
           │    │    └ <function Pool.connect at 0x000002F04849CA40>
           │    └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002F049D1FB50>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 452, in connect
    return _ConnectionFairy._checkout(self)
           │                │         └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002F049D1FB50>
           │                └ <classmethod(<function _ConnectionFairy._checkout at 0x000002F04849EAC0>)>
           └ <class 'sqlalchemy.pool.base._ConnectionFairy'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1267, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            │                 │        └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002F049D1FB50>
            │                 └ <classmethod(<function _ConnectionRecord.checkout at 0x000002F04849D620>)>
            └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 716, in checkout
    rec = pool._do_get()
          │    └ <function QueuePool._do_get at 0x000002F0484A6200>
          └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002F049D1FB50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 169, in _do_get
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x000002F049E62840>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 167, in _do_get
    return self._create_connection()
           │    └ <function Pool._create_connection at 0x000002F04849C7C0>
           └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002F049D1FB50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 393, in _create_connection
    return _ConnectionRecord(self)
           │                 └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002F049D1FB50>
           └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 678, in __init__
    self.__connect()
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x000002F049C87C40>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 902, in __connect
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x000002F049E62C00>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 898, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
    │    │                               │    │               └ <sqlalchemy.pool.base._ConnectionRecord object at 0x000002F049C87C40>
    │    │                               │    └ <function create_engine.<locals>.connect at 0x000002F049332E80>
    │    │                               └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002F049D1FB50>
    │    └ <member 'dbapi_connection' of '_ConnectionRecord' objects>
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x000002F049C87C40>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\create.py", line 637, in connect
    return dialect.connect(*cargs, **cparams)
           │       │        │        └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
           │       │        └ []
           │       └ <function DefaultDialect.connect at 0x000002F04885FE20>
           └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x000002F049D1F650>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 615, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)
           │    │            │        │        └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
           │    │            │        └ ()
           │    │            └ <function AsyncAdapt_asyncpg_dbapi.connect at 0x000002F049149760>
           │    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi object at 0x000002F049D1F450>
           └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x000002F049D1F650>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 916, in connect
    await_only(creator_fn(*arg, **kw)),
    │          │           │      └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
    │          │           └ ()
    │          └ <function connect at 0x000002F0493DE160>
    └ <function await_only at 0x000002F0483718A0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object connect at 0x000002F049E841B0>
           └ <_AsyncIoGreenlet object at 0x000002F049D5D000 (otid=0x000002F048361260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object connect at 0x000002F049E841B0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connection.py", line 2114, in connect
    return await connect_utils._connect(
                 │             └ <function _connect at 0x000002F0493DDB20>
                 └ <module 'asyncpg.connect_utils' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 1011, in _connect
    raise last_error or exceptions.TargetServerAttributeNotMatched(
          │             │          └ <class 'asyncpg.exceptions._base.TargetServerAttributeNotMatched'>
          │             └ <module 'asyncpg.exceptions' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\s...
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 982, in _connect
    conn = await _connect_addr(
                 └ <function _connect_addr at 0x000002F0493DD440>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 808, in _connect_addr
    return await __connect_addr(params, timeout, True, *args)
                 │              │       │               └ (('localhost', 5432), <_WindowsSelectorEventLoop running=True closed=False debug=False>, ConnectionConfiguration(command_time...
                 │              │       └ 60
                 │              └ ConnectionParameters(user='admin', password='<z5&+lLwlgB(]KV#', database='surf_it', ssl=<ssl.SSLContext object at 0x000002F04...
                 └ <function __connect_addr at 0x000002F0493DD4E0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 860, in __connect_addr
    tr, pr = await compat.wait_for(connector, timeout=timeout)
                   │      │        │                  └ 60
                   │      │        └ <Task finished name='Task-11' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания...
                   │      └ <function wait_for at 0x000002F049333600>
                   └ <module 'asyncpg.compat' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site-...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\compat.py", line 60, in wait_for
    return await asyncio.wait_for(fut, timeout)
                 │       │        │    └ 60
                 │       │        └ <Task finished name='Task-11' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания...
                 │       └ <function wait_for at 0x000002F045C34180>
                 └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\tasks.py", line 479, in wait_for
    return fut.result()
           │   └ <method 'result' of '_asyncio.Task' objects>
           └ <Task finished name='Task-11' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 719, in _create_ssl_connection
    tr, pr = await loop.create_connection(
                   │    └ <function BaseEventLoop.create_connection at 0x000002F045C42480>
                   └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1081, in create_connection
    raise OSError('Multiple exceptions: {}'.format(

OSError: Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127.0.0.1', 5432)
ERROR    2023-07-26 06:27:37.417 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 316
               │     └ 3
               └ <function _main at 0x000002F043EBF4C0>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 316
           │    └ <function BaseProcess._bootstrap at 0x000002F043E15080>
           └ <SpawnProcess name='SpawnProcess-1' parent=11244 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000002F043E145E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=11244 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000002F043E7E610>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=11244 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=11244 started>
    │    └ <function subprocess_started at 0x000002F045E78540>
    └ <SpawnProcess name='SpawnProcess-1' parent=11244 started>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=760, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000002F045FC3290>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=760, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x000002F045E5B740>
           │       │   └ <uvicorn.server.Server object at 0x000002F045FC3290>
           │       └ <function run at 0x000002F045C436A0>
           └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000002F045FD08C0>
           │      └ <function Runner.run at 0x000002F045C43B00>
           └ <asyncio.runners.Runner object at 0x000002F045FC3710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000002F045C41580>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000002F045FC3710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000002F045C414E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000002F045C432E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000002F0457BF2E0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
> File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002F049D64E50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002F049...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002F...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000002F0460E9610>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002F049D64E50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\applications.py", line 289, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002F049...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002F...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002F049...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002F...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000002F049E62010>
          └ <fastapi.applications.FastAPI object at 0x000002F0460E9610>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000002F049EAA8E0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002F...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002F049E62050>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000002F049E62010>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002F049EAAC00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002F...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x000002F049E61ED0>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002F049E62050>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 25, in __call__
    raise dependency_exception
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\db\connection.py", line 25, in get_db
    yield session
          └ <sqlalchemy.orm.session.AsyncSession object at 0x000002F049EBDED0>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002F049EAAC00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002F...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x000002F0482AC550>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x000002F049E61ED0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002F049EAAC00>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002F...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x000002F0482034C0>
          └ APIRoute(path='/auth/jwt/login', name='auth:jwt.login', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002F049EAAC00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002F...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x000002F049DF6F20>
          └ APIRoute(path='/auth/jwt/login', name='auth:jwt.login', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x000002F049E6A910>
                     └ <function get_request_handler.<locals>.app at 0x000002F049DF7060>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 273, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x000002F048201940>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 190, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'credentials': <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x000002F049E69310>, 'user_manager': <auth.manag...
                 │         └ <function get_auth_router.<locals>.login at 0x000002F049DF54E0>
                 └ <fastapi.dependencies.models.Dependant object at 0x000002F049E25250>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\router\auth.py", line 57, in login
    user = await user_manager.authenticate(credentials)
                 │            │            └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x000002F049E69310>
                 │            └ <function BaseUserManager.authenticate at 0x000002F049036AC0>
                 └ <auth.manager.UserManager object at 0x000002F049EBE2D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\manager.py", line 645, in authenticate
    user = await self.get_by_email(credentials.username)
                 │    │            │           └ 'admin'
                 │    │            └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x000002F049E69310>
                 │    └ <function BaseUserManager.get_by_email at 0x000002F049035DA0>
                 └ <auth.manager.UserManager object at 0x000002F049EBE2D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\manager.py", line 87, in get_by_email
    user = await self.user_db.get_by_email(user_email)
                 │    │       │            └ 'admin'
                 │    │       └ <function SQLAlchemyUserDatabase.get_by_email at 0x000002F04917F420>
                 │    └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x000002F049EBE210>
                 └ <auth.manager.UserManager object at 0x000002F049EBE2D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users_db_sqlalchemy\__init__.py", line 127, in get_by_email
    return await self._get_user(statement)
                 │    │         └ <sqlalchemy.sql.selectable.Select object at 0x000002F049D7AB10>
                 │    └ <function SQLAlchemyUserDatabase._get_user at 0x000002F04917F880>
                 └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x000002F049EBE210>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users_db_sqlalchemy\__init__.py", line 186, in _get_user
    results = await self.session.execute(statement)
                    │    │       │       └ <sqlalchemy.sql.selectable.Select object at 0x000002F049D7AB10>
                    │    │       └ <function AsyncSession.execute at 0x000002F048C37B00>
                    │    └ <sqlalchemy.orm.session.AsyncSession object at 0x000002F049EBDED0>
                    └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x000002F049EBE210>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 439, in execute
    result = await greenlet_spawn(
                   └ <function greenlet_spawn at 0x000002F0483F6020>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             │       │      │   └ <built-in function exc_info>
             │       │      └ <module 'sys' (built-in)>
             │       └ <method 'throw' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x000002F049D5D000 (otid=0x000002F048361260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2246, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x000002F048B7C900>
           └ <sqlalchemy.orm.session.Session object at 0x000002F049EBDDD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2131, in _execute_internal
    conn = self._connection_for_bind(bind)
           │    │                    └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │    └ <function Session._connection_for_bind at 0x000002F048B7C680>
           └ <sqlalchemy.orm.session.Session object at 0x000002F049EBDDD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1998, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           │     │                    │       └ None
           │     │                    └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │     └ <function SessionTransaction._connection_for_bind at 0x000002F048B77060>
           └ <sqlalchemy.orm.session.SessionTransaction object at 0x000002F0493091D0>
  File "<string>", line 2, in _connection_for_bind
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ (Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it), None)
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x000002F0493091D0>
                └ <function SessionTransaction._connection_for_bind at 0x000002F048B76FC0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1123, in _connection_for_bind
    conn = bind.connect()
           │    └ <function Engine.connect at 0x000002F0487ECD60>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3264, in connect
    return self._connection_cls(self)
           │    │               └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │    └ <class 'sqlalchemy.engine.base.Connection'>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 145, in __init__
    self._dbapi_connection = engine.raw_connection()
    │                        │      └ <function Engine.raw_connection at 0x000002F0487ECE00>
    │                        └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
    └ <sqlalchemy.engine.base.Connection object at 0x000002F0492D5990>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3288, in raw_connection
    return self.pool.connect()
           │    │    └ <function Pool.connect at 0x000002F04849CA40>
           │    └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002F049D1FB50>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 452, in connect
    return _ConnectionFairy._checkout(self)
           │                │         └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002F049D1FB50>
           │                └ <classmethod(<function _ConnectionFairy._checkout at 0x000002F04849EAC0>)>
           └ <class 'sqlalchemy.pool.base._ConnectionFairy'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1267, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            │                 │        └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002F049D1FB50>
            │                 └ <classmethod(<function _ConnectionRecord.checkout at 0x000002F04849D620>)>
            └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 716, in checkout
    rec = pool._do_get()
          │    └ <function QueuePool._do_get at 0x000002F0484A6200>
          └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002F049D1FB50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 169, in _do_get
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x000002F049E62840>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 167, in _do_get
    return self._create_connection()
           │    └ <function Pool._create_connection at 0x000002F04849C7C0>
           └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002F049D1FB50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 393, in _create_connection
    return _ConnectionRecord(self)
           │                 └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002F049D1FB50>
           └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 678, in __init__
    self.__connect()
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x000002F049C87C40>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 902, in __connect
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x000002F049E62C00>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 898, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
    │    │                               │    │               └ <sqlalchemy.pool.base._ConnectionRecord object at 0x000002F049C87C40>
    │    │                               │    └ <function create_engine.<locals>.connect at 0x000002F049332E80>
    │    │                               └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002F049D1FB50>
    │    └ <member 'dbapi_connection' of '_ConnectionRecord' objects>
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x000002F049C87C40>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\create.py", line 637, in connect
    return dialect.connect(*cargs, **cparams)
           │       │        │        └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
           │       │        └ []
           │       └ <function DefaultDialect.connect at 0x000002F04885FE20>
           └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x000002F049D1F650>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 615, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)
           │    │            │        │        └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
           │    │            │        └ ()
           │    │            └ <function AsyncAdapt_asyncpg_dbapi.connect at 0x000002F049149760>
           │    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi object at 0x000002F049D1F450>
           └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x000002F049D1F650>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 916, in connect
    await_only(creator_fn(*arg, **kw)),
    │          │           │      └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
    │          │           └ ()
    │          └ <function connect at 0x000002F0493DE160>
    └ <function await_only at 0x000002F0483718A0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object connect at 0x000002F049E841B0>
           └ <_AsyncIoGreenlet object at 0x000002F049D5D000 (otid=0x000002F048361260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object connect at 0x000002F049E841B0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connection.py", line 2114, in connect
    return await connect_utils._connect(
                 │             └ <function _connect at 0x000002F0493DDB20>
                 └ <module 'asyncpg.connect_utils' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 1011, in _connect
    raise last_error or exceptions.TargetServerAttributeNotMatched(
          │             │          └ <class 'asyncpg.exceptions._base.TargetServerAttributeNotMatched'>
          │             └ <module 'asyncpg.exceptions' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\s...
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 982, in _connect
    conn = await _connect_addr(
                 └ <function _connect_addr at 0x000002F0493DD440>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 808, in _connect_addr
    return await __connect_addr(params, timeout, True, *args)
                 │              │       │               └ (('localhost', 5432), <_WindowsSelectorEventLoop running=True closed=False debug=False>, ConnectionConfiguration(command_time...
                 │              │       └ 60
                 │              └ ConnectionParameters(user='admin', password='<z5&+lLwlgB(]KV#', database='surf_it', ssl=<ssl.SSLContext object at 0x000002F04...
                 └ <function __connect_addr at 0x000002F0493DD4E0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 860, in __connect_addr
    tr, pr = await compat.wait_for(connector, timeout=timeout)
                   │      │        │                  └ 60
                   │      │        └ <Task finished name='Task-11' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания...
                   │      └ <function wait_for at 0x000002F049333600>
                   └ <module 'asyncpg.compat' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site-...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\compat.py", line 60, in wait_for
    return await asyncio.wait_for(fut, timeout)
                 │       │        │    └ 60
                 │       │        └ <Task finished name='Task-11' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания...
                 │       └ <function wait_for at 0x000002F045C34180>
                 └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\tasks.py", line 479, in wait_for
    return fut.result()
           │   └ <method 'result' of '_asyncio.Task' objects>
           └ <Task finished name='Task-11' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 719, in _create_ssl_connection
    tr, pr = await loop.create_connection(
                   │    └ <function BaseEventLoop.create_connection at 0x000002F045C42480>
                   └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1081, in create_connection
    raise OSError('Multiple exceptions: {}'.format(

OSError: Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127.0.0.1', 5432)
INFO     2023-07-26 06:30:06.390 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 06:30:06.390 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 06:30:06.498 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 06:30:06.498 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 06:30:06.500 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 06:30:06.501 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 06:30:06.501 request id: app - logging:callHandlers - Finished server process [26012]
INFO     2023-07-26 06:30:06.502 request id: app - logging:callHandlers - Finished server process [26012]
INFO     2023-07-26 06:30:09.877 request id: app - logging:callHandlers - Started server process [14992]
INFO     2023-07-26 06:30:09.878 request id: app - logging:callHandlers - Started server process [14992]
INFO     2023-07-26 06:30:09.879 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 06:30:09.879 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 06:30:09.881 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 06:30:09.882 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 06:30:17.424 request id: app - logging:callHandlers - Started server process [2240]
INFO     2023-07-26 06:30:17.424 request id: app - logging:callHandlers - Started server process [2240]
INFO     2023-07-26 06:30:17.425 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 06:30:17.426 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 06:30:17.427 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 06:30:17.428 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 06:30:21.710 request id: app - logging:callHandlers - 127.0.0.1:62308 - "POST /auth/jwt/login HTTP/1.1" 500
ERROR    2023-07-26 06:30:21.712 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 320
               │     └ 3
               └ <function _main at 0x000002407EDCF4C0>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 320
           │    └ <function BaseProcess._bootstrap at 0x000002407ED25080>
           └ <SpawnProcess name='SpawnProcess-1' parent=20628 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000002407ED245E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=20628 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000002407ED8E610>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20628 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20628 started>
    │    └ <function subprocess_started at 0x000002407F978540>
    └ <SpawnProcess name='SpawnProcess-1' parent=20628 started>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=596, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000002407FAB3290>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=596, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x000002407F95B740>
           │       │   └ <uvicorn.server.Server object at 0x000002407FAB3290>
           │       └ <function run at 0x000002407F3436A0>
           └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000002407FAC08C0>
           │      └ <function Runner.run at 0x000002407F343B00>
           └ <asyncio.runners.Runner object at 0x000002407FAB3710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000002407F341580>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000002407FAB3710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000002407F3414E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000002407F3432E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000002407F2BF2E0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
> File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002407FABE7D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024004...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000002407FBB9610>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002407FABE7D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\applications.py", line 289, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024004...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024004...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000002400421E750>
          └ <fastapi.applications.FastAPI object at 0x000002407FBB9610>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000024004CE4040>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000024004C51290>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000002400421E750>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000024004CE4360>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x0000024004CFBAD0>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000024004C51290>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
          │    │   │      │    │      └ <traceback object at 0x0000024004D59B00>
          │    │   │      │    └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
          │    │   │      └ <class 'OSError'>
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object get_db at 0x0000024004D60C70>
          └ <contextlib._AsyncGeneratorContextManager object at 0x0000024004C350D0>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\db\connection.py", line 26, in get_db
    yield session
          └ <sqlalchemy.orm.session.AsyncSession object at 0x0000024004D51090>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000024004CE4360>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x000002407FBAC750>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x0000024004CFBAD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000024004CE4360>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x00000240031534C0>
          └ APIRoute(path='/auth/jwt/login', name='auth:jwt.login', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000024004CE4360>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000024004CE6F20>
          └ APIRoute(path='/auth/jwt/login', name='auth:jwt.login', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x0000024004D51B50>
                     └ <function get_request_handler.<locals>.app at 0x0000024004CE7060>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 273, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x0000024003151940>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 190, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'credentials': <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x0000024004D50250>, 'user_manager': <auth.manag...
                 │         └ <function get_auth_router.<locals>.login at 0x0000024004CE54E0>
                 └ <fastapi.dependencies.models.Dependant object at 0x0000024004D15410>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\router\auth.py", line 57, in login
    user = await user_manager.authenticate(credentials)
                 │            │            └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x0000024004D50250>
                 │            └ <function BaseUserManager.authenticate at 0x0000024003F16AC0>
                 └ <auth.manager.UserManager object at 0x0000024004D51010>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\manager.py", line 645, in authenticate
    user = await self.get_by_email(credentials.username)
                 │    │            │           └ 'admin'
                 │    │            └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x0000024004D50250>
                 │    └ <function BaseUserManager.get_by_email at 0x0000024003F15DA0>
                 └ <auth.manager.UserManager object at 0x0000024004D51010>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\manager.py", line 87, in get_by_email
    user = await self.user_db.get_by_email(user_email)
                 │    │       │            └ 'admin'
                 │    │       └ <function SQLAlchemyUserDatabase.get_by_email at 0x000002400406F420>
                 │    └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x0000024004D52C90>
                 └ <auth.manager.UserManager object at 0x0000024004D51010>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users_db_sqlalchemy\__init__.py", line 127, in get_by_email
    return await self._get_user(statement)
                 │    │         └ <sqlalchemy.sql.selectable.Select object at 0x0000024004C78650>
                 │    └ <function SQLAlchemyUserDatabase._get_user at 0x000002400406F880>
                 └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x0000024004D52C90>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users_db_sqlalchemy\__init__.py", line 186, in _get_user
    results = await self.session.execute(statement)
                    │    │       │       └ <sqlalchemy.sql.selectable.Select object at 0x0000024004C78650>
                    │    │       └ <function AsyncSession.execute at 0x0000024003B17B00>
                    │    └ <sqlalchemy.orm.session.AsyncSession object at 0x0000024004D51090>
                    └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x0000024004D52C90>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 439, in execute
    result = await greenlet_spawn(
                   └ <function greenlet_spawn at 0x00000240032E6020>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             │       │      │   └ <built-in function exc_info>
             │       │      └ <module 'sys' (built-in)>
             │       └ <method 'throw' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x0000024004D52880 (otid=0x00000240032B1260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2246, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x0000024003A5C900>
           └ <sqlalchemy.orm.session.Session object at 0x0000024004D50910>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2131, in _execute_internal
    conn = self._connection_for_bind(bind)
           │    │                    └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │    └ <function Session._connection_for_bind at 0x0000024003A5C680>
           └ <sqlalchemy.orm.session.Session object at 0x0000024004D50910>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1998, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           │     │                    │       └ None
           │     │                    └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │     └ <function SessionTransaction._connection_for_bind at 0x0000024003A57060>
           └ <sqlalchemy.orm.session.SessionTransaction object at 0x00000240041B4550>
  File "<string>", line 2, in _connection_for_bind
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ (Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it), None)
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x00000240041B4550>
                └ <function SessionTransaction._connection_for_bind at 0x0000024003A56FC0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1123, in _connection_for_bind
    conn = bind.connect()
           │    └ <function Engine.connect at 0x00000240036CCD60>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3264, in connect
    return self._connection_cls(self)
           │    │               └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │    └ <class 'sqlalchemy.engine.base.Connection'>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 145, in __init__
    self._dbapi_connection = engine.raw_connection()
    │                        │      └ <function Engine.raw_connection at 0x00000240036CCE00>
    │                        └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
    └ <sqlalchemy.engine.base.Connection object at 0x0000024004C4BB50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3288, in raw_connection
    return self.pool.connect()
           │    │    └ <function Pool.connect at 0x000002400338CA40>
           │    └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000024004C24B90>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 452, in connect
    return _ConnectionFairy._checkout(self)
           │                │         └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000024004C24B90>
           │                └ <classmethod(<function _ConnectionFairy._checkout at 0x000002400338EAC0>)>
           └ <class 'sqlalchemy.pool.base._ConnectionFairy'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1267, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            │                 │        └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000024004C24B90>
            │                 └ <classmethod(<function _ConnectionRecord.checkout at 0x000002400338D620>)>
            └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 716, in checkout
    rec = pool._do_get()
          │    └ <function QueuePool._do_get at 0x0000024003396200>
          └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000024004C24B90>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 169, in _do_get
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x0000024004D59580>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 167, in _do_get
    return self._create_connection()
           │    └ <function Pool._create_connection at 0x000002400338C7C0>
           └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000024004C24B90>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 393, in _create_connection
    return _ConnectionRecord(self)
           │                 └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000024004C24B90>
           └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 678, in __init__
    self.__connect()
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x0000024004D66190>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 902, in __connect
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x0000024004D59480>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 898, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
    │    │                               │    │               └ <sqlalchemy.pool.base._ConnectionRecord object at 0x0000024004D66190>
    │    │                               │    └ <function create_engine.<locals>.connect at 0x0000024004222F20>
    │    │                               └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000024004C24B90>
    │    └ <member 'dbapi_connection' of '_ConnectionRecord' objects>
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x0000024004D66190>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\create.py", line 637, in connect
    return dialect.connect(*cargs, **cparams)
           │       │        │        └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
           │       │        └ []
           │       └ <function DefaultDialect.connect at 0x000002400373FE20>
           └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x0000024004C07C50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 615, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)
           │    │            │        │        └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
           │    │            │        └ ()
           │    │            └ <function AsyncAdapt_asyncpg_dbapi.connect at 0x0000024004039760>
           │    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi object at 0x0000024004C07C90>
           └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x0000024004C07C50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 916, in connect
    await_only(creator_fn(*arg, **kw)),
    │          │           │      └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
    │          │           └ ()
    │          └ <function connect at 0x00000240042CE160>
    └ <function await_only at 0x00000240032C18A0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object connect at 0x0000024004D74EA0>
           └ <_AsyncIoGreenlet object at 0x0000024004D52880 (otid=0x00000240032B1260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object connect at 0x0000024004D74EA0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connection.py", line 2114, in connect
    return await connect_utils._connect(
                 │             └ <function _connect at 0x00000240042CDB20>
                 └ <module 'asyncpg.connect_utils' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 1011, in _connect
    raise last_error or exceptions.TargetServerAttributeNotMatched(
          │             │          └ <class 'asyncpg.exceptions._base.TargetServerAttributeNotMatched'>
          │             └ <module 'asyncpg.exceptions' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\s...
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 982, in _connect
    conn = await _connect_addr(
                 └ <function _connect_addr at 0x00000240042CD440>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 808, in _connect_addr
    return await __connect_addr(params, timeout, True, *args)
                 │              │       │               └ (('localhost', 5432), <_WindowsSelectorEventLoop running=True closed=False debug=False>, ConnectionConfiguration(command_time...
                 │              │       └ 60
                 │              └ ConnectionParameters(user='admin', password='<z5&+lLwlgB(]KV#', database='surf_it', ssl=<ssl.SSLContext object at 0x000002400...
                 └ <function __connect_addr at 0x00000240042CD4E0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 860, in __connect_addr
    tr, pr = await compat.wait_for(connector, timeout=timeout)
                   │      │        │                  └ 60
                   │      │        └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
                   │      └ <function wait_for at 0x0000024004223600>
                   └ <module 'asyncpg.compat' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site-...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\compat.py", line 60, in wait_for
    return await asyncio.wait_for(fut, timeout)
                 │       │        │    └ 60
                 │       │        └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
                 │       └ <function wait_for at 0x000002407F334180>
                 └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\tasks.py", line 479, in wait_for
    return fut.result()
           │   └ <method 'result' of '_asyncio.Task' objects>
           └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 719, in _create_ssl_connection
    tr, pr = await loop.create_connection(
                   │    └ <function BaseEventLoop.create_connection at 0x000002407F342480>
                   └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1081, in create_connection
    raise OSError('Multiple exceptions: {}'.format(

OSError: Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127.0.0.1', 5432)
ERROR    2023-07-26 06:30:21.757 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 320
               │     └ 3
               └ <function _main at 0x000002407EDCF4C0>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 320
           │    └ <function BaseProcess._bootstrap at 0x000002407ED25080>
           └ <SpawnProcess name='SpawnProcess-1' parent=20628 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000002407ED245E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=20628 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000002407ED8E610>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20628 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20628 started>
    │    └ <function subprocess_started at 0x000002407F978540>
    └ <SpawnProcess name='SpawnProcess-1' parent=20628 started>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=596, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000002407FAB3290>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=596, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x000002407F95B740>
           │       │   └ <uvicorn.server.Server object at 0x000002407FAB3290>
           │       └ <function run at 0x000002407F3436A0>
           └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000002407FAC08C0>
           │      └ <function Runner.run at 0x000002407F343B00>
           └ <asyncio.runners.Runner object at 0x000002407FAB3710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000002407F341580>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000002407FAB3710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000002407F3414E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000002407F3432E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000002407F2BF2E0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
> File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002407FABE7D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024004...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000002407FBB9610>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002407FABE7D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\applications.py", line 289, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024004...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024004...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000002400421E750>
          └ <fastapi.applications.FastAPI object at 0x000002407FBB9610>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000024004CE4040>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000024004C51290>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000002400421E750>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000024004CE4360>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x0000024004CFBAD0>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000024004C51290>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
          │    │   │      │    │      └ <traceback object at 0x0000024004D59B00>
          │    │   │      │    └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
          │    │   │      └ <class 'OSError'>
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object get_db at 0x0000024004D60C70>
          └ <contextlib._AsyncGeneratorContextManager object at 0x0000024004C350D0>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\db\connection.py", line 26, in get_db
    yield session
          └ <sqlalchemy.orm.session.AsyncSession object at 0x0000024004D51090>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000024004CE4360>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x000002407FBAC750>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x0000024004CFBAD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000024004CE4360>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x00000240031534C0>
          └ APIRoute(path='/auth/jwt/login', name='auth:jwt.login', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000024004CE4360>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000024...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000024004CE6F20>
          └ APIRoute(path='/auth/jwt/login', name='auth:jwt.login', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x0000024004D51B50>
                     └ <function get_request_handler.<locals>.app at 0x0000024004CE7060>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 273, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x0000024003151940>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 190, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'credentials': <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x0000024004D50250>, 'user_manager': <auth.manag...
                 │         └ <function get_auth_router.<locals>.login at 0x0000024004CE54E0>
                 └ <fastapi.dependencies.models.Dependant object at 0x0000024004D15410>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\router\auth.py", line 57, in login
    user = await user_manager.authenticate(credentials)
                 │            │            └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x0000024004D50250>
                 │            └ <function BaseUserManager.authenticate at 0x0000024003F16AC0>
                 └ <auth.manager.UserManager object at 0x0000024004D51010>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\manager.py", line 645, in authenticate
    user = await self.get_by_email(credentials.username)
                 │    │            │           └ 'admin'
                 │    │            └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x0000024004D50250>
                 │    └ <function BaseUserManager.get_by_email at 0x0000024003F15DA0>
                 └ <auth.manager.UserManager object at 0x0000024004D51010>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\manager.py", line 87, in get_by_email
    user = await self.user_db.get_by_email(user_email)
                 │    │       │            └ 'admin'
                 │    │       └ <function SQLAlchemyUserDatabase.get_by_email at 0x000002400406F420>
                 │    └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x0000024004D52C90>
                 └ <auth.manager.UserManager object at 0x0000024004D51010>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users_db_sqlalchemy\__init__.py", line 127, in get_by_email
    return await self._get_user(statement)
                 │    │         └ <sqlalchemy.sql.selectable.Select object at 0x0000024004C78650>
                 │    └ <function SQLAlchemyUserDatabase._get_user at 0x000002400406F880>
                 └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x0000024004D52C90>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users_db_sqlalchemy\__init__.py", line 186, in _get_user
    results = await self.session.execute(statement)
                    │    │       │       └ <sqlalchemy.sql.selectable.Select object at 0x0000024004C78650>
                    │    │       └ <function AsyncSession.execute at 0x0000024003B17B00>
                    │    └ <sqlalchemy.orm.session.AsyncSession object at 0x0000024004D51090>
                    └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x0000024004D52C90>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 439, in execute
    result = await greenlet_spawn(
                   └ <function greenlet_spawn at 0x00000240032E6020>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             │       │      │   └ <built-in function exc_info>
             │       │      └ <module 'sys' (built-in)>
             │       └ <method 'throw' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x0000024004D52880 (otid=0x00000240032B1260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2246, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x0000024003A5C900>
           └ <sqlalchemy.orm.session.Session object at 0x0000024004D50910>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2131, in _execute_internal
    conn = self._connection_for_bind(bind)
           │    │                    └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │    └ <function Session._connection_for_bind at 0x0000024003A5C680>
           └ <sqlalchemy.orm.session.Session object at 0x0000024004D50910>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1998, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           │     │                    │       └ None
           │     │                    └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │     └ <function SessionTransaction._connection_for_bind at 0x0000024003A57060>
           └ <sqlalchemy.orm.session.SessionTransaction object at 0x00000240041B4550>
  File "<string>", line 2, in _connection_for_bind
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ (Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it), None)
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x00000240041B4550>
                └ <function SessionTransaction._connection_for_bind at 0x0000024003A56FC0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1123, in _connection_for_bind
    conn = bind.connect()
           │    └ <function Engine.connect at 0x00000240036CCD60>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3264, in connect
    return self._connection_cls(self)
           │    │               └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │    └ <class 'sqlalchemy.engine.base.Connection'>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 145, in __init__
    self._dbapi_connection = engine.raw_connection()
    │                        │      └ <function Engine.raw_connection at 0x00000240036CCE00>
    │                        └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
    └ <sqlalchemy.engine.base.Connection object at 0x0000024004C4BB50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3288, in raw_connection
    return self.pool.connect()
           │    │    └ <function Pool.connect at 0x000002400338CA40>
           │    └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000024004C24B90>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 452, in connect
    return _ConnectionFairy._checkout(self)
           │                │         └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000024004C24B90>
           │                └ <classmethod(<function _ConnectionFairy._checkout at 0x000002400338EAC0>)>
           └ <class 'sqlalchemy.pool.base._ConnectionFairy'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1267, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            │                 │        └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000024004C24B90>
            │                 └ <classmethod(<function _ConnectionRecord.checkout at 0x000002400338D620>)>
            └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 716, in checkout
    rec = pool._do_get()
          │    └ <function QueuePool._do_get at 0x0000024003396200>
          └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000024004C24B90>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 169, in _do_get
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x0000024004D59580>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 167, in _do_get
    return self._create_connection()
           │    └ <function Pool._create_connection at 0x000002400338C7C0>
           └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000024004C24B90>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 393, in _create_connection
    return _ConnectionRecord(self)
           │                 └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000024004C24B90>
           └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 678, in __init__
    self.__connect()
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x0000024004D66190>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 902, in __connect
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x0000024004D59480>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 898, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
    │    │                               │    │               └ <sqlalchemy.pool.base._ConnectionRecord object at 0x0000024004D66190>
    │    │                               │    └ <function create_engine.<locals>.connect at 0x0000024004222F20>
    │    │                               └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000024004C24B90>
    │    └ <member 'dbapi_connection' of '_ConnectionRecord' objects>
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x0000024004D66190>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\create.py", line 637, in connect
    return dialect.connect(*cargs, **cparams)
           │       │        │        └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
           │       │        └ []
           │       └ <function DefaultDialect.connect at 0x000002400373FE20>
           └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x0000024004C07C50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 615, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)
           │    │            │        │        └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
           │    │            │        └ ()
           │    │            └ <function AsyncAdapt_asyncpg_dbapi.connect at 0x0000024004039760>
           │    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi object at 0x0000024004C07C90>
           └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x0000024004C07C50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 916, in connect
    await_only(creator_fn(*arg, **kw)),
    │          │           │      └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
    │          │           └ ()
    │          └ <function connect at 0x00000240042CE160>
    └ <function await_only at 0x00000240032C18A0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object connect at 0x0000024004D74EA0>
           └ <_AsyncIoGreenlet object at 0x0000024004D52880 (otid=0x00000240032B1260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object connect at 0x0000024004D74EA0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connection.py", line 2114, in connect
    return await connect_utils._connect(
                 │             └ <function _connect at 0x00000240042CDB20>
                 └ <module 'asyncpg.connect_utils' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 1011, in _connect
    raise last_error or exceptions.TargetServerAttributeNotMatched(
          │             │          └ <class 'asyncpg.exceptions._base.TargetServerAttributeNotMatched'>
          │             └ <module 'asyncpg.exceptions' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\s...
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 982, in _connect
    conn = await _connect_addr(
                 └ <function _connect_addr at 0x00000240042CD440>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 808, in _connect_addr
    return await __connect_addr(params, timeout, True, *args)
                 │              │       │               └ (('localhost', 5432), <_WindowsSelectorEventLoop running=True closed=False debug=False>, ConnectionConfiguration(command_time...
                 │              │       └ 60
                 │              └ ConnectionParameters(user='admin', password='<z5&+lLwlgB(]KV#', database='surf_it', ssl=<ssl.SSLContext object at 0x000002400...
                 └ <function __connect_addr at 0x00000240042CD4E0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 860, in __connect_addr
    tr, pr = await compat.wait_for(connector, timeout=timeout)
                   │      │        │                  └ 60
                   │      │        └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
                   │      └ <function wait_for at 0x0000024004223600>
                   └ <module 'asyncpg.compat' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site-...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\compat.py", line 60, in wait_for
    return await asyncio.wait_for(fut, timeout)
                 │       │        │    └ 60
                 │       │        └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
                 │       └ <function wait_for at 0x000002407F334180>
                 └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\tasks.py", line 479, in wait_for
    return fut.result()
           │   └ <method 'result' of '_asyncio.Task' objects>
           └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 719, in _create_ssl_connection
    tr, pr = await loop.create_connection(
                   │    └ <function BaseEventLoop.create_connection at 0x000002407F342480>
                   └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1081, in create_connection
    raise OSError('Multiple exceptions: {}'.format(

OSError: Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127.0.0.1', 5432)
INFO     2023-07-26 06:31:50.380 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 06:31:50.380 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 06:31:50.488 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 06:31:50.488 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 06:31:50.489 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 06:31:50.489 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 06:31:50.490 request id: app - logging:callHandlers - Finished server process [2240]
INFO     2023-07-26 06:31:50.491 request id: app - logging:callHandlers - Finished server process [2240]
INFO     2023-07-26 06:31:54.219 request id: app - logging:callHandlers - Started server process [26304]
INFO     2023-07-26 06:31:54.219 request id: app - logging:callHandlers - Started server process [26304]
INFO     2023-07-26 06:31:54.220 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 06:31:54.220 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 06:31:54.221 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 06:31:54.221 request id: app - logging:callHandlers - Application startup complete.
CRITICAL 2023-07-26 06:32:00.672 request id: None - db.connection:get_db - DataBase Error: Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127.0.0.1', 5432)
INFO     2023-07-26 06:32:00.673 request id: app - logging:callHandlers - 127.0.0.1:62320 - "POST /auth/jwt/login HTTP/1.1" 500
ERROR    2023-07-26 06:32:00.674 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 320
               │     └ 3
               └ <function _main at 0x000002394786F4C0>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 320
           │    └ <function BaseProcess._bootstrap at 0x00000239475A5080>
           └ <SpawnProcess name='SpawnProcess-1' parent=2284 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x00000239475A45E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=2284 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000002394760E610>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=2284 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=2284 started>
    │    └ <function subprocess_started at 0x0000023949888540>
    └ <SpawnProcess name='SpawnProcess-1' parent=2284 started>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=532, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x00000239499D3290>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=532, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x000002394986B740>
           │       │   └ <uvicorn.server.Server object at 0x00000239499D3290>
           │       └ <function run at 0x00000239492236A0>
           └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x00000239499E08C0>
           │      └ <function Runner.run at 0x0000023949223B00>
           └ <asyncio.runners.Runner object at 0x00000239499D3710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x0000023949221580>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x00000239499D3710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x00000239492214E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x00000239492232E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000002394918F2E0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
> File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002394CA57490>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002394D...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000023...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000023949AF9610>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002394CA57490>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\applications.py", line 289, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002394D...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000023...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002394D...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000023...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000002394D81AF90>
          └ <fastapi.applications.FastAPI object at 0x0000023949AF9610>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000002394D806520>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000023...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002394D82C710>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000002394D81AF90>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002394D806660>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000023...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x000002394D82C4D0>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002394D82C710>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 25, in __call__
    raise dependency_exception
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\db\connection.py", line 26, in get_db
    yield session
          └ <sqlalchemy.orm.session.AsyncSession object at 0x000002394D870250>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002394D806660>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000023...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x000002394D774190>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x000002394D82C4D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002394D806660>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000023...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x000002394BC134C0>
          └ APIRoute(path='/auth/jwt/login', name='auth:jwt.login', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002394D806660>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000023...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x000002394D806F20>
          └ APIRoute(path='/auth/jwt/login', name='auth:jwt.login', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x000002394D760F10>
                     └ <function get_request_handler.<locals>.app at 0x000002394D807060>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 273, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x000002394BC11940>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 190, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'credentials': <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x000002394D870050>, 'user_manager': <auth.manag...
                 │         └ <function get_auth_router.<locals>.login at 0x000002394D8054E0>
                 └ <fastapi.dependencies.models.Dependant object at 0x000002394D835450>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\router\auth.py", line 57, in login
    user = await user_manager.authenticate(credentials)
                 │            │            └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x000002394D870050>
                 │            └ <function BaseUserManager.authenticate at 0x000002394CA46AC0>
                 └ <auth.manager.UserManager object at 0x000002394D8729D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\manager.py", line 645, in authenticate
    user = await self.get_by_email(credentials.username)
                 │    │            │           └ 'admin'
                 │    │            └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x000002394D870050>
                 │    └ <function BaseUserManager.get_by_email at 0x000002394CA45DA0>
                 └ <auth.manager.UserManager object at 0x000002394D8729D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\manager.py", line 87, in get_by_email
    user = await self.user_db.get_by_email(user_email)
                 │    │       │            └ 'admin'
                 │    │       └ <function SQLAlchemyUserDatabase.get_by_email at 0x000002394CB8F420>
                 │    └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x000002394D870C10>
                 └ <auth.manager.UserManager object at 0x000002394D8729D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users_db_sqlalchemy\__init__.py", line 127, in get_by_email
    return await self._get_user(statement)
                 │    │         └ <sqlalchemy.sql.selectable.Select object at 0x000002394D757890>
                 │    └ <function SQLAlchemyUserDatabase._get_user at 0x000002394CB8F880>
                 └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x000002394D870C10>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users_db_sqlalchemy\__init__.py", line 186, in _get_user
    results = await self.session.execute(statement)
                    │    │       │       └ <sqlalchemy.sql.selectable.Select object at 0x000002394D757890>
                    │    │       └ <function AsyncSession.execute at 0x000002394C647B00>
                    │    └ <sqlalchemy.orm.session.AsyncSession object at 0x000002394D870250>
                    └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x000002394D870C10>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 439, in execute
    result = await greenlet_spawn(
                   └ <function greenlet_spawn at 0x000002394BE06020>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             │       │      │   └ <built-in function exc_info>
             │       │      └ <module 'sys' (built-in)>
             │       └ <method 'throw' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x000002394CD3AA40 (otid=0x000002394BD71260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2246, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x000002394C58C900>
           └ <sqlalchemy.orm.session.Session object at 0x000002394CF93CD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2131, in _execute_internal
    conn = self._connection_for_bind(bind)
           │    │                    └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │    └ <function Session._connection_for_bind at 0x000002394C58C680>
           └ <sqlalchemy.orm.session.Session object at 0x000002394CF93CD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1998, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           │     │                    │       └ None
           │     │                    └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │     └ <function SessionTransaction._connection_for_bind at 0x000002394C587060>
           └ <sqlalchemy.orm.session.SessionTransaction object at 0x000002394D8B1C70>
  File "<string>", line 2, in _connection_for_bind
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ (Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it), None)
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x000002394D8B1C70>
                └ <function SessionTransaction._connection_for_bind at 0x000002394C586FC0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1123, in _connection_for_bind
    conn = bind.connect()
           │    └ <function Engine.connect at 0x000002394C1FCD60>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3264, in connect
    return self._connection_cls(self)
           │    │               └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │    └ <class 'sqlalchemy.engine.base.Connection'>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 145, in __init__
    self._dbapi_connection = engine.raw_connection()
    │                        │      └ <function Engine.raw_connection at 0x000002394C1FCE00>
    │                        └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
    └ <sqlalchemy.engine.base.Connection object at 0x000002394CCE5990>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3288, in raw_connection
    return self.pool.connect()
           │    │    └ <function Pool.connect at 0x000002394BEACA40>
           │    └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002394D744290>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 452, in connect
    return _ConnectionFairy._checkout(self)
           │                │         └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002394D744290>
           │                └ <classmethod(<function _ConnectionFairy._checkout at 0x000002394BEAEAC0>)>
           └ <class 'sqlalchemy.pool.base._ConnectionFairy'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1267, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            │                 │        └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002394D744290>
            │                 └ <classmethod(<function _ConnectionRecord.checkout at 0x000002394BEAD620>)>
            └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 716, in checkout
    rec = pool._do_get()
          │    └ <function QueuePool._do_get at 0x000002394BEB6200>
          └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002394D744290>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 169, in _do_get
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x000002394D878180>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 167, in _do_get
    return self._create_connection()
           │    └ <function Pool._create_connection at 0x000002394BEAC7C0>
           └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002394D744290>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 393, in _create_connection
    return _ConnectionRecord(self)
           │                 └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002394D744290>
           └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 678, in __init__
    self.__connect()
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x000002394D886190>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 902, in __connect
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x000002394D878500>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 898, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
    │    │                               │    │               └ <sqlalchemy.pool.base._ConnectionRecord object at 0x000002394D886190>
    │    │                               │    └ <function create_engine.<locals>.connect at 0x000002394CD42E80>
    │    │                               └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002394D744290>
    │    └ <member 'dbapi_connection' of '_ConnectionRecord' objects>
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x000002394D886190>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\create.py", line 637, in connect
    return dialect.connect(*cargs, **cparams)
           │       │        │        └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
           │       │        └ []
           │       └ <function DefaultDialect.connect at 0x000002394C26FE20>
           └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x000002394D72B850>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 615, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)
           │    │            │        │        └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
           │    │            │        └ ()
           │    │            └ <function AsyncAdapt_asyncpg_dbapi.connect at 0x000002394CB59760>
           │    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi object at 0x000002394D72BA90>
           └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x000002394D72B850>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 916, in connect
    await_only(creator_fn(*arg, **kw)),
    │          │           │      └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
    │          │           └ ()
    │          └ <function connect at 0x000002394CDEE160>
    └ <function await_only at 0x000002394BD818A0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object connect at 0x000002394D894EA0>
           └ <_AsyncIoGreenlet object at 0x000002394CD3AA40 (otid=0x000002394BD71260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object connect at 0x000002394D894EA0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connection.py", line 2114, in connect
    return await connect_utils._connect(
                 │             └ <function _connect at 0x000002394CDEDB20>
                 └ <module 'asyncpg.connect_utils' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 1011, in _connect
    raise last_error or exceptions.TargetServerAttributeNotMatched(
          │             │          └ <class 'asyncpg.exceptions._base.TargetServerAttributeNotMatched'>
          │             └ <module 'asyncpg.exceptions' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\s...
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 982, in _connect
    conn = await _connect_addr(
                 └ <function _connect_addr at 0x000002394CDED440>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 808, in _connect_addr
    return await __connect_addr(params, timeout, True, *args)
                 │              │       │               └ (('localhost', 5432), <_WindowsSelectorEventLoop running=True closed=False debug=False>, ConnectionConfiguration(command_time...
                 │              │       └ 60
                 │              └ ConnectionParameters(user='admin', password='<z5&+lLwlgB(]KV#', database='surf_it', ssl=<ssl.SSLContext object at 0x000002394...
                 └ <function __connect_addr at 0x000002394CDED4E0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 860, in __connect_addr
    tr, pr = await compat.wait_for(connector, timeout=timeout)
                   │      │        │                  └ 60
                   │      │        └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
                   │      └ <function wait_for at 0x000002394CD43600>
                   └ <module 'asyncpg.compat' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site-...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\compat.py", line 60, in wait_for
    return await asyncio.wait_for(fut, timeout)
                 │       │        │    └ 60
                 │       │        └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
                 │       └ <function wait_for at 0x0000023949214180>
                 └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\tasks.py", line 479, in wait_for
    return fut.result()
           │   └ <method 'result' of '_asyncio.Task' objects>
           └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 719, in _create_ssl_connection
    tr, pr = await loop.create_connection(
                   │    └ <function BaseEventLoop.create_connection at 0x0000023949222480>
                   └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1081, in create_connection
    raise OSError('Multiple exceptions: {}'.format(

OSError: Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127.0.0.1', 5432)
ERROR    2023-07-26 06:32:00.719 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 320
               │     └ 3
               └ <function _main at 0x000002394786F4C0>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 320
           │    └ <function BaseProcess._bootstrap at 0x00000239475A5080>
           └ <SpawnProcess name='SpawnProcess-1' parent=2284 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x00000239475A45E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=2284 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000002394760E610>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=2284 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=2284 started>
    │    └ <function subprocess_started at 0x0000023949888540>
    └ <SpawnProcess name='SpawnProcess-1' parent=2284 started>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=532, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x00000239499D3290>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=532, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x000002394986B740>
           │       │   └ <uvicorn.server.Server object at 0x00000239499D3290>
           │       └ <function run at 0x00000239492236A0>
           └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x00000239499E08C0>
           │      └ <function Runner.run at 0x0000023949223B00>
           └ <asyncio.runners.Runner object at 0x00000239499D3710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x0000023949221580>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x00000239499D3710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x00000239492214E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x00000239492232E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000002394918F2E0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
> File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002394CA57490>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002394D...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000023...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000023949AF9610>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002394CA57490>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\applications.py", line 289, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002394D...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000023...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002394D...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000023...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000002394D81AF90>
          └ <fastapi.applications.FastAPI object at 0x0000023949AF9610>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000002394D806520>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000023...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002394D82C710>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000002394D81AF90>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002394D806660>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000023...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x000002394D82C4D0>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002394D82C710>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 25, in __call__
    raise dependency_exception
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\db\connection.py", line 26, in get_db
    yield session
          └ <sqlalchemy.orm.session.AsyncSession object at 0x000002394D870250>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002394D806660>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000023...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x000002394D774190>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x000002394D82C4D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002394D806660>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000023...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x000002394BC134C0>
          └ APIRoute(path='/auth/jwt/login', name='auth:jwt.login', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002394D806660>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000023...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x000002394D806F20>
          └ APIRoute(path='/auth/jwt/login', name='auth:jwt.login', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x000002394D760F10>
                     └ <function get_request_handler.<locals>.app at 0x000002394D807060>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 273, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x000002394BC11940>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 190, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'credentials': <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x000002394D870050>, 'user_manager': <auth.manag...
                 │         └ <function get_auth_router.<locals>.login at 0x000002394D8054E0>
                 └ <fastapi.dependencies.models.Dependant object at 0x000002394D835450>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\router\auth.py", line 57, in login
    user = await user_manager.authenticate(credentials)
                 │            │            └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x000002394D870050>
                 │            └ <function BaseUserManager.authenticate at 0x000002394CA46AC0>
                 └ <auth.manager.UserManager object at 0x000002394D8729D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\manager.py", line 645, in authenticate
    user = await self.get_by_email(credentials.username)
                 │    │            │           └ 'admin'
                 │    │            └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x000002394D870050>
                 │    └ <function BaseUserManager.get_by_email at 0x000002394CA45DA0>
                 └ <auth.manager.UserManager object at 0x000002394D8729D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\manager.py", line 87, in get_by_email
    user = await self.user_db.get_by_email(user_email)
                 │    │       │            └ 'admin'
                 │    │       └ <function SQLAlchemyUserDatabase.get_by_email at 0x000002394CB8F420>
                 │    └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x000002394D870C10>
                 └ <auth.manager.UserManager object at 0x000002394D8729D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users_db_sqlalchemy\__init__.py", line 127, in get_by_email
    return await self._get_user(statement)
                 │    │         └ <sqlalchemy.sql.selectable.Select object at 0x000002394D757890>
                 │    └ <function SQLAlchemyUserDatabase._get_user at 0x000002394CB8F880>
                 └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x000002394D870C10>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users_db_sqlalchemy\__init__.py", line 186, in _get_user
    results = await self.session.execute(statement)
                    │    │       │       └ <sqlalchemy.sql.selectable.Select object at 0x000002394D757890>
                    │    │       └ <function AsyncSession.execute at 0x000002394C647B00>
                    │    └ <sqlalchemy.orm.session.AsyncSession object at 0x000002394D870250>
                    └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x000002394D870C10>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 439, in execute
    result = await greenlet_spawn(
                   └ <function greenlet_spawn at 0x000002394BE06020>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             │       │      │   └ <built-in function exc_info>
             │       │      └ <module 'sys' (built-in)>
             │       └ <method 'throw' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x000002394CD3AA40 (otid=0x000002394BD71260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2246, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x000002394C58C900>
           └ <sqlalchemy.orm.session.Session object at 0x000002394CF93CD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2131, in _execute_internal
    conn = self._connection_for_bind(bind)
           │    │                    └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │    └ <function Session._connection_for_bind at 0x000002394C58C680>
           └ <sqlalchemy.orm.session.Session object at 0x000002394CF93CD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1998, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           │     │                    │       └ None
           │     │                    └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │     └ <function SessionTransaction._connection_for_bind at 0x000002394C587060>
           └ <sqlalchemy.orm.session.SessionTransaction object at 0x000002394D8B1C70>
  File "<string>", line 2, in _connection_for_bind
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ (Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it), None)
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x000002394D8B1C70>
                └ <function SessionTransaction._connection_for_bind at 0x000002394C586FC0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1123, in _connection_for_bind
    conn = bind.connect()
           │    └ <function Engine.connect at 0x000002394C1FCD60>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3264, in connect
    return self._connection_cls(self)
           │    │               └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │    └ <class 'sqlalchemy.engine.base.Connection'>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 145, in __init__
    self._dbapi_connection = engine.raw_connection()
    │                        │      └ <function Engine.raw_connection at 0x000002394C1FCE00>
    │                        └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
    └ <sqlalchemy.engine.base.Connection object at 0x000002394CCE5990>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3288, in raw_connection
    return self.pool.connect()
           │    │    └ <function Pool.connect at 0x000002394BEACA40>
           │    └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002394D744290>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 452, in connect
    return _ConnectionFairy._checkout(self)
           │                │         └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002394D744290>
           │                └ <classmethod(<function _ConnectionFairy._checkout at 0x000002394BEAEAC0>)>
           └ <class 'sqlalchemy.pool.base._ConnectionFairy'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1267, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            │                 │        └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002394D744290>
            │                 └ <classmethod(<function _ConnectionRecord.checkout at 0x000002394BEAD620>)>
            └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 716, in checkout
    rec = pool._do_get()
          │    └ <function QueuePool._do_get at 0x000002394BEB6200>
          └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002394D744290>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 169, in _do_get
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x000002394D878180>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 167, in _do_get
    return self._create_connection()
           │    └ <function Pool._create_connection at 0x000002394BEAC7C0>
           └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002394D744290>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 393, in _create_connection
    return _ConnectionRecord(self)
           │                 └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002394D744290>
           └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 678, in __init__
    self.__connect()
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x000002394D886190>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 902, in __connect
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x000002394D878500>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 898, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
    │    │                               │    │               └ <sqlalchemy.pool.base._ConnectionRecord object at 0x000002394D886190>
    │    │                               │    └ <function create_engine.<locals>.connect at 0x000002394CD42E80>
    │    │                               └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002394D744290>
    │    └ <member 'dbapi_connection' of '_ConnectionRecord' objects>
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x000002394D886190>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\create.py", line 637, in connect
    return dialect.connect(*cargs, **cparams)
           │       │        │        └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
           │       │        └ []
           │       └ <function DefaultDialect.connect at 0x000002394C26FE20>
           └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x000002394D72B850>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 615, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)
           │    │            │        │        └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
           │    │            │        └ ()
           │    │            └ <function AsyncAdapt_asyncpg_dbapi.connect at 0x000002394CB59760>
           │    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi object at 0x000002394D72BA90>
           └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x000002394D72B850>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 916, in connect
    await_only(creator_fn(*arg, **kw)),
    │          │           │      └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
    │          │           └ ()
    │          └ <function connect at 0x000002394CDEE160>
    └ <function await_only at 0x000002394BD818A0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object connect at 0x000002394D894EA0>
           └ <_AsyncIoGreenlet object at 0x000002394CD3AA40 (otid=0x000002394BD71260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object connect at 0x000002394D894EA0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connection.py", line 2114, in connect
    return await connect_utils._connect(
                 │             └ <function _connect at 0x000002394CDEDB20>
                 └ <module 'asyncpg.connect_utils' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 1011, in _connect
    raise last_error or exceptions.TargetServerAttributeNotMatched(
          │             │          └ <class 'asyncpg.exceptions._base.TargetServerAttributeNotMatched'>
          │             └ <module 'asyncpg.exceptions' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\s...
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 982, in _connect
    conn = await _connect_addr(
                 └ <function _connect_addr at 0x000002394CDED440>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 808, in _connect_addr
    return await __connect_addr(params, timeout, True, *args)
                 │              │       │               └ (('localhost', 5432), <_WindowsSelectorEventLoop running=True closed=False debug=False>, ConnectionConfiguration(command_time...
                 │              │       └ 60
                 │              └ ConnectionParameters(user='admin', password='<z5&+lLwlgB(]KV#', database='surf_it', ssl=<ssl.SSLContext object at 0x000002394...
                 └ <function __connect_addr at 0x000002394CDED4E0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 860, in __connect_addr
    tr, pr = await compat.wait_for(connector, timeout=timeout)
                   │      │        │                  └ 60
                   │      │        └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
                   │      └ <function wait_for at 0x000002394CD43600>
                   └ <module 'asyncpg.compat' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site-...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\compat.py", line 60, in wait_for
    return await asyncio.wait_for(fut, timeout)
                 │       │        │    └ 60
                 │       │        └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
                 │       └ <function wait_for at 0x0000023949214180>
                 └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\tasks.py", line 479, in wait_for
    return fut.result()
           │   └ <method 'result' of '_asyncio.Task' objects>
           └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 719, in _create_ssl_connection
    tr, pr = await loop.create_connection(
                   │    └ <function BaseEventLoop.create_connection at 0x0000023949222480>
                   └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1081, in create_connection
    raise OSError('Multiple exceptions: {}'.format(

OSError: Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127.0.0.1', 5432)
INFO     2023-07-26 06:32:40.376 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 06:32:40.377 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 06:32:40.486 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 06:32:40.486 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 06:32:40.487 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 06:32:40.487 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 06:32:40.487 request id: app - logging:callHandlers - Finished server process [26304]
INFO     2023-07-26 06:32:40.487 request id: app - logging:callHandlers - Finished server process [26304]
INFO     2023-07-26 06:32:44.180 request id: app - logging:callHandlers - Started server process [3160]
INFO     2023-07-26 06:32:44.181 request id: app - logging:callHandlers - Started server process [3160]
INFO     2023-07-26 06:32:44.182 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 06:32:44.183 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 06:32:44.184 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 06:32:44.184 request id: app - logging:callHandlers - Application startup complete.
CRITICAL 2023-07-26 06:32:48.535 request id: None - db.connection:get_db - DataBase Error: Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127.0.0.1', 5432)
INFO     2023-07-26 06:32:48.536 request id: app - logging:callHandlers - 127.0.0.1:62329 - "POST /auth/jwt/login HTTP/1.1" 500
ERROR    2023-07-26 06:32:48.536 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 348
               │     └ 3
               └ <function _main at 0x0000020391A0F4C0>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 348
           │    └ <function BaseProcess._bootstrap at 0x0000020391965080>
           └ <SpawnProcess name='SpawnProcess-1' parent=24500 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x00000203919645E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=24500 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x00000203919CE610>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=24500 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=24500 started>
    │    └ <function subprocess_started at 0x0000020393A08540>
    └ <SpawnProcess name='SpawnProcess-1' parent=24500 started>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=568, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000020393B53290>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=568, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x00000203939EB740>
           │       │   └ <uvicorn.server.Server object at 0x0000020393B53290>
           │       └ <function run at 0x00000203937A36A0>
           └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x0000020393B608C0>
           │      └ <function Runner.run at 0x00000203937A3B00>
           └ <asyncio.runners.Runner object at 0x0000020393B53710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x00000203937A1580>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x0000020393B53710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x00000203937A14E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x00000203937A32E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000002039330F2E0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
> File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000203971AF490>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020397...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000020393C79610>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000203971AF490>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\applications.py", line 289, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020397...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020397...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000020397906090>
          └ <fastapi.applications.FastAPI object at 0x0000020393C79610>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000020397985BC0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x00000203978EFD50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000020397906090>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000020397986520>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x00000203978EEBD0>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x00000203978EFD50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 25, in __call__
    raise dependency_exception
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\db\connection.py", line 26, in get_db
    yield session
          └ <sqlalchemy.orm.session.AsyncSession object at 0x00000203978E0F10>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000020397986520>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x0000020395E3C3D0>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x00000203978EEBD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000020397986520>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x0000020395D934C0>
          └ APIRoute(path='/auth/jwt/login', name='auth:jwt.login', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000020397986520>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000020397986F20>
          └ APIRoute(path='/auth/jwt/login', name='auth:jwt.login', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x000002039702BB90>
                     └ <function get_request_handler.<locals>.app at 0x0000020397987060>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 273, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x0000020395D91940>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 190, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'credentials': <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x0000020393B5FA50>, 'user_manager': <auth.manag...
                 │         └ <function get_auth_router.<locals>.login at 0x00000203979854E0>
                 └ <fastapi.dependencies.models.Dependant object at 0x00000203979B5210>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\router\auth.py", line 57, in login
    user = await user_manager.authenticate(credentials)
                 │            │            └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x0000020393B5FA50>
                 │            └ <function BaseUserManager.authenticate at 0x0000020396BC6AC0>
                 └ <auth.manager.UserManager object at 0x0000020393C2AA10>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\manager.py", line 645, in authenticate
    user = await self.get_by_email(credentials.username)
                 │    │            │           └ 'admin'
                 │    │            └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x0000020393B5FA50>
                 │    └ <function BaseUserManager.get_by_email at 0x0000020396BC5DA0>
                 └ <auth.manager.UserManager object at 0x0000020393C2AA10>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\manager.py", line 87, in get_by_email
    user = await self.user_db.get_by_email(user_email)
                 │    │       │            └ 'admin'
                 │    │       └ <function SQLAlchemyUserDatabase.get_by_email at 0x0000020396D0F420>
                 │    └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x00000203979F0D90>
                 └ <auth.manager.UserManager object at 0x0000020393C2AA10>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users_db_sqlalchemy\__init__.py", line 127, in get_by_email
    return await self._get_user(statement)
                 │    │         └ <sqlalchemy.sql.selectable.Select object at 0x0000020397900990>
                 │    └ <function SQLAlchemyUserDatabase._get_user at 0x0000020396D0F880>
                 └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x00000203979F0D90>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users_db_sqlalchemy\__init__.py", line 186, in _get_user
    results = await self.session.execute(statement)
                    │    │       │       └ <sqlalchemy.sql.selectable.Select object at 0x0000020397900990>
                    │    │       └ <function AsyncSession.execute at 0x00000203967C3B00>
                    │    └ <sqlalchemy.orm.session.AsyncSession object at 0x00000203978E0F10>
                    └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x00000203979F0D90>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 439, in execute
    result = await greenlet_spawn(
                   └ <function greenlet_spawn at 0x0000020395F86020>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             │       │      │   └ <built-in function exc_info>
             │       │      └ <module 'sys' (built-in)>
             │       └ <method 'throw' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x00000203978EC300 (otid=0x0000020395EF1260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2246, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x000002039670C900>
           └ <sqlalchemy.orm.session.Session object at 0x00000203979F1A50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2131, in _execute_internal
    conn = self._connection_for_bind(bind)
           │    │                    └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │    └ <function Session._connection_for_bind at 0x000002039670C680>
           └ <sqlalchemy.orm.session.Session object at 0x00000203979F1A50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1998, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           │     │                    │       └ None
           │     │                    └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │     └ <function SessionTransaction._connection_for_bind at 0x0000020396707060>
           └ <sqlalchemy.orm.session.SessionTransaction object at 0x000002039758C4B0>
  File "<string>", line 2, in _connection_for_bind
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ (Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it), None)
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x000002039758C4B0>
                └ <function SessionTransaction._connection_for_bind at 0x0000020396706FC0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1123, in _connection_for_bind
    conn = bind.connect()
           │    └ <function Engine.connect at 0x0000020396384D60>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3264, in connect
    return self._connection_cls(self)
           │    │               └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │    └ <class 'sqlalchemy.engine.base.Connection'>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 145, in __init__
    self._dbapi_connection = engine.raw_connection()
    │                        │      └ <function Engine.raw_connection at 0x0000020396384E00>
    │                        └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
    └ <sqlalchemy.engine.base.Connection object at 0x00000203978EEF10>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3288, in raw_connection
    return self.pool.connect()
           │    │    └ <function Pool.connect at 0x000002039602CA40>
           │    └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x00000203978C43D0>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 452, in connect
    return _ConnectionFairy._checkout(self)
           │                │         └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x00000203978C43D0>
           │                └ <classmethod(<function _ConnectionFairy._checkout at 0x000002039602EAC0>)>
           └ <class 'sqlalchemy.pool.base._ConnectionFairy'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1267, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            │                 │        └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x00000203978C43D0>
            │                 └ <classmethod(<function _ConnectionRecord.checkout at 0x000002039602D620>)>
            └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 716, in checkout
    rec = pool._do_get()
          │    └ <function QueuePool._do_get at 0x0000020396036200>
          └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x00000203978C43D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 169, in _do_get
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x0000020397A45540>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 167, in _do_get
    return self._create_connection()
           │    └ <function Pool._create_connection at 0x000002039602C7C0>
           └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x00000203978C43D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 393, in _create_connection
    return _ConnectionRecord(self)
           │                 └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x00000203978C43D0>
           └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 678, in __init__
    self.__connect()
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x00000203979FA200>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 902, in __connect
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x0000020397A454C0>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 898, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
    │    │                               │    │               └ <sqlalchemy.pool.base._ConnectionRecord object at 0x00000203979FA200>
    │    │                               │    └ <function create_engine.<locals>.connect at 0x0000020396EC2E80>
    │    │                               └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x00000203978C43D0>
    │    └ <member 'dbapi_connection' of '_ConnectionRecord' objects>
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x00000203979FA200>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\create.py", line 637, in connect
    return dialect.connect(*cargs, **cparams)
           │       │        │        └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
           │       │        └ []
           │       └ <function DefaultDialect.connect at 0x00000203963F7E20>
           └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x00000203978B3990>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 615, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)
           │    │            │        │        └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
           │    │            │        └ ()
           │    │            └ <function AsyncAdapt_asyncpg_dbapi.connect at 0x0000020396CD9760>
           │    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi object at 0x00000203978B34D0>
           └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x00000203978B3990>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 916, in connect
    await_only(creator_fn(*arg, **kw)),
    │          │           │      └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
    │          │           └ ()
    │          └ <function connect at 0x0000020396F6E160>
    └ <function await_only at 0x0000020395F018A0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object connect at 0x0000020397A14EA0>
           └ <_AsyncIoGreenlet object at 0x00000203978EC300 (otid=0x0000020395EF1260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object connect at 0x0000020397A14EA0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connection.py", line 2114, in connect
    return await connect_utils._connect(
                 │             └ <function _connect at 0x0000020396F6DB20>
                 └ <module 'asyncpg.connect_utils' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 1011, in _connect
    raise last_error or exceptions.TargetServerAttributeNotMatched(
          │             │          └ <class 'asyncpg.exceptions._base.TargetServerAttributeNotMatched'>
          │             └ <module 'asyncpg.exceptions' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\s...
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 982, in _connect
    conn = await _connect_addr(
                 └ <function _connect_addr at 0x0000020396F6D440>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 808, in _connect_addr
    return await __connect_addr(params, timeout, True, *args)
                 │              │       │               └ (('localhost', 5432), <_WindowsSelectorEventLoop running=True closed=False debug=False>, ConnectionConfiguration(command_time...
                 │              │       └ 60
                 │              └ ConnectionParameters(user='admin', password='<z5&+lLwlgB(]KV#', database='surf_it', ssl=<ssl.SSLContext object at 0x000002039...
                 └ <function __connect_addr at 0x0000020396F6D4E0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 860, in __connect_addr
    tr, pr = await compat.wait_for(connector, timeout=timeout)
                   │      │        │                  └ 60
                   │      │        └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
                   │      └ <function wait_for at 0x0000020396EC3600>
                   └ <module 'asyncpg.compat' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site-...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\compat.py", line 60, in wait_for
    return await asyncio.wait_for(fut, timeout)
                 │       │        │    └ 60
                 │       │        └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
                 │       └ <function wait_for at 0x0000020393794180>
                 └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\tasks.py", line 479, in wait_for
    return fut.result()
           │   └ <method 'result' of '_asyncio.Task' objects>
           └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 719, in _create_ssl_connection
    tr, pr = await loop.create_connection(
                   │    └ <function BaseEventLoop.create_connection at 0x00000203937A2480>
                   └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1081, in create_connection
    raise OSError('Multiple exceptions: {}'.format(

OSError: Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127.0.0.1', 5432)
ERROR    2023-07-26 06:32:48.587 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 348
               │     └ 3
               └ <function _main at 0x0000020391A0F4C0>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 348
           │    └ <function BaseProcess._bootstrap at 0x0000020391965080>
           └ <SpawnProcess name='SpawnProcess-1' parent=24500 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x00000203919645E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=24500 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x00000203919CE610>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=24500 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=24500 started>
    │    └ <function subprocess_started at 0x0000020393A08540>
    └ <SpawnProcess name='SpawnProcess-1' parent=24500 started>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=568, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000020393B53290>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=568, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x00000203939EB740>
           │       │   └ <uvicorn.server.Server object at 0x0000020393B53290>
           │       └ <function run at 0x00000203937A36A0>
           └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x0000020393B608C0>
           │      └ <function Runner.run at 0x00000203937A3B00>
           └ <asyncio.runners.Runner object at 0x0000020393B53710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x00000203937A1580>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x0000020393B53710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x00000203937A14E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x00000203937A32E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000002039330F2E0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
> File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000203971AF490>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020397...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000020393C79610>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000203971AF490>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\applications.py", line 289, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020397...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020397...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000020397906090>
          └ <fastapi.applications.FastAPI object at 0x0000020393C79610>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000020397985BC0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x00000203978EFD50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000020397906090>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000020397986520>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x00000203978EEBD0>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x00000203978EFD50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 25, in __call__
    raise dependency_exception
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\db\connection.py", line 26, in get_db
    yield session
          └ <sqlalchemy.orm.session.AsyncSession object at 0x00000203978E0F10>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000020397986520>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x0000020395E3C3D0>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x00000203978EEBD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000020397986520>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x0000020395D934C0>
          └ APIRoute(path='/auth/jwt/login', name='auth:jwt.login', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000020397986520>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000020397986F20>
          └ APIRoute(path='/auth/jwt/login', name='auth:jwt.login', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x000002039702BB90>
                     └ <function get_request_handler.<locals>.app at 0x0000020397987060>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 273, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x0000020395D91940>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 190, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'credentials': <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x0000020393B5FA50>, 'user_manager': <auth.manag...
                 │         └ <function get_auth_router.<locals>.login at 0x00000203979854E0>
                 └ <fastapi.dependencies.models.Dependant object at 0x00000203979B5210>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\router\auth.py", line 57, in login
    user = await user_manager.authenticate(credentials)
                 │            │            └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x0000020393B5FA50>
                 │            └ <function BaseUserManager.authenticate at 0x0000020396BC6AC0>
                 └ <auth.manager.UserManager object at 0x0000020393C2AA10>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\manager.py", line 645, in authenticate
    user = await self.get_by_email(credentials.username)
                 │    │            │           └ 'admin'
                 │    │            └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x0000020393B5FA50>
                 │    └ <function BaseUserManager.get_by_email at 0x0000020396BC5DA0>
                 └ <auth.manager.UserManager object at 0x0000020393C2AA10>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\manager.py", line 87, in get_by_email
    user = await self.user_db.get_by_email(user_email)
                 │    │       │            └ 'admin'
                 │    │       └ <function SQLAlchemyUserDatabase.get_by_email at 0x0000020396D0F420>
                 │    └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x00000203979F0D90>
                 └ <auth.manager.UserManager object at 0x0000020393C2AA10>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users_db_sqlalchemy\__init__.py", line 127, in get_by_email
    return await self._get_user(statement)
                 │    │         └ <sqlalchemy.sql.selectable.Select object at 0x0000020397900990>
                 │    └ <function SQLAlchemyUserDatabase._get_user at 0x0000020396D0F880>
                 └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x00000203979F0D90>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users_db_sqlalchemy\__init__.py", line 186, in _get_user
    results = await self.session.execute(statement)
                    │    │       │       └ <sqlalchemy.sql.selectable.Select object at 0x0000020397900990>
                    │    │       └ <function AsyncSession.execute at 0x00000203967C3B00>
                    │    └ <sqlalchemy.orm.session.AsyncSession object at 0x00000203978E0F10>
                    └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x00000203979F0D90>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 439, in execute
    result = await greenlet_spawn(
                   └ <function greenlet_spawn at 0x0000020395F86020>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             │       │      │   └ <built-in function exc_info>
             │       │      └ <module 'sys' (built-in)>
             │       └ <method 'throw' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x00000203978EC300 (otid=0x0000020395EF1260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2246, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x000002039670C900>
           └ <sqlalchemy.orm.session.Session object at 0x00000203979F1A50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2131, in _execute_internal
    conn = self._connection_for_bind(bind)
           │    │                    └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │    └ <function Session._connection_for_bind at 0x000002039670C680>
           └ <sqlalchemy.orm.session.Session object at 0x00000203979F1A50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1998, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           │     │                    │       └ None
           │     │                    └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │     └ <function SessionTransaction._connection_for_bind at 0x0000020396707060>
           └ <sqlalchemy.orm.session.SessionTransaction object at 0x000002039758C4B0>
  File "<string>", line 2, in _connection_for_bind
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ (Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it), None)
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x000002039758C4B0>
                └ <function SessionTransaction._connection_for_bind at 0x0000020396706FC0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1123, in _connection_for_bind
    conn = bind.connect()
           │    └ <function Engine.connect at 0x0000020396384D60>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3264, in connect
    return self._connection_cls(self)
           │    │               └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │    └ <class 'sqlalchemy.engine.base.Connection'>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 145, in __init__
    self._dbapi_connection = engine.raw_connection()
    │                        │      └ <function Engine.raw_connection at 0x0000020396384E00>
    │                        └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
    └ <sqlalchemy.engine.base.Connection object at 0x00000203978EEF10>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3288, in raw_connection
    return self.pool.connect()
           │    │    └ <function Pool.connect at 0x000002039602CA40>
           │    └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x00000203978C43D0>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 452, in connect
    return _ConnectionFairy._checkout(self)
           │                │         └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x00000203978C43D0>
           │                └ <classmethod(<function _ConnectionFairy._checkout at 0x000002039602EAC0>)>
           └ <class 'sqlalchemy.pool.base._ConnectionFairy'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1267, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            │                 │        └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x00000203978C43D0>
            │                 └ <classmethod(<function _ConnectionRecord.checkout at 0x000002039602D620>)>
            └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 716, in checkout
    rec = pool._do_get()
          │    └ <function QueuePool._do_get at 0x0000020396036200>
          └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x00000203978C43D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 169, in _do_get
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x0000020397A45540>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 167, in _do_get
    return self._create_connection()
           │    └ <function Pool._create_connection at 0x000002039602C7C0>
           └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x00000203978C43D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 393, in _create_connection
    return _ConnectionRecord(self)
           │                 └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x00000203978C43D0>
           └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 678, in __init__
    self.__connect()
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x00000203979FA200>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 902, in __connect
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x0000020397A454C0>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 898, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
    │    │                               │    │               └ <sqlalchemy.pool.base._ConnectionRecord object at 0x00000203979FA200>
    │    │                               │    └ <function create_engine.<locals>.connect at 0x0000020396EC2E80>
    │    │                               └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x00000203978C43D0>
    │    └ <member 'dbapi_connection' of '_ConnectionRecord' objects>
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x00000203979FA200>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\create.py", line 637, in connect
    return dialect.connect(*cargs, **cparams)
           │       │        │        └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
           │       │        └ []
           │       └ <function DefaultDialect.connect at 0x00000203963F7E20>
           └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x00000203978B3990>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 615, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)
           │    │            │        │        └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
           │    │            │        └ ()
           │    │            └ <function AsyncAdapt_asyncpg_dbapi.connect at 0x0000020396CD9760>
           │    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi object at 0x00000203978B34D0>
           └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x00000203978B3990>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 916, in connect
    await_only(creator_fn(*arg, **kw)),
    │          │           │      └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
    │          │           └ ()
    │          └ <function connect at 0x0000020396F6E160>
    └ <function await_only at 0x0000020395F018A0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object connect at 0x0000020397A14EA0>
           └ <_AsyncIoGreenlet object at 0x00000203978EC300 (otid=0x0000020395EF1260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object connect at 0x0000020397A14EA0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connection.py", line 2114, in connect
    return await connect_utils._connect(
                 │             └ <function _connect at 0x0000020396F6DB20>
                 └ <module 'asyncpg.connect_utils' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 1011, in _connect
    raise last_error or exceptions.TargetServerAttributeNotMatched(
          │             │          └ <class 'asyncpg.exceptions._base.TargetServerAttributeNotMatched'>
          │             └ <module 'asyncpg.exceptions' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\s...
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 982, in _connect
    conn = await _connect_addr(
                 └ <function _connect_addr at 0x0000020396F6D440>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 808, in _connect_addr
    return await __connect_addr(params, timeout, True, *args)
                 │              │       │               └ (('localhost', 5432), <_WindowsSelectorEventLoop running=True closed=False debug=False>, ConnectionConfiguration(command_time...
                 │              │       └ 60
                 │              └ ConnectionParameters(user='admin', password='<z5&+lLwlgB(]KV#', database='surf_it', ssl=<ssl.SSLContext object at 0x000002039...
                 └ <function __connect_addr at 0x0000020396F6D4E0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 860, in __connect_addr
    tr, pr = await compat.wait_for(connector, timeout=timeout)
                   │      │        │                  └ 60
                   │      │        └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
                   │      └ <function wait_for at 0x0000020396EC3600>
                   └ <module 'asyncpg.compat' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site-...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\compat.py", line 60, in wait_for
    return await asyncio.wait_for(fut, timeout)
                 │       │        │    └ 60
                 │       │        └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
                 │       └ <function wait_for at 0x0000020393794180>
                 └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\tasks.py", line 479, in wait_for
    return fut.result()
           │   └ <method 'result' of '_asyncio.Task' objects>
           └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 719, in _create_ssl_connection
    tr, pr = await loop.create_connection(
                   │    └ <function BaseEventLoop.create_connection at 0x00000203937A2480>
                   └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1081, in create_connection
    raise OSError('Multiple exceptions: {}'.format(

OSError: Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127.0.0.1', 5432)
CRITICAL 2023-07-26 06:33:32.371 request id: None - db.connection:get_db - DataBase Error: Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127.0.0.1', 5432)
INFO     2023-07-26 06:33:32.371 request id: app - logging:callHandlers - 127.0.0.1:62330 - "POST /auth/jwt/login HTTP/1.1" 500
ERROR    2023-07-26 06:33:32.372 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 348
               │     └ 3
               └ <function _main at 0x0000020391A0F4C0>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 348
           │    └ <function BaseProcess._bootstrap at 0x0000020391965080>
           └ <SpawnProcess name='SpawnProcess-1' parent=24500 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x00000203919645E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=24500 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x00000203919CE610>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=24500 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=24500 started>
    │    └ <function subprocess_started at 0x0000020393A08540>
    └ <SpawnProcess name='SpawnProcess-1' parent=24500 started>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=568, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000020393B53290>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=568, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x00000203939EB740>
           │       │   └ <uvicorn.server.Server object at 0x0000020393B53290>
           │       └ <function run at 0x00000203937A36A0>
           └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x0000020393B608C0>
           │      └ <function Runner.run at 0x00000203937A3B00>
           └ <asyncio.runners.Runner object at 0x0000020393B53710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x00000203937A1580>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x0000020393B53710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x00000203937A14E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x00000203937A32E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000002039330F2E0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
> File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000203971AF490>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020397...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000020393C79610>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000203971AF490>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\applications.py", line 289, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020397...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020397...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000020397906090>
          └ <fastapi.applications.FastAPI object at 0x0000020393C79610>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000020397A36C00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x00000203978EFD50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000020397906090>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000020398084A40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x00000203978EEBD0>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x00000203978EFD50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 25, in __call__
    raise dependency_exception
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\db\connection.py", line 26, in get_db
    yield session
          └ <sqlalchemy.orm.session.AsyncSession object at 0x00000203979998D0>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000020398084A40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x0000020395E3C3D0>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x00000203978EEBD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000020398084A40>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x0000020395D934C0>
          └ APIRoute(path='/auth/jwt/login', name='auth:jwt.login', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000020398084A40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000020397986F20>
          └ APIRoute(path='/auth/jwt/login', name='auth:jwt.login', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x0000020397A47710>
                     └ <function get_request_handler.<locals>.app at 0x0000020397987060>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 273, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x0000020395D91940>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 190, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'credentials': <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x0000020397980410>, 'user_manager': <auth.manag...
                 │         └ <function get_auth_router.<locals>.login at 0x00000203979854E0>
                 └ <fastapi.dependencies.models.Dependant object at 0x00000203979B5210>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\router\auth.py", line 57, in login
    user = await user_manager.authenticate(credentials)
                 │            │            └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x0000020397980410>
                 │            └ <function BaseUserManager.authenticate at 0x0000020396BC6AC0>
                 └ <auth.manager.UserManager object at 0x000002039813B490>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\manager.py", line 645, in authenticate
    user = await self.get_by_email(credentials.username)
                 │    │            │           └ 'admin'
                 │    │            └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x0000020397980410>
                 │    └ <function BaseUserManager.get_by_email at 0x0000020396BC5DA0>
                 └ <auth.manager.UserManager object at 0x000002039813B490>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\manager.py", line 87, in get_by_email
    user = await self.user_db.get_by_email(user_email)
                 │    │       │            └ 'admin'
                 │    │       └ <function SQLAlchemyUserDatabase.get_by_email at 0x0000020396D0F420>
                 │    └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x000002039813B690>
                 └ <auth.manager.UserManager object at 0x000002039813B490>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users_db_sqlalchemy\__init__.py", line 127, in get_by_email
    return await self._get_user(statement)
                 │    │         └ <sqlalchemy.sql.selectable.Select object at 0x0000020397A46210>
                 │    └ <function SQLAlchemyUserDatabase._get_user at 0x0000020396D0F880>
                 └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x000002039813B690>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users_db_sqlalchemy\__init__.py", line 186, in _get_user
    results = await self.session.execute(statement)
                    │    │       │       └ <sqlalchemy.sql.selectable.Select object at 0x0000020397A46210>
                    │    │       └ <function AsyncSession.execute at 0x00000203967C3B00>
                    │    └ <sqlalchemy.orm.session.AsyncSession object at 0x00000203979998D0>
                    └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x000002039813B690>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 439, in execute
    result = await greenlet_spawn(
                   └ <function greenlet_spawn at 0x0000020395F86020>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             │       │      │   └ <built-in function exc_info>
             │       │      └ <module 'sys' (built-in)>
             │       └ <method 'throw' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x0000020397A45E80 (otid=0x0000020395EF1260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2246, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x000002039670C900>
           └ <sqlalchemy.orm.session.Session object at 0x000002039799A510>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2131, in _execute_internal
    conn = self._connection_for_bind(bind)
           │    │                    └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │    └ <function Session._connection_for_bind at 0x000002039670C680>
           └ <sqlalchemy.orm.session.Session object at 0x000002039799A510>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1998, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           │     │                    │       └ None
           │     │                    └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │     └ <function SessionTransaction._connection_for_bind at 0x0000020396707060>
           └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000020397A1DE50>
  File "<string>", line 2, in _connection_for_bind
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ (Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it), None)
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000020397A1DE50>
                └ <function SessionTransaction._connection_for_bind at 0x0000020396706FC0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1123, in _connection_for_bind
    conn = bind.connect()
           │    └ <function Engine.connect at 0x0000020396384D60>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3264, in connect
    return self._connection_cls(self)
           │    │               └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │    └ <class 'sqlalchemy.engine.base.Connection'>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 145, in __init__
    self._dbapi_connection = engine.raw_connection()
    │                        │      └ <function Engine.raw_connection at 0x0000020396384E00>
    │                        └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
    └ <sqlalchemy.engine.base.Connection object at 0x00000203979F2A90>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3288, in raw_connection
    return self.pool.connect()
           │    │    └ <function Pool.connect at 0x000002039602CA40>
           │    └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x00000203978C43D0>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 452, in connect
    return _ConnectionFairy._checkout(self)
           │                │         └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x00000203978C43D0>
           │                └ <classmethod(<function _ConnectionFairy._checkout at 0x000002039602EAC0>)>
           └ <class 'sqlalchemy.pool.base._ConnectionFairy'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1267, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            │                 │        └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x00000203978C43D0>
            │                 └ <classmethod(<function _ConnectionRecord.checkout at 0x000002039602D620>)>
            └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 716, in checkout
    rec = pool._do_get()
          │    └ <function QueuePool._do_get at 0x0000020396036200>
          └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x00000203978C43D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 169, in _do_get
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x000002039813CB00>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 167, in _do_get
    return self._create_connection()
           │    └ <function Pool._create_connection at 0x000002039602C7C0>
           └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x00000203978C43D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 393, in _create_connection
    return _ConnectionRecord(self)
           │                 └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x00000203978C43D0>
           └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 678, in __init__
    self.__connect()
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x0000020398126CF0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 902, in __connect
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x000002039813C980>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 898, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
    │    │                               │    │               └ <sqlalchemy.pool.base._ConnectionRecord object at 0x0000020398126CF0>
    │    │                               │    └ <function create_engine.<locals>.connect at 0x0000020396EC2E80>
    │    │                               └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x00000203978C43D0>
    │    └ <member 'dbapi_connection' of '_ConnectionRecord' objects>
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x0000020398126CF0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\create.py", line 637, in connect
    return dialect.connect(*cargs, **cparams)
           │       │        │        └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
           │       │        └ []
           │       └ <function DefaultDialect.connect at 0x00000203963F7E20>
           └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x00000203978B3990>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 615, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)
           │    │            │        │        └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
           │    │            │        └ ()
           │    │            └ <function AsyncAdapt_asyncpg_dbapi.connect at 0x0000020396CD9760>
           │    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi object at 0x00000203978B34D0>
           └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x00000203978B3990>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 916, in connect
    await_only(creator_fn(*arg, **kw)),
    │          │           │      └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
    │          │           └ ()
    │          └ <function connect at 0x0000020396F6E160>
    └ <function await_only at 0x0000020395F018A0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object connect at 0x0000020397A152F0>
           └ <_AsyncIoGreenlet object at 0x0000020397A45E80 (otid=0x0000020395EF1260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object connect at 0x0000020397A152F0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connection.py", line 2114, in connect
    return await connect_utils._connect(
                 │             └ <function _connect at 0x0000020396F6DB20>
                 └ <module 'asyncpg.connect_utils' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 1011, in _connect
    raise last_error or exceptions.TargetServerAttributeNotMatched(
          │             │          └ <class 'asyncpg.exceptions._base.TargetServerAttributeNotMatched'>
          │             └ <module 'asyncpg.exceptions' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\s...
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 982, in _connect
    conn = await _connect_addr(
                 └ <function _connect_addr at 0x0000020396F6D440>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 808, in _connect_addr
    return await __connect_addr(params, timeout, True, *args)
                 │              │       │               └ (('localhost', 5432), <_WindowsSelectorEventLoop running=True closed=False debug=False>, ConnectionConfiguration(command_time...
                 │              │       └ 60
                 │              └ ConnectionParameters(user='admin', password='<z5&+lLwlgB(]KV#', database='surf_it', ssl=<ssl.SSLContext object at 0x000002039...
                 └ <function __connect_addr at 0x0000020396F6D4E0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 860, in __connect_addr
    tr, pr = await compat.wait_for(connector, timeout=timeout)
                   │      │        │                  └ 60
                   │      │        └ <Task finished name='Task-10' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания...
                   │      └ <function wait_for at 0x0000020396EC3600>
                   └ <module 'asyncpg.compat' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site-...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\compat.py", line 60, in wait_for
    return await asyncio.wait_for(fut, timeout)
                 │       │        │    └ 60
                 │       │        └ <Task finished name='Task-10' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания...
                 │       └ <function wait_for at 0x0000020393794180>
                 └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\tasks.py", line 479, in wait_for
    return fut.result()
           │   └ <method 'result' of '_asyncio.Task' objects>
           └ <Task finished name='Task-10' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 719, in _create_ssl_connection
    tr, pr = await loop.create_connection(
                   │    └ <function BaseEventLoop.create_connection at 0x00000203937A2480>
                   └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1081, in create_connection
    raise OSError('Multiple exceptions: {}'.format(

OSError: Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127.0.0.1', 5432)
ERROR    2023-07-26 06:33:32.396 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 348
               │     └ 3
               └ <function _main at 0x0000020391A0F4C0>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 348
           │    └ <function BaseProcess._bootstrap at 0x0000020391965080>
           └ <SpawnProcess name='SpawnProcess-1' parent=24500 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x00000203919645E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=24500 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x00000203919CE610>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=24500 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=24500 started>
    │    └ <function subprocess_started at 0x0000020393A08540>
    └ <SpawnProcess name='SpawnProcess-1' parent=24500 started>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=568, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000020393B53290>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=568, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x00000203939EB740>
           │       │   └ <uvicorn.server.Server object at 0x0000020393B53290>
           │       └ <function run at 0x00000203937A36A0>
           └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x0000020393B608C0>
           │      └ <function Runner.run at 0x00000203937A3B00>
           └ <asyncio.runners.Runner object at 0x0000020393B53710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x00000203937A1580>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x0000020393B53710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x00000203937A14E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x00000203937A32E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000002039330F2E0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
> File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000203971AF490>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020397...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000020393C79610>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000203971AF490>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\applications.py", line 289, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020397...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020397...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000020397906090>
          └ <fastapi.applications.FastAPI object at 0x0000020393C79610>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000020397A36C00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x00000203978EFD50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000020397906090>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000020398084A40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x00000203978EEBD0>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x00000203978EFD50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 25, in __call__
    raise dependency_exception
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\db\connection.py", line 26, in get_db
    yield session
          └ <sqlalchemy.orm.session.AsyncSession object at 0x00000203979998D0>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000020398084A40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x0000020395E3C3D0>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x00000203978EEBD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000020398084A40>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x0000020395D934C0>
          └ APIRoute(path='/auth/jwt/login', name='auth:jwt.login', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000020398084A40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000020...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000020397986F20>
          └ APIRoute(path='/auth/jwt/login', name='auth:jwt.login', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x0000020397A47710>
                     └ <function get_request_handler.<locals>.app at 0x0000020397987060>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 273, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x0000020395D91940>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 190, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'credentials': <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x0000020397980410>, 'user_manager': <auth.manag...
                 │         └ <function get_auth_router.<locals>.login at 0x00000203979854E0>
                 └ <fastapi.dependencies.models.Dependant object at 0x00000203979B5210>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\router\auth.py", line 57, in login
    user = await user_manager.authenticate(credentials)
                 │            │            └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x0000020397980410>
                 │            └ <function BaseUserManager.authenticate at 0x0000020396BC6AC0>
                 └ <auth.manager.UserManager object at 0x000002039813B490>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\manager.py", line 645, in authenticate
    user = await self.get_by_email(credentials.username)
                 │    │            │           └ 'admin'
                 │    │            └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x0000020397980410>
                 │    └ <function BaseUserManager.get_by_email at 0x0000020396BC5DA0>
                 └ <auth.manager.UserManager object at 0x000002039813B490>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\manager.py", line 87, in get_by_email
    user = await self.user_db.get_by_email(user_email)
                 │    │       │            └ 'admin'
                 │    │       └ <function SQLAlchemyUserDatabase.get_by_email at 0x0000020396D0F420>
                 │    └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x000002039813B690>
                 └ <auth.manager.UserManager object at 0x000002039813B490>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users_db_sqlalchemy\__init__.py", line 127, in get_by_email
    return await self._get_user(statement)
                 │    │         └ <sqlalchemy.sql.selectable.Select object at 0x0000020397A46210>
                 │    └ <function SQLAlchemyUserDatabase._get_user at 0x0000020396D0F880>
                 └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x000002039813B690>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users_db_sqlalchemy\__init__.py", line 186, in _get_user
    results = await self.session.execute(statement)
                    │    │       │       └ <sqlalchemy.sql.selectable.Select object at 0x0000020397A46210>
                    │    │       └ <function AsyncSession.execute at 0x00000203967C3B00>
                    │    └ <sqlalchemy.orm.session.AsyncSession object at 0x00000203979998D0>
                    └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x000002039813B690>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 439, in execute
    result = await greenlet_spawn(
                   └ <function greenlet_spawn at 0x0000020395F86020>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             │       │      │   └ <built-in function exc_info>
             │       │      └ <module 'sys' (built-in)>
             │       └ <method 'throw' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x0000020397A45E80 (otid=0x0000020395EF1260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2246, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x000002039670C900>
           └ <sqlalchemy.orm.session.Session object at 0x000002039799A510>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2131, in _execute_internal
    conn = self._connection_for_bind(bind)
           │    │                    └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │    └ <function Session._connection_for_bind at 0x000002039670C680>
           └ <sqlalchemy.orm.session.Session object at 0x000002039799A510>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1998, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           │     │                    │       └ None
           │     │                    └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │     └ <function SessionTransaction._connection_for_bind at 0x0000020396707060>
           └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000020397A1DE50>
  File "<string>", line 2, in _connection_for_bind
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ (Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it), None)
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000020397A1DE50>
                └ <function SessionTransaction._connection_for_bind at 0x0000020396706FC0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1123, in _connection_for_bind
    conn = bind.connect()
           │    └ <function Engine.connect at 0x0000020396384D60>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3264, in connect
    return self._connection_cls(self)
           │    │               └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │    └ <class 'sqlalchemy.engine.base.Connection'>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 145, in __init__
    self._dbapi_connection = engine.raw_connection()
    │                        │      └ <function Engine.raw_connection at 0x0000020396384E00>
    │                        └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
    └ <sqlalchemy.engine.base.Connection object at 0x00000203979F2A90>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3288, in raw_connection
    return self.pool.connect()
           │    │    └ <function Pool.connect at 0x000002039602CA40>
           │    └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x00000203978C43D0>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 452, in connect
    return _ConnectionFairy._checkout(self)
           │                │         └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x00000203978C43D0>
           │                └ <classmethod(<function _ConnectionFairy._checkout at 0x000002039602EAC0>)>
           └ <class 'sqlalchemy.pool.base._ConnectionFairy'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1267, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            │                 │        └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x00000203978C43D0>
            │                 └ <classmethod(<function _ConnectionRecord.checkout at 0x000002039602D620>)>
            └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 716, in checkout
    rec = pool._do_get()
          │    └ <function QueuePool._do_get at 0x0000020396036200>
          └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x00000203978C43D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 169, in _do_get
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x000002039813CB00>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 167, in _do_get
    return self._create_connection()
           │    └ <function Pool._create_connection at 0x000002039602C7C0>
           └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x00000203978C43D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 393, in _create_connection
    return _ConnectionRecord(self)
           │                 └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x00000203978C43D0>
           └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 678, in __init__
    self.__connect()
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x0000020398126CF0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 902, in __connect
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x000002039813C980>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 898, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
    │    │                               │    │               └ <sqlalchemy.pool.base._ConnectionRecord object at 0x0000020398126CF0>
    │    │                               │    └ <function create_engine.<locals>.connect at 0x0000020396EC2E80>
    │    │                               └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x00000203978C43D0>
    │    └ <member 'dbapi_connection' of '_ConnectionRecord' objects>
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x0000020398126CF0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\create.py", line 637, in connect
    return dialect.connect(*cargs, **cparams)
           │       │        │        └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
           │       │        └ []
           │       └ <function DefaultDialect.connect at 0x00000203963F7E20>
           └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x00000203978B3990>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 615, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)
           │    │            │        │        └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
           │    │            │        └ ()
           │    │            └ <function AsyncAdapt_asyncpg_dbapi.connect at 0x0000020396CD9760>
           │    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi object at 0x00000203978B34D0>
           └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x00000203978B3990>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 916, in connect
    await_only(creator_fn(*arg, **kw)),
    │          │           │      └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
    │          │           └ ()
    │          └ <function connect at 0x0000020396F6E160>
    └ <function await_only at 0x0000020395F018A0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object connect at 0x0000020397A152F0>
           └ <_AsyncIoGreenlet object at 0x0000020397A45E80 (otid=0x0000020395EF1260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object connect at 0x0000020397A152F0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connection.py", line 2114, in connect
    return await connect_utils._connect(
                 │             └ <function _connect at 0x0000020396F6DB20>
                 └ <module 'asyncpg.connect_utils' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 1011, in _connect
    raise last_error or exceptions.TargetServerAttributeNotMatched(
          │             │          └ <class 'asyncpg.exceptions._base.TargetServerAttributeNotMatched'>
          │             └ <module 'asyncpg.exceptions' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\s...
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 982, in _connect
    conn = await _connect_addr(
                 └ <function _connect_addr at 0x0000020396F6D440>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 808, in _connect_addr
    return await __connect_addr(params, timeout, True, *args)
                 │              │       │               └ (('localhost', 5432), <_WindowsSelectorEventLoop running=True closed=False debug=False>, ConnectionConfiguration(command_time...
                 │              │       └ 60
                 │              └ ConnectionParameters(user='admin', password='<z5&+lLwlgB(]KV#', database='surf_it', ssl=<ssl.SSLContext object at 0x000002039...
                 └ <function __connect_addr at 0x0000020396F6D4E0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 860, in __connect_addr
    tr, pr = await compat.wait_for(connector, timeout=timeout)
                   │      │        │                  └ 60
                   │      │        └ <Task finished name='Task-10' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания...
                   │      └ <function wait_for at 0x0000020396EC3600>
                   └ <module 'asyncpg.compat' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site-...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\compat.py", line 60, in wait_for
    return await asyncio.wait_for(fut, timeout)
                 │       │        │    └ 60
                 │       │        └ <Task finished name='Task-10' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания...
                 │       └ <function wait_for at 0x0000020393794180>
                 └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\tasks.py", line 479, in wait_for
    return fut.result()
           │   └ <method 'result' of '_asyncio.Task' objects>
           └ <Task finished name='Task-10' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 719, in _create_ssl_connection
    tr, pr = await loop.create_connection(
                   │    └ <function BaseEventLoop.create_connection at 0x00000203937A2480>
                   └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1081, in create_connection
    raise OSError('Multiple exceptions: {}'.format(

OSError: Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127.0.0.1', 5432)
INFO     2023-07-26 06:33:32.473 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 06:33:32.474 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 06:33:32.580 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 06:33:32.582 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 06:33:32.583 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 06:33:32.584 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 06:33:32.584 request id: app - logging:callHandlers - Finished server process [3160]
INFO     2023-07-26 06:33:32.585 request id: app - logging:callHandlers - Finished server process [3160]
INFO     2023-07-26 06:33:35.089 request id: app - logging:callHandlers - Started server process [20340]
INFO     2023-07-26 06:33:35.089 request id: app - logging:callHandlers - Started server process [20340]
INFO     2023-07-26 06:33:35.090 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 06:33:35.090 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 06:33:35.091 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 06:33:35.092 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 06:33:46.376 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 06:33:46.376 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 06:33:46.485 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 06:33:46.485 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 06:33:46.486 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 06:33:46.486 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 06:33:46.487 request id: app - logging:callHandlers - Finished server process [20340]
INFO     2023-07-26 06:33:46.487 request id: app - logging:callHandlers - Finished server process [20340]
INFO     2023-07-26 06:33:50.221 request id: app - logging:callHandlers - Started server process [24796]
INFO     2023-07-26 06:33:50.221 request id: app - logging:callHandlers - Started server process [24796]
INFO     2023-07-26 06:33:50.221 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 06:33:50.222 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 06:33:50.223 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 06:33:50.223 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 06:33:54.460 request id: app - logging:callHandlers - 127.0.0.1:62346 - "POST /auth/jwt/login HTTP/1.1" 500
ERROR    2023-07-26 06:33:54.461 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 336
               │     └ 3
               └ <function _main at 0x0000015A9A46F4C0>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 336
           │    └ <function BaseProcess._bootstrap at 0x0000015A9A3C5080>
           └ <SpawnProcess name='SpawnProcess-1' parent=16556 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000015A9A3C45E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=16556 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000015A9A42E610>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=16556 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=16556 started>
    │    └ <function subprocess_started at 0x0000015A9C458540>
    └ <SpawnProcess name='SpawnProcess-1' parent=16556 started>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=344, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000015A9C5A3290>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=344, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x0000015A9C43B740>
           │       │   └ <uvicorn.server.Server object at 0x0000015A9C5A3290>
           │       └ <function run at 0x0000015A9BDF36A0>
           └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x0000015A9C5B08C0>
           │      └ <function Runner.run at 0x0000015A9BDF3B00>
           └ <asyncio.runners.Runner object at 0x0000015A9C5A3710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x0000015A9BDF1580>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x0000015A9C5A3710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000015A9BDF14E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000015A9BDF32E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000015A9BD6F2E0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
> File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000015A9C5AE7D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000015AA0...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000015...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000015A9C6C9610>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000015A9C5AE7D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\applications.py", line 289, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000015AA0...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000015...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000015AA0...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000015...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000015AA0364F90>
          └ <fastapi.applications.FastAPI object at 0x0000015A9C6C9610>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000015AA03D4040>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000015...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000015AA041DCD0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000015AA0364F90>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000015AA03D63E0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000015...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x0000015AA043A610>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000015AA041DCD0>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
          │    │   │      │    │      └ <traceback object at 0x0000015AA0494E00>
          │    │   │      │    └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
          │    │   │      └ <class 'OSError'>
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object get_db at 0x0000015AA0445460>
          └ <contextlib._AsyncGeneratorContextManager object at 0x0000015A9C5AE650>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\db\connection.py", line 28, in get_db
    yield session
          └ <sqlalchemy.orm.session.AsyncSession object at 0x0000015A9F90EF90>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000015AA03D63E0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000015...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x0000015AA02FB290>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x0000015AA043A610>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000015AA03D63E0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000015...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x0000015A9E7E34C0>
          └ APIRoute(path='/auth/jwt/login', name='auth:jwt.login', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000015AA03D63E0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000015...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000015AA03D6F20>
          └ APIRoute(path='/auth/jwt/login', name='auth:jwt.login', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x0000015A9FFD6C50>
                     └ <function get_request_handler.<locals>.app at 0x0000015AA03D7060>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 273, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x0000015A9E7E1940>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 190, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'credentials': <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x0000015A9FDF48D0>, 'user_manager': <auth.manag...
                 │         └ <function get_auth_router.<locals>.login at 0x0000015AA03D54E0>
                 └ <fastapi.dependencies.models.Dependant object at 0x0000015AA0408B90>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\router\auth.py", line 57, in login
    user = await user_manager.authenticate(credentials)
                 │            │            └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x0000015A9FDF48D0>
                 │            └ <function BaseUserManager.authenticate at 0x0000015A9F616AC0>
                 └ <auth.manager.UserManager object at 0x0000015AA04403D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\manager.py", line 645, in authenticate
    user = await self.get_by_email(credentials.username)
                 │    │            │           └ 'admin'
                 │    │            └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x0000015A9FDF48D0>
                 │    └ <function BaseUserManager.get_by_email at 0x0000015A9F615DA0>
                 └ <auth.manager.UserManager object at 0x0000015AA04403D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\manager.py", line 87, in get_by_email
    user = await self.user_db.get_by_email(user_email)
                 │    │       │            └ 'admin'
                 │    │       └ <function SQLAlchemyUserDatabase.get_by_email at 0x0000015A9F75F420>
                 │    └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x0000015AA0443F90>
                 └ <auth.manager.UserManager object at 0x0000015AA04403D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users_db_sqlalchemy\__init__.py", line 127, in get_by_email
    return await self._get_user(statement)
                 │    │         └ <sqlalchemy.sql.selectable.Select object at 0x0000015A9F252A50>
                 │    └ <function SQLAlchemyUserDatabase._get_user at 0x0000015A9F75F880>
                 └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x0000015AA0443F90>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users_db_sqlalchemy\__init__.py", line 186, in _get_user
    results = await self.session.execute(statement)
                    │    │       │       └ <sqlalchemy.sql.selectable.Select object at 0x0000015A9F252A50>
                    │    │       └ <function AsyncSession.execute at 0x0000015A9F217B00>
                    │    └ <sqlalchemy.orm.session.AsyncSession object at 0x0000015A9F90EF90>
                    └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x0000015AA0443F90>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 439, in execute
    result = await greenlet_spawn(
                   └ <function greenlet_spawn at 0x0000015A9E9D6020>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             │       │      │   └ <built-in function exc_info>
             │       │      └ <module 'sys' (built-in)>
             │       └ <method 'throw' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x0000015AA034CE00 (otid=0x0000015A9E941260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2246, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x0000015A9F158900>
           └ <sqlalchemy.orm.session.Session object at 0x0000015A9F250490>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2131, in _execute_internal
    conn = self._connection_for_bind(bind)
           │    │                    └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │    └ <function Session._connection_for_bind at 0x0000015A9F158680>
           └ <sqlalchemy.orm.session.Session object at 0x0000015A9F250490>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1998, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           │     │                    │       └ None
           │     │                    └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │     └ <function SessionTransaction._connection_for_bind at 0x0000015A9F157060>
           └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000015AA047DC20>
  File "<string>", line 2, in _connection_for_bind
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ (Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it), None)
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000015AA047DC20>
                └ <function SessionTransaction._connection_for_bind at 0x0000015A9F156FC0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1123, in _connection_for_bind
    conn = bind.connect()
           │    └ <function Engine.connect at 0x0000015A9EDD4D60>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3264, in connect
    return self._connection_cls(self)
           │    │               └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │    └ <class 'sqlalchemy.engine.base.Connection'>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 145, in __init__
    self._dbapi_connection = engine.raw_connection()
    │                        │      └ <function Engine.raw_connection at 0x0000015A9EDD4E00>
    │                        └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
    └ <sqlalchemy.engine.base.Connection object at 0x0000015AA0442A90>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3288, in raw_connection
    return self.pool.connect()
           │    │    └ <function Pool.connect at 0x0000015A9EA7CA40>
           │    └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000015AA0310390>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 452, in connect
    return _ConnectionFairy._checkout(self)
           │                │         └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000015AA0310390>
           │                └ <classmethod(<function _ConnectionFairy._checkout at 0x0000015A9EA7EAC0>)>
           └ <class 'sqlalchemy.pool.base._ConnectionFairy'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1267, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            │                 │        └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000015AA0310390>
            │                 └ <classmethod(<function _ConnectionRecord.checkout at 0x0000015A9EA7D620>)>
            └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 716, in checkout
    rec = pool._do_get()
          │    └ <function QueuePool._do_get at 0x0000015A9EA86200>
          └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000015AA0310390>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 169, in _do_get
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x0000015AA0494840>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 167, in _do_get
    return self._create_connection()
           │    └ <function Pool._create_connection at 0x0000015A9EA7C7C0>
           └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000015AA0310390>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 393, in _create_connection
    return _ConnectionRecord(self)
           │                 └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000015AA0310390>
           └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 678, in __init__
    self.__connect()
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x0000015AA0452190>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 902, in __connect
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x0000015AA0494780>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 898, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
    │    │                               │    │               └ <sqlalchemy.pool.base._ConnectionRecord object at 0x0000015AA0452190>
    │    │                               │    └ <function create_engine.<locals>.connect at 0x0000015A9F912E80>
    │    │                               └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000015AA0310390>
    │    └ <member 'dbapi_connection' of '_ConnectionRecord' objects>
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x0000015AA0452190>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\create.py", line 637, in connect
    return dialect.connect(*cargs, **cparams)
           │       │        │        └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
           │       │        └ []
           │       └ <function DefaultDialect.connect at 0x0000015A9EE47E20>
           └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x0000015AA02FB950>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 615, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)
           │    │            │        │        └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
           │    │            │        └ ()
           │    │            └ <function AsyncAdapt_asyncpg_dbapi.connect at 0x0000015A9F729760>
           │    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi object at 0x0000015AA02FBB90>
           └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x0000015AA02FB950>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 916, in connect
    await_only(creator_fn(*arg, **kw)),
    │          │           │      └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
    │          │           └ ()
    │          └ <function connect at 0x0000015A9F9BE160>
    └ <function await_only at 0x0000015A9E9518A0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object connect at 0x0000015AA0464EA0>
           └ <_AsyncIoGreenlet object at 0x0000015AA034CE00 (otid=0x0000015A9E941260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object connect at 0x0000015AA0464EA0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connection.py", line 2114, in connect
    return await connect_utils._connect(
                 │             └ <function _connect at 0x0000015A9F9BDB20>
                 └ <module 'asyncpg.connect_utils' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 1011, in _connect
    raise last_error or exceptions.TargetServerAttributeNotMatched(
          │             │          └ <class 'asyncpg.exceptions._base.TargetServerAttributeNotMatched'>
          │             └ <module 'asyncpg.exceptions' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\s...
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 982, in _connect
    conn = await _connect_addr(
                 └ <function _connect_addr at 0x0000015A9F9BD440>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 808, in _connect_addr
    return await __connect_addr(params, timeout, True, *args)
                 │              │       │               └ (('localhost', 5432), <_WindowsSelectorEventLoop running=True closed=False debug=False>, ConnectionConfiguration(command_time...
                 │              │       └ 60
                 │              └ ConnectionParameters(user='admin', password='<z5&+lLwlgB(]KV#', database='surf_it', ssl=<ssl.SSLContext object at 0x0000015AA...
                 └ <function __connect_addr at 0x0000015A9F9BD4E0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 860, in __connect_addr
    tr, pr = await compat.wait_for(connector, timeout=timeout)
                   │      │        │                  └ 60
                   │      │        └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
                   │      └ <function wait_for at 0x0000015A9F913600>
                   └ <module 'asyncpg.compat' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site-...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\compat.py", line 60, in wait_for
    return await asyncio.wait_for(fut, timeout)
                 │       │        │    └ 60
                 │       │        └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
                 │       └ <function wait_for at 0x0000015A9BDE4180>
                 └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\tasks.py", line 479, in wait_for
    return fut.result()
           │   └ <method 'result' of '_asyncio.Task' objects>
           └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 719, in _create_ssl_connection
    tr, pr = await loop.create_connection(
                   │    └ <function BaseEventLoop.create_connection at 0x0000015A9BDF2480>
                   └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1081, in create_connection
    raise OSError('Multiple exceptions: {}'.format(

OSError: Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127.0.0.1', 5432)
ERROR    2023-07-26 06:33:54.501 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 336
               │     └ 3
               └ <function _main at 0x0000015A9A46F4C0>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 336
           │    └ <function BaseProcess._bootstrap at 0x0000015A9A3C5080>
           └ <SpawnProcess name='SpawnProcess-1' parent=16556 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000015A9A3C45E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=16556 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000015A9A42E610>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=16556 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=16556 started>
    │    └ <function subprocess_started at 0x0000015A9C458540>
    └ <SpawnProcess name='SpawnProcess-1' parent=16556 started>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=344, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000015A9C5A3290>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=344, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x0000015A9C43B740>
           │       │   └ <uvicorn.server.Server object at 0x0000015A9C5A3290>
           │       └ <function run at 0x0000015A9BDF36A0>
           └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x0000015A9C5B08C0>
           │      └ <function Runner.run at 0x0000015A9BDF3B00>
           └ <asyncio.runners.Runner object at 0x0000015A9C5A3710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x0000015A9BDF1580>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x0000015A9C5A3710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000015A9BDF14E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000015A9BDF32E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000015A9BD6F2E0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
> File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000015A9C5AE7D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000015AA0...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000015...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000015A9C6C9610>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000015A9C5AE7D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\applications.py", line 289, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000015AA0...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000015...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000015AA0...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000015...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000015AA0364F90>
          └ <fastapi.applications.FastAPI object at 0x0000015A9C6C9610>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000015AA03D4040>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000015...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000015AA041DCD0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000015AA0364F90>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000015AA03D63E0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000015...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x0000015AA043A610>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000015AA041DCD0>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
          │    │   │      │    │      └ <traceback object at 0x0000015AA0494E00>
          │    │   │      │    └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
          │    │   │      └ <class 'OSError'>
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object get_db at 0x0000015AA0445460>
          └ <contextlib._AsyncGeneratorContextManager object at 0x0000015A9C5AE650>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\db\connection.py", line 28, in get_db
    yield session
          └ <sqlalchemy.orm.session.AsyncSession object at 0x0000015A9F90EF90>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000015AA03D63E0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000015...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x0000015AA02FB290>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x0000015AA043A610>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000015AA03D63E0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000015...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x0000015A9E7E34C0>
          └ APIRoute(path='/auth/jwt/login', name='auth:jwt.login', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x0000015AA03D63E0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000015...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000015AA03D6F20>
          └ APIRoute(path='/auth/jwt/login', name='auth:jwt.login', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x0000015A9FFD6C50>
                     └ <function get_request_handler.<locals>.app at 0x0000015AA03D7060>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 273, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x0000015A9E7E1940>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 190, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'credentials': <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x0000015A9FDF48D0>, 'user_manager': <auth.manag...
                 │         └ <function get_auth_router.<locals>.login at 0x0000015AA03D54E0>
                 └ <fastapi.dependencies.models.Dependant object at 0x0000015AA0408B90>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\router\auth.py", line 57, in login
    user = await user_manager.authenticate(credentials)
                 │            │            └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x0000015A9FDF48D0>
                 │            └ <function BaseUserManager.authenticate at 0x0000015A9F616AC0>
                 └ <auth.manager.UserManager object at 0x0000015AA04403D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\manager.py", line 645, in authenticate
    user = await self.get_by_email(credentials.username)
                 │    │            │           └ 'admin'
                 │    │            └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x0000015A9FDF48D0>
                 │    └ <function BaseUserManager.get_by_email at 0x0000015A9F615DA0>
                 └ <auth.manager.UserManager object at 0x0000015AA04403D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\manager.py", line 87, in get_by_email
    user = await self.user_db.get_by_email(user_email)
                 │    │       │            └ 'admin'
                 │    │       └ <function SQLAlchemyUserDatabase.get_by_email at 0x0000015A9F75F420>
                 │    └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x0000015AA0443F90>
                 └ <auth.manager.UserManager object at 0x0000015AA04403D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users_db_sqlalchemy\__init__.py", line 127, in get_by_email
    return await self._get_user(statement)
                 │    │         └ <sqlalchemy.sql.selectable.Select object at 0x0000015A9F252A50>
                 │    └ <function SQLAlchemyUserDatabase._get_user at 0x0000015A9F75F880>
                 └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x0000015AA0443F90>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users_db_sqlalchemy\__init__.py", line 186, in _get_user
    results = await self.session.execute(statement)
                    │    │       │       └ <sqlalchemy.sql.selectable.Select object at 0x0000015A9F252A50>
                    │    │       └ <function AsyncSession.execute at 0x0000015A9F217B00>
                    │    └ <sqlalchemy.orm.session.AsyncSession object at 0x0000015A9F90EF90>
                    └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x0000015AA0443F90>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 439, in execute
    result = await greenlet_spawn(
                   └ <function greenlet_spawn at 0x0000015A9E9D6020>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             │       │      │   └ <built-in function exc_info>
             │       │      └ <module 'sys' (built-in)>
             │       └ <method 'throw' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x0000015AA034CE00 (otid=0x0000015A9E941260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2246, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x0000015A9F158900>
           └ <sqlalchemy.orm.session.Session object at 0x0000015A9F250490>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2131, in _execute_internal
    conn = self._connection_for_bind(bind)
           │    │                    └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │    └ <function Session._connection_for_bind at 0x0000015A9F158680>
           └ <sqlalchemy.orm.session.Session object at 0x0000015A9F250490>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1998, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           │     │                    │       └ None
           │     │                    └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │     └ <function SessionTransaction._connection_for_bind at 0x0000015A9F157060>
           └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000015AA047DC20>
  File "<string>", line 2, in _connection_for_bind
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ (Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it), None)
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x0000015AA047DC20>
                └ <function SessionTransaction._connection_for_bind at 0x0000015A9F156FC0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1123, in _connection_for_bind
    conn = bind.connect()
           │    └ <function Engine.connect at 0x0000015A9EDD4D60>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3264, in connect
    return self._connection_cls(self)
           │    │               └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │    └ <class 'sqlalchemy.engine.base.Connection'>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 145, in __init__
    self._dbapi_connection = engine.raw_connection()
    │                        │      └ <function Engine.raw_connection at 0x0000015A9EDD4E00>
    │                        └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
    └ <sqlalchemy.engine.base.Connection object at 0x0000015AA0442A90>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3288, in raw_connection
    return self.pool.connect()
           │    │    └ <function Pool.connect at 0x0000015A9EA7CA40>
           │    └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000015AA0310390>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 452, in connect
    return _ConnectionFairy._checkout(self)
           │                │         └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000015AA0310390>
           │                └ <classmethod(<function _ConnectionFairy._checkout at 0x0000015A9EA7EAC0>)>
           └ <class 'sqlalchemy.pool.base._ConnectionFairy'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1267, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            │                 │        └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000015AA0310390>
            │                 └ <classmethod(<function _ConnectionRecord.checkout at 0x0000015A9EA7D620>)>
            └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 716, in checkout
    rec = pool._do_get()
          │    └ <function QueuePool._do_get at 0x0000015A9EA86200>
          └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000015AA0310390>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 169, in _do_get
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x0000015AA0494840>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 167, in _do_get
    return self._create_connection()
           │    └ <function Pool._create_connection at 0x0000015A9EA7C7C0>
           └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000015AA0310390>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 393, in _create_connection
    return _ConnectionRecord(self)
           │                 └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000015AA0310390>
           └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 678, in __init__
    self.__connect()
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x0000015AA0452190>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 902, in __connect
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x0000015AA0494780>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 898, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
    │    │                               │    │               └ <sqlalchemy.pool.base._ConnectionRecord object at 0x0000015AA0452190>
    │    │                               │    └ <function create_engine.<locals>.connect at 0x0000015A9F912E80>
    │    │                               └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x0000015AA0310390>
    │    └ <member 'dbapi_connection' of '_ConnectionRecord' objects>
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x0000015AA0452190>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\create.py", line 637, in connect
    return dialect.connect(*cargs, **cparams)
           │       │        │        └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
           │       │        └ []
           │       └ <function DefaultDialect.connect at 0x0000015A9EE47E20>
           └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x0000015AA02FB950>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 615, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)
           │    │            │        │        └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
           │    │            │        └ ()
           │    │            └ <function AsyncAdapt_asyncpg_dbapi.connect at 0x0000015A9F729760>
           │    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi object at 0x0000015AA02FBB90>
           └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x0000015AA02FB950>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 916, in connect
    await_only(creator_fn(*arg, **kw)),
    │          │           │      └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
    │          │           └ ()
    │          └ <function connect at 0x0000015A9F9BE160>
    └ <function await_only at 0x0000015A9E9518A0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object connect at 0x0000015AA0464EA0>
           └ <_AsyncIoGreenlet object at 0x0000015AA034CE00 (otid=0x0000015A9E941260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object connect at 0x0000015AA0464EA0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connection.py", line 2114, in connect
    return await connect_utils._connect(
                 │             └ <function _connect at 0x0000015A9F9BDB20>
                 └ <module 'asyncpg.connect_utils' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 1011, in _connect
    raise last_error or exceptions.TargetServerAttributeNotMatched(
          │             │          └ <class 'asyncpg.exceptions._base.TargetServerAttributeNotMatched'>
          │             └ <module 'asyncpg.exceptions' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\s...
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 982, in _connect
    conn = await _connect_addr(
                 └ <function _connect_addr at 0x0000015A9F9BD440>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 808, in _connect_addr
    return await __connect_addr(params, timeout, True, *args)
                 │              │       │               └ (('localhost', 5432), <_WindowsSelectorEventLoop running=True closed=False debug=False>, ConnectionConfiguration(command_time...
                 │              │       └ 60
                 │              └ ConnectionParameters(user='admin', password='<z5&+lLwlgB(]KV#', database='surf_it', ssl=<ssl.SSLContext object at 0x0000015AA...
                 └ <function __connect_addr at 0x0000015A9F9BD4E0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 860, in __connect_addr
    tr, pr = await compat.wait_for(connector, timeout=timeout)
                   │      │        │                  └ 60
                   │      │        └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
                   │      └ <function wait_for at 0x0000015A9F913600>
                   └ <module 'asyncpg.compat' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site-...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\compat.py", line 60, in wait_for
    return await asyncio.wait_for(fut, timeout)
                 │       │        │    └ 60
                 │       │        └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
                 │       └ <function wait_for at 0x0000015A9BDE4180>
                 └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\tasks.py", line 479, in wait_for
    return fut.result()
           │   └ <method 'result' of '_asyncio.Task' objects>
           └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 719, in _create_ssl_connection
    tr, pr = await loop.create_connection(
                   │    └ <function BaseEventLoop.create_connection at 0x0000015A9BDF2480>
                   └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1081, in create_connection
    raise OSError('Multiple exceptions: {}'.format(

OSError: Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127.0.0.1', 5432)
INFO     2023-07-26 06:34:01.091 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 06:34:01.091 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 06:34:01.201 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 06:34:01.201 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 06:34:01.202 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 06:34:01.203 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 06:34:01.203 request id: app - logging:callHandlers - Finished server process [24796]
INFO     2023-07-26 06:34:01.204 request id: app - logging:callHandlers - Finished server process [24796]
INFO     2023-07-26 06:34:05.093 request id: app - logging:callHandlers - Started server process [24948]
INFO     2023-07-26 06:34:05.093 request id: app - logging:callHandlers - Started server process [24948]
INFO     2023-07-26 06:34:05.093 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 06:34:05.094 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 06:34:05.094 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 06:34:05.094 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 06:34:11.221 request id: app - logging:callHandlers - 127.0.0.1:62354 - "POST /auth/jwt/login HTTP/1.1" 500
ERROR    2023-07-26 06:34:11.221 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 188
               │     └ 3
               └ <function _main at 0x000002217422F4C0>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 188
           │    └ <function BaseProcess._bootstrap at 0x0000022174165080>
           └ <SpawnProcess name='SpawnProcess-1' parent=18028 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x00000221741645E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=18028 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x00000221741CE610>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=18028 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=18028 started>
    │    └ <function subprocess_started at 0x0000022176248540>
    └ <SpawnProcess name='SpawnProcess-1' parent=18028 started>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=824, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000022176393290>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=824, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x000002217622B740>
           │       │   └ <uvicorn.server.Server object at 0x0000022176393290>
           │       └ <function run at 0x0000022175FE36A0>
           └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x00000221763A08C0>
           │      └ <function Runner.run at 0x0000022175FE3B00>
           └ <asyncio.runners.Runner object at 0x0000022176393710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x0000022175FE1580>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x0000022176393710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000022175FE14E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000022175FE32E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000022175B4F2E0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
> File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002217639E7D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002217A...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000002217A11D150>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002217639E7D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\applications.py", line 289, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002217A...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002217A...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000002217A1DA9D0>
          └ <fastapi.applications.FastAPI object at 0x000002217A11D150>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000002217A1C5BC0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002217A1DA610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000002217A1DA9D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002217A1C63E0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x00000221799A2610>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002217A1DA610>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
          │    │   │      │    │      └ <traceback object at 0x000002217A285340>
          │    │   │      │    └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
          │    │   │      └ <class 'OSError'>
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object get_db at 0x000002217A235460>
          └ <contextlib._AsyncGeneratorContextManager object at 0x00000221796A5550>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\db\connection.py", line 28, in get_db
    yield session
          └ <sqlalchemy.orm.session.AsyncSession object at 0x000002217A232FD0>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002217A1C63E0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x000002217867CA90>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x00000221799A2610>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002217A1C63E0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x00000221785D34C0>
          └ APIRoute(path='/auth/jwt/login', name='auth:jwt.login', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002217A1C63E0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x000002217A1C6F20>
          └ APIRoute(path='/auth/jwt/login', name='auth:jwt.login', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x000002217A233910>
                     └ <function get_request_handler.<locals>.app at 0x000002217A1C7060>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 273, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x00000221785D1940>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 190, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'credentials': <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x000002217A1029D0>, 'user_manager': <auth.manag...
                 │         └ <function get_auth_router.<locals>.login at 0x000002217A1C54E0>
                 └ <fastapi.dependencies.models.Dependant object at 0x000002217A1F53D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\router\auth.py", line 57, in login
    user = await user_manager.authenticate(credentials)
                 │            │            └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x000002217A1029D0>
                 │            └ <function BaseUserManager.authenticate at 0x0000022179406AC0>
                 └ <auth.manager.UserManager object at 0x000002217A230C50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\manager.py", line 645, in authenticate
    user = await self.get_by_email(credentials.username)
                 │    │            │           └ 'admin'
                 │    │            └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x000002217A1029D0>
                 │    └ <function BaseUserManager.get_by_email at 0x0000022179405DA0>
                 └ <auth.manager.UserManager object at 0x000002217A230C50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\manager.py", line 87, in get_by_email
    user = await self.user_db.get_by_email(user_email)
                 │    │       │            └ 'admin'
                 │    │       └ <function SQLAlchemyUserDatabase.get_by_email at 0x000002217954F420>
                 │    └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x000002217A230490>
                 └ <auth.manager.UserManager object at 0x000002217A230C50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users_db_sqlalchemy\__init__.py", line 127, in get_by_email
    return await self._get_user(statement)
                 │    │         └ <sqlalchemy.sql.selectable.Select object at 0x000002217940AA50>
                 │    └ <function SQLAlchemyUserDatabase._get_user at 0x000002217954F880>
                 └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x000002217A230490>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users_db_sqlalchemy\__init__.py", line 186, in _get_user
    results = await self.session.execute(statement)
                    │    │       │       └ <sqlalchemy.sql.selectable.Select object at 0x000002217940AA50>
                    │    │       └ <function AsyncSession.execute at 0x0000022179007B00>
                    │    └ <sqlalchemy.orm.session.AsyncSession object at 0x000002217A232FD0>
                    └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x000002217A230490>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 439, in execute
    result = await greenlet_spawn(
                   └ <function greenlet_spawn at 0x00000221787C6020>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             │       │      │   └ <built-in function exc_info>
             │       │      └ <module 'sys' (built-in)>
             │       └ <method 'throw' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x000002217A102880 (otid=0x0000022178731260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2246, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x0000022178F48900>
           └ <sqlalchemy.orm.session.Session object at 0x000002217A233CD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2131, in _execute_internal
    conn = self._connection_for_bind(bind)
           │    │                    └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │    └ <function Session._connection_for_bind at 0x0000022178F48680>
           └ <sqlalchemy.orm.session.Session object at 0x000002217A233CD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1998, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           │     │                    │       └ None
           │     │                    └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │     └ <function SessionTransaction._connection_for_bind at 0x0000022178F47060>
           └ <sqlalchemy.orm.session.SessionTransaction object at 0x000002217A26DD10>
  File "<string>", line 2, in _connection_for_bind
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ (Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it), None)
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x000002217A26DD10>
                └ <function SessionTransaction._connection_for_bind at 0x0000022178F46FC0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1123, in _connection_for_bind
    conn = bind.connect()
           │    └ <function Engine.connect at 0x0000022178BC4D60>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3264, in connect
    return self._connection_cls(self)
           │    │               └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │    └ <class 'sqlalchemy.engine.base.Connection'>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 145, in __init__
    self._dbapi_connection = engine.raw_connection()
    │                        │      └ <function Engine.raw_connection at 0x0000022178BC4E00>
    │                        └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
    └ <sqlalchemy.engine.base.Connection object at 0x000002217A22AA90>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3288, in raw_connection
    return self.pool.connect()
           │    │    └ <function Pool.connect at 0x000002217886CA40>
           │    └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002217A100290>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 452, in connect
    return _ConnectionFairy._checkout(self)
           │                │         └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002217A100290>
           │                └ <classmethod(<function _ConnectionFairy._checkout at 0x000002217886EAC0>)>
           └ <class 'sqlalchemy.pool.base._ConnectionFairy'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1267, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            │                 │        └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002217A100290>
            │                 └ <classmethod(<function _ConnectionRecord.checkout at 0x000002217886D620>)>
            └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 716, in checkout
    rec = pool._do_get()
          │    └ <function QueuePool._do_get at 0x0000022178876200>
          └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002217A100290>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 169, in _do_get
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x000002217A284C80>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 167, in _do_get
    return self._create_connection()
           │    └ <function Pool._create_connection at 0x000002217886C7C0>
           └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002217A100290>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 393, in _create_connection
    return _ConnectionRecord(self)
           │                 └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002217A100290>
           └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 678, in __init__
    self.__connect()
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x000002217A246190>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 902, in __connect
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x000002217A284B40>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 898, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
    │    │                               │    │               └ <sqlalchemy.pool.base._ConnectionRecord object at 0x000002217A246190>
    │    │                               │    └ <function create_engine.<locals>.connect at 0x0000022179702E80>
    │    │                               └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002217A100290>
    │    └ <member 'dbapi_connection' of '_ConnectionRecord' objects>
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x000002217A246190>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\create.py", line 637, in connect
    return dialect.connect(*cargs, **cparams)
           │       │        │        └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
           │       │        └ []
           │       └ <function DefaultDialect.connect at 0x0000022178C37E20>
           └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x000002217A0EF850>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 615, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)
           │    │            │        │        └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
           │    │            │        └ ()
           │    │            └ <function AsyncAdapt_asyncpg_dbapi.connect at 0x0000022179519760>
           │    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi object at 0x0000022179898E90>
           └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x000002217A0EF850>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 916, in connect
    await_only(creator_fn(*arg, **kw)),
    │          │           │      └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
    │          │           └ ()
    │          └ <function connect at 0x00000221797AE160>
    └ <function await_only at 0x00000221787418A0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object connect at 0x000002217A254EA0>
           └ <_AsyncIoGreenlet object at 0x000002217A102880 (otid=0x0000022178731260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object connect at 0x000002217A254EA0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connection.py", line 2114, in connect
    return await connect_utils._connect(
                 │             └ <function _connect at 0x00000221797ADB20>
                 └ <module 'asyncpg.connect_utils' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 1011, in _connect
    raise last_error or exceptions.TargetServerAttributeNotMatched(
          │             │          └ <class 'asyncpg.exceptions._base.TargetServerAttributeNotMatched'>
          │             └ <module 'asyncpg.exceptions' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\s...
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 982, in _connect
    conn = await _connect_addr(
                 └ <function _connect_addr at 0x00000221797AD440>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 808, in _connect_addr
    return await __connect_addr(params, timeout, True, *args)
                 │              │       │               └ (('localhost', 5432), <_WindowsSelectorEventLoop running=True closed=False debug=False>, ConnectionConfiguration(command_time...
                 │              │       └ 60
                 │              └ ConnectionParameters(user='admin', password='<z5&+lLwlgB(]KV#', database='surf_it', ssl=<ssl.SSLContext object at 0x000002217...
                 └ <function __connect_addr at 0x00000221797AD4E0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 860, in __connect_addr
    tr, pr = await compat.wait_for(connector, timeout=timeout)
                   │      │        │                  └ 60
                   │      │        └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
                   │      └ <function wait_for at 0x0000022179703600>
                   └ <module 'asyncpg.compat' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site-...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\compat.py", line 60, in wait_for
    return await asyncio.wait_for(fut, timeout)
                 │       │        │    └ 60
                 │       │        └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
                 │       └ <function wait_for at 0x0000022175FD4180>
                 └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\tasks.py", line 479, in wait_for
    return fut.result()
           │   └ <method 'result' of '_asyncio.Task' objects>
           └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 719, in _create_ssl_connection
    tr, pr = await loop.create_connection(
                   │    └ <function BaseEventLoop.create_connection at 0x0000022175FE2480>
                   └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1081, in create_connection
    raise OSError('Multiple exceptions: {}'.format(

OSError: Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127.0.0.1', 5432)
ERROR    2023-07-26 06:34:11.269 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 188
               │     └ 3
               └ <function _main at 0x000002217422F4C0>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 188
           │    └ <function BaseProcess._bootstrap at 0x0000022174165080>
           └ <SpawnProcess name='SpawnProcess-1' parent=18028 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x00000221741645E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=18028 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x00000221741CE610>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=18028 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=18028 started>
    │    └ <function subprocess_started at 0x0000022176248540>
    └ <SpawnProcess name='SpawnProcess-1' parent=18028 started>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=824, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000022176393290>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=824, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x000002217622B740>
           │       │   └ <uvicorn.server.Server object at 0x0000022176393290>
           │       └ <function run at 0x0000022175FE36A0>
           └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x00000221763A08C0>
           │      └ <function Runner.run at 0x0000022175FE3B00>
           └ <asyncio.runners.Runner object at 0x0000022176393710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x0000022175FE1580>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x0000022176393710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000022175FE14E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000022175FE32E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000022175B4F2E0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
> File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002217639E7D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002217A...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000002217A11D150>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002217639E7D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\applications.py", line 289, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002217A...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002217A...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000002217A1DA9D0>
          └ <fastapi.applications.FastAPI object at 0x000002217A11D150>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000002217A1C5BC0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002217A1DA610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000002217A1DA9D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002217A1C63E0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x00000221799A2610>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002217A1DA610>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
          │    │   │      │    │      └ <traceback object at 0x000002217A285340>
          │    │   │      │    └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
          │    │   │      └ <class 'OSError'>
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object get_db at 0x000002217A235460>
          └ <contextlib._AsyncGeneratorContextManager object at 0x00000221796A5550>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\db\connection.py", line 28, in get_db
    yield session
          └ <sqlalchemy.orm.session.AsyncSession object at 0x000002217A232FD0>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002217A1C63E0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x000002217867CA90>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x00000221799A2610>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002217A1C63E0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x00000221785D34C0>
          └ APIRoute(path='/auth/jwt/login', name='auth:jwt.login', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002217A1C63E0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x000002217A1C6F20>
          └ APIRoute(path='/auth/jwt/login', name='auth:jwt.login', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x000002217A233910>
                     └ <function get_request_handler.<locals>.app at 0x000002217A1C7060>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 273, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x00000221785D1940>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 190, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'credentials': <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x000002217A1029D0>, 'user_manager': <auth.manag...
                 │         └ <function get_auth_router.<locals>.login at 0x000002217A1C54E0>
                 └ <fastapi.dependencies.models.Dependant object at 0x000002217A1F53D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\router\auth.py", line 57, in login
    user = await user_manager.authenticate(credentials)
                 │            │            └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x000002217A1029D0>
                 │            └ <function BaseUserManager.authenticate at 0x0000022179406AC0>
                 └ <auth.manager.UserManager object at 0x000002217A230C50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\manager.py", line 645, in authenticate
    user = await self.get_by_email(credentials.username)
                 │    │            │           └ 'admin'
                 │    │            └ <fastapi.security.oauth2.OAuth2PasswordRequestForm object at 0x000002217A1029D0>
                 │    └ <function BaseUserManager.get_by_email at 0x0000022179405DA0>
                 └ <auth.manager.UserManager object at 0x000002217A230C50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users\manager.py", line 87, in get_by_email
    user = await self.user_db.get_by_email(user_email)
                 │    │       │            └ 'admin'
                 │    │       └ <function SQLAlchemyUserDatabase.get_by_email at 0x000002217954F420>
                 │    └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x000002217A230490>
                 └ <auth.manager.UserManager object at 0x000002217A230C50>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users_db_sqlalchemy\__init__.py", line 127, in get_by_email
    return await self._get_user(statement)
                 │    │         └ <sqlalchemy.sql.selectable.Select object at 0x000002217940AA50>
                 │    └ <function SQLAlchemyUserDatabase._get_user at 0x000002217954F880>
                 └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x000002217A230490>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi_users_db_sqlalchemy\__init__.py", line 186, in _get_user
    results = await self.session.execute(statement)
                    │    │       │       └ <sqlalchemy.sql.selectable.Select object at 0x000002217940AA50>
                    │    │       └ <function AsyncSession.execute at 0x0000022179007B00>
                    │    └ <sqlalchemy.orm.session.AsyncSession object at 0x000002217A232FD0>
                    └ <fastapi_users_db_sqlalchemy.SQLAlchemyUserDatabase object at 0x000002217A230490>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 439, in execute
    result = await greenlet_spawn(
                   └ <function greenlet_spawn at 0x00000221787C6020>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             │       │      │   └ <built-in function exc_info>
             │       │      └ <module 'sys' (built-in)>
             │       └ <method 'throw' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x000002217A102880 (otid=0x0000022178731260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2246, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x0000022178F48900>
           └ <sqlalchemy.orm.session.Session object at 0x000002217A233CD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2131, in _execute_internal
    conn = self._connection_for_bind(bind)
           │    │                    └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │    └ <function Session._connection_for_bind at 0x0000022178F48680>
           └ <sqlalchemy.orm.session.Session object at 0x000002217A233CD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1998, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           │     │                    │       └ None
           │     │                    └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │     └ <function SessionTransaction._connection_for_bind at 0x0000022178F47060>
           └ <sqlalchemy.orm.session.SessionTransaction object at 0x000002217A26DD10>
  File "<string>", line 2, in _connection_for_bind
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ (Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it), None)
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x000002217A26DD10>
                └ <function SessionTransaction._connection_for_bind at 0x0000022178F46FC0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1123, in _connection_for_bind
    conn = bind.connect()
           │    └ <function Engine.connect at 0x0000022178BC4D60>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3264, in connect
    return self._connection_cls(self)
           │    │               └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
           │    └ <class 'sqlalchemy.engine.base.Connection'>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 145, in __init__
    self._dbapi_connection = engine.raw_connection()
    │                        │      └ <function Engine.raw_connection at 0x0000022178BC4E00>
    │                        └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
    └ <sqlalchemy.engine.base.Connection object at 0x000002217A22AA90>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3288, in raw_connection
    return self.pool.connect()
           │    │    └ <function Pool.connect at 0x000002217886CA40>
           │    └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002217A100290>
           └ Engine(postgresql+asyncpg://admin:***@localhost:5432/surf_it)
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 452, in connect
    return _ConnectionFairy._checkout(self)
           │                │         └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002217A100290>
           │                └ <classmethod(<function _ConnectionFairy._checkout at 0x000002217886EAC0>)>
           └ <class 'sqlalchemy.pool.base._ConnectionFairy'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1267, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            │                 │        └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002217A100290>
            │                 └ <classmethod(<function _ConnectionRecord.checkout at 0x000002217886D620>)>
            └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 716, in checkout
    rec = pool._do_get()
          │    └ <function QueuePool._do_get at 0x0000022178876200>
          └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002217A100290>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 169, in _do_get
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x000002217A284C80>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 167, in _do_get
    return self._create_connection()
           │    └ <function Pool._create_connection at 0x000002217886C7C0>
           └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002217A100290>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 393, in _create_connection
    return _ConnectionRecord(self)
           │                 └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002217A100290>
           └ <class 'sqlalchemy.pool.base._ConnectionRecord'>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 678, in __init__
    self.__connect()
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x000002217A246190>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 902, in __connect
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x000002217A284B40>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\pool\base.py", line 898, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
    │    │                               │    │               └ <sqlalchemy.pool.base._ConnectionRecord object at 0x000002217A246190>
    │    │                               │    └ <function create_engine.<locals>.connect at 0x0000022179702E80>
    │    │                               └ <sqlalchemy.pool.impl.AsyncAdaptedQueuePool object at 0x000002217A100290>
    │    └ <member 'dbapi_connection' of '_ConnectionRecord' objects>
    └ <sqlalchemy.pool.base._ConnectionRecord object at 0x000002217A246190>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\create.py", line 637, in connect
    return dialect.connect(*cargs, **cparams)
           │       │        │        └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
           │       │        └ []
           │       └ <function DefaultDialect.connect at 0x0000022178C37E20>
           └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x000002217A0EF850>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 615, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)
           │    │            │        │        └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
           │    │            │        └ ()
           │    │            └ <function AsyncAdapt_asyncpg_dbapi.connect at 0x0000022179519760>
           │    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi object at 0x0000022179898E90>
           └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x000002217A0EF850>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 916, in connect
    await_only(creator_fn(*arg, **kw)),
    │          │           │      └ {'host': 'localhost', 'database': 'surf_it', 'user': 'admin', 'password': '<z5&+lLwlgB(]KV#', 'port': 5432}
    │          │           └ ()
    │          └ <function connect at 0x00000221797AE160>
    └ <function await_only at 0x00000221787418A0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object connect at 0x000002217A254EA0>
           └ <_AsyncIoGreenlet object at 0x000002217A102880 (otid=0x0000022178731260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object connect at 0x000002217A254EA0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connection.py", line 2114, in connect
    return await connect_utils._connect(
                 │             └ <function _connect at 0x00000221797ADB20>
                 └ <module 'asyncpg.connect_utils' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 1011, in _connect
    raise last_error or exceptions.TargetServerAttributeNotMatched(
          │             │          └ <class 'asyncpg.exceptions._base.TargetServerAttributeNotMatched'>
          │             └ <module 'asyncpg.exceptions' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\s...
          └ OSError("Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127....
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 982, in _connect
    conn = await _connect_addr(
                 └ <function _connect_addr at 0x00000221797AD440>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 808, in _connect_addr
    return await __connect_addr(params, timeout, True, *args)
                 │              │       │               └ (('localhost', 5432), <_WindowsSelectorEventLoop running=True closed=False debug=False>, ConnectionConfiguration(command_time...
                 │              │       └ 60
                 │              └ ConnectionParameters(user='admin', password='<z5&+lLwlgB(]KV#', database='surf_it', ssl=<ssl.SSLContext object at 0x000002217...
                 └ <function __connect_addr at 0x00000221797AD4E0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 860, in __connect_addr
    tr, pr = await compat.wait_for(connector, timeout=timeout)
                   │      │        │                  └ 60
                   │      │        └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
                   │      └ <function wait_for at 0x0000022179703600>
                   └ <module 'asyncpg.compat' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\site-...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\compat.py", line 60, in wait_for
    return await asyncio.wait_for(fut, timeout)
                 │       │        │    └ 60
                 │       │        └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
                 │       └ <function wait_for at 0x0000022175FD4180>
                 └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\tasks.py", line 479, in wait_for
    return fut.result()
           │   └ <method 'result' of '_asyncio.Task' objects>
           └ <Task finished name='Task-5' coro=<_create_ssl_connection() done, defined at D:\Programming_projects\Python\Тестовые задания\...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\connect_utils.py", line 719, in _create_ssl_connection
    tr, pr = await loop.create_connection(
                   │    └ <function BaseEventLoop.create_connection at 0x0000022175FE2480>
                   └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1081, in create_connection
    raise OSError('Multiple exceptions: {}'.format(

OSError: Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127.0.0.1', 5432)
INFO     2023-07-26 06:37:01.656 request id: app - logging:callHandlers - 127.0.0.1:62378 - "POST /auth/jwt/login HTTP/1.1" 204
INFO     2023-07-26 06:37:50.915 request id: app - logging:callHandlers - 127.0.0.1:62443 - "POST /ad/create HTTP/1.1" 200
INFO     2023-07-26 06:38:04.960 request id: app - logging:callHandlers - 127.0.0.1:62448 - "POST /ad/list HTTP/1.1" 500
ERROR    2023-07-26 06:38:04.962 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "asyncpg\protocol\prepared_stmt.pyx", line 168, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
    codec.encode(self.settings, writer, arg)
  File "asyncpg\protocol\codecs/base.pyx", line 206, in asyncpg.protocol.protocol.Codec.encode
    return self.encoder(self, settings, buf, obj)
  File "asyncpg\protocol\codecs/base.pyx", line 111, in asyncpg.protocol.protocol.Codec.encode_scalar
    self.c_encoder(settings, buf, obj)
  File "asyncpg\pgproto\./codecs/datetime.pyx", line 152, in asyncpg.pgproto.pgproto.timestamp_encode
    delta = obj - pg_epoch_datetime
                  └ datetime.datetime(2000, 1, 1, 0, 0)

TypeError: can't subtract offset-naive and offset-aware datetimes


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 551, in _prepare_and_execute
    self._rows = await prepared_stmt.fetch(*parameters)
    │    │             │             │      └ (datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinfo=TzInfo(UTC)), datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinf...
    │    │             │             └ <function PreparedStatement.fetch at 0x00000221797AFF60>
    │    │             └ <asyncpg.prepared_stmt.PreparedStatement object at 0x000002217A39A070>
    │    └ <member '_rows' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A969D20>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
                 │                   │        └ None
                 │                   └ (datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinfo=TzInfo(UTC)), datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinf...
                 └ <asyncpg.prepared_stmt.PreparedStatement object at 0x000002217A39A070>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 241, in __bind_execute
    data, status, _ = await self.__do_execute(
                            └ <asyncpg.prepared_stmt.PreparedStatement object at 0x000002217A39A070>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 230, in __do_execute
    return await executor(protocol)
                 │        └ <asyncpg.protocol.protocol.Protocol object at 0x000002217A255750>
                 └ <function PreparedStatement.__bind_execute.<locals>.<lambda> at 0x0000022176385440>
  File "asyncpg\protocol\protocol.pyx", line 183, in bind_execute
    args_buf = state._encode_bind_msg(args)
  File "asyncpg\protocol\prepared_stmt.pyx", line 197, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
    raise exceptions.DataError(
          │          └ <class 'asyncpg.exceptions.DataError'>
          └ <module 'asyncpg.exceptions' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\s...

asyncpg.exceptions.DataError: invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,... (can't subtract offset-naive and offset-aware datetimes)


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1965, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000022178C50AE0>
    │    └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x000002217A0EF850>
    └ <sqlalchemy.engine.base.Connection object at 0x000002217A9A8FD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 921, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ (datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinfo=TzInfo(UTC)), datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinf...
    │      │       └ 'SELECT ad.id, ad.type_id, ad.title, ad.category_id, ad.content, ad.created_at, ad.is_published, ad.owner, ad.price \nFROM ad...
    │      └ <function AsyncAdapt_asyncpg_cursor.execute at 0x00000221795180E0>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A969D20>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 584, in execute
    self._adapt_connection.await_(
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A969D20>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x000002217A98C820>
           └ <_AsyncIoGreenlet object at 0x000002217A925040 (otid=0x0000022178731260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x000002217A98C820>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 563, in _prepare_and_execute
    self._handle_exception(error)
    │    └ <function AsyncAdapt_asyncpg_cursor._handle_exception at 0x0000022179513EC0>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A969D20>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 514, in _handle_exception
    self._adapt_connection._handle_exception(error)
    │    │                                   └ DataError("invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,... (can't subtract offset-naive and ...
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A969D20>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 801, in _handle_exception
    raise translated_error from error
          │                     └ DataError("invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,... (can't subtract offset-naive and ...
          └ Error("<class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,....

sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,... (can't subtract offset-naive and offset-aware datetimes)


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 188
               │     └ 3
               └ <function _main at 0x000002217422F4C0>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 188
           │    └ <function BaseProcess._bootstrap at 0x0000022174165080>
           └ <SpawnProcess name='SpawnProcess-1' parent=18028 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x00000221741645E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=18028 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x00000221741CE610>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=18028 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=18028 started>
    │    └ <function subprocess_started at 0x0000022176248540>
    └ <SpawnProcess name='SpawnProcess-1' parent=18028 started>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=824, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000022176393290>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=824, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x000002217622B740>
           │       │   └ <uvicorn.server.Server object at 0x0000022176393290>
           │       └ <function run at 0x0000022175FE36A0>
           └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x00000221763A08C0>
           │      └ <function Runner.run at 0x0000022175FE3B00>
           └ <asyncio.runners.Runner object at 0x0000022176393710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x0000022175FE1580>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x0000022176393710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000022175FE14E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000022175FE32E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000022175B4F2E0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
> File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002217639E7D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002217A...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000002217A11D150>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002217639E7D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\applications.py", line 289, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002217A...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002217A...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000002217A1DA9D0>
          └ <fastapi.applications.FastAPI object at 0x000002217A11D150>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000002217A870900>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002217A1DA610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000002217A1DA9D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002217A872700>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x00000221799A2610>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002217A1DA610>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
          │    │   │      │    │      └ <traceback object at 0x000002217A9AB540>
          │    │   │      │    └ DBAPIError("(sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query ar...
          │    │   │      └ <class 'sqlalchemy.exc.DBAPIError'>
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object get_db at 0x000002217A237E60>
          └ <contextlib._AsyncGeneratorContextManager object at 0x000002217A98A8D0>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\db\connection.py", line 28, in get_db
    yield session
          └ <sqlalchemy.orm.session.AsyncSession object at 0x000002217A98A750>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002217A872700>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x000002217867CA90>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x00000221799A2610>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002217A872700>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x00000221785D34C0>
          └ APIRoute(path='/ad/list', name='list_ads', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002217A872700>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x000002217A10BB00>
          └ APIRoute(path='/ad/list', name='list_ads', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x000002217A98B450>
                     └ <function get_request_handler.<locals>.app at 0x000002217938F100>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 273, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x00000221785D1940>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 190, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x000002217A98A750>, 'query': AdListQuery(page=1, per_page=10, categori...
                 │         └ <function list_ads at 0x000002217A108AE0>
                 └ <fastapi.dependencies.models.Dependant object at 0x000002217A1B49D0>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\routes.py", line 25, in list_ads
    return await services.list_ads(query, db)
                 │        │        │      └ <sqlalchemy.orm.session.AsyncSession object at 0x000002217A98A750>
                 │        │        └ AdListQuery(page=1, per_page=10, categories=[0], ad_type=0, sort='string', creation_time_interval=CreationTimeInterval(older_...
                 │        └ <function list_ads at 0x0000022179702520>
                 └ <module 'ad.services' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\ad\\services.py'>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\services.py", line 35, in list_ads
    ads = await queries.list_ads(filter_conditions, start, end, query.sort, db)
                │       │        │                  │      │    │     │     └ <sqlalchemy.orm.session.AsyncSession object at 0x000002217A98A750>
                │       │        │                  │      │    │     └ 'string'
                │       │        │                  │      │    └ AdListQuery(page=1, per_page=10, categories=[0], ad_type=0, sort='string', creation_time_interval=CreationTimeInterval(older_...
                │       │        │                  │      └ 10
                │       │        │                  └ 0
                │       │        └ [<sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x00000221796B0360>, <sqlalchemy.sql.elements.BinaryExpression ob...
                │       └ <function list_ads at 0x000002217968AFC0>
                └ <module 'ad.queries' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\ad\\queries.py'>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\queries.py", line 31, in list_ads
    result = await db.execute(ads.slice(start, end))
                   │  │       │   │     │      └ 10
                   │  │       │   │     └ 0
                   │  │       │   └ <function GenerativeSelect.slice at 0x0000022178B32980>
                   │  │       └ <sqlalchemy.sql.selectable.Select object at 0x000002217A232D10>
                   │  └ <function AsyncSession.execute at 0x0000022179007B00>
                   └ <sqlalchemy.orm.session.AsyncSession object at 0x000002217A98A750>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 439, in execute
    result = await greenlet_spawn(
                   └ <function greenlet_spawn at 0x00000221787C6020>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             │       │      │   └ <built-in function exc_info>
             │       │      └ <module 'sys' (built-in)>
             │       └ <method 'throw' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x000002217A925040 (otid=0x0000022178731260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2246, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x0000022178F48900>
           └ <sqlalchemy.orm.session.Session object at 0x000002217A98A850>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2141, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                   │      │                 └ <classmethod(<function AbstractORMCompileState.orm_execute_statement at 0x0000022178DF68E0>)>
                   │      └ <class 'sqlalchemy.orm.context.ORMSelectCompileState'>
                   └ typing.Any
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
             │    └ <function Connection.execute at 0x0000022178BC1D00>
             └ <sqlalchemy.engine.base.Connection object at 0x000002217A9A8FD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1412, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.selectable.Select object at 0x000002217A233B50>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x0000022178BC2020>
           └ <sqlalchemy.engine.base.Connection object at 0x000002217A9A8FD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x0000022178BC2200>
          └ <sqlalchemy.engine.base.Connection object at 0x000002217A9A8FD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1844, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x0000022178BC22A0>
           └ <sqlalchemy.engine.base.Connection object at 0x000002217A9A8FD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1984, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x0000022178BC2520>
    └ <sqlalchemy.engine.base.Connection object at 0x000002217A9A8FD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ Error("<class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,....
          │                    │              └ (<class 'sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error'>, Error("<class 'asyncpg.exceptions.DataError...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ DBAPIError("(sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query ar...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1965, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000022178C50AE0>
    │    └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x000002217A0EF850>
    └ <sqlalchemy.engine.base.Connection object at 0x000002217A9A8FD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 921, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ (datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinfo=TzInfo(UTC)), datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinf...
    │      │       └ 'SELECT ad.id, ad.type_id, ad.title, ad.category_id, ad.content, ad.created_at, ad.is_published, ad.owner, ad.price \nFROM ad...
    │      └ <function AsyncAdapt_asyncpg_cursor.execute at 0x00000221795180E0>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A969D20>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 584, in execute
    self._adapt_connection.await_(
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A969D20>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x000002217A98C820>
           └ <_AsyncIoGreenlet object at 0x000002217A925040 (otid=0x0000022178731260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x000002217A98C820>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 563, in _prepare_and_execute
    self._handle_exception(error)
    │    └ <function AsyncAdapt_asyncpg_cursor._handle_exception at 0x0000022179513EC0>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A969D20>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 514, in _handle_exception
    self._adapt_connection._handle_exception(error)
    │    │                                   └ DataError("invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,... (can't subtract offset-naive and ...
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A969D20>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 801, in _handle_exception
    raise translated_error from error
          │                     └ DataError("invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,... (can't subtract offset-naive and ...
          └ Error("<class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,....

sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,... (can't subtract offset-naive and offset-aware datetimes)
[SQL: SELECT ad.id, ad.type_id, ad.title, ad.category_id, ad.content, ad.created_at, ad.is_published, ad.owner, ad.price 
FROM ad 
WHERE ad.is_published AND ad.category_id IN ($4::INTEGER) AND ad.created_at >= $1::TIMESTAMP WITHOUT TIME ZONE AND ad.created_at <= $2::TIMESTAMP WITHOUT TIME ZONE 
 LIMIT $3::INTEGER]
[parameters: (datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinfo=TzInfo(UTC)), datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinfo=TzInfo(UTC)), 10, 0)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
ERROR    2023-07-26 06:38:05.042 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "asyncpg\protocol\prepared_stmt.pyx", line 168, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
    codec.encode(self.settings, writer, arg)
  File "asyncpg\protocol\codecs/base.pyx", line 206, in asyncpg.protocol.protocol.Codec.encode
    return self.encoder(self, settings, buf, obj)
  File "asyncpg\protocol\codecs/base.pyx", line 111, in asyncpg.protocol.protocol.Codec.encode_scalar
    self.c_encoder(settings, buf, obj)
  File "asyncpg\pgproto\./codecs/datetime.pyx", line 152, in asyncpg.pgproto.pgproto.timestamp_encode
    delta = obj - pg_epoch_datetime
                  └ datetime.datetime(2000, 1, 1, 0, 0)

TypeError: can't subtract offset-naive and offset-aware datetimes


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 551, in _prepare_and_execute
    self._rows = await prepared_stmt.fetch(*parameters)
    │    │             │             │      └ (datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinfo=TzInfo(UTC)), datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinf...
    │    │             │             └ <function PreparedStatement.fetch at 0x00000221797AFF60>
    │    │             └ <asyncpg.prepared_stmt.PreparedStatement object at 0x000002217A39A070>
    │    └ <member '_rows' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A969D20>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
                 │                   │        └ None
                 │                   └ (datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinfo=TzInfo(UTC)), datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinf...
                 └ <asyncpg.prepared_stmt.PreparedStatement object at 0x000002217A39A070>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 241, in __bind_execute
    data, status, _ = await self.__do_execute(
                            └ <asyncpg.prepared_stmt.PreparedStatement object at 0x000002217A39A070>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 230, in __do_execute
    return await executor(protocol)
                 │        └ <asyncpg.protocol.protocol.Protocol object at 0x000002217A255750>
                 └ <function PreparedStatement.__bind_execute.<locals>.<lambda> at 0x0000022176385440>
  File "asyncpg\protocol\protocol.pyx", line 183, in bind_execute
    args_buf = state._encode_bind_msg(args)
  File "asyncpg\protocol\prepared_stmt.pyx", line 197, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
    raise exceptions.DataError(
          │          └ <class 'asyncpg.exceptions.DataError'>
          └ <module 'asyncpg.exceptions' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\s...

asyncpg.exceptions.DataError: invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,... (can't subtract offset-naive and offset-aware datetimes)


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1965, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000022178C50AE0>
    │    └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x000002217A0EF850>
    └ <sqlalchemy.engine.base.Connection object at 0x000002217A9A8FD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 921, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ (datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinfo=TzInfo(UTC)), datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinf...
    │      │       └ 'SELECT ad.id, ad.type_id, ad.title, ad.category_id, ad.content, ad.created_at, ad.is_published, ad.owner, ad.price \nFROM ad...
    │      └ <function AsyncAdapt_asyncpg_cursor.execute at 0x00000221795180E0>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A969D20>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 584, in execute
    self._adapt_connection.await_(
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A969D20>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x000002217A98C820>
           └ <_AsyncIoGreenlet object at 0x000002217A925040 (otid=0x0000022178731260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x000002217A98C820>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 563, in _prepare_and_execute
    self._handle_exception(error)
    │    └ <function AsyncAdapt_asyncpg_cursor._handle_exception at 0x0000022179513EC0>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A969D20>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 514, in _handle_exception
    self._adapt_connection._handle_exception(error)
    │    │                                   └ DataError("invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,... (can't subtract offset-naive and ...
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A969D20>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 801, in _handle_exception
    raise translated_error from error
          │                     └ DataError("invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,... (can't subtract offset-naive and ...
          └ Error("<class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,....

sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,... (can't subtract offset-naive and offset-aware datetimes)


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 188
               │     └ 3
               └ <function _main at 0x000002217422F4C0>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 188
           │    └ <function BaseProcess._bootstrap at 0x0000022174165080>
           └ <SpawnProcess name='SpawnProcess-1' parent=18028 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x00000221741645E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=18028 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x00000221741CE610>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=18028 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=18028 started>
    │    └ <function subprocess_started at 0x0000022176248540>
    └ <SpawnProcess name='SpawnProcess-1' parent=18028 started>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=824, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000022176393290>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=824, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x000002217622B740>
           │       │   └ <uvicorn.server.Server object at 0x0000022176393290>
           │       └ <function run at 0x0000022175FE36A0>
           └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x00000221763A08C0>
           │      └ <function Runner.run at 0x0000022175FE3B00>
           └ <asyncio.runners.Runner object at 0x0000022176393710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x0000022175FE1580>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x0000022176393710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000022175FE14E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000022175FE32E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000022175B4F2E0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
> File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002217639E7D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002217A...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000002217A11D150>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002217639E7D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\applications.py", line 289, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002217A...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002217A...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000002217A1DA9D0>
          └ <fastapi.applications.FastAPI object at 0x000002217A11D150>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000002217A870900>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002217A1DA610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000002217A1DA9D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002217A872700>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x00000221799A2610>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002217A1DA610>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
          │    │   │      │    │      └ <traceback object at 0x000002217A9AB540>
          │    │   │      │    └ DBAPIError("(sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query ar...
          │    │   │      └ <class 'sqlalchemy.exc.DBAPIError'>
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object get_db at 0x000002217A237E60>
          └ <contextlib._AsyncGeneratorContextManager object at 0x000002217A98A8D0>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\db\connection.py", line 28, in get_db
    yield session
          └ <sqlalchemy.orm.session.AsyncSession object at 0x000002217A98A750>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002217A872700>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x000002217867CA90>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x00000221799A2610>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002217A872700>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x00000221785D34C0>
          └ APIRoute(path='/ad/list', name='list_ads', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002217A872700>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x000002217A10BB00>
          └ APIRoute(path='/ad/list', name='list_ads', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x000002217A98B450>
                     └ <function get_request_handler.<locals>.app at 0x000002217938F100>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 273, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x00000221785D1940>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 190, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x000002217A98A750>, 'query': AdListQuery(page=1, per_page=10, categori...
                 │         └ <function list_ads at 0x000002217A108AE0>
                 └ <fastapi.dependencies.models.Dependant object at 0x000002217A1B49D0>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\routes.py", line 25, in list_ads
    return await services.list_ads(query, db)
                 │        │        │      └ <sqlalchemy.orm.session.AsyncSession object at 0x000002217A98A750>
                 │        │        └ AdListQuery(page=1, per_page=10, categories=[0], ad_type=0, sort='string', creation_time_interval=CreationTimeInterval(older_...
                 │        └ <function list_ads at 0x0000022179702520>
                 └ <module 'ad.services' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\ad\\services.py'>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\services.py", line 35, in list_ads
    ads = await queries.list_ads(filter_conditions, start, end, query.sort, db)
                │       │        │                  │      │    │     │     └ <sqlalchemy.orm.session.AsyncSession object at 0x000002217A98A750>
                │       │        │                  │      │    │     └ 'string'
                │       │        │                  │      │    └ AdListQuery(page=1, per_page=10, categories=[0], ad_type=0, sort='string', creation_time_interval=CreationTimeInterval(older_...
                │       │        │                  │      └ 10
                │       │        │                  └ 0
                │       │        └ [<sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x00000221796B0360>, <sqlalchemy.sql.elements.BinaryExpression ob...
                │       └ <function list_ads at 0x000002217968AFC0>
                └ <module 'ad.queries' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\ad\\queries.py'>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\queries.py", line 31, in list_ads
    result = await db.execute(ads.slice(start, end))
                   │  │       │   │     │      └ 10
                   │  │       │   │     └ 0
                   │  │       │   └ <function GenerativeSelect.slice at 0x0000022178B32980>
                   │  │       └ <sqlalchemy.sql.selectable.Select object at 0x000002217A232D10>
                   │  └ <function AsyncSession.execute at 0x0000022179007B00>
                   └ <sqlalchemy.orm.session.AsyncSession object at 0x000002217A98A750>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 439, in execute
    result = await greenlet_spawn(
                   └ <function greenlet_spawn at 0x00000221787C6020>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             │       │      │   └ <built-in function exc_info>
             │       │      └ <module 'sys' (built-in)>
             │       └ <method 'throw' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x000002217A925040 (otid=0x0000022178731260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2246, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x0000022178F48900>
           └ <sqlalchemy.orm.session.Session object at 0x000002217A98A850>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2141, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                   │      │                 └ <classmethod(<function AbstractORMCompileState.orm_execute_statement at 0x0000022178DF68E0>)>
                   │      └ <class 'sqlalchemy.orm.context.ORMSelectCompileState'>
                   └ typing.Any
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
             │    └ <function Connection.execute at 0x0000022178BC1D00>
             └ <sqlalchemy.engine.base.Connection object at 0x000002217A9A8FD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1412, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.selectable.Select object at 0x000002217A233B50>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x0000022178BC2020>
           └ <sqlalchemy.engine.base.Connection object at 0x000002217A9A8FD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x0000022178BC2200>
          └ <sqlalchemy.engine.base.Connection object at 0x000002217A9A8FD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1844, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x0000022178BC22A0>
           └ <sqlalchemy.engine.base.Connection object at 0x000002217A9A8FD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1984, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x0000022178BC2520>
    └ <sqlalchemy.engine.base.Connection object at 0x000002217A9A8FD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ Error("<class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,....
          │                    │              └ (<class 'sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error'>, Error("<class 'asyncpg.exceptions.DataError...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ DBAPIError("(sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query ar...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1965, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000022178C50AE0>
    │    └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x000002217A0EF850>
    └ <sqlalchemy.engine.base.Connection object at 0x000002217A9A8FD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 921, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ (datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinfo=TzInfo(UTC)), datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinf...
    │      │       └ 'SELECT ad.id, ad.type_id, ad.title, ad.category_id, ad.content, ad.created_at, ad.is_published, ad.owner, ad.price \nFROM ad...
    │      └ <function AsyncAdapt_asyncpg_cursor.execute at 0x00000221795180E0>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A969D20>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 584, in execute
    self._adapt_connection.await_(
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A969D20>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x000002217A98C820>
           └ <_AsyncIoGreenlet object at 0x000002217A925040 (otid=0x0000022178731260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x000002217A98C820>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 563, in _prepare_and_execute
    self._handle_exception(error)
    │    └ <function AsyncAdapt_asyncpg_cursor._handle_exception at 0x0000022179513EC0>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A969D20>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 514, in _handle_exception
    self._adapt_connection._handle_exception(error)
    │    │                                   └ DataError("invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,... (can't subtract offset-naive and ...
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A969D20>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 801, in _handle_exception
    raise translated_error from error
          │                     └ DataError("invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,... (can't subtract offset-naive and ...
          └ Error("<class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,....

sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,... (can't subtract offset-naive and offset-aware datetimes)
[SQL: SELECT ad.id, ad.type_id, ad.title, ad.category_id, ad.content, ad.created_at, ad.is_published, ad.owner, ad.price 
FROM ad 
WHERE ad.is_published AND ad.category_id IN ($4::INTEGER) AND ad.created_at >= $1::TIMESTAMP WITHOUT TIME ZONE AND ad.created_at <= $2::TIMESTAMP WITHOUT TIME ZONE 
 LIMIT $3::INTEGER]
[parameters: (datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinfo=TzInfo(UTC)), datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinfo=TzInfo(UTC)), 10, 0)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
INFO     2023-07-26 06:38:06.352 request id: app - logging:callHandlers - 127.0.0.1:62449 - "POST /ad/list HTTP/1.1" 500
ERROR    2023-07-26 06:38:06.353 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "asyncpg\protocol\prepared_stmt.pyx", line 168, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
    codec.encode(self.settings, writer, arg)
  File "asyncpg\protocol\codecs/base.pyx", line 206, in asyncpg.protocol.protocol.Codec.encode
    return self.encoder(self, settings, buf, obj)
  File "asyncpg\protocol\codecs/base.pyx", line 111, in asyncpg.protocol.protocol.Codec.encode_scalar
    self.c_encoder(settings, buf, obj)
  File "asyncpg\pgproto\./codecs/datetime.pyx", line 152, in asyncpg.pgproto.pgproto.timestamp_encode
    delta = obj - pg_epoch_datetime
                  └ datetime.datetime(2000, 1, 1, 0, 0)

TypeError: can't subtract offset-naive and offset-aware datetimes


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 551, in _prepare_and_execute
    self._rows = await prepared_stmt.fetch(*parameters)
    │    │             │             │      └ (datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinfo=TzInfo(UTC)), datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinf...
    │    │             │             └ <function PreparedStatement.fetch at 0x00000221797AFF60>
    │    │             └ <asyncpg.prepared_stmt.PreparedStatement object at 0x000002217A39A070>
    │    └ <member '_rows' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A96ACE0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
                 │                   │        └ None
                 │                   └ (datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinfo=TzInfo(UTC)), datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinf...
                 └ <asyncpg.prepared_stmt.PreparedStatement object at 0x000002217A39A070>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 241, in __bind_execute
    data, status, _ = await self.__do_execute(
                            └ <asyncpg.prepared_stmt.PreparedStatement object at 0x000002217A39A070>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 230, in __do_execute
    return await executor(protocol)
                 │        └ <asyncpg.protocol.protocol.Protocol object at 0x000002217A255750>
                 └ <function PreparedStatement.__bind_execute.<locals>.<lambda> at 0x000002217A9ACFE0>
  File "asyncpg\protocol\protocol.pyx", line 183, in bind_execute
    args_buf = state._encode_bind_msg(args)
  File "asyncpg\protocol\prepared_stmt.pyx", line 197, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
    raise exceptions.DataError(
          │          └ <class 'asyncpg.exceptions.DataError'>
          └ <module 'asyncpg.exceptions' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\s...

asyncpg.exceptions.DataError: invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,... (can't subtract offset-naive and offset-aware datetimes)


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1965, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000022178C50AE0>
    │    └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x000002217A0EF850>
    └ <sqlalchemy.engine.base.Connection object at 0x000002217AA9EFD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 921, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ (datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinfo=TzInfo(UTC)), datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinf...
    │      │       └ 'SELECT ad.id, ad.type_id, ad.title, ad.category_id, ad.content, ad.created_at, ad.is_published, ad.owner, ad.price \nFROM ad...
    │      └ <function AsyncAdapt_asyncpg_cursor.execute at 0x00000221795180E0>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A96ACE0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 584, in execute
    self._adapt_connection.await_(
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A96ACE0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x000002217A98D120>
           └ <_AsyncIoGreenlet object at 0x000002217AA9D080 (otid=0x0000022178731260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x000002217A98D120>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 563, in _prepare_and_execute
    self._handle_exception(error)
    │    └ <function AsyncAdapt_asyncpg_cursor._handle_exception at 0x0000022179513EC0>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A96ACE0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 514, in _handle_exception
    self._adapt_connection._handle_exception(error)
    │    │                                   └ DataError("invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,... (can't subtract offset-naive and ...
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A96ACE0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 801, in _handle_exception
    raise translated_error from error
          │                     └ DataError("invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,... (can't subtract offset-naive and ...
          └ Error("<class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,....

sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,... (can't subtract offset-naive and offset-aware datetimes)


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 188
               │     └ 3
               └ <function _main at 0x000002217422F4C0>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 188
           │    └ <function BaseProcess._bootstrap at 0x0000022174165080>
           └ <SpawnProcess name='SpawnProcess-1' parent=18028 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x00000221741645E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=18028 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x00000221741CE610>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=18028 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=18028 started>
    │    └ <function subprocess_started at 0x0000022176248540>
    └ <SpawnProcess name='SpawnProcess-1' parent=18028 started>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=824, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000022176393290>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=824, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x000002217622B740>
           │       │   └ <uvicorn.server.Server object at 0x0000022176393290>
           │       └ <function run at 0x0000022175FE36A0>
           └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x00000221763A08C0>
           │      └ <function Runner.run at 0x0000022175FE3B00>
           └ <asyncio.runners.Runner object at 0x0000022176393710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x0000022175FE1580>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x0000022176393710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000022175FE14E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000022175FE32E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000022175B4F2E0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
> File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002217639E7D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002217A...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000002217A11D150>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002217639E7D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\applications.py", line 289, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002217A...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002217A...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000002217A1DA9D0>
          └ <fastapi.applications.FastAPI object at 0x000002217A11D150>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000002217A870FE0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002217A1DA610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000002217A1DA9D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002217A9ACB80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x00000221799A2610>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002217A1DA610>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
          │    │   │      │    │      └ <traceback object at 0x000002217AAAC340>
          │    │   │      │    └ DBAPIError("(sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query ar...
          │    │   │      └ <class 'sqlalchemy.exc.DBAPIError'>
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object get_db at 0x000002217A9A2F80>
          └ <contextlib._AsyncGeneratorContextManager object at 0x000002217AA9D490>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\db\connection.py", line 28, in get_db
    yield session
          └ <sqlalchemy.orm.session.AsyncSession object at 0x000002217AA9E350>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002217A9ACB80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x000002217867CA90>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x00000221799A2610>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002217A9ACB80>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x00000221785D34C0>
          └ APIRoute(path='/ad/list', name='list_ads', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002217A9ACB80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x000002217A10BB00>
          └ APIRoute(path='/ad/list', name='list_ads', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x000002217AA9CED0>
                     └ <function get_request_handler.<locals>.app at 0x000002217938F100>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 273, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x00000221785D1940>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 190, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x000002217AA9E350>, 'query': AdListQuery(page=1, per_page=10, categori...
                 │         └ <function list_ads at 0x000002217A108AE0>
                 └ <fastapi.dependencies.models.Dependant object at 0x000002217A1B49D0>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\routes.py", line 25, in list_ads
    return await services.list_ads(query, db)
                 │        │        │      └ <sqlalchemy.orm.session.AsyncSession object at 0x000002217AA9E350>
                 │        │        └ AdListQuery(page=1, per_page=10, categories=[0], ad_type=0, sort='string', creation_time_interval=CreationTimeInterval(older_...
                 │        └ <function list_ads at 0x0000022179702520>
                 └ <module 'ad.services' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\ad\\services.py'>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\services.py", line 35, in list_ads
    ads = await queries.list_ads(filter_conditions, start, end, query.sort, db)
                │       │        │                  │      │    │     │     └ <sqlalchemy.orm.session.AsyncSession object at 0x000002217AA9E350>
                │       │        │                  │      │    │     └ 'string'
                │       │        │                  │      │    └ AdListQuery(page=1, per_page=10, categories=[0], ad_type=0, sort='string', creation_time_interval=CreationTimeInterval(older_...
                │       │        │                  │      └ 10
                │       │        │                  └ 0
                │       │        └ [<sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x00000221796B0360>, <sqlalchemy.sql.elements.BinaryExpression ob...
                │       └ <function list_ads at 0x000002217968AFC0>
                └ <module 'ad.queries' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\ad\\queries.py'>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\queries.py", line 31, in list_ads
    result = await db.execute(ads.slice(start, end))
                   │  │       │   │     │      └ 10
                   │  │       │   │     └ 0
                   │  │       │   └ <function GenerativeSelect.slice at 0x0000022178B32980>
                   │  │       └ <sqlalchemy.sql.selectable.Select object at 0x000002217A1307D0>
                   │  └ <function AsyncSession.execute at 0x0000022179007B00>
                   └ <sqlalchemy.orm.session.AsyncSession object at 0x000002217AA9E350>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 439, in execute
    result = await greenlet_spawn(
                   └ <function greenlet_spawn at 0x00000221787C6020>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             │       │      │   └ <built-in function exc_info>
             │       │      └ <module 'sys' (built-in)>
             │       └ <method 'throw' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x000002217AA9D080 (otid=0x0000022178731260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2246, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x0000022178F48900>
           └ <sqlalchemy.orm.session.Session object at 0x000002217AA9CFD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2141, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                   │      │                 └ <classmethod(<function AbstractORMCompileState.orm_execute_statement at 0x0000022178DF68E0>)>
                   │      └ <class 'sqlalchemy.orm.context.ORMSelectCompileState'>
                   └ typing.Any
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
             │    └ <function Connection.execute at 0x0000022178BC1D00>
             └ <sqlalchemy.engine.base.Connection object at 0x000002217AA9EFD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1412, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.selectable.Select object at 0x000002217AA9DF10>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x0000022178BC2020>
           └ <sqlalchemy.engine.base.Connection object at 0x000002217AA9EFD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x0000022178BC2200>
          └ <sqlalchemy.engine.base.Connection object at 0x000002217AA9EFD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1844, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x0000022178BC22A0>
           └ <sqlalchemy.engine.base.Connection object at 0x000002217AA9EFD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1984, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x0000022178BC2520>
    └ <sqlalchemy.engine.base.Connection object at 0x000002217AA9EFD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ Error("<class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,....
          │                    │              └ (<class 'sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error'>, Error("<class 'asyncpg.exceptions.DataError...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ DBAPIError("(sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query ar...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1965, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000022178C50AE0>
    │    └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x000002217A0EF850>
    └ <sqlalchemy.engine.base.Connection object at 0x000002217AA9EFD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 921, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ (datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinfo=TzInfo(UTC)), datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinf...
    │      │       └ 'SELECT ad.id, ad.type_id, ad.title, ad.category_id, ad.content, ad.created_at, ad.is_published, ad.owner, ad.price \nFROM ad...
    │      └ <function AsyncAdapt_asyncpg_cursor.execute at 0x00000221795180E0>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A96ACE0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 584, in execute
    self._adapt_connection.await_(
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A96ACE0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x000002217A98D120>
           └ <_AsyncIoGreenlet object at 0x000002217AA9D080 (otid=0x0000022178731260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x000002217A98D120>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 563, in _prepare_and_execute
    self._handle_exception(error)
    │    └ <function AsyncAdapt_asyncpg_cursor._handle_exception at 0x0000022179513EC0>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A96ACE0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 514, in _handle_exception
    self._adapt_connection._handle_exception(error)
    │    │                                   └ DataError("invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,... (can't subtract offset-naive and ...
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A96ACE0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 801, in _handle_exception
    raise translated_error from error
          │                     └ DataError("invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,... (can't subtract offset-naive and ...
          └ Error("<class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,....

sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,... (can't subtract offset-naive and offset-aware datetimes)
[SQL: SELECT ad.id, ad.type_id, ad.title, ad.category_id, ad.content, ad.created_at, ad.is_published, ad.owner, ad.price 
FROM ad 
WHERE ad.is_published AND ad.category_id IN ($4::INTEGER) AND ad.created_at >= $1::TIMESTAMP WITHOUT TIME ZONE AND ad.created_at <= $2::TIMESTAMP WITHOUT TIME ZONE 
 LIMIT $3::INTEGER]
[parameters: (datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinfo=TzInfo(UTC)), datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinfo=TzInfo(UTC)), 10, 0)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
ERROR    2023-07-26 06:38:06.385 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "asyncpg\protocol\prepared_stmt.pyx", line 168, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
    codec.encode(self.settings, writer, arg)
  File "asyncpg\protocol\codecs/base.pyx", line 206, in asyncpg.protocol.protocol.Codec.encode
    return self.encoder(self, settings, buf, obj)
  File "asyncpg\protocol\codecs/base.pyx", line 111, in asyncpg.protocol.protocol.Codec.encode_scalar
    self.c_encoder(settings, buf, obj)
  File "asyncpg\pgproto\./codecs/datetime.pyx", line 152, in asyncpg.pgproto.pgproto.timestamp_encode
    delta = obj - pg_epoch_datetime
                  └ datetime.datetime(2000, 1, 1, 0, 0)

TypeError: can't subtract offset-naive and offset-aware datetimes


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 551, in _prepare_and_execute
    self._rows = await prepared_stmt.fetch(*parameters)
    │    │             │             │      └ (datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinfo=TzInfo(UTC)), datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinf...
    │    │             │             └ <function PreparedStatement.fetch at 0x00000221797AFF60>
    │    │             └ <asyncpg.prepared_stmt.PreparedStatement object at 0x000002217A39A070>
    │    └ <member '_rows' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A96ACE0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
                 │                   │        └ None
                 │                   └ (datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinfo=TzInfo(UTC)), datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinf...
                 └ <asyncpg.prepared_stmt.PreparedStatement object at 0x000002217A39A070>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 241, in __bind_execute
    data, status, _ = await self.__do_execute(
                            └ <asyncpg.prepared_stmt.PreparedStatement object at 0x000002217A39A070>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 230, in __do_execute
    return await executor(protocol)
                 │        └ <asyncpg.protocol.protocol.Protocol object at 0x000002217A255750>
                 └ <function PreparedStatement.__bind_execute.<locals>.<lambda> at 0x000002217A9ACFE0>
  File "asyncpg\protocol\protocol.pyx", line 183, in bind_execute
    args_buf = state._encode_bind_msg(args)
  File "asyncpg\protocol\prepared_stmt.pyx", line 197, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
    raise exceptions.DataError(
          │          └ <class 'asyncpg.exceptions.DataError'>
          └ <module 'asyncpg.exceptions' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\s...

asyncpg.exceptions.DataError: invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,... (can't subtract offset-naive and offset-aware datetimes)


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1965, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000022178C50AE0>
    │    └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x000002217A0EF850>
    └ <sqlalchemy.engine.base.Connection object at 0x000002217AA9EFD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 921, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ (datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinfo=TzInfo(UTC)), datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinf...
    │      │       └ 'SELECT ad.id, ad.type_id, ad.title, ad.category_id, ad.content, ad.created_at, ad.is_published, ad.owner, ad.price \nFROM ad...
    │      └ <function AsyncAdapt_asyncpg_cursor.execute at 0x00000221795180E0>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A96ACE0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 584, in execute
    self._adapt_connection.await_(
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A96ACE0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x000002217A98D120>
           └ <_AsyncIoGreenlet object at 0x000002217AA9D080 (otid=0x0000022178731260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x000002217A98D120>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 563, in _prepare_and_execute
    self._handle_exception(error)
    │    └ <function AsyncAdapt_asyncpg_cursor._handle_exception at 0x0000022179513EC0>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A96ACE0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 514, in _handle_exception
    self._adapt_connection._handle_exception(error)
    │    │                                   └ DataError("invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,... (can't subtract offset-naive and ...
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A96ACE0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 801, in _handle_exception
    raise translated_error from error
          │                     └ DataError("invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,... (can't subtract offset-naive and ...
          └ Error("<class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,....

sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,... (can't subtract offset-naive and offset-aware datetimes)


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 188
               │     └ 3
               └ <function _main at 0x000002217422F4C0>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 188
           │    └ <function BaseProcess._bootstrap at 0x0000022174165080>
           └ <SpawnProcess name='SpawnProcess-1' parent=18028 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x00000221741645E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=18028 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x00000221741CE610>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=18028 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=18028 started>
    │    └ <function subprocess_started at 0x0000022176248540>
    └ <SpawnProcess name='SpawnProcess-1' parent=18028 started>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=824, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000022176393290>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=824, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x000002217622B740>
           │       │   └ <uvicorn.server.Server object at 0x0000022176393290>
           │       └ <function run at 0x0000022175FE36A0>
           └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x00000221763A08C0>
           │      └ <function Runner.run at 0x0000022175FE3B00>
           └ <asyncio.runners.Runner object at 0x0000022176393710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x0000022175FE1580>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x0000022176393710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000022175FE14E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000022175FE32E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000022175B4F2E0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
> File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002217639E7D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002217A...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000002217A11D150>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002217639E7D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\applications.py", line 289, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002217A...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002217A...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000002217A1DA9D0>
          └ <fastapi.applications.FastAPI object at 0x000002217A11D150>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000002217A870FE0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002217A1DA610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000002217A1DA9D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002217A9ACB80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x00000221799A2610>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002217A1DA610>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
          │    │   │      │    │      └ <traceback object at 0x000002217AAAC340>
          │    │   │      │    └ DBAPIError("(sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query ar...
          │    │   │      └ <class 'sqlalchemy.exc.DBAPIError'>
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object get_db at 0x000002217A9A2F80>
          └ <contextlib._AsyncGeneratorContextManager object at 0x000002217AA9D490>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\db\connection.py", line 28, in get_db
    yield session
          └ <sqlalchemy.orm.session.AsyncSession object at 0x000002217AA9E350>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002217A9ACB80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x000002217867CA90>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x00000221799A2610>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002217A9ACB80>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x00000221785D34C0>
          └ APIRoute(path='/ad/list', name='list_ads', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002217A9ACB80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x000002217A10BB00>
          └ APIRoute(path='/ad/list', name='list_ads', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x000002217AA9CED0>
                     └ <function get_request_handler.<locals>.app at 0x000002217938F100>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 273, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x00000221785D1940>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 190, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x000002217AA9E350>, 'query': AdListQuery(page=1, per_page=10, categori...
                 │         └ <function list_ads at 0x000002217A108AE0>
                 └ <fastapi.dependencies.models.Dependant object at 0x000002217A1B49D0>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\routes.py", line 25, in list_ads
    return await services.list_ads(query, db)
                 │        │        │      └ <sqlalchemy.orm.session.AsyncSession object at 0x000002217AA9E350>
                 │        │        └ AdListQuery(page=1, per_page=10, categories=[0], ad_type=0, sort='string', creation_time_interval=CreationTimeInterval(older_...
                 │        └ <function list_ads at 0x0000022179702520>
                 └ <module 'ad.services' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\ad\\services.py'>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\services.py", line 35, in list_ads
    ads = await queries.list_ads(filter_conditions, start, end, query.sort, db)
                │       │        │                  │      │    │     │     └ <sqlalchemy.orm.session.AsyncSession object at 0x000002217AA9E350>
                │       │        │                  │      │    │     └ 'string'
                │       │        │                  │      │    └ AdListQuery(page=1, per_page=10, categories=[0], ad_type=0, sort='string', creation_time_interval=CreationTimeInterval(older_...
                │       │        │                  │      └ 10
                │       │        │                  └ 0
                │       │        └ [<sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x00000221796B0360>, <sqlalchemy.sql.elements.BinaryExpression ob...
                │       └ <function list_ads at 0x000002217968AFC0>
                └ <module 'ad.queries' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\ad\\queries.py'>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\queries.py", line 31, in list_ads
    result = await db.execute(ads.slice(start, end))
                   │  │       │   │     │      └ 10
                   │  │       │   │     └ 0
                   │  │       │   └ <function GenerativeSelect.slice at 0x0000022178B32980>
                   │  │       └ <sqlalchemy.sql.selectable.Select object at 0x000002217A1307D0>
                   │  └ <function AsyncSession.execute at 0x0000022179007B00>
                   └ <sqlalchemy.orm.session.AsyncSession object at 0x000002217AA9E350>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 439, in execute
    result = await greenlet_spawn(
                   └ <function greenlet_spawn at 0x00000221787C6020>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             │       │      │   └ <built-in function exc_info>
             │       │      └ <module 'sys' (built-in)>
             │       └ <method 'throw' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x000002217AA9D080 (otid=0x0000022178731260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2246, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x0000022178F48900>
           └ <sqlalchemy.orm.session.Session object at 0x000002217AA9CFD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2141, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                   │      │                 └ <classmethod(<function AbstractORMCompileState.orm_execute_statement at 0x0000022178DF68E0>)>
                   │      └ <class 'sqlalchemy.orm.context.ORMSelectCompileState'>
                   └ typing.Any
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
             │    └ <function Connection.execute at 0x0000022178BC1D00>
             └ <sqlalchemy.engine.base.Connection object at 0x000002217AA9EFD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1412, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.selectable.Select object at 0x000002217AA9DF10>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x0000022178BC2020>
           └ <sqlalchemy.engine.base.Connection object at 0x000002217AA9EFD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x0000022178BC2200>
          └ <sqlalchemy.engine.base.Connection object at 0x000002217AA9EFD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1844, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x0000022178BC22A0>
           └ <sqlalchemy.engine.base.Connection object at 0x000002217AA9EFD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1984, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x0000022178BC2520>
    └ <sqlalchemy.engine.base.Connection object at 0x000002217AA9EFD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ Error("<class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,....
          │                    │              └ (<class 'sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error'>, Error("<class 'asyncpg.exceptions.DataError...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ DBAPIError("(sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query ar...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1965, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000022178C50AE0>
    │    └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x000002217A0EF850>
    └ <sqlalchemy.engine.base.Connection object at 0x000002217AA9EFD0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 921, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ (datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinfo=TzInfo(UTC)), datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinf...
    │      │       └ 'SELECT ad.id, ad.type_id, ad.title, ad.category_id, ad.content, ad.created_at, ad.is_published, ad.owner, ad.price \nFROM ad...
    │      └ <function AsyncAdapt_asyncpg_cursor.execute at 0x00000221795180E0>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A96ACE0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 584, in execute
    self._adapt_connection.await_(
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A96ACE0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x000002217A98D120>
           └ <_AsyncIoGreenlet object at 0x000002217AA9D080 (otid=0x0000022178731260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x000002217A98D120>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 563, in _prepare_and_execute
    self._handle_exception(error)
    │    └ <function AsyncAdapt_asyncpg_cursor._handle_exception at 0x0000022179513EC0>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A96ACE0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 514, in _handle_exception
    self._adapt_connection._handle_exception(error)
    │    │                                   └ DataError("invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,... (can't subtract offset-naive and ...
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A96ACE0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 801, in _handle_exception
    raise translated_error from error
          │                     └ DataError("invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,... (can't subtract offset-naive and ...
          └ Error("<class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,....

sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,... (can't subtract offset-naive and offset-aware datetimes)
[SQL: SELECT ad.id, ad.type_id, ad.title, ad.category_id, ad.content, ad.created_at, ad.is_published, ad.owner, ad.price 
FROM ad 
WHERE ad.is_published AND ad.category_id IN ($4::INTEGER) AND ad.created_at >= $1::TIMESTAMP WITHOUT TIME ZONE AND ad.created_at <= $2::TIMESTAMP WITHOUT TIME ZONE 
 LIMIT $3::INTEGER]
[parameters: (datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinfo=TzInfo(UTC)), datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinfo=TzInfo(UTC)), 10, 0)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
INFO     2023-07-26 06:38:22.095 request id: app - logging:callHandlers - 127.0.0.1:62451 - "POST /ad/list HTTP/1.1" 500
ERROR    2023-07-26 06:38:22.096 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "asyncpg\protocol\prepared_stmt.pyx", line 168, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
    codec.encode(self.settings, writer, arg)
  File "asyncpg\protocol\codecs/base.pyx", line 206, in asyncpg.protocol.protocol.Codec.encode
    return self.encoder(self, settings, buf, obj)
  File "asyncpg\protocol\codecs/base.pyx", line 111, in asyncpg.protocol.protocol.Codec.encode_scalar
    self.c_encoder(settings, buf, obj)
  File "asyncpg\pgproto\./codecs/datetime.pyx", line 152, in asyncpg.pgproto.pgproto.timestamp_encode
    delta = obj - pg_epoch_datetime
                  └ datetime.datetime(2000, 1, 1, 0, 0)

TypeError: can't subtract offset-naive and offset-aware datetimes


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 551, in _prepare_and_execute
    self._rows = await prepared_stmt.fetch(*parameters)
    │    │             │             │      └ (datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinfo=TzInfo(UTC)), datetime.datetime(2023, 6, 26, 0, 38, 2, 878000, tzinf...
    │    │             │             └ <function PreparedStatement.fetch at 0x00000221797AFF60>
    │    │             └ <asyncpg.prepared_stmt.PreparedStatement object at 0x000002217A39A070>
    │    └ <member '_rows' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A96AAA0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
                 │                   │        └ None
                 │                   └ (datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinfo=TzInfo(UTC)), datetime.datetime(2023, 6, 26, 0, 38, 2, 878000, tzinf...
                 └ <asyncpg.prepared_stmt.PreparedStatement object at 0x000002217A39A070>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 241, in __bind_execute
    data, status, _ = await self.__do_execute(
                            └ <asyncpg.prepared_stmt.PreparedStatement object at 0x000002217A39A070>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 230, in __do_execute
    return await executor(protocol)
                 │        └ <asyncpg.protocol.protocol.Protocol object at 0x000002217A255750>
                 └ <function PreparedStatement.__bind_execute.<locals>.<lambda> at 0x000002217A276A20>
  File "asyncpg\protocol\protocol.pyx", line 183, in bind_execute
    args_buf = state._encode_bind_msg(args)
  File "asyncpg\protocol\prepared_stmt.pyx", line 197, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
    raise exceptions.DataError(
          │          └ <class 'asyncpg.exceptions.DataError'>
          └ <module 'asyncpg.exceptions' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\s...

asyncpg.exceptions.DataError: invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,... (can't subtract offset-naive and offset-aware datetimes)


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1965, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000022178C50AE0>
    │    └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x000002217A0EF850>
    └ <sqlalchemy.engine.base.Connection object at 0x000002217A9299D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 921, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ (datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinfo=TzInfo(UTC)), datetime.datetime(2023, 6, 26, 0, 38, 2, 878000, tzinf...
    │      │       └ 'SELECT ad.id, ad.type_id, ad.title, ad.category_id, ad.content, ad.created_at, ad.is_published, ad.owner, ad.price \nFROM ad...
    │      └ <function AsyncAdapt_asyncpg_cursor.execute at 0x00000221795180E0>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A96AAA0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 584, in execute
    self._adapt_connection.await_(
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A96AAA0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x000002217A032680>
           └ <_AsyncIoGreenlet object at 0x000002217A92A840 (otid=0x0000022178731260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x000002217A032680>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 563, in _prepare_and_execute
    self._handle_exception(error)
    │    └ <function AsyncAdapt_asyncpg_cursor._handle_exception at 0x0000022179513EC0>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A96AAA0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 514, in _handle_exception
    self._adapt_connection._handle_exception(error)
    │    │                                   └ DataError("invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,... (can't subtract offset-naive and ...
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A96AAA0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 801, in _handle_exception
    raise translated_error from error
          │                     └ DataError("invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,... (can't subtract offset-naive and ...
          └ Error("<class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,....

sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,... (can't subtract offset-naive and offset-aware datetimes)


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 188
               │     └ 3
               └ <function _main at 0x000002217422F4C0>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 188
           │    └ <function BaseProcess._bootstrap at 0x0000022174165080>
           └ <SpawnProcess name='SpawnProcess-1' parent=18028 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x00000221741645E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=18028 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x00000221741CE610>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=18028 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=18028 started>
    │    └ <function subprocess_started at 0x0000022176248540>
    └ <SpawnProcess name='SpawnProcess-1' parent=18028 started>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=824, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000022176393290>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=824, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x000002217622B740>
           │       │   └ <uvicorn.server.Server object at 0x0000022176393290>
           │       └ <function run at 0x0000022175FE36A0>
           └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x00000221763A08C0>
           │      └ <function Runner.run at 0x0000022175FE3B00>
           └ <asyncio.runners.Runner object at 0x0000022176393710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x0000022175FE1580>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x0000022176393710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000022175FE14E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000022175FE32E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000022175B4F2E0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
> File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002217639E7D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002217A...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000002217A11D150>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002217639E7D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\applications.py", line 289, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002217A...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002217A...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000002217A1DA9D0>
          └ <fastapi.applications.FastAPI object at 0x000002217A11D150>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000002217A987880>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002217A1DA610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000002217A1DA9D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002217A870900>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x00000221799A2610>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002217A1DA610>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
          │    │   │      │    │      └ <traceback object at 0x000002217A1D8B40>
          │    │   │      │    └ DBAPIError("(sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query ar...
          │    │   │      └ <class 'sqlalchemy.exc.DBAPIError'>
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object get_db at 0x000002217A956F80>
          └ <contextlib._AsyncGeneratorContextManager object at 0x000002217A930210>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\db\connection.py", line 28, in get_db
    yield session
          └ <sqlalchemy.orm.session.AsyncSession object at 0x000002217A1B4090>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002217A870900>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x000002217867CA90>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x00000221799A2610>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002217A870900>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x00000221785D34C0>
          └ APIRoute(path='/ad/list', name='list_ads', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002217A870900>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x000002217A10BB00>
          └ APIRoute(path='/ad/list', name='list_ads', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x000002217A92FA90>
                     └ <function get_request_handler.<locals>.app at 0x000002217938F100>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 273, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x00000221785D1940>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 190, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x000002217A1B4090>, 'query': AdListQuery(page=1, per_page=10, categori...
                 │         └ <function list_ads at 0x000002217A108AE0>
                 └ <fastapi.dependencies.models.Dependant object at 0x000002217A1B49D0>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\routes.py", line 25, in list_ads
    return await services.list_ads(query, db)
                 │        │        │      └ <sqlalchemy.orm.session.AsyncSession object at 0x000002217A1B4090>
                 │        │        └ AdListQuery(page=1, per_page=10, categories=[0], ad_type=0, sort='string', creation_time_interval=CreationTimeInterval(older_...
                 │        └ <function list_ads at 0x0000022179702520>
                 └ <module 'ad.services' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\ad\\services.py'>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\services.py", line 35, in list_ads
    ads = await queries.list_ads(filter_conditions, start, end, query.sort, db)
                │       │        │                  │      │    │     │     └ <sqlalchemy.orm.session.AsyncSession object at 0x000002217A1B4090>
                │       │        │                  │      │    │     └ 'string'
                │       │        │                  │      │    └ AdListQuery(page=1, per_page=10, categories=[0], ad_type=0, sort='string', creation_time_interval=CreationTimeInterval(older_...
                │       │        │                  │      └ 10
                │       │        │                  └ 0
                │       │        └ [<sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x00000221796B0360>, <sqlalchemy.sql.elements.BinaryExpression ob...
                │       └ <function list_ads at 0x000002217968AFC0>
                └ <module 'ad.queries' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\ad\\queries.py'>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\queries.py", line 31, in list_ads
    result = await db.execute(ads.slice(start, end))
                   │  │       │   │     │      └ 10
                   │  │       │   │     └ 0
                   │  │       │   └ <function GenerativeSelect.slice at 0x0000022178B32980>
                   │  │       └ <sqlalchemy.sql.selectable.Select object at 0x000002217A92A0D0>
                   │  └ <function AsyncSession.execute at 0x0000022179007B00>
                   └ <sqlalchemy.orm.session.AsyncSession object at 0x000002217A1B4090>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 439, in execute
    result = await greenlet_spawn(
                   └ <function greenlet_spawn at 0x00000221787C6020>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             │       │      │   └ <built-in function exc_info>
             │       │      └ <module 'sys' (built-in)>
             │       └ <method 'throw' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x000002217A92A840 (otid=0x0000022178731260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2246, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x0000022178F48900>
           └ <sqlalchemy.orm.session.Session object at 0x000002217A1B6690>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2141, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                   │      │                 └ <classmethod(<function AbstractORMCompileState.orm_execute_statement at 0x0000022178DF68E0>)>
                   │      └ <class 'sqlalchemy.orm.context.ORMSelectCompileState'>
                   └ typing.Any
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
             │    └ <function Connection.execute at 0x0000022178BC1D00>
             └ <sqlalchemy.engine.base.Connection object at 0x000002217A9299D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1412, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.selectable.Select object at 0x000002217A929F10>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x0000022178BC2020>
           └ <sqlalchemy.engine.base.Connection object at 0x000002217A9299D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x0000022178BC2200>
          └ <sqlalchemy.engine.base.Connection object at 0x000002217A9299D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1844, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x0000022178BC22A0>
           └ <sqlalchemy.engine.base.Connection object at 0x000002217A9299D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1984, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x0000022178BC2520>
    └ <sqlalchemy.engine.base.Connection object at 0x000002217A9299D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ Error("<class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,....
          │                    │              └ (<class 'sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error'>, Error("<class 'asyncpg.exceptions.DataError...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ DBAPIError("(sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query ar...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1965, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000022178C50AE0>
    │    └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x000002217A0EF850>
    └ <sqlalchemy.engine.base.Connection object at 0x000002217A9299D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 921, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ (datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinfo=TzInfo(UTC)), datetime.datetime(2023, 6, 26, 0, 38, 2, 878000, tzinf...
    │      │       └ 'SELECT ad.id, ad.type_id, ad.title, ad.category_id, ad.content, ad.created_at, ad.is_published, ad.owner, ad.price \nFROM ad...
    │      └ <function AsyncAdapt_asyncpg_cursor.execute at 0x00000221795180E0>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A96AAA0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 584, in execute
    self._adapt_connection.await_(
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A96AAA0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x000002217A032680>
           └ <_AsyncIoGreenlet object at 0x000002217A92A840 (otid=0x0000022178731260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x000002217A032680>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 563, in _prepare_and_execute
    self._handle_exception(error)
    │    └ <function AsyncAdapt_asyncpg_cursor._handle_exception at 0x0000022179513EC0>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A96AAA0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 514, in _handle_exception
    self._adapt_connection._handle_exception(error)
    │    │                                   └ DataError("invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,... (can't subtract offset-naive and ...
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A96AAA0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 801, in _handle_exception
    raise translated_error from error
          │                     └ DataError("invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,... (can't subtract offset-naive and ...
          └ Error("<class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,....

sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,... (can't subtract offset-naive and offset-aware datetimes)
[SQL: SELECT ad.id, ad.type_id, ad.title, ad.category_id, ad.content, ad.created_at, ad.is_published, ad.owner, ad.price 
FROM ad 
WHERE ad.is_published AND ad.category_id IN ($4::INTEGER) AND ad.created_at >= $1::TIMESTAMP WITHOUT TIME ZONE AND ad.created_at <= $2::TIMESTAMP WITHOUT TIME ZONE 
 LIMIT $3::INTEGER]
[parameters: (datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinfo=TzInfo(UTC)), datetime.datetime(2023, 6, 26, 0, 38, 2, 878000, tzinfo=TzInfo(UTC)), 10, 0)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
ERROR    2023-07-26 06:38:22.134 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "asyncpg\protocol\prepared_stmt.pyx", line 168, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
    codec.encode(self.settings, writer, arg)
  File "asyncpg\protocol\codecs/base.pyx", line 206, in asyncpg.protocol.protocol.Codec.encode
    return self.encoder(self, settings, buf, obj)
  File "asyncpg\protocol\codecs/base.pyx", line 111, in asyncpg.protocol.protocol.Codec.encode_scalar
    self.c_encoder(settings, buf, obj)
  File "asyncpg\pgproto\./codecs/datetime.pyx", line 152, in asyncpg.pgproto.pgproto.timestamp_encode
    delta = obj - pg_epoch_datetime
                  └ datetime.datetime(2000, 1, 1, 0, 0)

TypeError: can't subtract offset-naive and offset-aware datetimes


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 551, in _prepare_and_execute
    self._rows = await prepared_stmt.fetch(*parameters)
    │    │             │             │      └ (datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinfo=TzInfo(UTC)), datetime.datetime(2023, 6, 26, 0, 38, 2, 878000, tzinf...
    │    │             │             └ <function PreparedStatement.fetch at 0x00000221797AFF60>
    │    │             └ <asyncpg.prepared_stmt.PreparedStatement object at 0x000002217A39A070>
    │    └ <member '_rows' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A96AAA0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
                 │                   │        └ None
                 │                   └ (datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinfo=TzInfo(UTC)), datetime.datetime(2023, 6, 26, 0, 38, 2, 878000, tzinf...
                 └ <asyncpg.prepared_stmt.PreparedStatement object at 0x000002217A39A070>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 241, in __bind_execute
    data, status, _ = await self.__do_execute(
                            └ <asyncpg.prepared_stmt.PreparedStatement object at 0x000002217A39A070>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 230, in __do_execute
    return await executor(protocol)
                 │        └ <asyncpg.protocol.protocol.Protocol object at 0x000002217A255750>
                 └ <function PreparedStatement.__bind_execute.<locals>.<lambda> at 0x000002217A276A20>
  File "asyncpg\protocol\protocol.pyx", line 183, in bind_execute
    args_buf = state._encode_bind_msg(args)
  File "asyncpg\protocol\prepared_stmt.pyx", line 197, in asyncpg.protocol.protocol.PreparedStatementState._encode_bind_msg
    raise exceptions.DataError(
          │          └ <class 'asyncpg.exceptions.DataError'>
          └ <module 'asyncpg.exceptions' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\venv\\Lib\\s...

asyncpg.exceptions.DataError: invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,... (can't subtract offset-naive and offset-aware datetimes)


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1965, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000022178C50AE0>
    │    └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x000002217A0EF850>
    └ <sqlalchemy.engine.base.Connection object at 0x000002217A9299D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 921, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ (datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinfo=TzInfo(UTC)), datetime.datetime(2023, 6, 26, 0, 38, 2, 878000, tzinf...
    │      │       └ 'SELECT ad.id, ad.type_id, ad.title, ad.category_id, ad.content, ad.created_at, ad.is_published, ad.owner, ad.price \nFROM ad...
    │      └ <function AsyncAdapt_asyncpg_cursor.execute at 0x00000221795180E0>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A96AAA0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 584, in execute
    self._adapt_connection.await_(
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A96AAA0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x000002217A032680>
           └ <_AsyncIoGreenlet object at 0x000002217A92A840 (otid=0x0000022178731260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x000002217A032680>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 563, in _prepare_and_execute
    self._handle_exception(error)
    │    └ <function AsyncAdapt_asyncpg_cursor._handle_exception at 0x0000022179513EC0>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A96AAA0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 514, in _handle_exception
    self._adapt_connection._handle_exception(error)
    │    │                                   └ DataError("invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,... (can't subtract offset-naive and ...
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A96AAA0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 801, in _handle_exception
    raise translated_error from error
          │                     └ DataError("invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,... (can't subtract offset-naive and ...
          └ Error("<class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,....

sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,... (can't subtract offset-naive and offset-aware datetimes)


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 188
               │     └ 3
               └ <function _main at 0x000002217422F4C0>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 188
           │    └ <function BaseProcess._bootstrap at 0x0000022174165080>
           └ <SpawnProcess name='SpawnProcess-1' parent=18028 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x00000221741645E0>
    └ <SpawnProcess name='SpawnProcess-1' parent=18028 started>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x00000221741CE610>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=18028 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=18028 started>
    │    └ <function subprocess_started at 0x0000022176248540>
    └ <SpawnProcess name='SpawnProcess-1' parent=18028 started>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=824, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000022176393290>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=824, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x000002217622B740>
           │       │   └ <uvicorn.server.Server object at 0x0000022176393290>
           │       └ <function run at 0x0000022175FE36A0>
           └ <module 'asyncio' from 'C:\\Users\\say1\\AppData\\Local\\Programs\\Python\\Python311\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x00000221763A08C0>
           │      └ <function Runner.run at 0x0000022175FE3B00>
           └ <asyncio.runners.Runner object at 0x0000022176393710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x0000022175FE1580>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x0000022176393710>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 637, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000022175FE14E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 604, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000022175FE32E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 1909, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000022175B4F2E0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>
> File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 435, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002217639E7D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002217A...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000002217A11D150>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002217639E7D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\applications.py", line 289, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002217A...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002217A...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000002217A1DA9D0>
          └ <fastapi.applications.FastAPI object at 0x000002217A11D150>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000002217A987880>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002217A1DA610>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000002217A1DA9D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002217A870900>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x00000221799A2610>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002217A1DA610>
  File "C:\Users\say1\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
          │    │   │      │    │      └ <traceback object at 0x000002217A1D8B40>
          │    │   │      │    └ DBAPIError("(sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query ar...
          │    │   │      └ <class 'sqlalchemy.exc.DBAPIError'>
          │    │   └ <method 'athrow' of 'async_generator' objects>
          │    └ <async_generator object get_db at 0x000002217A956F80>
          └ <contextlib._AsyncGeneratorContextManager object at 0x000002217A930210>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\db\connection.py", line 28, in get_db
    yield session
          └ <sqlalchemy.orm.session.AsyncSession object at 0x000002217A1B4090>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002217A870900>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x000002217867CA90>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x00000221799A2610>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002217A870900>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x00000221785D34C0>
          └ APIRoute(path='/ad/list', name='list_ads', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x000002217A870900>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x000002217A10BB00>
          └ APIRoute(path='/ad/list', name='list_ads', methods=['POST'])
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x000002217A92FA90>
                     └ <function get_request_handler.<locals>.app at 0x000002217938F100>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 273, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x00000221785D1940>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\fastapi\routing.py", line 190, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x000002217A1B4090>, 'query': AdListQuery(page=1, per_page=10, categori...
                 │         └ <function list_ads at 0x000002217A108AE0>
                 └ <fastapi.dependencies.models.Dependant object at 0x000002217A1B49D0>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\routes.py", line 25, in list_ads
    return await services.list_ads(query, db)
                 │        │        │      └ <sqlalchemy.orm.session.AsyncSession object at 0x000002217A1B4090>
                 │        │        └ AdListQuery(page=1, per_page=10, categories=[0], ad_type=0, sort='string', creation_time_interval=CreationTimeInterval(older_...
                 │        └ <function list_ads at 0x0000022179702520>
                 └ <module 'ad.services' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\ad\\services.py'>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\services.py", line 35, in list_ads
    ads = await queries.list_ads(filter_conditions, start, end, query.sort, db)
                │       │        │                  │      │    │     │     └ <sqlalchemy.orm.session.AsyncSession object at 0x000002217A1B4090>
                │       │        │                  │      │    │     └ 'string'
                │       │        │                  │      │    └ AdListQuery(page=1, per_page=10, categories=[0], ad_type=0, sort='string', creation_time_interval=CreationTimeInterval(older_...
                │       │        │                  │      └ 10
                │       │        │                  └ 0
                │       │        └ [<sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x00000221796B0360>, <sqlalchemy.sql.elements.BinaryExpression ob...
                │       └ <function list_ads at 0x000002217968AFC0>
                └ <module 'ad.queries' from 'D:\\Programming_projects\\Python\\Тестовые задания\\2023\\Surf IT\\test_task\\ad\\queries.py'>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\ad\queries.py", line 31, in list_ads
    result = await db.execute(ads.slice(start, end))
                   │  │       │   │     │      └ 10
                   │  │       │   │     └ 0
                   │  │       │   └ <function GenerativeSelect.slice at 0x0000022178B32980>
                   │  │       └ <sqlalchemy.sql.selectable.Select object at 0x000002217A92A0D0>
                   │  └ <function AsyncSession.execute at 0x0000022179007B00>
                   └ <sqlalchemy.orm.session.AsyncSession object at 0x000002217A1B4090>

  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 439, in execute
    result = await greenlet_spawn(
                   └ <function greenlet_spawn at 0x00000221787C6020>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             │       │      │   └ <built-in function exc_info>
             │       │      └ <module 'sys' (built-in)>
             │       └ <method 'throw' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x000002217A92A840 (otid=0x0000022178731260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2246, in execute
    return self._execute_internal(
           │    └ <function Session._execute_internal at 0x0000022178F48900>
           └ <sqlalchemy.orm.session.Session object at 0x000002217A1B6690>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2141, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                   │      │                 └ <classmethod(<function AbstractORMCompileState.orm_execute_statement at 0x0000022178DF68E0>)>
                   │      └ <class 'sqlalchemy.orm.context.ORMSelectCompileState'>
                   └ typing.Any
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
             │    └ <function Connection.execute at 0x0000022178BC1D00>
             └ <sqlalchemy.engine.base.Connection object at 0x000002217A9299D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1412, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.selectable.Select object at 0x000002217A929F10>>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x0000022178BC2020>
           └ <sqlalchemy.engine.base.Connection object at 0x000002217A9299D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x0000022178BC2200>
          └ <sqlalchemy.engine.base.Connection object at 0x000002217A9299D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1844, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x0000022178BC22A0>
           └ <sqlalchemy.engine.base.Connection object at 0x000002217A9299D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1984, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x0000022178BC2520>
    └ <sqlalchemy.engine.base.Connection object at 0x000002217A9299D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ Error("<class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,....
          │                    │              └ (<class 'sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error'>, Error("<class 'asyncpg.exceptions.DataError...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ DBAPIError("(sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query ar...
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1965, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x0000022178C50AE0>
    │    └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x000002217A0EF850>
    └ <sqlalchemy.engine.base.Connection object at 0x000002217A9299D0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 921, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ (datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinfo=TzInfo(UTC)), datetime.datetime(2023, 6, 26, 0, 38, 2, 878000, tzinf...
    │      │       └ 'SELECT ad.id, ad.type_id, ad.title, ad.category_id, ad.content, ad.created_at, ad.is_published, ad.owner, ad.price \nFROM ad...
    │      └ <function AsyncAdapt_asyncpg_cursor.execute at 0x00000221795180E0>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A96AAA0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 584, in execute
    self._adapt_connection.await_(
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A96AAA0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x000002217A032680>
           └ <_AsyncIoGreenlet object at 0x000002217A92A840 (otid=0x0000022178731260) dead>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x000002217A032680>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 563, in _prepare_and_execute
    self._handle_exception(error)
    │    └ <function AsyncAdapt_asyncpg_cursor._handle_exception at 0x0000022179513EC0>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A96AAA0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 514, in _handle_exception
    self._adapt_connection._handle_exception(error)
    │    │                                   └ DataError("invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,... (can't subtract offset-naive and ...
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x000002217A96AAA0>
  File "D:\Programming_projects\Python\Тестовые задания\2023\Surf IT\test_task\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 801, in _handle_exception
    raise translated_error from error
          │                     └ DataError("invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,... (can't subtract offset-naive and ...
          └ Error("<class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,....

sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: datetime.datetime(2023, 7, 26, 0, 38, 2,... (can't subtract offset-naive and offset-aware datetimes)
[SQL: SELECT ad.id, ad.type_id, ad.title, ad.category_id, ad.content, ad.created_at, ad.is_published, ad.owner, ad.price 
FROM ad 
WHERE ad.is_published AND ad.category_id IN ($4::INTEGER) AND ad.created_at >= $1::TIMESTAMP WITHOUT TIME ZONE AND ad.created_at <= $2::TIMESTAMP WITHOUT TIME ZONE 
 LIMIT $3::INTEGER]
[parameters: (datetime.datetime(2023, 7, 26, 0, 38, 2, 878000, tzinfo=TzInfo(UTC)), datetime.datetime(2023, 6, 26, 0, 38, 2, 878000, tzinfo=TzInfo(UTC)), 10, 0)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
INFO     2023-07-26 06:42:41.444 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 06:42:41.446 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 06:42:52.841 request id: app - logging:callHandlers - Started server process [19308]
INFO     2023-07-26 06:42:52.841 request id: app - logging:callHandlers - Started server process [19308]
INFO     2023-07-26 06:42:52.842 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 06:42:52.842 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 06:42:52.843 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 06:42:52.843 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 06:42:53.277 request id: app - logging:callHandlers - 127.0.0.1:62482 - "POST /ad/list HTTP/1.1" 200
INFO     2023-07-26 06:43:10.390 request id: app - logging:callHandlers - 127.0.0.1:62481 - "POST /ad/list HTTP/1.1" 200
INFO     2023-07-26 06:43:55.223 request id: app - logging:callHandlers - 127.0.0.1:62498 - "POST /ad/list HTTP/1.1" 200
INFO     2023-07-26 06:44:15.114 request id: app - logging:callHandlers - 127.0.0.1:62500 - "POST /ad/list HTTP/1.1" 200
INFO     2023-07-26 06:45:52.632 request id: app - logging:callHandlers - 127.0.0.1:62513 - "POST /ad/list HTTP/1.1" 200
INFO     2023-07-26 06:46:55.743 request id: app - logging:callHandlers - 127.0.0.1:62517 - "GET /ad/4/get/ HTTP/1.1" 200
CRITICAL 2023-07-26 06:47:10.006 request id: None - db.connection:get_db - DataBase Error: 
INFO     2023-07-26 06:47:10.009 request id: app - logging:callHandlers - 127.0.0.1:62559 - "GET /ad/complains/list/1/ HTTP/1.1" 404
INFO     2023-07-26 06:47:14.854 request id: app - logging:callHandlers - 127.0.0.1:62559 - "GET /ad/complains/list/3/ HTTP/1.1" 200
CRITICAL 2023-07-26 06:47:41.078 request id: None - db.connection:get_db - DataBase Error: [{'type': 'greater_than_equal', 'loc': ('body', 'score'), 'msg': 'Input should be greater than or equal to 1', 'input': 0, 'ctx': {'ge': 1}, 'url': 'https://errors.pydantic.dev/2.0.3/v/greater_than_equal'}]
INFO     2023-07-26 06:47:41.083 request id: app - logging:callHandlers - 127.0.0.1:62600 - "POST /ad/review/create/ HTTP/1.1" 422
INFO     2023-07-26 06:47:50.346 request id: app - logging:callHandlers - 127.0.0.1:62601 - "POST /ad/review/create/ HTTP/1.1" 200
INFO     2023-07-26 06:48:17.733 request id: app - logging:callHandlers - 127.0.0.1:62605 - "GET /docs HTTP/1.1" 200
INFO     2023-07-26 06:48:18.156 request id: app - logging:callHandlers - 127.0.0.1:62605 - "GET /openapi.json HTTP/1.1" 200
INFO     2023-07-26 06:48:33.685 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 06:48:33.685 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 06:48:33.794 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 06:48:33.794 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 06:48:33.795 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 06:48:33.796 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 06:48:33.796 request id: app - logging:callHandlers - Finished server process [19308]
INFO     2023-07-26 06:48:33.797 request id: app - logging:callHandlers - Finished server process [19308]
INFO     2023-07-26 06:48:53.869 request id: app - logging:callHandlers - Started server process [4248]
INFO     2023-07-26 06:48:53.869 request id: app - logging:callHandlers - Started server process [4248]
INFO     2023-07-26 06:48:53.870 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 06:48:53.870 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-07-26 06:48:53.871 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 06:48:53.871 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-07-26 06:48:56.633 request id: app - logging:callHandlers - 127.0.0.1:62622 - "POST /ad/review/create/ HTTP/1.1" 200
INFO     2023-07-26 06:49:06.006 request id: app - logging:callHandlers - 127.0.0.1:62624 - "GET /ad/3/review/list HTTP/1.1" 200
CRITICAL 2023-07-26 06:49:14.877 request id: None - db.connection:get_db - DataBase Error: 
INFO     2023-07-26 06:49:14.880 request id: app - logging:callHandlers - 127.0.0.1:62625 - "DELETE /ad/reviews/3 HTTP/1.1" 404
CRITICAL 2023-07-26 06:49:17.738 request id: None - db.connection:get_db - DataBase Error: 
INFO     2023-07-26 06:49:17.742 request id: app - logging:callHandlers - 127.0.0.1:62625 - "DELETE /ad/reviews/2 HTTP/1.1" 404
INFO     2023-07-26 06:49:20.462 request id: app - logging:callHandlers - 127.0.0.1:62625 - "DELETE /ad/reviews/1 HTTP/1.1" 200
INFO     2023-07-26 06:49:53.324 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 06:49:53.324 request id: app - logging:callHandlers - Shutting down
INFO     2023-07-26 06:49:53.434 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 06:49:53.434 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-07-26 06:49:53.435 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 06:49:53.436 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-07-26 06:49:53.437 request id: app - logging:callHandlers - Finished server process [4248]
INFO     2023-07-26 06:49:53.437 request id: app - logging:callHandlers - Finished server process [4248]
